<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª API - Ø¨Ø®Ø´ 3: Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .test {
            background: white;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .test:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .test.perf { border-left: 5px solid #9b59b6; }
        .test.concurrent { border-left: 5px solid #e74c3c; }
        .test.cache { border-left: 5px solid #2ecc71; }
        
        h3 {
            color: #2c3e50;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            color: white;
            margin-left: 10px;
        }
        
        .perf-badge { background: #9b59b6; }
        .concurrent-badge { background: #e74c3c; }
        .cache-badge { background: #2ecc71; }
        
        .test-description {
            color: #5d6d7e;
            margin: 15px 0;
            line-height: 1.6;
        }
        
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            font-size: 13px;
            direction: ltr;
            overflow-x: auto;
        }
        
        button {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(52, 152, 219, 0.3);
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .result {
            margin-top: 20px;
            padding: 18px;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success {
            background: linear-gradient(135deg, #d5f4e6 0%, #a3e4d7 100%);
            color: #27ae60;
            border: 2px solid #2ecc71;
            display: block;
        }
        
        .error {
            background: linear-gradient(135deg, #fadbd8 0%, #f5b7b1 100%);
            color: #c0392b;
            border: 2px solid #e74c3c;
            display: block;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            border-radius: 4px;
            transition: width 0.5s ease;
            width: 0%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .console {
            background: #1a252f;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #3498db;
        }
        
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .action-bar { flex-direction: column; }
            button { width: 100%; margin: 5px 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš¡ ØªØ³Øª API - Ø¨Ø®Ø´ 3: Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
        <div class="subtitle">PerformanceØŒ Concurrent RequestsØŒ Caching Ùˆ Retry Logic</div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Ø²Ù…Ø§Ù† Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§</div>
                <div class="stat-value" id="total-time">0ms</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®</div>
                <div class="stat-value" id="avg-response">0ms</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</div>
                <div class="stat-value" id="total-requests">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù…ÙˆÙÙ‚ÛŒØª</div>
                <div class="stat-value" id="success-rate">0%</div>
            </div>
        </div>
        
        <div class="test perf">
            <h3>ğŸ“Š ØªØ³Øª 1: Performance & Benchmark 
                <span class="test-badge perf-badge">PERFORMANCE</span>
            </h3>
            <div class="test-description">
                Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® Û±Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ØªÙˆØ§Ù„ÛŒ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ†
            </div>
            <div class="code-block">
// Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Û±Û° Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…ØªÙˆØ§Ù„ÛŒ<br>
for (let i = 0; i < 10; i++) {<br>
&nbsp;&nbsp;await api.get(`/data/${i}`);<br>
}<br>
// Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®
            </div>
            <button onclick="runPerformanceTest()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Performance</button>
            <div class="progress-bar">
                <div class="progress-fill" id="progress1"></div>
            </div>
            <div id="result1" class="result"></div>
        </div>
        
        <div class="test concurrent">
            <h3>ğŸŒ€ ØªØ³Øª 2: Concurrent Requests 
                <span class="test-badge concurrent-badge">CONCURRENT</span>
            </h3>
            <div class="test-description">
                Ûµ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Race Conditions
            </div>
            <div class="code-block">
// Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† Ûµ Ø¯Ø±Ø®ÙˆØ§Ø³Øª<br>
const promises = [];<br>
for (let i = 0; i < 5; i++) {<br>
&nbsp;&nbsp;promises.push(api.get(`/concurrent/${i}`));<br>
}<br>
// Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… PromiseÙ‡Ø§<br>
await Promise.all(promises);
            </div>
            <button onclick="runConcurrentTest()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Concurrent</button>
            <div id="result2" class="result"></div>
        </div>
        
        <div class="test cache">
            <h3>ğŸ’¾ ØªØ³Øª 3: Caching Strategy 
                <span class="test-badge cache-badge">CACHING</span>
            </h3>
            <div class="test-description">
                ØªØ³Øª Ú©Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ùˆ Ú©Ø§Ù‡Ø´ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®
            </div>
            <div class="code-block">
// Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´)<br>
const result1 = await api.get('/cached-data');<br>
// Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø¬Ø¯Ø¯ (Ø¨Ø§ÛŒØ¯ Ø§Ø² Ú©Ø´ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´ÙˆØ¯)<br>
const result2 = await api.get('/cached-data');<br>
// Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®
            </div>
            <button onclick="runCacheTest()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Caching</button>
            <div id="result3" class="result"></div>
        </div>
        
        <div class="test">
            <h3>ğŸ”„ ØªØ³Øª 4: Retry Logic & Exponential Backoff</h3>
            <div class="test-description">
                ØªØ³Øª ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨Ø§ Ø§ÙØ²Ø§ÛŒØ´ ØªØ¯Ø±ÛŒØ¬ÛŒ ÙØ§ØµÙ„Ù‡
            </div>
            <div class="code-block">
// Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ÛŒ Ù…ÙˆÙ‚Øª<br>
api.simulateTemporaryFailure = true;<br>
// Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ Û³ Ø¨Ø§Ø± ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯<br>
const result = await api.getWithRetry('/unstable-endpoint', 3);<br>
// Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§
            </div>
            <button onclick="runRetryTest()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Retry</button>
            <div id="result4" class="result"></div>
        </div>
        
        <div class="action-bar">
            <button onclick="runAllAdvancedTests()" style="background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);">
                ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
            </button>
            <button onclick="resetAdvancedTests()" style="background: linear-gradient(135deg, #7f8c8d 0%, #95a5a6 100%);">
                ğŸ”„ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
        </div>
        
        <div class="console">
            <div class="console-header">
                <span>ğŸ“Ÿ Ú©Ù†Ø³ÙˆÙ„ Ø§Ø¬Ø±Ø§</span>
                <button onclick="clearConsole()" style="padding: 5px 15px; font-size: 12px; background: #34495e;">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
            </div>
            <div id="console-output"></div>
        </div>
    </div>

    <script>
        // ========== Advanced Api Client ==========
        class AdvancedApiClient {
            constructor() {
                this.cache = new Map();
                this.requestHistory = [];
                this.totalRequests = 0;
                this.successfulRequests = 0;
                this.simulateTemporaryFailure = false;
                this.failureCount = 0;
            }
            
            async get(endpoint, useCache = true) {
                const startTime = Date.now();
                const requestId = ++this.totalRequests;
                
                this.log(`Ø¯Ø±Ø®ÙˆØ§Ø³Øª #${requestId}: GET ${endpoint}`);
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø´
                if (useCache && this.cache.has(endpoint)) {
                    const cached = this.cache.get(endpoint);
                    const time = Date.now() - startTime;
                    this.log(`Ø¯Ø±Ø®ÙˆØ§Ø³Øª #${requestId}: Ø§Ø² Ú©Ø´ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ø´Ø¯ (${time}ms)`);
                    return { ...cached, fromCache: true, responseTime: time };
                }
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ÛŒ Ù…ÙˆÙ‚Øª
                if (this.simulateTemporaryFailure && this.failureCount < 3) {
                    this.failureCount++;
                    const time = Date.now() - startTime;
                    this.requestHistory.push({ id: requestId, success: false, time });
                    throw new Error(`Ø®Ø·Ø§ÛŒ Ù…ÙˆÙ‚Øª Ø³Ø±ÙˆØ± (ØªÙ„Ø§Ø´ ${this.failureCount})`);
                }
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø®ÛŒØ± Ø´Ø¨Ú©Ù‡
                const delayTime = Math.random() * 300 + 200; // 200-500ms
                await this.delay(delayTime);
                
                const responseTime = Date.now() - startTime;
                
                // Ø³Ø§Ø®Øª Ù¾Ø§Ø³Ø®
                const response = {
                    success: true,
                    data: { 
                        endpoint, 
                        requestId,
                        timestamp: Date.now(),
                        message: 'Ø¯Ø§Ø¯Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯'
                    },
                    responseTime
                };
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ú©Ø´
                if (useCache) {
                    this.cache.set(endpoint, response);
                    this.log(`Ø¯Ø±Ø®ÙˆØ§Ø³Øª #${requestId}: Ø¯Ø± Ú©Ø´ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`);
                }
                
                // Ø«Ø¨Øª Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
                this.requestHistory.push({ 
                    id: requestId, 
                    success: true, 
                    time: responseTime,
                    endpoint 
                });
                this.successfulRequests++;
                
                this.log(`Ø¯Ø±Ø®ÙˆØ§Ø³Øª #${requestId}: Ù…ÙˆÙÙ‚ (${responseTime}ms)`);
                
                return response;
            }
            
            async getWithRetry(endpoint, maxRetries = 3) {
                for (let attempt = 1; attempt <= maxRetries; attempt++) {
                    try {
                        this.log(`ØªÙ„Ø§Ø´ ${attempt} Ø§Ø² ${maxRetries} Ø¨Ø±Ø§ÛŒ ${endpoint}`);
                        const result = await this.get(endpoint);
                        return { ...result, attempts: attempt };
                    } catch (error) {
                        if (attempt === maxRetries) {
                            throw error;
                        }
                        
                        // Exponential backoff: 300ms, 600ms, 1200ms, ...
                        const backoffTime = 300 * Math.pow(2, attempt - 1);
                        this.log(`Ø§Ù†ØªØ¸Ø§Ø± ${backoffTime}ms Ù‚Ø¨Ù„ Ø§Ø² ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯...`);
                        await this.delay(backoffTime);
                    }
                }
            }
            
            async getConcurrent(endpoints) {
                const startTime = Date.now();
                const promises = endpoints.map(endpoint => this.get(endpoint));
                
                try {
                    const results = await Promise.all(promises);
                    const totalTime = Date.now() - startTime;
                    
                    return {
                        success: true,
                        results,
                        totalTime,
                        requestCount: endpoints.length
                    };
                } catch (error) {
                    return {
                        success: false,
                        error: error.message,
                        totalTime: Date.now() - startTime
                    };
                }
            }
            
            getStats() {
                const totalTime = this.requestHistory.reduce((sum, req) => sum + req.time, 0);
                const avgTime = this.requestHistory.length > 0 
                    ? Math.round(totalTime / this.requestHistory.length) 
                    : 0;
                
                const successRate = this.totalRequests > 0
                    ? Math.round((this.successfulRequests / this.totalRequests) * 100)
                    : 0;
                
                return {
                    totalRequests: this.totalRequests,
                    successfulRequests: this.successfulRequests,
                    avgResponseTime: avgTime,
                    successRate,
                    cacheSize: this.cache.size
                };
            }
            
            resetStats() {
                this.requestHistory = [];
                this.totalRequests = 0;
                this.successfulRequests = 0;
                this.cache.clear();
                this.failureCount = 0;
                this.simulateTemporaryFailure = false;
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            log(message) {
                const time = new Date().toLocaleTimeString('fa-IR');
                const consoleOutput = document.getElementById('console-output');
                const logEntry = document.createElement('div');
                logEntry.style.padding = '5px 0';
                logEntry.style.borderBottom = '1px solid #2c3e50';
                logEntry.innerHTML = `<span style="color: #3498db">[${time}]</span> ${message}`;
                consoleOutput.appendChild(logEntry);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
                console.log(message);
            }
        }

        // ========== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú¯Ù„ÙˆØ¨Ø§Ù„ ==========
        const api = new AdvancedApiClient();
        let testResults = {};

        // ========== ØªØ³Øª 1: Performance ==========
        async function runPerformanceTest() {
            const btn = event.target;
            const resultDiv = document.getElementById('result1');
            const progressBar = document.getElementById('progress1');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Performance...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            progressBar.style.width = '0%';
            
            api.resetStats();
            
            try {
                const iterations = 10;
                const times = [];
                
                for (let i = 0; i < iterations; i++) {
                    const startTime = Date.now();
                    await api.get(`/performance-data/${i}`, false); // Ø¨Ø¯ÙˆÙ† Ú©Ø´
                    const time = Date.now() - startTime;
                    times.push(time);
                    
                    // Ø¢Ù¾Ø¯ÛŒØª progress bar
                    progressBar.style.width = `${((i + 1) / iterations) * 100}%`;
                    await api.delay(100);
                }
                
                const avgTime = Math.round(times.reduce((a, b) => a + b) / times.length);
                const maxTime = Math.max(...times);
                const minTime = Math.min(...times);
                
                const stats = api.getStats();
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>âœ… ØªØ³Øª Performance Ú©Ø§Ù…Ù„ Ø´Ø¯!</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§: ${iterations}<br>
                    â€¢ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù†: <strong>${avgTime}ms</strong><br>
                    â€¢ Ø³Ø±ÛŒØ¹â€ŒØªØ±ÛŒÙ†: ${minTime}ms<br>
                    â€¢ Ú©Ù†Ø¯ØªØ±ÛŒÙ†: ${maxTime}ms<br>
                    â€¢ Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª: ${stats.successRate}%<br><br>
                    <small>ØªØ³Øª Performance Ù…Ø¹ÛŒØ§Ø± Ø®ÙˆØ¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ù†Ø¬Ø´ Ú©Ø§Ø±Ø§ÛŒÛŒ API Ø§Ø³Øª.</small>
                `;
                
                testResults.performance = { avgTime, maxTime, minTime, success: true };
                updateGlobalStats();
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ ØªØ³Øª Performance Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}<br>
                    <small>Ù…Ø´Ú©Ù„ Ø¯Ø± Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</small>
                `;
                
                testResults.performance = { success: false, error: error.message };
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Performance';
        }

        // ========== ØªØ³Øª 2: Concurrent ==========
        async function runConcurrentTest() {
            const btn = event.target;
            const resultDiv = document.getElementById('result2');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Concurrent...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            
            try {
                const endpoints = [
                    '/concurrent/1',
                    '/concurrent/2',
                    '/concurrent/3',
                    '/concurrent/4',
                    '/concurrent/5'
                ];
                
                const startTime = Date.now();
                const result = await api.getConcurrent(endpoints);
                const totalTime = Date.now() - startTime;
                
                if (!result.success) {
                    throw new Error(result.error);
                }
                
                const responseTimes = result.results.map(r => r.responseTime);
                const avgConcurrentTime = Math.round(responseTimes.reduce((a, b) => a + b) / responseTimes.length);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>âœ… ØªØ³Øª Concurrent Ú©Ø§Ù…Ù„ Ø´Ø¯!</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†: ${endpoints.length}<br>
                    â€¢ Ø²Ù…Ø§Ù† Ú©Ù„ Ø§Ø¬Ø±Ø§: <strong>${totalTime}ms</strong><br>
                    â€¢ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ù‡Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª: ${avgConcurrentTime}ms<br>
                    â€¢ Ø³Ø±ÛŒØ¹â€ŒØªØ±ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª: ${Math.min(...responseTimes)}ms<br>
                    â€¢ Ú©Ù†Ø¯ØªØ±ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª: ${Math.max(...responseTimes)}ms<br><br>
                    <small>Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ø±Ø§ÛŒ Scalability Ø­ÛŒØ§ØªÛŒ Ø§Ø³Øª.</small>
                `;
                
                testResults.concurrent = { totalTime, avgConcurrentTime, success: true };
                updateGlobalStats();
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ ØªØ³Øª Concurrent Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}<br>
                    <small>Ù…Ø´Ú©Ù„ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†</small>
                `;
                
                testResults.concurrent = { success: false, error: error.message };
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Concurrent';
        }

        // ========== ØªØ³Øª 3: Caching ==========
        async function runCacheTest() {
            const btn = event.target;
            const resultDiv = document.getElementById('result3');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Caching...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            
            try {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú©Ø´
                api.cache.clear();
                
                // Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø¨Ø¯ÙˆÙ† Ú©Ø´)
                const startTime1 = Date.now();
                const result1 = await api.get('/cached-endpoint', true);
                const time1 = Date.now() - startTime1;
                
                // Ø¯ÙˆÙ…ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø¨Ø§ Ú©Ø´)
                const startTime2 = Date.now();
                const result2 = await api.get('/cached-endpoint', true);
                const time2 = Date.now() - startTime2;
                
                // Ø³ÙˆÙ…ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø¨Ø§ Ú©Ø´)
                const startTime3 = Date.now();
                const result3 = await api.get('/cached-endpoint', true);
                const time3 = Date.now() - startTime3;
                
                const improvement = Math.round(((time1 - time2) / time1) * 100);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>âœ… ØªØ³Øª Caching Ú©Ø§Ù…Ù„ Ø´Ø¯!</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ Ø§ÙˆÙ„ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø¨Ø¯ÙˆÙ† Ú©Ø´): <strong>${time1}ms</strong><br>
                    â€¢ Ø¯ÙˆÙ…ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø¨Ø§ Ú©Ø´): <strong>${time2}ms</strong><br>
                    â€¢ Ø³ÙˆÙ…ÛŒÙ† Ø¯Ø±Ø®ÙˆØ§Ø³Øª (Ø¨Ø§ Ú©Ø´): ${time3}ms<br>
                    â€¢ Ø¨Ù‡Ø¨ÙˆØ¯ Ø³Ø±Ø¹Øª: <strong>${improvement}%</strong><br>
                    â€¢ Ø§Ù†Ø¯Ø§Ø²Ù‡ Ú©Ø´: ${api.cache.size} Ø¢ÛŒØªÙ…<br><br>
                    <small>Caching Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªØ§ 90% Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® Ø±Ø§ Ú©Ø§Ù‡Ø´ Ø¯Ù‡Ø¯.</small>
                `;
                
                testResults.caching = { 
                    firstRequest: time1, 
                    secondRequest: time2, 
                    improvement, 
                    success: true 
                };
                updateGlobalStats();
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ ØªØ³Øª Caching Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}<br>
                    <small>Ù…Ø´Ú©Ù„ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ú©Ø´</small>
                `;
                
                testResults.caching = { success: false, error: error.message };
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Caching';
        }

        // ========== ØªØ³Øª 4: Retry Logic ==========
        async function runRetryTest() {
            const btn = event.target;
            const resultDiv = document.getElementById('result4');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Retry...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            
            try {
                // ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø®Ø·Ø§ÛŒ Ù…ÙˆÙ‚Øª
                api.simulateTemporaryFailure = true;
                api.failureCount = 0;
                
                const startTime = Date.now();
                const result = await api.getWithRetry('/unstable-endpoint', 3);
                const totalTime = Date.now() - startTime;
                
                // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø®Ø·Ø§ÛŒ Ù…ÙˆÙ‚Øª
                api.simulateTemporaryFailure = false;
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>âœ… ØªØ³Øª Retry Logic Ú©Ø§Ù…Ù„ Ø´Ø¯!</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ ØªØ¹Ø¯Ø§Ø¯ ØªÙ„Ø§Ø´â€ŒÙ‡Ø§: <strong>${result.attempts} Ø¨Ø§Ø±</strong><br>
                    â€¢ Ø²Ù…Ø§Ù† Ú©Ù„: ${totalTime}ms<br>
                    â€¢ ÙˆØ¶Ø¹ÛŒØª: ${result.success ? 'Ù…ÙˆÙÙ‚' : 'Ù†Ø§Ù…ÙˆÙÙ‚'}<br>
                    â€¢ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡: ${api.failureCount} Ø¨Ø§Ø±<br><br>
                    <small>Exponential Backoff Ø§Ø² overload Ø´Ø¯Ù† Ø³Ø±ÙˆØ± Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</small>
                `;
                
                testResults.retry = { attempts: result.attempts, totalTime, success: true };
                updateGlobalStats();
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ ØªØ³Øª Retry Logic Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}<br>
                    <small>Ø³ÛŒØ³ØªÙ… Retry Ù†ØªÙˆØ§Ù†Ø³Øª Ø®Ø·Ø§ Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ø¯</small>
                `;
                
                testResults.retry = { success: false, error: error.message };
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Retry';
        }

        // ========== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ==========
        async function runAllAdvancedTests() {
            api.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡...');
            
            // Ø±ÛŒØ³Øª Ù‡Ù…Ù‡
            testResults = {};
            resetAdvancedTests();
            
            // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ ÙˆÙ‚ÙÙ‡
            await simulateClick('runPerformanceTest()');
            await api.delay(1500);
            
            await simulateClick('runConcurrentTest()');
            await api.delay(1500);
            
            await simulateClick('runCacheTest()');
            await api.delay(1500);
            
            await simulateClick('runRetryTest()');
            
            api.log('ğŸ¯ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ú©Ø§Ù…Ù„ Ø´Ø¯Ù†Ø¯');
        }
        
        async function simulateClick(functionCall) {
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ùˆ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ù„ÛŒÚ©
            const buttons = document.querySelectorAll('button');
            for (const btn of buttons) {
                if (btn.getAttribute('onclick') === functionCall) {
                    const event = { target: btn };
                    if (functionCall.includes('Performance')) runPerformanceTest(event);
                    if (functionCall.includes('Concurrent')) runConcurrentTest(event);
                    if (functionCall.includes('Cache')) runCacheTest(event);
                    if (functionCall.includes('Retry')) runRetryTest(event);
                    break;
                }
            }
        }
        
        function resetAdvancedTests() {
            api.resetStats();
            
            // Ø±ÛŒØ³Øª progress bar
            document.getElementById('progress1').style.width = '0%';
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬
            for (let i = 1; i <= 4; i++) {
                const resultDiv = document.getElementById('result' + i);
                resultDiv.className = 'result';
                resultDiv.innerHTML = '';
            }
            
            // Ø±ÛŒØ³Øª Ø¢Ù…Ø§Ø±
            updateGlobalStats();
            
            api.log('â™»ï¸ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯');
        }
        
        function updateGlobalStats() {
            const stats = api.getStats();
            
            document.getElementById('total-requests').textContent = stats.totalRequests;
            document.getElementById('avg-response').textContent = `${stats.avgResponseTime}ms`;
            document.getElementById('success-rate').textContent = `${stats.successRate}%`;
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ú©Ù„
            const totalTime = api.requestHistory.reduce((sum, req) => sum + req.time, 0);
            document.getElementById('total-time').textContent = `${totalTime}ms`;
        }
        
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
            api.log('Ú©Ù†Ø³ÙˆÙ„ Ù¾Ø§Ú© Ø´Ø¯');
        }

        // ========== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ==========
        document.addEventListener('DOMContentLoaded', () => {
            api.log('âš¡ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ API Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§');
            updateGlobalStats();
        });
    </script>
</body>
</html>
