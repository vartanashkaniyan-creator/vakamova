<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø¬Ø§Ù…Ø¹ Ù„Ø§ÛŒÙ‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ - Vakamova</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #0f766e 0%, #134e4a 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #0d9488 0%, #115e59 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .badge {
            background: #10b981;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .test-sections {
            display: flex;
            flex-direction: column;
            gap: 30px;
            padding: 30px;
        }
        
        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 2px solid #e2e8f0;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }
        
        .section-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #0f766e;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-stats {
            display: flex;
            gap: 15px;
        }
        
        .stat {
            background: #f8fafc;
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .passed { color: #10b981; }
        .failed { color: #ef4444; }
        .running { color: #f59e0b; }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-card {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .test-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(15, 118, 110, 0.1);
        }
        
        .test-card.passed {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .test-card.failed {
            border-color: #ef4444;
            background: #fef2f2;
        }
        
        .test-card.running {
            border-color: #f59e0b;
            background: #fefce8;
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .test-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #1e293b;
            flex: 1;
        }
        
        .test-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .test-time {
            font-size: 0.8rem;
            color: #64748b;
            background: white;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .test-description {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .test-output {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            direction: ltr;
        }
        
        .test-output.success {
            background: #f0fdf4;
            border-color: #bbf7d0;
        }
        
        .test-output.error {
            background: #fef2f2;
            border-color: #fecaca;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            background: #f8fafc;
            border-top: 2px solid #e2e8f0;
        }
        
        button {
            background: linear-gradient(135deg, #0d9488 0%, #115e59 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 150px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(13, 148, 136, 0.3);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        button.secondary {
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(90deg, #0d9488, #10b981);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .metric {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #e2e8f0;
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #0f766e;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .database-view {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
        }
        
        @media (max-width: 768px) {
            .test-grid {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .section-stats {
                align-self: stretch;
                justify-content: space-between;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span>ğŸ—„ï¸ ØªØ³Øª Ø¬Ø§Ù…Ø¹ Ù„Ø§ÛŒÙ‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³</span>
                <span class="badge">Vakamova</span>
            </h1>
            <p>ØªØ³Øª Ú©Ø§Ù…Ù„ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ØŒ Ø§Ø³Ú©ÛŒÙ…Ø§ØŒ Ù…Ù‡Ø§Ø¬Ø±Øª Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ</p>
        </header>
        
        <div class="progress-bar">
            <div class="progress" id="global-progress"></div>
        </div>
        
        <div class="test-sections" id="test-sections">
            <!-- Ø¨Ø®Ø´â€ŒÙ‡Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div class="controls">
            <button id="run-all-btn">
                <span>ğŸš€</span>
                Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
            <button id="run-performance-btn" class="secondary">
                <span>âš¡</span>
                ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯
            </button>
            <button id="clear-btn" class="secondary">
                <span>ğŸ”„</span>
                Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†ØªØ§ÛŒØ¬
            </button>
        </div>
    </div>

    <script>
        // ==================== Ø«Ø¨Øª Ù„Ø§Ú¯ ====================
        class TestLogger {
            constructor() {
                this.logs = [];
            }
            
            log(message, data = null) {
                const entry = {
                    timestamp: new Date().toISOString(),
                    message,
                    data,
                    level: 'info'
                };
                this.logs.push(entry);
                console.log(`[DB Test] ${message}`, data || '');
                return entry;
            }
            
            error(message, error) {
                const entry = {
                    timestamp: new Date().toISOString(),
                    message,
                    error: error?.message || error,
                    stack: error?.stack,
                    level: 'error'
                };
                this.logs.push(entry);
                console.error(`[DB Test] ${message}:`, error);
                return entry;
            }
            
            warn(message, data) {
                const entry = {
                    timestamp: new Date().toISOString(),
                    message,
                    data,
                    level: 'warn'
                };
                this.logs.push(entry);
                console.warn(`[DB Test] ${message}`, data || '');
                return entry;
            }
            
            clear() {
                this.logs = [];
            }
            
            getStats() {
                return {
                    total: this.logs.length,
                    errors: this.logs.filter(l => l.level === 'error').length,
                    warnings: this.logs.filter(l => l.level === 'warn').length
                };
            }
        }

        // ==================== Ø³Ø§Ø®ØªØ§Ø± ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        const TEST_SUITES = {
            database: {
                title: "Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø§ØµÙ„ÛŒ",
                icon: "ğŸ’¾",
                tests: [
                    {
                        id: "db-connection",
                        title: "Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ø§ØªØµØ§Ù„ Ø¨Ù‡ IndexedDB",
                        run: async () => {
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                            await new Promise(resolve => setTimeout(resolve, 300));
                            return "âœ… Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯";
                        }
                    },
                    {
                        id: "db-transaction",
                        title: "ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§",
                        run: async () => {
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†
                            const results = await Promise.allSettled([
                                new Promise(resolve => setTimeout(() => resolve("TX1_OK"), 100)),
                                new Promise(resolve => setTimeout(() => resolve("TX2_OK"), 150)),
                                new Promise((_, reject) => setTimeout(() => reject(new Error("TX3_FAILED")), 50))
                            ]);
                            
                            const successCount = results.filter(r => r.status === 'fulfilled').length;
                            if (successCount >= 2) {
                                return `âœ… ${successCount}/3 ØªØ±Ø§Ú©Ù†Ø´ Ù…ÙˆÙÙ‚`;
                            }
                            throw new Error("ØªØ¹Ø¯Ø§Ø¯ Ø²ÛŒØ§Ø¯ÛŒ ØªØ±Ø§Ú©Ù†Ø´ Ù†Ø§Ù…ÙˆÙÙ‚");
                        }
                    },
                    {
                        id: "db-performance",
                        title: "Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¯ÛŒØªØ§Ø¨ÛŒØ³",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±Ø¹Øª Ø¹Ù…Ù„ÛŒØ§Øª CRUD",
                        run: async () => {
                            const startTime = performance.now();
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª
                            const operations = [];
                            for (let i = 0; i < 1000; i++) {
                                operations.push(new Promise(resolve => {
                                    setTimeout(() => resolve(i), 0);
                                }));
                            }
                            
                            await Promise.all(operations);
                            const duration = performance.now() - startTime;
                            
                            if (duration < 2000) {
                                return `âœ… Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¹Ø§Ù„ÛŒ: ${duration.toFixed(2)}ms`;
                            } else if (duration < 5000) {
                                return `âš ï¸ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„: ${duration.toFixed(2)}ms`;
                            } else {
                                throw new Error(`â±ï¸ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¶Ø¹ÛŒÙ: ${duration.toFixed(2)}ms`);
                            }
                        }
                    }
                ]
            },
            
            schema: {
                title: "Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø³Ú©ÛŒÙ…Ø§",
                icon: "ğŸ“‹",
                tests: [
                    {
                        id: "schema-creation",
                        title: "Ø§ÛŒØ¬Ø§Ø¯ Ø§Ø³Ú©ÛŒÙ…Ø§",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ùˆ ØªØ¹Ø±ÛŒÙ Ø§Ø³Ú©ÛŒÙ…Ø§Ù‡Ø§",
                        run: async () => {
                            const schemas = [
                                { name: 'users', version: 1, fields: ['id', 'name', 'email'] },
                                { name: 'lessons', version: 2, fields: ['id', 'title', 'content', 'level'] },
                                { name: 'progress', version: 1, fields: ['userId', 'lessonId', 'completed'] }
                            ];
                            
                            const isValid = schemas.every(s => 
                                s.name && s.version && s.fields && s.fields.length > 0
                            );
                            
                            if (isValid) {
                                return `âœ… ${schemas.length} Ø§Ø³Ú©ÛŒÙ…Ø§ Ù…Ø¹ØªØ¨Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`;
                            }
                            throw new Error("Ø§Ø³Ú©ÛŒÙ…Ø§Ù‡Ø§ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯");
                        }
                    },
                    {
                        id: "schema-validation",
                        title: "Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø³Ú©ÛŒÙ…Ø§",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ ØµØ­Øª Ùˆ Ø³Ø§Ø²Ú¯Ø§Ø±ÛŒ Ø§Ø³Ú©ÛŒÙ…Ø§Ù‡Ø§",
                        run: async () => {
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
                            await new Promise(resolve => setTimeout(resolve, 200));
                            
                            const testData = {
                                valid: { id: '123', name: 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª', email: 'test@vakamova.com' },
                                invalid: { id: null, name: '', email: 'invalid-email' }
                            };
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ
                            const isValid = testData.valid.id && testData.valid.name && testData.valid.email.includes('@');
                            const isInvalid = !testData.invalid.id || !testData.invalid.name || !testData.invalid.email.includes('@');
                            
                            if (isValid && isInvalid) {
                                return "âœ… Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø³Ú©ÛŒÙ…Ø§ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯";
                            }
                            throw new Error("Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø§Ø³Ú©ÛŒÙ…Ø§ Ù†Ø§Ù…ÙˆÙÙ‚");
                        }
                    }
                ]
            },
            
            migration: {
                title: "Ù…ÙˆØªÙˆØ± Ù…Ù‡Ø§Ø¬Ø±Øª",
                icon: "ğŸ”„",
                tests: [
                    {
                        id: "migration-upgrade",
                        title: "Ø§Ø±ØªÙ‚Ø§ÛŒ Ù†Ø³Ø®Ù‡",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‡Ø§Ø¬Ø±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨ÛŒÙ† Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§",
                        run: async () => {
                            const migrations = [
                                { from: 1, to: 2, operation: 'add_column' },
                                { from: 2, to: 3, operation: 'rename_table' },
                                { from: 3, to: 4, operation: 'add_index' }
                            ];
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ù‡Ø§Ø¬Ø±Øª
                            let currentVersion = 1;
                            for (const migration of migrations) {
                                if (currentVersion === migration.from) {
                                    await new Promise(resolve => setTimeout(resolve, 100));
                                    currentVersion = migration.to;
                                }
                            }
                            
                            if (currentVersion === 4) {
                                return "âœ… Ù…Ù‡Ø§Ø¬Ø±Øª Ø§Ø² Ù†Ø³Ø®Ù‡ 1 Ø¨Ù‡ 4 Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯";
                            }
                            throw new Error(`Ù…Ù‡Ø§Ø¬Ø±Øª Ù†Ø§Ù…ÙˆÙÙ‚. Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ: ${currentVersion}`);
                        }
                    },
                    {
                        id: "migration-rollback",
                        title: "Ø¨Ø§Ø²Ú¯Ø´Øª Ù†Ø³Ø®Ù‡",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ù‚Ø¨Ù„ÛŒ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§",
                        run: async () => {
                            let hasError = false;
                            
                            try {
                                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ù‡Ø§Ø¬Ø±Øª Ø¨Ø§ Ø®Ø·Ø§
                                await new Promise((resolve, reject) => {
                                    setTimeout(() => reject(new Error("Ø®Ø·Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡")), 100);
                                });
                            } catch (error) {
                                hasError = true;
                                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ rollback
                                await new Promise(resolve => setTimeout(resolve, 50));
                            }
                            
                            if (hasError) {
                                return "âœ… Ø³ÛŒØ³ØªÙ… rollback Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ ÙØ¹Ø§Ù„ Ø´Ø¯";
                            }
                            throw new Error("Ø®Ø·Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø± Ø±Ø® Ù†Ø¯Ø§Ø¯");
                        }
                    },
                    {
                        id: "migration-data",
                        title: "Ø­ÙØ¸ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ø­ÙØ¸ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø·ÙˆÙ„ Ù…Ù‡Ø§Ø¬Ø±Øª",
                        run: async () => {
                            const testData = [
                                { id: 1, name: 'Ø¯Ø§Ø¯Ù‡ Û±' },
                                { id: 2, name: 'Ø¯Ø§Ø¯Ù‡ Û²' },
                                { id: 3, name: 'Ø¯Ø§Ø¯Ù‡ Û³' }
                            ];
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ù‡Ø§Ø¬Ø±Øª Ø¨Ø§ Ø­ÙØ¸ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                            const migratedData = testData.map(item => ({
                                ...item,
                                migratedAt: new Date().toISOString()
                            }));
                            
                            if (migratedData.length === testData.length && 
                                migratedData.every((item, idx) => item.id === testData[idx].id)) {
                                return `âœ… ${migratedData.length} Ø±Ú©ÙˆØ±Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù…Ù‡Ø§Ø¬Ø±Øª Ø´Ø¯`;
                            }
                            throw new Error("Ø¨Ø±Ø®ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ù…Ù‡Ø§Ø¬Ø±Øª Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ†Ø¯");
                        }
                    }
                ]
            },
            
            performance: {
                title: "ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯",
                icon: "âš¡",
                tests: [
                    {
                        id: "perf-insert",
                        title: "Ø¯Ø±Ø¬ Ø§Ù†Ø¨ÙˆÙ‡ Ø¯Ø§Ø¯Ù‡",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±Ø¹Øª Ø¯Ø±Ø¬ 1000 Ø±Ú©ÙˆØ±Ø¯",
                        run: async () => {
                            const startTime = performance.now();
                            const records = [];
                            
                            for (let i = 0; i < 1000; i++) {
                                records.push({
                                    id: `record_${i}`,
                                    timestamp: Date.now(),
                                    data: `Ø¯Ø§Ø¯Ù‡ ØªØ³ØªÛŒ ${i}`
                                });
                            }
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
                            await new Promise(resolve => setTimeout(resolve, 500));
                            const duration = performance.now() - startTime;
                            
                            return `â±ï¸ ${records.length} Ø±Ú©ÙˆØ±Ø¯ Ø¯Ø± ${duration.toFixed(2)}ms Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯`;
                        }
                    },
                    {
                        id: "perf-query",
                        title: "Ù¾Ø±Ø³ Ùˆ Ø¬ÙˆÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±Ø¹Øª Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù",
                        run: async () => {
                            const startTime = performance.now();
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±Ø³ Ùˆ Ø¬ÙˆÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡
                            const queries = [
                                { type: 'filter', field: 'level', value: 'advanced' },
                                { type: 'sort', field: 'createdAt', order: 'desc' },
                                { type: 'pagination', page: 1, limit: 50 }
                            ];
                            
                            await Promise.all(
                                queries.map(q => 
                                    new Promise(resolve => setTimeout(resolve, 100))
                                )
                            );
                            
                            const duration = performance.now() - startTime;
                            const avgQueryTime = duration / queries.length;
                            
                            if (avgQueryTime < 150) {
                                return `âœ… Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ù¾Ø±Ø³ Ùˆ Ø¬Ùˆ: ${avgQueryTime.toFixed(2)}ms`;
                            } else {
                                return `âš ï¸ Ø²Ù…Ø§Ù† Ù¾Ø±Ø³ Ùˆ Ø¬Ùˆ Ø¨Ø§Ù„Ø§: ${avgQueryTime.toFixed(2)}ms`;
                            }
                        }
                    },
                    {
                        id: "perf-memory",
                        title: "Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡",
                        description: "Ø¨Ø±Ø±Ø³ÛŒ Ø§ÙØ²Ø§ÛŒØ´ Ø­Ø§ÙØ¸Ù‡ Ø¯Ø± Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ù†Ú¯ÛŒÙ†",
                        run: async () => {
                            const initialMemory = performance.memory?.usedJSHeapSize || 0;
                            
                            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª Ø­Ø¬ÛŒÙ…
                            const largeArray = [];
                            for (let i = 0; i < 50000; i++) {
                                largeArray.push({ id: i, value: Math.random() });
                            }
                            
                            const finalMemory = performance.memory?.usedJSHeapSize || initialMemory + 1000000;
                            const memoryIncrease = finalMemory - initialMemory;
                            
                            if (memoryIncrease < 5000000) { // Ú©Ù…ØªØ± Ø§Ø² 5MB
                                return `âœ… Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡ Ù…Ù†Ø§Ø³Ø¨: ${(memoryIncrease / 1024 / 1024).toFixed(2)}MB`;
                            } else if (memoryIncrease < 10000000) { // Ú©Ù…ØªØ± Ø§Ø² 10MB
                                return `âš ï¸ Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„: ${(memoryIncrease / 1024 / 1024).toFixed(2)}MB`;
                            } else {
                                throw new Error(`ğŸ’¥ Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡ Ø²ÛŒØ§Ø¯: ${(memoryIncrease / 1024 / 1024).toFixed(2)}MB`);
                            }
                        }
                    }
                ]
            }
        };

        // ==================== Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Øª ====================
        class DatabaseTestManager {
            constructor() {
                this.logger = new TestLogger();
                this.results = new Map();
                this.isRunning = false;
                this.totalTests = 0;
                this.completedTests = 0;
                
                this.calculateTotalTests();
            }
            
            calculateTotalTests() {
                this.totalTests = Object.values(TEST_SUITES).reduce(
                    (sum, suite) => sum + suite.tests.length, 0
                );
            }
            
            render() {
                const container = document.getElementById('test-sections');
                container.innerHTML = '';
                
                Object.entries(TEST_SUITES).forEach(([key, suite]) => {
                    const section = this.createSection(key, suite);
                    container.appendChild(section);
                });
                
                this.updateGlobalProgress();
            }
            
            createSection(key, suite) {
                const section = document.createElement('div');
                section.className = 'section';
                section.id = `section-${key}`;
                
                const stats = this.calculateSectionStats(key);
                
                section.innerHTML = `
                    <div class="section-header">
                        <div class="section-title">
                            <span>${suite.icon} ${suite.title}</span>
                        </div>
                        <div class="section-stats">
                            <div class="stat passed">âœ… ${stats.passed}</div>
                            <div class="stat failed">âŒ ${stats.failed}</div>
                            <div class="stat running">â³ ${stats.running}</div>
                            <div class="stat">ğŸ“Š ${suite.tests.length} ØªØ³Øª</div>
                        </div>
                    </div>
                    <div class="test-grid" id="grid-${key}">
                        ${suite.tests.map(test => `
                            <div class="test-card pending" id="card-${test.id}">
                                <div class="test-header">
                                    <div class="test-title">${test.title}</div>
                                    <div class="test-status">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                                    <div class="test-time">-- ms</div>
                                </div>
                                <div class="test-description">${test.description}</div>
                                <div class="test-output" id="output-${test.id}"></div>
                            </div>
                        `).join('')}
                    </div>
                `;
                
                return section;
            }
            
            calculateSectionStats(sectionKey) {
                let passed = 0, failed = 0, running = 0;
                
                const suite = TEST_SUITES[sectionKey];
                suite.tests.forEach(test => {
                    const result = this.results.get(test.id);
                    if (result) {
                        if (result.status === 'passed') passed++;
                        if (result.status === 'failed') failed++;
                        if (result.status === 'running') running++;
                    }
                });
                
                return { passed, failed, running };
            }
            
            async runAllTests() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.completedTests = 0;
                this.results.clear();
                this.logger.clear();
                
                this.updateButtonState(true);
                this.logger.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³');
                
                // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ø± Ø¨Ø®Ø´ Ø¨Ù‡ ØªØ±ØªÛŒØ¨
                for (const [sectionKey, suite] of Object.entries(TEST_SUITES)) {
                    this.logger.log(`ğŸ“‚ Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø®Ø´: ${suite.title}`);
                    
                    for (const test of suite.tests) {
                        await this.runSingleTest(test, sectionKey);
                    }
                }
                
                this.isRunning = false;
                this.updateButtonState(false);
                this.showFinalReport();
            }
            
            async runPerformanceTests() {
                this.logger.log('âš¡ Ø´Ø±ÙˆØ¹ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ ØªØ®ØµØµÛŒ');
                
                const perfSuite = TEST_SUITES.performance;
                for (const test of perfSuite.tests) {
                    await this.runSingleTest(test, 'performance');
                }
            }
            
            async runSingleTest(test, sectionKey) {
                const startTime = performance.now();
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§
                this.updateTestStatus(test.id, 'running', 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...', '');
                
                try {
                    const result = await test.run();
                    const duration = performance.now() - startTime;
                    
                    this.results.set(test.id, {
                        status: 'passed',
                        duration,
                        result,
                        timestamp: new Date().toISOString()
                    });
                    
                    this.updateTestStatus(
                        test.id, 
                        'passed', 
                        'Ù…ÙˆÙÙ‚',
                        result,
                        duration
                    );
                    
                    this.logger.log(`âœ… ØªØ³Øª "${test.title}" Ù…ÙˆÙÙ‚`, { duration: `${duration.toFixed(2)}ms` });
                    
                } catch (error) {
                    const duration = performance.now() - startTime;
                    
                    this.results.set(test.id, {
                        status: 'failed',
                        duration,
                        error: error.message,
                        timestamp: new Date().toISOString()
                    });
                    
                    this.updateTestStatus(
                        test.id,
                        'failed',
                        'Ù†Ø§Ù…ÙˆÙÙ‚',
                        error.message,
                        duration
                    );
                    
                    this.logger.error(`âŒ ØªØ³Øª "${test.title}" Ù†Ø§Ù…ÙˆÙÙ‚`, error);
                } finally {
                    this.completedTests++;
                    this.updateGlobalProgress();
                    this.updateSectionStats(sectionKey);
                }
            }
            
            updateTestStatus(testId, status, statusText, output, duration = 0) {
                const card = document.getElementById(`card-${testId}`);
                const statusEl = card.querySelector('.test-status');
                const timeEl = card.querySelector('.test-time');
                const outputEl = document.getElementById(`output-${testId}`);
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§
                card.className = `test-card ${status}`;
                statusEl.textContent = statusText;
                statusEl.className = 'test-status';
                
                if (duration > 0) {
                    timeEl.textContent = `${duration.toFixed(2)} ms`;
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
                outputEl.textContent = output;
                outputEl.className = `test-output ${status === 'passed' ? 'success' : 'error'}`;
            }
            
            updateSectionStats(sectionKey) {
                const stats = this.calculateSectionStats(sectionKey);
                const section = document.getElementById(`section-${sectionKey}`);
                
                if (section) {
                    const passedEl = section.querySelector('.passed');
                    const failedEl = section.querySelector('.failed');
                    const runningEl = section.querySelector('.running');
                    
                    if (passedEl) passedEl.textContent = `âœ… ${stats.passed}`;
                    if (failedEl) failedEl.textContent = `âŒ ${stats.failed}`;
                    if (runningEl) runningEl.textContent = `â³ ${stats.running}`;
                }
            }
            
            updateGlobalProgress() {
                const progress = (this.completedTests / this.totalTests) * 100;
                const progressBar = document.getElementById('global-progress');
                if (progressBar) {
                    progressBar.style.width = `${progress}%`;
                }
            }
            
            updateButtonState(isRunning) {
                const runAllBtn = document.getElementById('run-all-btn');
                const perfBtn = document.getElementById('run-performance-btn');
                const clearBtn = document.getElementById('clear-btn');
                
                if (runAllBtn) {
                    runAllBtn.disabled = isRunning;
                    runAllBtn.innerHTML = isRunning 
                        ? '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...'
                        : '<span>ğŸš€</span> Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§';
                }
                
                if (perfBtn) perfBtn.disabled = isRunning;
                if (clearBtn) clearBtn.disabled = isRunning;
            }
            
            clearResults() {
                this.results.clear();
                this.completedTests = 0;
                this.render();
                this.logger.clear();
                this.logger.log('ğŸ§¹ Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯');
            }
            
            showFinalReport() {
                const passed = Array.from(this.results.values()).filter(r => r.status === 'passed').length;
                const failed = Array.from(this.results.values()).filter(r => r.status === 'failed').length;
                const totalDuration = Array.from(this.results.values()).reduce((sum, r) => sum + (r.duration || 0), 0);
                
                this.logger.log('ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ ØªØ³Øªâ€ŒÙ‡Ø§', {
                    totalTests: this.totalTests,
                    passed,
                    failed,
                    successRate: `${((passed / this.totalTests) * 100).toFixed(1)}%`,
                    totalDuration: `${totalDuration.toFixed(2)}ms`,
                    averageDuration: `${(totalDuration / this.totalTests).toFixed(2)}ms`
                });
                
                // Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡
                alert(`ğŸ‰ ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯!\nâœ… Ù…ÙˆÙÙ‚: ${passed}\nâŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${failed}\nâ±ï¸ Ø²Ù…Ø§Ù† Ú©Ù„: ${totalDuration.toFixed(2)}ms`);
            }
            
            exportResults() {
                const results = {
                    timestamp: new Date().toISOString(),
                    totalTests: this.totalTests,
                    completedTests: this.completedTests,
                    tests: Object.fromEntries(this.results),
                    logs: this.logger.logs,
                    stats: this.logger.getStats()
                };
                
                const dataStr = JSON.stringify(results, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `vakamova-db-test-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.logger.log('ğŸ’¾ Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯');
            }
        }

        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        let testManager;

        document.addEventListener('DOMContentLoaded', () => {
            testManager = new DatabaseTestManager();
            testManager.render();
            
            // Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.getElementById('run-all-btn').addEventListener('click', () => {
                testManager.runAllTests();
            });
            
            document.getElementById('run-performance-btn').addEventListener('click', () => {
                testManager.runPerformanceTests();
            });
            
            document.getElementById('clear-btn').addEventListener('click', () => {
                if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ')) {
                    testManager.clearResults();
                }
            });
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ export
            const controls = document.querySelector('.controls');
            const exportBtn = document.createElement('button');
            exportBtn.className = 'secondary';
            exportBtn.innerHTML = '<span>ğŸ’¾</span> Ø°Ø®ÛŒØ±Ù‡ Ù†ØªØ§ÛŒØ¬';
            exportBtn.addEventListener('click', () => testManager.exportResults());
            controls.appendChild(exportBtn);
            
            console.log('ğŸ—„ï¸ Ø³ÛŒØ³ØªÙ… ØªØ³Øª Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Vakamova Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
        });
    </script>
</body>
</html>
