<!DOCTYPE html>
<html dir="rtl">
<head>
    <title>ØªØ³Øª Ù…Ø§Ú˜ÙˆÙ„ Core</title>
    <style>
        body { font-family: Tahoma; margin: 20px; }
        button { padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; margin: 5px; }
        .result { padding: 10px; margin: 5px 0; border-right: 4px solid; }
        .success { background: #E8F5E9; border-color: #4CAF50; }
        .error { background: #FFEBEE; border-color: #F44336; }
    </style>
</head>
<body>
    <h2>âš™ï¸ ØªØ³Øª Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Core</h2>
    <button onclick="testStateManager()">ØªØ³Øª State Manager</button>
    <button onclick="testEventBus()">ØªØ³Øª Event Bus</button>
    <button onclick="testAll()">ØªØ³Øª Ú©Ø§Ù…Ù„ Core</button>
    <div id="results"></div>

    <!-- ÙÙ‚Ø· ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ core -->
    <script src="core/utils.js"></script>
    <script src="core/event_bus.js"></script>
    <script src="core/state_manager.js"></script>
    <script src="core/db.js"></script>
    <script src="core/router.js"></script>

    <script>
        const results = document.getElementById('results');
        
        function showResult(module, message, isSuccess) {
            const div = document.createElement('div');
            div.className = `result ${isSuccess ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${module}:</strong> ${message}`;
            results.appendChild(div);
        }

        function testStateManager() {
            results.innerHTML = '<h3>ğŸ§  ØªØ³Øª State Manager</h3>';
            try {
                // Ø§ÙˆÙ„ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù† Ú©Ø¯Ø§Ù… Ù†Ø§Ù… Ù…ØªØºÛŒØ± global ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                const stateManagerObj = window.state_manager || window.stateManager;
                
                if (!stateManagerObj) {
                    showResult('state_manager', 'âŒ ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ù†Ø´Ø¯ - Ù‡ÛŒÚ† Ù…ØªØºÛŒØ± state_manager ÛŒØ§ stateManager ÛŒØ§ÙØª Ù†Ø´Ø¯', false);
                    return;
                }
                
                showResult('state_manager', 'âœ… ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ø´Ø¯', true);
                
                // ØªØ³Øª Ø¹Ù…Ù„ÛŒØ§ØªÛŒ
                if (typeof stateManagerObj.setState !== 'function') {
                    showResult('state_manager', 'âŒ ØªØ§Ø¨Ø¹ setState ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', false);
                    return;
                }
                
                if (typeof stateManagerObj.getState !== 'function') {
                    showResult('state_manager', 'âŒ ØªØ§Ø¨Ø¹ getState ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', false);
                    return;
                }
                
                stateManagerObj.setState('testKey', 'testValue');
                const retrieved = stateManagerObj.getState('testKey');
                
                if (retrieved === 'testValue') {
                    showResult('state_manager', 'âœ… Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÙˆÙÙ‚', true);
                } else {
                    showResult('state_manager', `âŒ Ù…Ù‚Ø¯Ø§Ø± Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø´Ø¯Ù‡: ${retrieved}`, false);
                }
                
            } catch (error) {
                showResult('state_manager', `âŒ Ø®Ø·Ø§: ${error.message}`, false);
            }
        }

        function testEventBus() {
            results.innerHTML = '<h3>ğŸ“¡ ØªØ³Øª Event Bus</h3>';
            try {
                // Ø§ÙˆÙ„ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù† Ú©Ø¯Ø§Ù… Ù†Ø§Ù… Ù…ØªØºÛŒØ± global ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
                const eventBusObj = window.event_bus || window.eventBus;
                
                if (!eventBusObj) {
                    showResult('event_bus', 'âŒ ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ù†Ø´Ø¯ - Ù‡ÛŒÚ† Ù…ØªØºÛŒØ± event_bus ÛŒØ§ eventBus ÛŒØ§ÙØª Ù†Ø´Ø¯', false);
                    return;
                }
                
                showResult('event_bus', 'âœ… ÙØ§ÛŒÙ„ Ù„ÙˆØ¯ Ø´Ø¯', true);
                
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ
                if (typeof eventBusObj.on !== 'function') {
                    showResult('event_bus', 'âŒ ØªØ§Ø¨Ø¹ on ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', false);
                    return;
                }
                
                if (typeof eventBusObj.emit !== 'function') {
                    showResult('event_bus', 'âŒ ØªØ§Ø¨Ø¹ emit ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯', false);
                    return;
                }
                
                // ØªØ³Øª Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆÛŒØ¯Ø§Ø¯
                let testPassed = false;
                eventBusObj.on('test-event', (data) => {
                    if (data === 'hello') testPassed = true;
                });
                
                eventBusObj.emit('test-event', 'hello');
                
                setTimeout(() => {
                    if (testPassed) {
                        showResult('event_bus', 'âœ… Ø§Ø±Ø³Ø§Ù„ Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…ÙˆÙÙ‚', true);
                    } else {
                        showResult('event_bus', 'âŒ Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù†Ø§Ù…ÙˆÙÙ‚', false);
                    }
                }, 100);
                
            } catch (error) {
                showResult('event_bus', `âŒ Ø®Ø·Ø§: ${error.message}`, false);
            }
        }

        function testAll() {
            results.innerHTML = '<h3>ğŸ¯ ØªØ³Øª Ú©Ø§Ù…Ù„ Ù…Ø§Ú˜ÙˆÙ„ Core</h3>';
            testStateManager();
            setTimeout(() => {
                testEventBus();
                
                // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø¹Ø¯ Ø§Ø² 400ms
                setTimeout(() => {
                    // ØªØ³Øª db.js
                    if (typeof db !== 'undefined') {
                        showResult('db', 'âœ… ÙØ§ÛŒÙ„ db.js Ù„ÙˆØ¯ Ø´Ø¯', true);
                    } else {
                        showResult('db', 'âš ï¸ ÙØ§ÛŒÙ„ db.js Ù„ÙˆØ¯ Ù†Ø´Ø¯ ÛŒØ§ Ù…ØªØºÛŒØ± global Ù†Ø¯Ø§Ø±Ø¯', false);
                    }
                    
                    // ØªØ³Øª router.js
                    if (typeof router !== 'undefined') {
                        showResult('router', 'âœ… ÙØ§ÛŒÙ„ router.js Ù„ÙˆØ¯ Ø´Ø¯', true);
                    } else {
                        showResult('router', 'âš ï¸ ÙØ§ÛŒÙ„ router.js Ù„ÙˆØ¯ Ù†Ø´Ø¯ ÛŒØ§ Ù…ØªØºÛŒØ± global Ù†Ø¯Ø§Ø±Ø¯', false);
                    }
                    
                    showResult('Ø³ÛŒØ³ØªÙ…', 'âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ core ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯', true);
                }, 400);
            }, 200);
        }
    </script>
</body>
</html>
