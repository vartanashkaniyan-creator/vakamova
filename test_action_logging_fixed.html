<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Action Logging - Vakamova</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .badge {
            background: #10b981;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            padding: 20px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .sidebar {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }
        
        .test-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .test-btn {
            background: white;
            border: 2px solid #4f46e5;
            color: #4f46e5;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            width: 100%;
        }
        
        .test-btn:hover {
            background: #4f46e5;
            color: white;
            transform: translateY(-2px);
        }
        
        .run-all-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            color: white !important;
            border: none !important;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #6b7280;
        }
        
        .test-results {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .test-result {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 5px solid #f59e0b;
            background: white;
        }
        
        .test-result.passed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .test-result.failed {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .test-result h4 {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #1f2937;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .passed .status-badge {
            background: #d1fae5;
            color: #065f46;
        }
        
        .failed .status-badge {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .test-output {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 10px;
            overflow-x: auto;
        }
        
        .log-viewer {
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin: 0 20px 20px 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-viewer h3 {
            color: #94a3b8;
            margin-bottom: 15px;
        }
        
        .log-entries {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        
        .log-entry {
            padding: 5px 10px;
            border-bottom: 1px solid #334155;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .log-time {
            color: #94a3b8;
            min-width: 80px;
            font-size: 0.8rem;
        }
        
        .log-level {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }
        
        .log-level.info { background: #3b82f6; color: white; }
        .log-level.warn { background: #f59e0b; color: white; }
        .log-level.error { background: #ef4444; color: white; }
        .log-level.success { background: #10b981; color: white; }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span>ğŸ“ ØªØ³Øª Action Logging</span>
                <span class="badge">Vakamova</span>
            </h1>
            <p>Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯ Ø¹Ù…Ù„ÛŒØ§Øª</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <h3>ğŸƒ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
                <div class="test-controls">
                    <button class="test-btn" onclick="runTest(1)">Û±. Ø³Ø§Ø®Øª Logger</button>
                    <button class="test-btn" onclick="runTest(2)">Û². Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ LogÙ‡Ø§</button>
                    <button class="test-btn" onclick="runTest(3)">Û³. ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ</button>
                    <button class="test-btn" onclick="runTest(4)">Û´. Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ LogÙ‡Ø§</button>
                    <button class="test-btn" onclick="runTest(5)">Ûµ. Import/Export</button>
                    <button class="test-btn" onclick="runTest(6)">Û¶. Performance</button>
                    <button class="test-btn" onclick="runTest(7)">Û·. ØªØ³Øª Ø¬Ø§Ù…Ø¹</button>
                    <button class="test-btn run-all-btn" onclick="runAllTests()">
                        â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
                    </button>
                </div>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="total-tests">7</div>
                        <div class="stat-label">Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="passed-tests">0</div>
                        <div class="stat-label">Ù…ÙˆÙÙ‚</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="failed-tests">0</div>
                        <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="success-rate">0%</div>
                        <div class="stat-label">Ù…ÙˆÙÙ‚ÛŒØª</div>
                    </div>
                </div>
            </div>
            
            <div class="test-results" id="test-results">
                <!-- Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
        </div>
        
        <div class="log-viewer">
            <h3>ğŸ“‹ Live Log Viewer</h3>
            <div class="log-entries" id="log-entries">
                <div class="log-entry">
                    <span class="log-time">--:--:--</span>
                    <span class="log-level info">INFO</span>
                    <span>Ø³ÛŒØ³ØªÙ… ØªØ³Øª Action Logging Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== Ø³ÛŒØ³ØªÙ… Action Logging (Ù†Ø³Ø®Ù‡ Ú©Ø§Ù…Ù„Ø§Ù‹ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡) ====================
        class ActionLogger {
            constructor(maxLogs = 1000, autoSave = true) {
                this.maxLogs = maxLogs;
                this.autoSave = autoSave;
                this.logs = [];
                this.listeners = [];
                this.loadFromStorage();
            }
            
            log(action, data = {}, level = 'info') {
                const logEntry = {
                    id: `log_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    timestamp: Date.now(),
                    action: action,
                    data: this._sanitizeData(data),
                    level: level,
                    sessionId: this._getSessionId()
                };
                
                this.logs.unshift(logEntry);
                
                // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯
                if (this.logs.length > this.maxLogs) {
                    this.logs = this.logs.slice(0, this.maxLogs);
                }
                
                if (this.autoSave) {
                    this.saveToStorage();
                }
                
                this._notifyListeners(logEntry);
                this._updateLiveLog(logEntry);
                
                return logEntry;
            }
            
            getLogs(filter = {}) {
                let filteredLogs = [...this.logs];
                
                if (filter.level) {
                    filteredLogs = filteredLogs.filter(log => log.level === filter.level);
                }
                
                if (filter.startDate && filter.endDate) {
                    filteredLogs = filteredLogs.filter(log => 
                        log.timestamp >= filter.startDate && 
                        log.timestamp <= filter.endDate
                    );
                }
                
                if (filter.action) {
                    filteredLogs = filteredLogs.filter(log => 
                        log.action.toLowerCase().includes(filter.action.toLowerCase())
                    );
                }
                
                if (filter.searchText) {
                    filteredLogs = filteredLogs.filter(log => 
                        JSON.stringify(log).toLowerCase().includes(filter.searchText.toLowerCase())
                    );
                }
                
                if (filter.limit) {
                    filteredLogs = filteredLogs.slice(0, filter.limit);
                }
                
                return filteredLogs;
            }
            
            clearLogs(olderThan = null) {
                if (olderThan) {
                    const cutoffTime = Date.now() - olderThan;
                    this.logs = this.logs.filter(log => log.timestamp >= cutoffTime);
                } else {
                    this.logs = [];
                }
                
                this.saveToStorage();
                return this.logs.length;
            }
            
            exportLogs(format = 'json') {
                const exportData = {
                    meta: {
                        exportedAt: Date.now(),
                        totalLogs: this.logs.length,
                        format: format,
                        version: '1.0'
                    },
                    logs: this.logs
                };
                
                if (format === 'json') {
                    return JSON.stringify(exportData, null, 2);
                } else if (format === 'csv') {
                    return this._convertToCSV(exportData.logs);
                }
                
                return exportData;
            }
            
            importLogs(data) {
                try {
                    const parsed = typeof data === 'string' ? JSON.parse(data) : data;
                    
                    if (!parsed.logs || !Array.isArray(parsed.logs)) {
                        throw new Error('ÙØ±Ù…Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                    }
                    
                    const validLogs = parsed.logs.filter(log => 
                        log.timestamp && log.action && log.level
                    );
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ù‡ Ø§Ø¨ØªØ¯Ø§
                    this.logs = [...validLogs, ...this.logs].slice(0, this.maxLogs);
                    this.saveToStorage();
                    
                    return validLogs.length;
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± import Ù„Ø§Ú¯â€ŒÙ‡Ø§:', error);
                    return 0;
                }
            }
            
            getStatistics() {
                const levels = {};
                const actions = {};
                let totalSize = 0;
                
                this.logs.forEach(log => {
                    levels[log.level] = (levels[log.level] || 0) + 1;
                    actions[log.action] = (actions[log.action] || 0) + 1;
                    totalSize += JSON.stringify(log).length;
                });
                
                return {
                    totalLogs: this.logs.length,
                    levels: levels,
                    topActions: Object.entries(actions)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 5),
                    sizeKB: (totalSize / 1024).toFixed(2),
                    oldestLog: this.logs.length > 0 ? Math.min(...this.logs.map(l => l.timestamp)) : null,
                    newestLog: this.logs.length > 0 ? Math.max(...this.logs.map(l => l.timestamp)) : null
                };
            }
            
            saveToStorage() {
                try {
                    localStorage.setItem('vakamova_action_logs', JSON.stringify({
                        logs: this.logs,
                        lastSaved: Date.now()
                    }));
                } catch (e) {
                    console.warn('Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¯Ø± localStorage Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯:', e);
                }
            }
            
            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('vakamova_action_logs');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.logs = parsed.logs || [];
                    }
                } catch (e) {
                    console.warn('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø§Ø² localStorage Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯:', e);
                    this.logs = [];
                }
            }
            
            addListener(callback) {
                this.listeners.push(callback);
            }
            
            removeListener(callback) {
                this.listeners = this.listeners.filter(listener => listener !== callback);
            }
            
            // ========== Ù…ØªØ¯Ù‡Ø§ÛŒ Ø®ØµÙˆØµÛŒ ==========
            _sanitizeData(data) {
                if (!data || typeof data !== 'object') return data;
                
                const sanitized = {...data};
                const sensitiveKeys = ['password', 'token', 'creditCard', 'cvv', 'secret'];
                
                sensitiveKeys.forEach(key => {
                    if (sanitized[key] !== undefined) {
                        sanitized[key] = '***REMOVED***';
                    }
                });
                
                return sanitized;
            }
            
            _getSessionId() {
                let sessionId = sessionStorage.getItem('vakamova_session_id');
                if (!sessionId) {
                    sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    sessionStorage.setItem('vakamova_session_id', sessionId);
                }
                return sessionId;
            }
            
            _notifyListeners(logEntry) {
                this.listeners.forEach(listener => {
                    try {
                        listener(logEntry);
                    } catch (e) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± listener Ù„Ø§Ú¯:', e);
                    }
                });
            }
            
            _updateLiveLog(logEntry) {
                const logEntries = document.getElementById('log-entries');
                if (!logEntries) return;
                
                const time = new Date(logEntry.timestamp).toLocaleTimeString('fa-IR');
                const levelClass = `log-level ${logEntry.level}`;
                
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                entry.innerHTML = `
                    <span class="log-time">${time}</span>
                    <span class="${levelClass}">${logEntry.level.toUpperCase()}</span>
                    <span>${logEntry.action}</span>
                `;
                
                logEntries.insertBefore(entry, logEntries.firstChild);
                
                // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡
                if (logEntries.children.length > 20) {
                    logEntries.removeChild(logEntries.lastChild);
                }
            }
            
            _convertToCSV(logs) {
                if (logs.length === 0) return '';
                
                const headers = ['timestamp', 'action', 'level', 'data', 'sessionId'];
                const rows = logs.map(log => [
                    new Date(log.timestamp).toISOString(),
                    `"${log.action.replace(/"/g, '""')}"`,
                    log.level,
                    `"${JSON.stringify(log.data).replace(/"/g, '""')}"`,
                    log.sessionId
                ]);
                
                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.join(','))
                ].join('\n');
                
                return csvContent;
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ ====================
        const tests = [
            {
                id: 1,
                name: 'Ø³Ø§Ø®Øª Logger',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ ØµØ­ÛŒØ­ ActionLogger',
                run: async () => {
                    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† localStorage Ø¨Ø±Ø§ÛŒ ØªØ³Øª ØªÙ…ÛŒØ²
                    localStorage.removeItem('vakamova_action_logs');
                    
                    const logger = new ActionLogger();
                    
                    if (!logger) {
                        throw new Error('Logger Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯');
                    }
                    
                    if (!Array.isArray(logger.logs)) {
                        throw new Error('ÙÛŒÙ„Ø¯ logs Ø¨Ø§ÛŒØ¯ Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§Ø´Ø¯');
                    }
                    
                    if (logger.maxLogs !== 1000) {
                        throw new Error(`maxLogs Ø¨Ø§ÛŒØ¯ 1000 Ø¨Ø§Ø´Ø¯ (Ù…Ù‚Ø¯Ø§Ø± ÙØ¹Ù„ÛŒ: ${logger.maxLogs})`);
                    }
                    
                    return 'âœ… Logger Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯';
                }
            },
            {
                id: 2,
                name: 'Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ LogÙ‡Ø§',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø«Ø¨Øª Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§',
                run: async () => {
                    // Ø³Ø§Ø®Øª logger Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ maxLogs Ú©ÙˆÚ†Ú©
                    const logger = new ActionLogger(10);
                    
                    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
                    logger.clearLogs();
                    
                    // Ø«Ø¨Øª Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ
                    const testData = [
                        { action: 'login', data: { user: 'test' }, level: 'info' },
                        { action: 'payment', data: { amount: 1000 }, level: 'success' },
                        { action: 'error', data: { code: 500 }, level: 'error' }
                    ];
                    
                    // Ø«Ø¨Øª Ù„Ø§Ú¯â€ŒÙ‡Ø§
                    testData.forEach(item => {
                        logger.log(item.action, item.data, item.level);
                    });
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§
                    if (logger.logs.length !== 3) {
                        throw new Error(`ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ ${logger.logs.length} Ø§Ø³Øª (Ø§Ù†ØªØ¸Ø§Ø±: 3)`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ±ØªÛŒØ¨ Ø²Ù…Ø§Ù†ÛŒ (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
                    const actions = logger.logs.map(log => log.action);
                    const expectedActions = ['error', 'payment', 'login'];
                    
                    for (let i = 0; i < expectedActions.length; i++) {
                        if (actions[i] !== expectedActions[i]) {
                            throw new Error(`ØªØ±ØªÛŒØ¨ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª. Ø§Ù†ØªØ¸Ø§Ø±: ${expectedActions[i]}, Ø¯Ø±ÛŒØ§ÙØª: ${actions[i]}`);
                        }
                    }
                    
                    return 'âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ ØµØ­ÛŒØ­ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯';
                }
            },
            {
                id: 3,
                name: 'ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø³ÛŒØ³ØªÙ… ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡',
                run: async () => {
                    const logger = new ActionLogger();
                    logger.clearLogs();
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ
                    logger.log('user_login', { username: 'ali' }, 'info');
                    logger.log('payment_success', { amount: 5000 }, 'success');
                    logger.log('network_error', { code: 404 }, 'error');
                    logger.log('user_login', { username: 'reza' }, 'info');
                    logger.log('warning', { message: 'low battery' }, 'warn');
                    
                    // ØªØ³Øª ÙÛŒÙ„ØªØ± level
                    const errorLogs = logger.getLogs({ level: 'error' });
                    if (errorLogs.length !== 1 || errorLogs[0].action !== 'network_error') {
                        throw new Error(`ÙÛŒÙ„ØªØ± level Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. ${errorLogs.length} Ù„Ø§Ú¯ Ø®Ø·Ø§ ÛŒØ§ÙØª Ø´Ø¯`);
                    }
                    
                    // ØªØ³Øª ÙÛŒÙ„ØªØ± action
                    const loginLogs = logger.getLogs({ action: 'login' });
                    if (loginLogs.length !== 2) {
                        throw new Error(`ÙÛŒÙ„ØªØ± action Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. ${loginLogs.length} Ù„Ø§Ú¯ login ÛŒØ§ÙØª Ø´Ø¯`);
                    }
                    
                    // ØªØ³Øª limit
                    const limitedLogs = logger.getLogs({ limit: 2 });
                    if (limitedLogs.length !== 2) {
                        throw new Error(`limit Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯. ${limitedLogs.length} Ù„Ø§Ú¯ Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯Ù‡ Ø´Ø¯`);
                    }
                    
                    return 'âœ… ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯';
                }
            },
            {
                id: 4,
                name: 'Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ LogÙ‡Ø§',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ùˆ Ú©Ø§Ù…Ù„',
                run: async () => {
                    const logger = new ActionLogger();
                    logger.clearLogs();
                    
                    const now = Date.now();
                    const oneDay = 24 * 60 * 60 * 1000;
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¨Ø§ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
                    logger.logs = [
                        { id: 'old1', timestamp: now - (oneDay * 3), action: 'old1', data: {}, level: 'info', sessionId: 'test' },
                        { id: 'old2', timestamp: now - (oneDay * 4), action: 'old2', data: {}, level: 'info', sessionId: 'test' },
                        { id: 'new1', timestamp: now, action: 'new1', data: {}, level: 'info', sessionId: 'test' },
                        { id: 'new2', timestamp: now - (oneDay * 1), action: 'new2', data: {}, level: 'info', sessionId: 'test' }
                    ];
                    
                    // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² 2 Ø±ÙˆØ²
                    const remaining = logger.clearLogs(oneDay * 2);
                    
                    // Ø¨Ø§ÛŒØ¯ 2 Ù„Ø§Ú¯ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§Ù‚ÛŒ Ø¨Ù…Ø§Ù†Ø¯
                    if (remaining !== 2) {
                        throw new Error(`Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ ${remaining} Ù„Ø§Ú¯ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
                    const remainingActions = logger.logs.map(log => log.action);
                    if (!remainingActions.includes('new1') || !remainingActions.includes('new2')) {
                        throw new Error('Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ÛŒØ¯ Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù†Ø¯');
                    }
                    
                    // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„
                    logger.clearLogs();
                    if (logger.logs.length !== 0) {
                        throw new Error(`Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ ${logger.logs.length} Ù„Ø§Ú¯ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡`);
                    }
                    
                    return 'âœ… Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ ØµØ­ÛŒØ­ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯';
                }
            },
            {
                id: 5,
                name: 'Import/Export',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ',
                run: async () => {
                    const logger = new ActionLogger();
                    logger.clearLogs();
                    
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ
                    logger.log('test_export_1', { data: 'test1' }, 'info');
                    logger.log('test_export_2', { data: 'test2' }, 'success');
                    
                    // Export Ø¨Ù‡ JSON
                    const jsonExport = logger.exportLogs('json');
                    if (!jsonExport || typeof jsonExport !== 'string') {
                        throw new Error('Export JSON Ø§Ù†Ø¬Ø§Ù… Ù†Ø´Ø¯');
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ export
                    if (!jsonExport.includes('test_export_1')) {
                        throw new Error('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± export ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ù†Ø¯');
                    }
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ logger Ø¬Ø¯ÛŒØ¯ Ùˆ import
                    const newLogger = new ActionLogger();
                    newLogger.clearLogs();
                    
                    const importResult = newLogger.importLogs(jsonExport);
                    
                    if (importResult !== 2) {
                        throw new Error(`${importResult} Ù„Ø§Ú¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯ (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ import Ø´Ø¯Ù‡
                    if (newLogger.logs.length !== 2) {
                        throw new Error(`${newLogger.logs.length} Ù„Ø§Ú¯ Ø¯Ø± logger Ø¬Ø¯ÛŒØ¯ (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    }
                    
                    return 'âœ… Import/Export Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯';
                }
            },
            {
                id: 6,
                name: 'Performance',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§ Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§',
                run: async () => {
                    const logger = new ActionLogger(500);
                    logger.clearLogs();
                    
                    // ØªØ³Øª Ø³Ø±Ø¹Øª Ø«Ø¨Øª
                    const startTime = Date.now();
                    const count = 100;
                    
                    for (let i = 0; i < count; i++) {
                        logger.log(`perf_test_${i}`, { index: i, data: 'x'.repeat(50) });
                    }
                    
                    const totalTime = Date.now() - startTime;
                    const avgTime = totalTime / count;
                    
                    if (avgTime > 10) {
                        throw new Error(`Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ø«Ø¨Øª ${avgTime.toFixed(2)}ms Ø§Ø³Øª (Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø²)`);
                    }
                    
                    // ØªØ³Øª Ø¬Ø³ØªØ¬Ùˆ
                    const searchStart = Date.now();
                    const results = logger.getLogs({ searchText: 'perf_test_50' });
                    const searchTime = Date.now() - searchStart;
                    
                    if (searchTime > 100) {
                        throw new Error(`Ø²Ù…Ø§Ù† Ø¬Ø³ØªØ¬Ùˆ ${searchTime}ms Ø§Ø³Øª (Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø²)`);
                    }
                    
                    return `âœ… Performance Ù…Ù†Ø§Ø³Ø¨ - Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø«Ø¨Øª: ${avgTime.toFixed(2)}ms, Ø¬Ø³ØªØ¬Ùˆ: ${searchTime}ms`;
                }
            },
            {
                id: 7,
                name: 'ØªØ³Øª Ø¬Ø§Ù…Ø¹',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ ØªÙ…Ø§Ù… Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø¯Ø± Ø³Ù†Ø§Ø±ÛŒÙˆ ÙˆØ§Ù‚Ø¹ÛŒ',
                run: async () => {
                    const logger = new ActionLogger(50);
                    logger.clearLogs();
                    
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
                    logger.log('app_started', { version: '1.0.0', platform: 'web' });
                    logger.log('user_logged_in', { userId: 'user123', method: 'email' }, 'success');
                    logger.log('lesson_started', { lessonId: 'L101', difficulty: 'beginner' });
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§
                    if (logger.logs.length !== 3) {
                        throw new Error(`${logger.logs.length} Ù„Ø§Ú¯ Ø«Ø¨Øª Ø´Ø¯Ù‡ (Ø§Ù†ØªØ¸Ø§Ø±: 3)`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ listener
                    let listenerTriggered = false;
                    logger.addListener((logEntry) => {
                        listenerTriggered = true;
                    });
                    
                    logger.log('test_listener', { test: true });
                    
                    if (!listenerTriggered) {
                        throw new Error('Listener Ù„Ø§Ú¯ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù†Ø´Ø¯');
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Live Log
                    const liveLogs = document.getElementById('log-entries');
                    if (!liveLogs || liveLogs.children.length === 0) {
                        throw new Error('Live Log Viewer Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯');
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ù…Ø§Ø±
                    const stats = logger.getStatistics();
                    if (stats.totalLogs < 4) {
                        throw new Error(`Ø¢Ù…Ø§Ø±: ${stats.totalLogs} Ù„Ø§Ú¯ (Ø­Ø¯Ø§Ù‚Ù„ 4 Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÛŒâ€ŒØ±ÙØª)`);
                    }
                    
                    return 'âœ… ØªØ³Øª Ø¬Ø§Ù…Ø¹ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯';
                }
            }
        ];

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        const TestManager = {
            results: [],
            
            displayResult(testId, success, message) {
                const resultsDiv = document.getElementById('test-results');
                const resultDiv = document.createElement('div');
                
                resultDiv.className = `test-result ${success ? 'passed' : 'failed'}`;
                resultDiv.innerHTML = `
                    <h4>
                        <span>${testId}. ${tests.find(t => t.id === testId).name}</span>
                        <span class="status-badge">${success ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚'}</span>
                    </h4>
                    <p>${tests.find(t => t.id === testId).description}</p>
                    <div class="test-output">${message}</div>
                `;
                
                resultsDiv.appendChild(resultDiv);
                this.results[testId] = success;
                this.updateStats();
                
                // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ø¢Ø®Ø±ÛŒÙ† Ù†ØªÛŒØ¬Ù‡
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
            },
            
            async runTest(testId) {
                const test = tests.find(t => t.id === testId);
                if (!test) return;
                
                try {
                    const result = await test.run();
                    this.displayResult(testId, true, result);
                    
                    // Ø«Ø¨Øª Ù„Ø§Ú¯ Ù…ÙˆÙÙ‚ÛŒØª
                    if (window.logger) {
                        window.logger.log(`test_${testId}_passed`, { test: test.name }, 'success');
                    }
                    
                } catch (error) {
                    this.displayResult(testId, false, error.message);
                    
                    // Ø«Ø¨Øª Ù„Ø§Ú¯ Ø®Ø·Ø§
                    if (window.logger) {
                        window.logger.log(`test_${testId}_failed`, { 
                            test: test.name,
                            error: error.message 
                        }, 'error');
                    }
                }
            },
            
            async runAllTests() {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ
                document.getElementById('test-results').innerHTML = '';
                this.results = [];
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† localStorage Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªÙ…ÛŒØ²
                localStorage.removeItem('vakamova_action_logs');
                sessionStorage.removeItem('vakamova_session_id');
                
                // Ø§Ø¬Ø±Ø§ÛŒ ØªØ±ØªÛŒØ¨ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
                for (const test of tests) {
                    await this.runTest(test.id);
                    await new Promise(resolve => setTimeout(resolve, 400)); // ÙˆÙ‚ÙÙ‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
                }
                
                // Ø«Ø¨Øª Ù†ØªÛŒØ¬Ù‡ Ú©Ù„ÛŒ
                const passed = this.results.filter(Boolean).length;
                const total = tests.length;
                
                if (window.logger) {
                    window.logger.log('all_tests_completed', { 
                        passed: passed,
                        total: total,
                        successRate: `${Math.round((passed / total) * 100)}%`
                    }, passed === total ? 'success' : 'warn');
                }
            },
            
            updateStats() {
                const total = tests.length;
                const passed = this.results.filter(Boolean).length;
                const failed = total - passed;
                const rate = total > 0 ? Math.round((passed / total) * 100) : 0;
                
                document.getElementById('passed-tests').textContent = passed;
                document.getElementById('failed-tests').textContent = failed;
                document.getElementById('success-rate').textContent = `${rate}%`;
            }
        };

        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Ø§ÛŒØ¬Ø§Ø¯ logger Ø¬Ù‡Ø§Ù†ÛŒ
            window.logger = new ActionLogger();
            
            // Ø«Ø¨Øª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø´Ø±ÙˆØ¹
            logger.log('test_suite_started', { 
                suite: 'Action Logging',
                timestamp: new Date().toISOString(),
                browser: navigator.userAgent
            }, 'info');
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¢Ù…Ø§Ø±
            TestManager.updateStats();
            
            console.log('ğŸš€ ØªØ³Øª Action Logging Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª');
            console.log('ğŸ“ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯');
        });

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ ====================
        function runTest(testId) {
            TestManager.runTest(testId);
        }
        
        function runAllTests() {
            TestManager.runAllTests();
        }
    </script>
</body>
</html>
