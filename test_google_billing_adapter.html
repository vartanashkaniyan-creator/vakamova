<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª Google Play Billing Adapter - Vakamova</title>
    <style>
        :root {
            --google-green: #34a853;
            --google-blue: #4285f4;
            --google-red: #ea4335;
            --google-yellow: #fbbc05;
            --dark-bg: #202124;
            --light-bg: #f8f9fa;
        }
        
        body {
            font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #3c4043 100%);
            color: #e8eaed;
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 25px 70px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .google-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        
        .google-logo {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .google-letter {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
        }
        
        .g-blue { background: var(--google-blue); }
        .g-red { background: var(--google-red); }
        .g-yellow { background: var(--google-yellow); }
        .g-green { background: var(--google-green); }
        
        h1 {
            color: white;
            font-size: 32px;
            margin: 10px 0;
            font-weight: 300;
        }
        
        .subtitle {
            color: #9aa0a6;
            font-size: 16px;
            margin-top: 5px;
        }
        
        .play-badge {
            background: rgba(255,255,255,0.1);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            color: var(--google-blue);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 25px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .test-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--google-blue), var(--google-green));
        }
        
        .test-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        
        .test-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 500;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .test-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            background: rgba(255,255,255,0.1);
        }
        
        .test-description {
            color: #9aa0a6;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .sku-details {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid var(--google-blue);
        }
        
        .sku-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .sku-item:last-child {
            border-bottom: none;
        }
        
        button {
            background: linear-gradient(135deg, var(--google-blue), #3367d6);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            cursor: pointer;
            font-weight: 500;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(66, 133, 244, 0.3);
            background: linear-gradient(135deg, #4285f4, #1a73e8);
        }
        
        button:disabled {
            background: #5f6368;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .result-panel {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result-panel.show { display: block; }
        
        .result-success {
            background: rgba(52, 168, 83, 0.1);
            border-color: var(--google-green);
            color: #34a853;
        }
        
        .result-error {
            background: rgba(234, 67, 53, 0.1);
            border-color: var(--google-red);
            color: #ea4335;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.08);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: white;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #9aa0a6;
            font-size: 14px;
        }
        
        .sandbox-controls {
            background: rgba(251, 188, 5, 0.1);
            border: 2px solid var(--google-yellow);
            border-radius: 16px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .control-item {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        label {
            font-weight: 500;
            color: white;
            font-size: 14px;
        }
        
        select, input {
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: white;
            font-family: inherit;
            font-size: 14px;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: var(--google-blue);
            background: rgba(255,255,255,0.15);
        }
        
        .purchase-flow {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 25px;
            margin: 30px 0;
        }
        
        .flow-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 25px 0;
            position: relative;
        }
        
        .flow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            z-index: 2;
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 12px;
            min-width: 120px;
        }
        
        .step-icon {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .step-active { background: var(--google-blue); color: white; }
        .step-success { background: var(--google-green); color: white; }
        .step-error { background: var(--google-red); color: white; }
        
        .flow-line {
            position: absolute;
            top: 25px;
            left: 60px;
            right: 60px;
            height: 2px;
            background: rgba(255,255,255,0.1);
            z-index: 1;
        }
        
        .console {
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 20px;
            margin-top: 30px;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--google-blue);
        }
        
        .google-response {
            background: rgba(0,0,0,0.4);
            color: #e8eaed;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-family: 'Roboto Mono', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .product-card {
            background: rgba(255,255,255,0.08);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease;
        }
        
        .product-card:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-3px);
        }
        
        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .product-title {
            font-size: 16px;
            font-weight: 500;
            color: white;
        }
        
        .product-price {
            background: var(--google-green);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .product-features {
            color: #9aa0a6;
            font-size: 13px;
            line-height: 1.5;
            margin: 10px 0;
        }
        
        .product-features li {
            margin: 5px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .product-features li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--google-green);
        }
        
        @media (max-width: 768px) {
            .test-grid, .product-grid { grid-template-columns: 1fr; }
            .flow-steps { flex-direction: column; gap: 20px; }
            .flow-line { display: none; }
            .action-bar { flex-direction: column; }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=Roboto+Mono&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="google-header">
            <div class="google-logo">
                <div class="google-letter g-blue">G</div>
                <div class="google-letter g-red">o</div>
                <div class="google-letter g-yellow">o</div>
                <div class="google-letter g-blue">g</div>
                <div class="google-letter g-green">l</div>
                <div class="google-letter g-red">e</div>
            </div>
            <h1>Google Play Billing Adapter</h1>
            <div class="subtitle">ØªØ³Øª Ú©Ø§Ù…Ù„ Ø¢Ø¯Ø§Ù¾ØªØ± Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø±ÙˆÙ†â€ŒØ¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ø§Ø± Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ Vakamova</div>
            <div class="play-badge">
                <span>â–¶ï¸</span>
                Google Play Billing Library v5.0+
            </div>
        </div>
        
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-label">SKUÙ‡Ø§ÛŒ ØªØ³Øª</div>
                <div class="stat-value" id="sku-count">5</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù…ÙˆÙÙ‚ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§</div>
                <div class="stat-value" id="test-success">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§</div>
                <div class="stat-value" id="request-count">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§</div>
                <div class="stat-value" id="execution-time">0ms</div>
            </div>
        </div>
        
        <div class="sandbox-controls">
            <div style="color: var(--google-yellow); font-weight: 500; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <span>âš™ï¸</span>
                ØªÙ†Ø¸ÛŒÙ…Ø§Øª Sandbox Google Play Billing
            </div>
            <div class="control-group">
                <div class="control-item">
                    <label>Ø­Ø§Ù„Øª Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ</label>
                    <select id="response-mode">
                        <option value="success">âœ… Ù…ÙˆÙÙ‚ (Purchase OK)</option>
                        <option value="pending">â³ Ù…Ø¹Ù„Ù‚ (Pending)</option>
                        <option value="failed">âŒ Ù†Ø§Ù…ÙˆÙÙ‚ (Billing Unavailable)</option>
                        <option value="user_cancelled">ğŸš« Ù„ØºÙˆ Ú©Ø§Ø±Ø¨Ø± (User Cancelled)</option>
                        <option value="item_unavailable">ğŸ“¦ Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ (Item Unavailable)</option>
                    </select>
                </div>
                <div class="control-item">
                    <label>Ø²Ù…Ø§Ù† Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ (ms)</label>
                    <input type="range" id="simulation-delay" min="500" max="5000" value="2000">
                    <div id="delay-label" style="color: #9aa0a6; text-align: center;">2000ms</div>
                </div>
                <div class="control-item">
                    <label>Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø±</label>
                    <select id="user-type">
                        <option value="new">ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</option>
                        <option value="returning">ğŸ”„ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§Ø²Ú¯Ø´ØªÛŒ</option>
                        <option value="has_purchases">ğŸ’° Ø¯Ø§Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ</option>
                        <option value="refunded">ğŸ’¸ Ø¯Ø§Ø±Ø§ÛŒ Ø¨Ø§Ø²Ù¾Ø±Ø¯Ø§Ø®Øª</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="purchase-flow">
            <div style="color: white; font-weight: 500; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                <span>ğŸ”„</span>
                ÙØ±Ø¢ÛŒÙ†Ø¯ Ø®Ø±ÛŒØ¯ Google Play Billing
            </div>
            <div class="flow-steps">
                <div class="flow-line"></div>
                <div class="flow-step">
                    <div class="step-icon" id="step-1">1</div>
                    <div style="font-size: 13px;">Ø§ØªØµØ§Ù„ Ø¨Ù‡ Billing Client</div>
                </div>
                <div class="flow-step">
                    <div class="step-icon" id="step-2">2</div>
                    <div style="font-size: 13px;">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ SKUÙ‡Ø§</div>
                </div>
                <div class="flow-step">
                    <div class="step-icon" id="step-3">3</div>
                    <div style="font-size: 13px;">Ø´Ø±ÙˆØ¹ Ø¬Ø±ÛŒØ§Ù† Ø®Ø±ÛŒØ¯</div>
                </div>
                <div class="flow-step">
                    <div class="step-icon" id="step-4">4</div>
                    <div style="font-size: 13px;">Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®Ø±ÛŒØ¯</div>
                </div>
                <div class="flow-step">
                    <div class="step-icon" id="step-5">5</div>
                    <div style="font-size: 13px;">ØªØ£ÛŒÛŒØ¯ Ùˆ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ</div>
                </div>
            </div>
        </div>
        
        <div class="product-grid">
            <div class="product-card">
                <div class="product-header">
                    <div class="product-title">Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
                    <div class="product-price">$4.99</div>
                </div>
                <div style="color: #9aa0a6; font-size: 13px; margin-bottom: 15px;">vakamova.monthly</div>
                <ul class="product-features">
                    <li>Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ 12 Ø²Ø¨Ø§Ù†</li>
                    <li>ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯</li>
                    <li>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§ÙˆÙ„ÛŒÙ‡</li>
                    <li>ØªØ¬Ø¯ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±</li>
                </ul>
                <button onclick="testPurchase('vakamova.monthly', 4.99, 'USD')" style="width: 100%; justify-content: center;">
                    <span>ğŸ›’</span>
                    ØªØ³Øª Ø®Ø±ÛŒØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡
                </button>
            </div>
            
            <div class="product-card">
                <div class="product-header">
                    <div class="product-title">Ø§Ø´ØªØ±Ø§Ú© Ø³Ø§Ù„Ø§Ù†Ù‡</div>
                    <div class="product-price">$49.99</div>
                </div>
                <div style="color: #9aa0a6; font-size: 13px; margin-bottom: 15px;">vakamova.yearly</div>
                <ul class="product-features">
                    <li>Ù‡Ù…Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡</li>
                    <li>ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ 16%</li>
                    <li>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ VIP</li>
                    <li>Ù…Ø­ØªÙˆØ§ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ</li>
                </ul>
                <button onclick="testPurchase('vakamova.yearly', 49.99, 'USD')" style="width: 100%; justify-content: center;">
                    <span>ğŸ†</span>
                    ØªØ³Øª Ø®Ø±ÛŒØ¯ Ø³Ø§Ù„Ø§Ù†Ù‡
                </button>
            </div>
            
            <div class="product-card">
                <div class="product-header">
                    <div class="product-title">Ø®Ø±ÛŒØ¯ Lifetime</div>
                    <div class="product-price">$149.99</div>
                </div>
                <div style="color: #9aa0a6; font-size: 13px; margin-bottom: 15px;">vakamova.lifetime</div>
                <ul class="product-features">
                    <li>Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø§Ø¯Ø§Ù…â€ŒØ§Ù„Ø¹Ù…Ø±</li>
                    <li>Ù‡Ù…Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡</li>
                    <li>Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø®ØªØµØ§ØµÛŒ</li>
                    <li>Ø¢Ù¾Ø¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†</li>
                </ul>
                <button onclick="testPurchase('vakamova.lifetime', 149.99, 'USD')" style="width: 100%; justify-content: center;">
                    <span>ğŸ‘‘</span>
                    ØªØ³Øª Ø®Ø±ÛŒØ¯ Lifetime
                </button>
            </div>
        </div>
        
        <div class="test-grid">
            <!-- ØªØ³Øª 1: Ø§ØªØµØ§Ù„ Ùˆ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ -->
            <div class="test-card">
                <div class="test-header">
                    <div class="test-title">
                        <span>ğŸ”Œ</span>
                        ØªØ³Øª 1: Ø§ØªØµØ§Ù„ Billing Client
                    </div>
                    <div class="test-badge" id="status-1">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="test-description">
                    Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Google Play Billing Client Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªØµØ§Ù„
                </div>
                <div class="sku-details">
                    <div class="sku-item">
                        <span>ÙˆØ¶Ø¹ÛŒØª:</span>
                        <span id="billing-status">Not Connected</span>
                    </div>
                    <div class="sku-item">
                        <span>Ù†Ø³Ø®Ù‡ Billing:</span>
                        <span>5.2.1</span>
                    </div>
                </div>
                <button onclick="runTest1()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø§ØªØµØ§Ù„</button>
                <div class="result-panel" id="result-1"></div>
            </div>
            
            <!-- ØªØ³Øª 2: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª -->
            <div class="test-card">
                <div class="test-header">
                    <div class="test-title">
                        <span>ğŸ“¦</span>
                        ØªØ³Øª 2: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ SKUÙ‡Ø§
                    </div>
                    <div class="test-badge" id="status-2">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="test-description">
                    Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ø² Google Play Console
                </div>
                <div class="sku-details">
                    <div class="sku-item">
                        <span>ØªØ¹Ø¯Ø§Ø¯ SKU:</span>
                        <span id="sku-loaded">0</span>
                    </div>
                    <div class="sku-item">
                        <span>Ù†ÙˆØ¹:</span>
                        <span>inapp & subscriptions</span>
                    </div>
                </div>
                <button onclick="runTest2()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
                <div class="result-panel" id="result-2"></div>
            </div>
            
            <!-- ØªØ³Øª 3: Ø¬Ø±ÛŒØ§Ù† Ø®Ø±ÛŒØ¯ -->
            <div class="test-card">
                <div class="test-header">
                    <div class="test-title">
                        <span>ğŸ›’</span>
                        ØªØ³Øª 3: Ø¬Ø±ÛŒØ§Ù† Ø®Ø±ÛŒØ¯
                    </div>
                    <div class="test-badge" id="status-3">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="test-description">
                    Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ø¬Ø±ÛŒØ§Ù† Ø®Ø±ÛŒØ¯ Google Play
                </div>
                <div class="sku-details">
                    <div class="sku-item">
                        <span>Ù…Ø­ØµÙˆÙ„ ØªØ³Øª:</span>
                        <span>vakamova.monthly</span>
                    </div>
                    <div class="sku-item">
                        <span>Ù‚ÛŒÙ…Øª:</span>
                        <span>$4.99</span>
                    </div>
                </div>
                <button onclick="runTest3()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø®Ø±ÛŒØ¯</button>
                <div class="result-panel" id="result-3"></div>
            </div>
            
            <!-- ØªØ³Øª 4: Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ -->
            <div class="test-card">
                <div class="test-header">
                    <div class="test-title">
                        <span>ğŸ’°</span>
                        ØªØ³Øª 4: Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
                    </div>
                    <div class="test-badge" id="status-4">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="test-description">
                    Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ùˆ ØªØ£ÛŒÛŒØ¯ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ú©Ø§Ø±Ø¨Ø±
                </div>
                <div class="sku-details">
                    <div class="sku-item">
                        <span>Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø±:</span>
                        <span id="user-type-display">Ø¬Ø¯ÛŒØ¯</span>
                    </div>
                    <div class="sku-item">
                        <span>Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ:</span>
                        <span id="previous-purchases">0</span>
                    </div>
                </div>
                <button onclick="runTest4()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</button>
                <div class="result-panel" id="result-4"></div>
            </div>
            
            <!-- ØªØ³Øª 5: Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§ -->
            <div class="test-card">
                <div class="test-header">
                    <div class="test-title">
                        <span>ğŸ”„</span>
                        ØªØ³Øª 5: Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§
                    </div>
                    <div class="test-badge" id="status-5">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="test-description">
                    ØªØ³Øª Ù„ØºÙˆØŒ ØªØ¬Ø¯ÛŒØ¯ Ùˆ Ø§Ø±ØªÙ‚Ø§Ø¡ Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§
                </div>
                <div class="sku-details">
                    <div class="sku-item">
                        <span>ÙˆØ¶Ø¹ÛŒØª Ø§Ø´ØªØ±Ø§Ú©:</span>
                        <span id="subscription-status">ÙØ¹Ø§Ù„</span>
                    </div>
                    <div class="sku-item">
                        <span>ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§:</span>
                        <span id="expiry-date">--</span>
                    </div>
                </div>
                <button onclick="runTest5()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø§Ø´ØªØ±Ø§Ú©</button>
                <div class="result-panel" id="result-5"></div>
            </div>
            
            <!-- ØªØ³Øª 6: Ø®Ø·Ø§Ù‡Ø§ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ -->
            <div class="test-card">
                <div class="test-header">
                    <div class="test-title">
                        <span>âš ï¸</span>
                        ØªØ³Øª 6: Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§Ù‡Ø§
                    </div>
                    <div class="test-badge" id="status-6">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                </div>
                <div class="test-description">
                    ØªØ³Øª Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø±Ø§ÛŒØ¬ Google Play Billing
                </div>
                <div class="sku-details">
                    <div class="sku-item">
                        <span>Ø®Ø·Ø§Ù‡Ø§ÛŒ ØªØ³Øª:</span>
                        <span>6 Ù†ÙˆØ¹</span>
                    </div>
                    <div class="sku-item">
                        <span>Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ:</span>
                        <span>Ø§ØªÙˆÙ…Ø§ØªÛŒÚ©</span>
                    </div>
                </div>
                <button onclick="runTest6()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø®Ø·Ø§Ù‡Ø§</button>
                <div class="result-panel" id="result-6"></div>
            </div>
        </div>
        
        <div class="action-bar">
            <button onclick="runAllTests()" style="background: linear-gradient(135deg, var(--google-green), #0d904f); padding: 15px 30px;">
                ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Û¶ ØªØ³Øª
            </button>
            <button onclick="simulateCompleteFlow()" style="background: linear-gradient(135deg, var(--google-blue), #1a5bb9); padding: 15px 30px;">
                ğŸª Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡
            </button>
            <button onclick="resetAllTests()" style="background: linear-gradient(135deg, #5f6368, #3c4043); padding: 15px 30px;">
                ğŸ”„ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
        </div>
        
        <div class="google-response">
            <div style="color: var(--google-blue); margin-bottom: 10px;">ğŸ“¡ Ù¾Ø§Ø³Ø® Google Play Billing:</div>
            <pre id="billing-response">{
  "status": "ready",
  "environment": "SANDBOX",
  "message": "Google Play Billing simulator ready"
}</pre>
        </div>
        
        <div class="console">
            <div class="console-header">
                <span>ğŸ“Ÿ Ù„Ø§Ú¯ Ø§Ø¬Ø±Ø§ÛŒ Google Play Billing</span>
                <button onclick="clearConsole()" style="padding: 5px 15px; font-size: 12px; background: rgba(255,255,255,0.1);">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
            </div>
            <div id="console-output"></div>
        </div>
    </div>

    <script>
        // ========== Google Play Billing Adapter Mock ==========
        class GooglePlayBillingAdapter {
            constructor() {
                this.billingClient = null;
                this.isConnected = false;
                this.availableSkus = [];
                this.purchases = [];
                this.testCount = 0;
                this.successCount = 0;
                this.responseMode = 'success';
                this.simulationDelay = 2000;
                this.userType = 'new';
                this.executionStartTime = null;
                this.requestCount = 0;
                
                // Ù…Ø­ØµÙˆÙ„Ø§Øª ØªØ³Øª
                this.skuList = [
                    {
                        sku: 'vakamova.monthly',
                        type: 'subs',
                        price: '$4.99',
                        price_amount_micros: 4990000,
                        price_currency_code: 'USD',
                        title: 'Ø§Ø´ØªØ±Ø§Ú© Ù…Ø§Ù‡Ø§Ù†Ù‡ Vakamova',
                        description: 'Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ 12 Ø²Ø¨Ø§Ù† Ø¨Ø§ ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯'
                    },
                    {
                        sku: 'vakamova.yearly',
                        type: 'subs',
                        price: '$49.99',
                        price_amount_micros: 49990000,
                        price_currency_code: 'USD',
                        title: 'Ø§Ø´ØªØ±Ø§Ú© Ø³Ø§Ù„Ø§Ù†Ù‡ Vakamova',
                        description: 'ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ 16% - Ù‡Ù…Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø¨Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ù…Ø­ØªÙˆØ§ÛŒ VIP'
                    },
                    {
                        sku: 'vakamova.lifetime',
                        type: 'inapp',
                        price: '$149.99',
                        price_amount_micros: 149990000,
                        price_currency_code: 'USD',
                        title: 'Ø®Ø±ÛŒØ¯ Lifetime Vakamova',
                        description: 'Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø§Ø¯Ø§Ù…â€ŒØ§Ù„Ø¹Ù…Ø± Ø¨Ù‡ Ù‡Ù…Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø­Ø§Ù„ Ùˆ Ø¢ÛŒÙ†Ø¯Ù‡'
                    },
                    {
                        sku: 'vakamova.coins_100',
                        type: 'inapp',
                        price: '$0.99',
                        price_amount_micros: 990000,
                        price_currency_code: 'USD',
                        title: '100 Ø³Ú©Ù‡ Vakamova',
                        description: 'Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ø¯Ø±ÙˆÙ†â€ŒØ¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ'
                    },
                    {
                        sku: 'vakamova.premium_pack',
                        type: 'inapp',
                        price: '$9.99',
                        price_amount_micros: 9990000,
                        price_currency_code: 'USD',
                        title: 'Ø¨Ø³ØªÙ‡ Premium',
                        description: 'ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ'
                    }
                ];
                
                // Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø±
                this.setupUserPurchases();
            }
            
            setupUserPurchases() {
                switch(this.userType) {
                    case 'new':
                        this.purchases = [];
                        break;
                    case 'returning':
                        this.purchases = [
                            {
                                sku: 'vakamova.monthly',
                                purchaseToken: 'mock_token_001',
                                purchaseTime: Date.now() - 86400000 * 15, // 15 Ø±ÙˆØ² Ù¾ÛŒØ´
                                isAcknowledged: true,
                                isAutoRenewing: true
                            }
                        ];
                        break;
                    case 'has_purchases':
                        this.purchases = [
                            {
                                sku: 'vakamova.yearly',
                                purchaseToken: 'mock_token_002',
                                purchaseTime: Date.now() - 86400000 * 200,
                                isAcknowledged: true,
                                isAutoRenewing: true
                            },
                            {
                                sku: 'vakamova.premium_pack',
                                purchaseToken: 'mock_token_003',
                                purchaseTime: Date.now() - 86400000 * 50,
                                isAcknowledged: true,
                                isAutoRenewing: false
                            }
                        ];
                        break;
                    case 'refunded':
                        this.purchases = [
                            {
                                sku: 'vakamova.monthly',
                                purchaseToken: 'mock_token_004',
                                purchaseTime: Date.now() - 86400000 * 10,
                                isAcknowledged: true,
                                isAutoRenewing: false,
                                isRefunded: true
                            }
                        ];
                        break;
                }
                
                document.getElementById('previous-purchases').textContent = this.purchases.length;
                document.getElementById('user-type-display').textContent = 
                    this.userType === 'new' ? 'Ø¬Ø¯ÛŒØ¯' :
                    this.userType === 'returning' ? 'Ø¨Ø§Ø²Ú¯Ø´ØªÛŒ' :
                    this.userType === 'has_purchases' ? 'Ø¯Ø§Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯' : 'Ø¨Ø§Ø²Ù¾Ø±Ø¯Ø§Ø®Øª';
            }
            
            async connectBillingClient() {
                this.requestCount++;
                this.updateStep(1);
                this.log('ğŸ”Œ Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Google Play Billing Client...');
                
                await this.delay(this.simulationDelay * 0.5);
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§ØªØµØ§Ù„
                if (this.responseMode === 'failed') {
                    throw new BillingError('BILLING_UNAVAILABLE', 'Google Play Billing service is unavailable');
                }
                
                this.billingClient = {
                    isReady: true,
                    connectionState: 'CONNECTED',
                    apiVersion: '5.2.1'
                };
                
                this.isConnected = true;
                this.updateStep(1, 'success');
                
                return {
                    success: true,
                    connectionState: 'CONNECTED',
                    apiVersion: '5.2.1',
                    isReady: true
                };
            }
            
            async querySkus(skuType = 'subs') {
                this.requestCount++;
                this.updateStep(2);
                this.log(`ğŸ“¦ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ SKUÙ‡Ø§ÛŒ Ù†ÙˆØ¹ ${skuType}...`);
                
                await this.delay(this.simulationDelay * 0.3);
                
                const filteredSkus = this.skuList.filter(sku => sku.type === skuType);
                this.availableSkus = filteredSkus;
                
                this.updateStep(2, 'success');
                
                return {
                    success: true,
                    skus: filteredSkus,
                    count: filteredSkus.length
                };
            }
            
            async launchPurchaseFlow(sku, skuType = 'subs') {
                this.requestCount++;
                this.updateStep(3);
                this.log(`ğŸ›’ Ø´Ø±ÙˆØ¹ Ø¬Ø±ÛŒØ§Ù† Ø®Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ ${sku}...`);
                
                // ÛŒØ§ÙØªÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª SKU
                const skuDetails = this.skuList.find(s => s.sku === sku);
                if (!skuDetails) {
                    throw new BillingError('ITEM_UNAVAILABLE', `SKU ${sku} not found`);
                }
                
                await this.delay(this.simulationDelay);
                
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§Ø³Ø®
                switch(this.responseMode) {
                    case 'success':
                        this.updateStep(4);
                        this.log(`âœ… Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®Ø±ÛŒØ¯ ${sku}...`);
                        
                        // Ø§ÛŒØ¬Ø§Ø¯ Ø®Ø±ÛŒØ¯ Ù…ÙˆÙÙ‚
                        const purchase = {
                            sku: sku,
                            purchaseToken: `gp_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                            orderId: `GPA.${Math.random().toString(36).substr(2, 4)}-${Math.random().toString(36).substr(2, 4)}-${Math.random().toString(36).substr(2, 4)}`,
                            purchaseTime: Date.now(),
                            purchaseState: 'PURCHASED',
                            isAcknowledged: false,
                            isAutoRenewing: skuType === 'subs',
                            skuDetails: skuDetails
                        };
                        
                        this.purchases.push(purchase);
                        this.updateStep(4, 'success');
                        
                        await this.delay(800);
                        this.updateStep(5);
                        
                        // ØªØ£ÛŒÛŒØ¯ Ø®Ø±ÛŒØ¯
                        purchase.isAcknowledged = true;
                        this.updateStep(5, 'success');
                        
                        return {
                            success: true,
                            purchase: purchase,
                            message: 'Purchase completed successfully'
                        };
                        
                    case 'pending':
                        return {
                            success: true,
                            pending: true,
                            message: 'Purchase is pending approval'
                        };
                        
                    case 'failed':
                        throw new BillingError('ERROR', 'Purchase failed. Please try again.');
                        
                    case 'user_cancelled':
                        throw new BillingError('USER_CANCELLED', 'Purchase was cancelled by user');
                        
                    case 'item_unavailable':
                        throw new BillingError('ITEM_UNAVAILABLE', 'Requested item is not available for purchase');
                }
            }
            
            async queryPurchases(skuType = 'subs') {
                this.requestCount++;
                this.log(`ğŸ’° Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ú©Ø§Ø±Ø¨Ø±...`);
                
                await this.delay(this.simulationDelay * 0.4);
                
                const userPurchases = this.purchases.filter(p => {
                    const sku = this.skuList.find(s => s.sku === p.sku);
                    return sku && sku.type === skuType;
                });
                
                return {
                    success: true,
                    purchases: userPurchases,
                    count: userPurchases.length,
                    hasPurchases: userPurchases.length > 0
                };
            }
            
            async manageSubscription(subscriptionId, action) {
                this.requestCount++;
                this.log(`ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ ${action} Ø§Ø´ØªØ±Ø§Ú© ${subscriptionId}...`);
                
                await this.delay(this.simulationDelay * 0.6);
                
                const purchase = this.purchases.find(p => p.sku === subscriptionId);
                
                if (!purchase) {
                    throw new BillingError('ITEM_NOT_OWNED', 'User does not own this subscription');
                }
                
                switch(action) {
                    case 'cancel':
                        purchase.isAutoRenewing = false;
                        return {
                            success: true,
                            message: 'Subscription cancelled successfully',
                            cancellationDate: new Date().toISOString(),
                            expiresDate: new Date(Date.now() + 86400000 * 30).toISOString() // 30 Ø±ÙˆØ² Ø¯ÛŒÚ¯Ø±
                        };
                        
                    case 'reactivate':
                        purchase.isAutoRenewing = true;
                        return {
                            success: true,
                            message: 'Subscription reactivated successfully'
                        };
                        
                    case 'upgrade':
                        // Ø§Ø±ØªÙ‚Ø§Ø¡ Ø¨Ù‡ SKU Ø¨Ø§Ù„Ø§ØªØ±
                        const currentSku = purchase.sku;
                        const newSku = currentSku === 'vakamova.monthly' ? 'vakamova.yearly' : 'vakamova.lifetime';
                        
                        purchase.sku = newSku;
                        purchase.upgradedFrom = currentSku;
                        purchase.upgradeTime = Date.now();
                        
                        return {
                            success: true,
                            message: 'Subscription upgraded successfully',
                            newSku: newSku,
                            proratedAmount: 25.50 // Ù…Ø¨Ù„Øº ØªÙ†Ø§Ø³Ø¨ÛŒ
                        };
                }
            }
            
            async testErrorScenarios() {
                this.requestCount++;
                this.log(`âš ï¸ Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ø®Ø·Ø§...`);
                
                const errorScenarios = [
                    { code: 'BILLING_UNAVAILABLE', message: 'Billing service is unavailable' },
                    { code: 'DEVELOPER_ERROR', message: 'Invalid arguments provided to API' },
                    { code: 'ERROR', message: 'Fatal error during API action' },
                    { code: 'FEATURE_NOT_SUPPORTED', message: 'Requested feature is not supported' },
                    { code: 'ITEM_ALREADY_OWNED', message: 'User already owns this item' },
                    { code: 'ITEM_NOT_OWNED', message: 'User does not own this item' },
                    { code: 'ITEM_UNAVAILABLE', message: 'Requested product is not available' },
                    { code: 'NETWORK_ERROR', message: 'Network error occurred' },
                    { code: 'SERVICE_DISCONNECTED', message: 'Billing service disconnected' },
                    { code: 'SERVICE_TIMEOUT', message: 'Billing service timeout' },
                    { code: 'SERVICE_UNAVAILABLE', message: 'Billing service is currently unavailable' },
                    { code: 'USER_CANCELLED', message: 'User cancelled the flow' }
                ];
                
                let results = '<strong>ğŸ§ª Ù†ØªØ§ÛŒØ¬ ØªØ³Øª Ø®Ø·Ø§Ù‡Ø§:</strong><br><br>';
                
                for (const scenario of errorScenarios.slice(0, 6)) {
                    try {
                        throw new BillingError(scenario.code, scenario.message);
                    } catch (error) {
                        if (error.code === scenario.code) {
                            results += `âœ… ${scenario.code}: ${error.message}<br>`;
                        } else {
                            results += `âŒ ${scenario.code}: Ø®Ø·Ø§ÛŒ Ù†Ø§Ø¯Ø±Ø³Øª<br>`;
                        }
                    }
                    await this.delay(100);
                }
                
                return {
                    success: true,
                    results: results,
                    testedScenarios: 6
                };
            }
            
            updateStep(stepNumber, status = 'active') {
                const stepElement = document.getElementById(`step-${stepNumber}`);
                if (stepElement) {
                    stepElement.className = 'step-icon';
                    if (status === 'success') {
                        stepElement.className = 'step-icon step-success';
                    } else if (status === 'error') {
                        stepElement.className = 'step-icon step-error';
                    } else {
                        stepElement.className = 'step-icon step-active';
                    }
                }
            }
            
            resetSteps() {
                for (let i = 1; i <= 5; i++) {
                    const step = document.getElementById(`step-${i}`);
                    if (step) {
                        step.className = 'step-icon';
                    }
                }
            }
            
            updateResponseDisplay(response) {
                const responseElement = document.getElementById('billing-response');
                if (responseElement) {
                    responseElement.textContent = JSON.stringify(response, null, 2);
                }
            }
            
            updateStats(success = true) {
                this.testCount++;
                if (success) this.successCount++;
                
                document.getElementById('sku-count').textContent = this.skuList.length;
                document.getElementById('request-count').textContent = this.requestCount;
                
                const successRate = this.testCount > 0 
                    ? Math.round((this.successCount / this.testCount) * 100) 
                    : 0;
                document.getElementById('test-success').textContent = `${successRate}%`;
                
                if (this.executionStartTime) {
                    const elapsed = Date.now() - this.executionStartTime;
                    document.getElementById('execution-time').textContent = `${elapsed}ms`;
                }
            }
            
            log(message) {
                const time = new Date().toLocaleTimeString('fa-IR');
                const consoleOutput = document.getElementById('console-output');
                const logEntry = document.createElement('div');
                logEntry.style.padding = '5px 0';
                logEntry.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                logEntry.innerHTML = `<span style="color: #9aa0a6">[${time}]</span> ${message}`;
                consoleOutput.appendChild(logEntry);
                consoleOutput.scrollTop = consoleOutput.scrollHeight;
                console.log(message);
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        class BillingError extends Error {
            constructor(code, message) {
                super(message);
                this.name = 'BillingError';
                this.code = code;
                this.timestamp = new Date().toISOString();
            }
        }
        
        // ========== Global Adapter ==========
        const billingAdapter = new GooglePlayBillingAdapter();
        
        // ========== Setup Controls ==========
        document.getElementById('response-mode').addEventListener('change', function() {
            billingAdapter.responseMode = this.value;
            billingAdapter.log(`âš™ï¸ Ø­Ø§Ù„Øª Ù¾Ø§Ø³Ø® Ø¨Ù‡ "${this.options[this.selectedIndex].text}" ØªØºÛŒÛŒØ± Ú©Ø±Ø¯`);
        });
        
        document.getElementById('simulation-delay').addEventListener('input', function() {
            const value = parseInt(this.value);
            document.getElementById('delay-label').textContent = `${value}ms`;
            billingAdapter.simulationDelay = value;
        });
        
        document.getElementById('user-type').addEventListener('change', function() {
            billingAdapter.userType = this.value;
            billingAdapter.setupUserPurchases();
            billingAdapter.log(`ğŸ‘¤ Ù†ÙˆØ¹ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ "${this.options[this.selectedIndex].text}" ØªØºÛŒÛŒØ± Ú©Ø±Ø¯`);
        });
        
        // ========== Test Functions ==========
        async function runTest1() {
            const status = document.getElementById('status-1');
            const resultPanel = document.getElementById('result-1');
            const btn = event.target;
            const billingStatus = document.getElementById('billing-status');
            
            status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„...';
            resultPanel.className = 'result-panel';
            resultPanel.innerHTML = '';
            billingAdapter.resetSteps();
            
            billingAdapter.executionStartTime = Date.now();
            
            try {
                const result = await billingAdapter.connectBillingClient();
                
                status.textContent = 'Ù…ÙˆÙÙ‚';
                billingStatus.textContent = result.connectionState;
                
                resultPanel.className = 'result-panel show result-success';
                resultPanel.innerHTML = `
                    <strong>âœ… Ø§ØªØµØ§Ù„ Ø¨Ù‡ Google Play Billing Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„: ${result.connectionState}<br>
                    â€¢ Ù†Ø³Ø®Ù‡ API: ${result.apiVersion}<br>
                    â€¢ Ø¢Ù…Ø§Ø¯Ù‡: ${result.isReady ? 'âœ… Ø¨Ù„Ù‡' : 'âŒ Ø®ÛŒØ±'}<br>
                    â€¢ Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: ${Date.now() - billingAdapter.executionStartTime}ms<br><br>
                    <small>âœ… Billing Client Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯.</small>
                `;
                
                billingAdapter.updateResponseDisplay(result);
                billingAdapter.updateStats(true);
                
            } catch (error) {
                status.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                billingStatus.textContent = 'DISCONNECTED';
                
                resultPanel.className = 'result-panel show result-error';
                resultPanel.innerHTML = `
                    <strong>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Google Play Billing</strong><br><br>
                    <strong>Ø®Ø·Ø§:</strong> ${error.message}<br>
                    â€¢ Ú©Ø¯ Ø®Ø·Ø§: ${error.code || 'Ù†Ø§Ù…Ø´Ø®Øµ'}<br>
                    â€¢ Ù†ÙˆØ¹: ${error.name}<br><br>
                    <small>âš ï¸ Ù…Ø´Ú©Ù„ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆÛŒØ³ Ù¾Ø±Ø¯Ø§Ø®Øª Google Play</small>
                `;
                
                billingAdapter.updateResponseDisplay({ error: error.code, message: error.message });
                billingAdapter.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø§ØªØµØ§Ù„';
        }
        
        async function runTest2() {
            const status = document.getElementById('status-2');
            const resultPanel = document.getElementById('result-2');
            const btn = event.target;
            const skuLoaded = document.getElementById('sku-loaded');
            
            status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...';
            resultPanel.className = 'result-panel';
            resultPanel.innerHTML = '';
            
            try {
                const result = await billingAdapter.querySkus('subs');
                
                status.textContent = 'Ù…ÙˆÙÙ‚';
                skuLoaded.textContent = result.count;
                
                resultPanel.className = 'result-panel show result-success';
                resultPanel.innerHTML = `
                    <strong>âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ SKUÙ‡Ø§ Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ ØªØ¹Ø¯Ø§Ø¯ SKUÙ‡Ø§: ${result.count}<br>
                    â€¢ Ù†ÙˆØ¹: Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§ (subs)<br>
                    â€¢ ÙˆØ¶Ø¹ÛŒØª: âœ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„<br><br>
                    <strong>SKUÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡:</strong><br>
                    ${result.skus.map(sku => `â€¢ ${sku.sku}: ${sku.price} - ${sku.title}`).join('<br>')}<br><br>
                    <small>âœ… Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ø² Google Play Console Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù†Ø¯.</small>
                `;
                
                billingAdapter.updateResponseDisplay(result);
                billingAdapter.updateStats(true);
                
            } catch (error) {
                status.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                skuLoaded.textContent = '0';
                
                resultPanel.className = 'result-panel show result-error';
                resultPanel.innerHTML = `
                    <strong>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ SKUÙ‡Ø§</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}
                `;
                
                billingAdapter.updateResponseDisplay({ error: error.code, message: error.message });
                billingAdapter.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ';
        }
        
        async function runTest3() {
            const status = document.getElementById('status-3');
            const resultPanel = document.getElementById('result-3');
            const btn = event.target;
            
            status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø®Ø±ÛŒØ¯...';
            resultPanel.className = 'result-panel';
            resultPanel.innerHTML = '';
            billingAdapter.resetSteps();
            
            try {
                const result = await billingAdapter.launchPurchaseFlow('vakamova.monthly', 'subs');
                
                status.textContent = result.success ? 'Ù…ÙˆÙÙ‚' : 'Ù…Ø¹Ù„Ù‚';
                
                if (result.success && !result.pending) {
                    resultPanel.className = 'result-panel show result-success';
                    resultPanel.innerHTML = `
                        <strong>âœ… Ø®Ø±ÛŒØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯</strong><br><br>
                        <strong>Ø¬Ø²Ø¦ÛŒØ§Øª Ø®Ø±ÛŒØ¯:</strong><br>
                        â€¢ SKU: ${result.purchase.sku}<br>
                        â€¢ Order ID: ${result.purchase.orderId}<br>
                        â€¢ Token: ${result.purchase.purchaseToken.substring(0, 20)}...<br>
                        â€¢ ØªØ§Ø±ÛŒØ® Ø®Ø±ÛŒØ¯: ${new Date(result.purchase.purchaseTime).toLocaleString('fa-IR')}<br>
                        â€¢ ÙˆØ¶Ø¹ÛŒØª: ${result.purchase.purchaseState}<br>
                        â€¢ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡: ${result.purchase.isAcknowledged ? 'âœ… Ø¨Ù„Ù‡' : 'âŒ Ø®ÛŒØ±'}<br>
                        â€¢ ØªØ¬Ø¯ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±: ${result.purchase.isAutoRenewing ? 'âœ… ÙØ¹Ø§Ù„' : 'âŒ ØºÛŒØ±ÙØ¹Ø§Ù„'}<br><br>
                        <small>âœ… Ø¬Ø±ÛŒØ§Ù† Ø®Ø±ÛŒØ¯ Google Play Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ø§Ù…Ù„ Ø´Ø¯.</small>
                    `;
                    
                    billingAdapter.updateStats(true);
                } else if (result.pending) {
                    resultPanel.className = 'result-panel show result-success';
                    resultPanel.innerHTML = `
                        <strong>âš ï¸ Ø®Ø±ÛŒØ¯ Ø¯Ø± ÙˆØ¶Ø¹ÛŒØª Ù…Ø¹Ù„Ù‚</strong><br><br>
                        Ø®Ø±ÛŒØ¯ Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ£ÛŒÛŒØ¯ Ø¯Ø³ØªÛŒ Ø¯Ø§Ø±Ø¯. Ø§ÛŒÙ† Ø­Ø§Ù„Øª Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ø®ÛŒ Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯.<br><br>
                        <small>âœ… Ø³ÛŒØ³ØªÙ… Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù…Ø¹Ù„Ù‚ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø±Ø¯.</small>
                    `;
                    
                    billingAdapter.updateStats(true);
                }
                
                billingAdapter.updateResponseDisplay(result);
                
            } catch (error) {
                status.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                
                resultPanel.className = 'result-panel show result-error';
                resultPanel.innerHTML = `
                    <strong>âŒ Ø®Ø±ÛŒØ¯ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    <strong>Ø®Ø·Ø§:</strong> ${error.message}<br>
                    â€¢ Ú©Ø¯ Ø®Ø·Ø§: ${error.code || 'Ù†Ø§Ù…Ø´Ø®Øµ'}<br>
                    â€¢ Ù†ÙˆØ¹: ${error.name}<br><br>
                    <small>âš ï¸ Ø¬Ø±ÛŒØ§Ù† Ø®Ø±ÛŒØ¯ Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯.</small>
                `;
                
                billingAdapter.updateResponseDisplay({ error: error.code, message: error.message });
                billingAdapter.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø®Ø±ÛŒØ¯';
        }
        
        async function runTest4() {
            const status = document.getElementById('status-4');
            const resultPanel = document.getElementById('result-4');
            const btn = event.target;
            
            status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ...';
            resultPanel.className = 'result-panel';
            resultPanel.innerHTML = '';
            
            try {
                const result = await billingAdapter.queryPurchases('subs');
                
                status.textContent = 'Ù…ÙˆÙÙ‚';
                
                resultPanel.className = 'result-panel show result-success';
                resultPanel.innerHTML = `
                    <strong>âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø®Ø±ÛŒØ¯Ù‡Ø§: ${result.count}<br>
                    â€¢ Ú©Ø§Ø±Ø¨Ø± Ø®Ø±ÛŒØ¯ Ø¯Ø§Ø±Ø¯: ${result.hasPurchases ? 'âœ… Ø¨Ù„Ù‡' : 'âŒ Ø®ÛŒØ±'}<br>
                    â€¢ Ù†ÙˆØ¹: Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§<br><br>
                    ${result.hasPurchases ? `
                    <strong>Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±:</strong><br>
                    ${result.purchases.map(p => 
                        `â€¢ ${p.sku}: ${new Date(p.purchaseTime).toLocaleDateString('fa-IR')} - ` +
                        `${p.isAutoRenewing ? 'ØªØ¬Ø¯ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±' : 'ØºÛŒØ±ÙØ¹Ø§Ù„'}`
                    ).join('<br>')}<br><br>
                    ` : ''}
                    <small>âœ… Ø³ÛŒØ³ØªÙ… Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø±Ø¯.</small>
                `;
                
                billingAdapter.updateResponseDisplay(result);
                billingAdapter.updateStats(true);
                
            } catch (error) {
                status.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                
                resultPanel.className = 'result-panel show result-error';
                resultPanel.innerHTML = `
                    <strong>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}
                `;
                
                billingAdapter.updateResponseDisplay({ error: error.code, message: error.message });
                billingAdapter.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ';
        }
        
        async function runTest5() {
            const status = document.getElementById('status-5');
            const resultPanel = document.getElementById('result-5');
            const btn = event.target;
            const subscriptionStatus = document.getElementById('subscription-status');
            const expiryDate = document.getElementById('expiry-date');
            
            status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ù…Ø¯ÛŒØ±ÛŒØª...';
            resultPanel.className = 'result-panel';
            resultPanel.innerHTML = '';
            
            try {
                // Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© Ø®Ø±ÛŒØ¯ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
                billingAdapter.purchases.push({
                    sku: 'vakamova.monthly',
                    purchaseToken: 'test_manage_token',
                    purchaseTime: Date.now() - 86400000 * 10,
                    isAcknowledged: true,
                    isAutoRenewing: true
                });
                
                // ØªØ³Øª Ù„ØºÙˆ Ø§Ø´ØªØ±Ø§Ú©
                const cancelResult = await billingAdapter.manageSubscription('vakamova.monthly', 'cancel');
                
                status.textContent = 'Ù…ÙˆÙÙ‚';
                subscriptionStatus.textContent = 'Ù„ØºÙˆ Ø´Ø¯Ù‡';
                expiryDate.textContent = new Date(cancelResult.expiresDate).toLocaleDateString('fa-IR');
                
                resultPanel.className = 'result-panel show result-success';
                resultPanel.innerHTML = `
                    <strong>âœ… Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø´ØªØ±Ø§Ú© Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬ Ù„ØºÙˆ:</strong><br>
                    â€¢ ÙˆØ¶Ø¹ÛŒØª: Ù„ØºÙˆ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²<br>
                    â€¢ ØªØ§Ø±ÛŒØ® Ù„ØºÙˆ: ${new Date(cancelResult.cancellationDate).toLocaleString('fa-IR')}<br>
                    â€¢ ØªØ§Ø±ÛŒØ® Ø§Ù†Ù‚Ø¶Ø§: ${new Date(cancelResult.expiresDate).toLocaleString('fa-IR')}<br>
                    â€¢ ØªØ¬Ø¯ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±: âŒ ØºÛŒØ±ÙØ¹Ø§Ù„<br><br>
                    <small>âœ… Ø³ÛŒØ³ØªÙ… Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø´ØªØ±Ø§Ú© Google Play ØªØ³Øª Ø´Ø¯.</small>
                `;
                
                billingAdapter.updateResponseDisplay(cancelResult);
                billingAdapter.updateStats(true);
                
            } catch (error) {
                status.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                subscriptionStatus.textContent = 'Ø®Ø·Ø§';
                expiryDate.textContent = '--';
                
                resultPanel.className = 'result-panel show result-error';
                resultPanel.innerHTML = `
                    <strong>âŒ Ø®Ø·Ø§ Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø´ØªØ±Ø§Ú©</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}
                `;
                
                billingAdapter.updateResponseDisplay({ error: error.code, message: error.message });
                billingAdapter.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø§Ø´ØªØ±Ø§Ú©';
        }
        
        async function runTest6() {
            const status = document.getElementById('status-6');
            const resultPanel = document.getElementById('result-6');
            const btn = event.target;
            
            status.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø®Ø·Ø§Ù‡Ø§...';
            resultPanel.className = 'result-panel';
            resultPanel.innerHTML = '';
            
            try {
                const result = await billingAdapter.testErrorScenarios();
                
                status.textContent = 'Ù…ÙˆÙÙ‚';
                
                resultPanel.className = 'result-panel show result-success';
                resultPanel.innerHTML = result.results + `<br><small>âœ… Û¶ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø®Ø·Ø§ÛŒ Google Play Billing ØªØ³Øª Ø´Ø¯Ù†Ø¯.</small>`;
                
                billingAdapter.updateResponseDisplay(result);
                billingAdapter.updateStats(true);
                
            } catch (error) {
                status.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                
                resultPanel.className = 'result-panel show result-error';
                resultPanel.innerHTML = `
                    <strong>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø®Ø·Ø§Ù‡Ø§</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}
                `;
                
                billingAdapter.updateResponseDisplay({ error: error.code, message: error.message });
                billingAdapter.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø®Ø·Ø§Ù‡Ø§';
        }
        
        // ========== Helper Functions ==========
        async function testPurchase(sku, price, currency) {
            billingAdapter.log(`ğŸ›’ Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø®Ø±ÛŒØ¯ Ù…Ø³ØªÙ‚ÛŒÙ…: ${sku} - ${price} ${currency}`);
            
            try {
                billingAdapter.resetSteps();
                const result = await billingAdapter.launchPurchaseFlow(sku, sku.includes('lifetime') ? 'inapp' : 'subs');
                
                if (result.success) {
                    alert(`âœ… Ø®Ø±ÛŒØ¯ Ù…ÙˆÙÙ‚!\n\nâ€¢ Ù…Ø­ØµÙˆÙ„: ${sku}\nâ€¢ Ù‚ÛŒÙ…Øª: ${price} ${currency}\nâ€¢ ÙˆØ¶Ø¹ÛŒØª: ${result.purchase ? 'ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡' : 'Ù…Ø¹Ù„Ù‚'}`);
                } else {
                    alert(`âš ï¸ Ø®Ø±ÛŒØ¯ Ø¯Ø± ÙˆØ¶Ø¹ÛŒØª Ù…Ø¹Ù„Ù‚\n\nÙ„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ Ø§Ù‚Ø¯Ø§Ù… Ú©Ù†ÛŒØ¯.`);
                }
            } catch (error) {
                alert(`âŒ Ø®Ø±ÛŒØ¯ Ù†Ø§Ù…ÙˆÙÙ‚\n\nØ®Ø·Ø§: ${error.message}\nÚ©Ø¯: ${error.code}`);
            }
        }
        
        async function runAllTests() {
            billingAdapter.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Û¶ ØªØ³Øª Google Play Billing...');
            billingAdapter.resetSteps();
            
            await simulateTestRun(1);
            await billingAdapter.delay(1500);
            
            await simulateTestRun(2);
            await billingAdapter.delay(1500);
            
            await simulateTestRun(3);
            await billingAdapter.delay(1500);
            
            await simulateTestRun(4);
            await billingAdapter.delay(1500);
            
            await simulateTestRun(5);
            await billingAdapter.delay(1500);
            
            await simulateTestRun(6);
            
            billingAdapter.log('ğŸ¯ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Google Play Billing Ú©Ø§Ù…Ù„ Ø´Ø¯Ù†Ø¯');
        }
        
        async function simulateCompleteFlow() {
            billingAdapter.log('ğŸª Ø´Ø±ÙˆØ¹ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Google Play...');
            
            try {
                // 1. Ø§ØªØµØ§Ù„
                billingAdapter.log('ğŸ”Œ Ù…Ø±Ø­Ù„Ù‡ 1: Ø§ØªØµØ§Ù„ Ø¨Ù‡ Billing Client');
                await billingAdapter.connectBillingClient();
                
                await billingAdapter.delay(1000);
                
                // 2. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª
                billingAdapter.log('ğŸ“¦ Ù…Ø±Ø­Ù„Ù‡ 2: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª');
                const skus = await billingAdapter.querySkus('subs');
                
                await billingAdapter.delay(1000);
                
                // 3. Ø®Ø±ÛŒØ¯
                billingAdapter.log('ğŸ›’ Ù…Ø±Ø­Ù„Ù‡ 3: Ø®Ø±ÛŒØ¯ Ù…Ø­ØµÙˆÙ„');
                const purchase = await billingAdapter.launchPurchaseFlow('vakamova.yearly', 'subs');
                
                // 4. Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
                billingAdapter.log('ğŸ’° Ù…Ø±Ø­Ù„Ù‡ 4: Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±');
                const purchases = await billingAdapter.queryPurchases('subs');
                
                billingAdapter.log(`ğŸ‰ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ù…ÙˆÙÙ‚! ${skus.count} Ù…Ø­ØµÙˆÙ„ØŒ ${purchases.count} Ø®Ø±ÛŒØ¯`);
                
                alert(`âœ… Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Google Play Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯!\n\nâ€¢ Ø§ØªØµØ§Ù„: Ù…ÙˆÙÙ‚\nâ€¢ Ù…Ø­ØµÙˆÙ„Ø§Øª: ${skus.count} Ø¢ÛŒØªÙ…\nâ€¢ Ø®Ø±ÛŒØ¯: ${purchase.success ? 'Ù…ÙˆÙÙ‚' : 'Ù…Ø¹Ù„Ù‚'}\nâ€¢ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ: ${purchases.count}`);
                
            } catch (error) {
                billingAdapter.log(`âŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${error.message}`);
                alert(`âŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${error.message}`);
            }
        }
        
        async function simulateTestRun(testNumber) {
            const btn = document.querySelector(`button[onclick="runTest${testNumber}()"]`);
            if (btn) {
                const event = { target: btn };
                switch(testNumber) {
                    case 1: await runTest1(event); break;
                    case 2: await runTest2(event); break;
                    case 3: await runTest3(event); break;
                    case 4: await runTest4(event); break;
                    case 5: await runTest5(event); break;
                    case 6: await runTest6(event); break;
                }
            }
        }
        
        function resetAllTests() {
            // Ø±ÛŒØ³Øª ÙˆØ¶Ø¹ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§
            for (let i = 1; i <= 6; i++) {
                const status = document.getElementById(`status-${i}`);
                const result = document.getElementById(`result-${i}`);
                
                if (status) {
                    status.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                }
                if (result) {
                    result.className = 'result-panel';
                    result.innerHTML = '';
                }
            }
            
            // Ø±ÛŒØ³Øª Ù…Ø±Ø§Ø­Ù„
            billingAdapter.resetSteps();
            
            // Ø±ÛŒØ³Øª Ù†Ù…Ø§ÛŒØ´â€ŒÙ‡Ø§
            document.getElementById('billing-status').textContent = 'Not Connected';
            document.getElementById('sku-loaded').textContent = '0';
            document.getElementById('previous-purchases').textContent = '0';
            document.getElementById('subscription-status').textContent = 'ÙØ¹Ø§Ù„';
            document.getElementById('expiry-date').textContent = '--';
            
            // Ø±ÛŒØ³Øª Ø¢Ù…Ø§Ø±
            document.getElementById('test-success').textContent = '0%';
            document.getElementById('request-count').textContent = '0';
            document.getElementById('execution-time').textContent = '0ms';
            
            // Ø±ÛŒØ³Øª Ú©Ù†Ø³ÙˆÙ„
            document.getElementById('console-output').innerHTML = '';
            
            // Ø±ÛŒØ³Øª Ù¾Ø§Ø³Ø®
            document.getElementById('billing-response').textContent = JSON.stringify({
                status: "ready",
                environment: "SANDBOX",
                message: "Google Play Billing simulator ready"
            }, null, 2);
            
            billingAdapter.log('â™»ï¸ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯');
        }
        
        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
            billingAdapter.log('Ú©Ù†Ø³ÙˆÙ„ Ù¾Ø§Ú© Ø´Ø¯');
        }
        
        // ========== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ==========
        document.addEventListener('DOMContentLoaded', () => {
            billingAdapter.log('ğŸª ØªØ³Øª Ø¢Ø¯Ø§Ù¾ØªØ± Google Play Billing Vakamova Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§');
            billingAdapter.log('âœ… Û¶ ØªØ³Øª ØªØ®ØµØµÛŒ Ùˆ Û³ Ù…Ø­ØµÙˆÙ„ Ø¨Ø±Ø§ÛŒ ØªØ³Øª ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯');
            
            // ØªÙ†Ø¸ÛŒÙ… Ø§ÙˆÙ„ÛŒÙ‡
            document.getElementById('sku-count').textContent = billingAdapter.skuList.length;
        });
    </script>
</body>
                          </html>
