<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª ÙÙˆØ±ÛŒ Lesson Engine</title>
    <style>
        body { font-family: Tahoma; direction: rtl; padding: 20px; }
        .result { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ¯ ØªØ³Øª Ø³Ø±ÛŒØ¹ Lesson Engine</h1>
    
    <div id="tests">
        <button onclick="runAllTests()">â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
        <div id="results"></div>
    </div>

    <script type="module">
        // Ø§ÛŒÙ…Ù¾ÙˆØ±Øª ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ Ø§Ø² Ù‡Ù…Ø§Ù† Ù¾ÙˆØ´Ù‡
        import { LessonEngine } from './lesson-engine.js';
        
        // Mock ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
        const mockDB = {
            query: () => ({
                where: () => ({ andWhere: () => ({ with: () => ({ first: () => ({ id: 'test', title: 'ØªØ³Øª' }) }) }) })
            })
        };
        
        const mockEventBus = { publish: () => console.log('Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ù†ØªØ´Ø± Ø´Ø¯') };
        const mockProgressTracker = {
            startSession: async () => {},
            recordExerciseResult: async () => {},
            completeLesson: async () => {},
            getUserProgress: async () => ({ completedLessons: 2, overallScore: 80, timeSpent: 3600, lastActive: new Date() })
        };
        
        let engine;
        
        async function runAllTests() {
            const results = document.getElementById('results');
            results.innerHTML = '';
            
            try {
                // ØªØ³Øª Û±: Ø³Ø§Ø®Øª Ù…ÙˆØªÙˆØ±
                engine = new LessonEngine({
                    database: mockDB,
                    eventBus: mockEventBus,
                    progressTracker: mockProgressTracker
                });
                addResult('âœ… ØªØ³Øª Û±: Ù…ÙˆØªÙˆØ± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯', 'success');
                
                // ØªØ³Øª Û²: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯ÙˆØ±Ù‡
                const course = await engine.loadCourse('english_beginners', 'en');
                addResult(`âœ… ØªØ³Øª Û²: Ø¯ÙˆØ±Ù‡ "${course.title}" Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'success');
                
                // ØªØ³Øª Û³: Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³
                const session = await engine.startLesson('lesson_1', 'user_123');
                addResult(`âœ… ØªØ³Øª Û³: Ø¬Ù„Ø³Ù‡ "${session.id}" Ø´Ø±ÙˆØ¹ Ø´Ø¯`, 'success');
                
                // ØªØ³Øª Û´: Ø§Ø±Ø³Ø§Ù„ ØªÙ…Ø±ÛŒÙ†
                const result = await engine.submitExercise({
                    sessionId: session.id,
                    exerciseId: 'ex_1',
                    answers: ['A', 'B', 'C'],
                    timeSpent: 30
                });
                addResult(`âœ… ØªØ³Øª Û´: ØªÙ…Ø±ÛŒÙ† Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯ (Ø§Ù…ØªÛŒØ§Ø²: ${result.score})`, 'success');
                
                // ØªØ³Øª Ûµ: Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´Ø±ÙØª
                const progress = await engine.getProgress('user_123', 'english_beginners');
                addResult(`âœ… ØªØ³Øª Ûµ: Ù¾ÛŒØ´Ø±ÙØª Ú©Ø§Ø±Ø¨Ø±: ${progress.completionPercentage}%`, 'success');
                
                addResult('<br><strong>ğŸ‰ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø´ØªÙ†Ø¯!</strong>', 'success');
                
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø§: ${error.message}`, 'error');
            }
        }
        
        function addResult(message, className) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${className}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
    </script>
</body>
</html>
