<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Ù…Ù…ÛŒØ²ÛŒ Ù‡Ø³ØªÙ‡ Vakamova - Core Auditor</title>
    <style>
        :root {
            --primary: #0d7377;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            --dark: #1a1a2e;
            --light: #f8f9fa;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Vazirmatn', sans-serif; }
        body { background: linear-gradient(135deg, var(--dark) 0%, #16213e 100%); color: var(--light); min-height: 100vh; padding: 20px; }
        
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 40px; padding: 30px; background: rgba(255,255,255,0.05); border-radius: 20px; border: 2px solid var(--primary); }
        h1 { color: #14ffec; font-size: 2.8rem; margin-bottom: 10px; }
        .subtitle { color: #8892b0; font-size: 1.2rem; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .stat-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .stat-card h3 { color: #8892b0; font-size: 1rem; margin-bottom: 10px; }
        .stat-card .value { font-size: 2.5rem; font-weight: bold; }
        .stat-card.success .value { color: var(--success); }
        .stat-card.warning .value { color: var(--warning); }
        
        .modules-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 30px 0; }
        .module-card { background: rgba(17,34,64,0.8); border-radius: 15px; padding: 20px; border: 2px solid transparent; transition: all 0.3s; }
        .module-card.loaded { border-color: var(--success); }
        .module-card.error { border-color: var(--danger); }
        .module-card.pending { border-color: var(--warning); }
        
        .module-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .module-name { font-size: 1.3rem; font-weight: bold; color: #14ffec; }
        .module-status { padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; }
        .status-loaded { background: rgba(76,175,80,0.2); color: var(--success); }
        .status-error { background: rgba(244,67,54,0.2); color: var(--danger); }
        .status-pending { background: rgba(255,152,0,0.2); color: var(--warning); }
        .status-waiting { background: rgba(33,150,243,0.2); color: #2196f3; }
        
        .module-deps { margin: 15px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 10px; }
        .dep-item { display: inline-block; padding: 3px 10px; margin: 3px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.85rem; }
        .dep-item.missing { background: rgba(244,67,54,0.3); color: #ff8a8a; }
        .dep-item.loaded { background: rgba(76,175,80,0.3); color: #a5d6a7; }
        
        .test-buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .btn-test { background: var(--primary); color: white; }
        .btn-test:hover { background: #0a5f62; transform: translateY(-2px); }
        .btn-load { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); }
        .btn-load:hover { background: rgba(255,255,255,0.2); }
        .btn-load:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .controls { display: flex; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .btn-main { padding: 15px 30px; font-size: 1.1rem; background: linear-gradient(135deg, var(--primary) 0%, #14ffec 100%); color: black; font-weight: bold; }
        .btn-smart { background: linear-gradient(135deg, #9c27b0 0%, #e91e63 100%); }
        
        .logs-container { background: rgba(0,0,0,0.5); border-radius: 10px; padding: 20px; margin-top: 30px; max-height: 400px; overflow-y: auto; }
        .log-entry { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); font-family: 'Courier New', monospace; }
        .log-timestamp { color: #8892b0; font-size: 0.9rem; }
        .log-success { color: var(--success); border-left: 4px solid var(--success); padding-left: 15px; }
        .log-error { color: var(--danger); border-left: 4px solid var(--danger); padding-left: 15px; }
        .log-warning { color: var(--warning); border-left: 4px solid var(--warning); padding-left: 15px; }
        .log-info { color: #64b5f6; border-left: 4px solid #64b5f6; padding-left: 15px; }
        
        .progress-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 20px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #14ffec); width: 0%; transition: width 0.5s; }
        
        .dependency-graph { margin: 30px 0; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 10px; }
        .graph-node { display: inline-block; padding: 8px 15px; margin: 5px; background: rgba(255,255,255,0.1); border-radius: 5px; }
        .graph-arrow { color: #14ffec; margin: 0 10px; }
        
        @media (max-width: 768px) {
            .modules-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
            .btn-main { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ” Ù…Ù…ÛŒØ²ÛŒ Ù‡Ø³ØªÙ‡ Vakamova</h1>
            <p class="subtitle">Ø¨Ø±Ø±Ø³ÛŒ Û±Û³ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ core/ - ØªØ³Øª Ù…Ø³ØªÙ‚Ù„ Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø®Ø§Ø±Ø¬ÛŒ</p>
        </header>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card success">
                <h3>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡</h3>
                <div class="value" id="loadedCount">0</div>
            </div>
            <div class="stat-card success">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚</h3>
                <div class="value" id="passedCount">0</div>
            </div>
            <div class="stat-card warning">
                <h3>Ø®Ø·Ø§Ù‡Ø§</h3>
                <div class="value" id="errorCount">0</div>
            </div>
            <div class="stat-card">
                <h3>ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
                <div class="value" id="depCount">0</div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="controls">
            <button class="btn btn-main" onclick="loadAllCoreFiles()">ğŸ“¥ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Core</button>
            <button class="btn btn-main btn-smart" onclick="loadSmartSequence()">ğŸ§  Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ (ØªØ±ØªÛŒØ¨ ØµØ­ÛŒØ­)</button>
            <button class="btn btn-main" onclick="runAllTests()">âš¡ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button class="btn btn-main" onclick="analyzeDependencies()">ğŸ”— ØªØ­Ù„ÛŒÙ„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§</button>
            <button class="btn btn-main" onclick="clearLogs()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯Ø²Ø§Ø±Ø´</button>
        </div>
        
        <div id="modulesContainer" class="modules-grid">
            <!-- Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div class="logs-container" id="logsContainer">
            <!-- Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
    </div>
    
    <script>
        // ==================== Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ CORE ====================
        const CORE_MODULES = [
            { 
                id: 'event_bus',
                name: 'Event Bus', 
                path: 'core/event_bus.js', 
                dependencies: [],
                test: () => testEventBus()
            },
            { 
                id: 'state_manager',
                name: 'State Manager', 
                path: 'core/state_manager.js', 
                dependencies: ['event_bus'],
                test: () => testStateManager()
            },
            { 
                id: 'context_provider',
                name: 'Context Provider', 
                path: 'core/context_provider.js', 
                dependencies: ['event_bus'],
                test: () => testContextProvider()
            },
            { 
                id: 'api_client',
                name: 'API Client', 
                path: 'core/api_client.js', 
                dependencies: ['event_bus', 'utils'],
                test: () => testApiClient()
            },
            { 
                id: 'router_middleware',
                name: 'Router Middleware', 
                path: 'core/router_middleware.js', 
                dependencies: ['router', 'state_manager'],
                test: () => testRouterMiddleware()
            },
            { 
                id: 'guards',
                name: 'Route Guards', 
                path: 'core/guards.js', 
                dependencies: ['router', 'state_manager'],
                test: () => testGuards()
            },
            { 
                id: 'state',
                name: 'State (Ù¾Ø§ÛŒÙ‡)', 
                path: 'core/state.js', 
                dependencies: [],
                test: () => testBaseState()
            },
            { 
                id: 'router',
                name: 'Router', 
                path: 'core/router.js', 
                dependencies: ['event_bus', 'state_manager'],
                test: () => testRouter()
            },
            { 
                id: 'database',
                name: 'Database', 
                path: 'core/database.js', 
                dependencies: ['utils'],
                test: () => testDatabase()
            },
            { 
                id: 'api',
                name: 'API (Ù¾Ø§ÛŒÙ‡)', 
                path: 'core/api.js', 
                dependencies: ['utils'],
                test: () => testBaseApi()
            },
            { 
                id: 'utils',
                name: 'Utilities', 
                path: 'core/utils.js', 
                dependencies: [],
                test: () => testUtilities()
            },
            { 
                id: 'config',
                name: 'Config Manager', 
                path: 'core/config.js', 
                dependencies: ['utils'],
                test: () => testConfig()
            },
            { 
                id: 'font_manager',
                name: 'Font Manager', 
                path: 'core/font_manager.js', 
                dependencies: ['utils'],
                test: () => testFontManager()
            }
        ];
        
        // ==================== ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ù†Ø§Ù…Ù‡ ====================
        const appState = {
            loadedModules: new Map(),
            testResults: { passed: 0, failed: 0, total: 0 },
            dependencies: new Map(),
            logs: [],
            moduleMap: new Map()
        };
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù‚Ø´Ù‡ Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹
        CORE_MODULES.forEach((module, index) => {
            appState.moduleMap.set(module.id, { index, module });
        });
        
        // ==================== Ø³ÛŒØ³ØªÙ… Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ ====================
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const logEntry = { message, type, timestamp };
            appState.logs.push(logEntry);
            
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${type}`;
            logElement.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span>${message}</span>
            `;
            
            document.getElementById('logsContainer').prepend(logElement);
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            updateStats();
            return logEntry;
        }
        
        // ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ====================
        async function loadSmartSequence() {
            log('ğŸ§  Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§ ØªØ±ØªÛŒØ¨ ØµØ­ÛŒØ­ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§...', 'info');
            document.getElementById('progressFill').style.width = '0%';
            
            const total = CORE_MODULES.length;
            let loaded = 0;
            let iteration = 0;
            const maxIterations = total * 2; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ù„Ù‚Ù‡ Ø¨ÛŒâ€ŒÙ†Ù‡Ø§ÛŒØª
            
            // Ø±ÛŒØ³Øª ÙˆØ¶Ø¹ÛŒØª
            appState.loadedModules.clear();
            createModuleCards(); // Ø¨Ø§Ø²Ø³Ø§Ø²ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
            
            while (loaded < total && iteration < maxIterations) {
                iteration++;
                let loadedThisRound = 0;
                
                for (let i = 0; i < CORE_MODULES.length; i++) {
                    const module = CORE_MODULES[i];
                    
                    // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ØŒ Ø±Ø¯ Ø´Ùˆ
                    if (appState.loadedModules.has(module.id)) {
                        continue;
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
                    const missingDeps = module.dependencies.filter(dep => 
                        !appState.loadedModules.has(dep)
                    );
                    
                    if (missingDeps.length === 0) {
                        // Ù‡Ù…Ù‡ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ù‡Ø³ØªÙ†Ø¯
                        const success = await loadModule(i);
                        if (success) {
                            loaded++;
                            loadedThisRound++;
                        }
                        
                        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
                        const progress = (loaded / total) * 100;
                        document.getElementById('progressFill').style.width = `${progress}%`;
                        
                        // ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ù‡ØªØ±
                        await new Promise(resolve => setTimeout(resolve, 300));
                    } else {
                        // Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Øª Ø¨Ø±Ø§ÛŒ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…ÙÙ‚ÙˆØ¯
                        updateModuleCard(i, 'waiting', missingDeps);
                    }
                }
                
                if (loadedThisRound === 0 && loaded < total) {
                    log(`âš ï¸ Ø¯ÙˆØ± ${iteration}: Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯. ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø­Ù„ Ù†Ø´Ø¯Ù‡ Ù…Ø§Ù†Ø¹ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.`, 'warning');
                    break;
                }
            }
            
            if (loaded === total) {
                log(`ğŸ‰ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ú©Ø§Ù…Ù„ Ø´Ø¯: Ù‡Ù…Ù‡ ${total} ÙØ§ÛŒÙ„ Ø¨Ø§ ØªØ±ØªÛŒØ¨ ØµØ­ÛŒØ­ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯`, 'success');
            } else {
                log(`âš ï¸ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù†Ø§ØªÙ…Ø§Ù…: ${loaded} Ø§Ø² ${total} ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'warning');
            }
            
            return { loaded, total };
        }
        
        // ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„ ====================
        async function loadModule(moduleIndex) {
            const module = CORE_MODULES[moduleIndex];
            
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù‡Ø§ÛŒÛŒ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
                const missingDeps = module.dependencies.filter(dep => 
                    !appState.loadedModules.has(dep)
                );
                
                if (missingDeps.length > 0) {
                    log(`â³ ${module.name} Ù…Ù†ØªØ¸Ø± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ: ${missingDeps.join(', ')}`, 'warning');
                    updateModuleCard(moduleIndex, 'waiting', missingDeps);
                    return false;
                }
                
                log(`ğŸ“¦ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${module.name}...`, 'info');
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„
                await new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = module.path;
                    script.type = 'module';
                    
                    script.onload = () => {
                        appState.loadedModules.set(module.id, { 
                            loaded: true, 
                            path: module.path,
                            dependencies: module.dependencies,
                            name: module.name
                        });
                        updateModuleCard(moduleIndex, 'loaded');
                        log(`âœ… ${module.name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'success');
                        resolve();
                    };
                    
                    script.onerror = (err) => {
                        console.error('Ø®Ø·Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ:', err);
                        reject(new Error(`Ø®Ø·Ø§ÛŒ 404 ÛŒØ§ Ù…Ø´Ú©Ù„ Ø´Ø¨Ú©Ù‡: ${module.path}`));
                    };
                    
                    document.head.appendChild(script);
                });
                
                return true;
            } catch (error) {
                updateModuleCard(moduleIndex, 'error');
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${module.name}: ${error.message}`, 'error');
                return false;
            }
        }
        
        async function loadAllCoreFiles() {
            log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Core (Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø§ÛŒÙ†Ø¯Ú©Ø³)...', 'info');
            document.getElementById('progressFill').style.width = '0%';
            
            let loaded = 0;
            const total = CORE_MODULES.length;
            
            for (let i = 0; i < total; i++) {
                const success = await loadModule(i);
                if (success) loaded++;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
                const progress = (loaded / total) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                
                // ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ù‡ØªØ±
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            log(`ğŸ“¦ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯: ${loaded} Ø§Ø² ${total} ÙØ§ÛŒÙ„`, 'info');
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ ØªØ³Øª Ù‡Ø± Ù…Ø§Ú˜ÙˆÙ„ ====================
        function testEventBus() {
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ EventBus
                const eventBusExists = typeof eventBus !== 'undefined' || 
                                      typeof HyperEventBus !== 'undefined' ||
                                      typeof window.EventBus !== 'undefined';
                
                if (!eventBusExists) {
                    return { success: false, message: 'Ù‡ÛŒÚ† Ù†Ù…ÙˆÙ†Ù‡ EventBus ÛŒØ§ÙØª Ù†Ø´Ø¯' };
                }
                
                // ØªØ³Øª Ø¹Ù…Ù„Ú©Ø±Ø¯
                let testPassed = false;
                const testEvent = 'core:auditor:test:' + Date.now();
                
                // Ø³Ø¹ÛŒ Ú©Ù† Ø§Ø² eventBus Ø¬Ù‡Ø§Ù†ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒ
                const bus = eventBus || window.eventBus || 
                          (typeof HyperEventBus !== 'undefined' ? new HyperEventBus() : null);
                
                if (bus && typeof bus.on === 'function' && typeof bus.emit === 'function') {
                    const unsubscribe = bus.on(testEvent, () => testPassed = true);
                    bus.emit(testEvent, { test: true });
                    
                    // Ú©Ù…ÛŒ ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±ÙˆÛŒØ¯Ø§Ø¯
                    setTimeout(() => {
                        unsubscribe();
                    }, 50);
                    
                    return testPassed ? 
                        { success: true, message: 'EventBus ÙØ¹Ø§Ù„ Ùˆ Ù¾Ø§Ø³Ø®Ú¯Ùˆ Ø§Ø³Øª' } :
                        { success: false, message: 'EventBus Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù†Ú©Ø±Ø¯' };
                }
                
                return { success: false, message: 'EventBus API Ù…Ø¹ØªØ¨Ø± Ù†Ø¯Ø§Ø±Ø¯' };
            } catch (error) {
                return { success: false, message: `Ø®Ø·Ø§ÛŒ ØªØ³Øª: ${error.message}` };
            }
        }
        
        function testStateManager() {
            try {
                if (typeof HyperStateManager === 'undefined') {
                    return { success: false, message: 'Ú©Ù„Ø§Ø³ HyperStateManager ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡' };
                }
                
                // Ø§ÛŒØ¬Ø§Ø¯ EventBus Ù…ÙˆÙ‚Øª Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
                let eventBus = window.eventBus;
                if (!eventBus && typeof HyperEventBus !== 'undefined') {
                    eventBus = new HyperEventBus();
                }
                
                if (!eventBus) {
                    return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ EventBus Ø¯Ø§Ø±Ø¯ (ÙˆØ¶Ø¹ÛŒØª: ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ø±Ø¢ÙˆØ±Ø¯Ù‡ Ù†Ø´Ø¯Ù‡)' };
                }
                
                const state = new HyperStateManager(eventBus);
                const testKey = 'auditor.test.' + Date.now();
                const testValue = { timestamp: Date.now(), data: 'test' };
                
                state.set(testKey, testValue);
                const retrieved = state.get(testKey);
                
                return retrieved && retrieved.data === testValue.data ?
                    { success: true, message: 'StateManager Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡/Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯' } :
                    { success: false, message: 'StateManager Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø±Ø³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ú©Ø±Ø¯' };
            } catch (error) {
                return { success: false, message: `Ø®Ø·Ø§ÛŒ ØªØ³Øª: ${error.message}` };
            }
        }
        
        function testUtilities() {
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ utilities
                const utilsExist = typeof window.Utils !== 'undefined' || 
                                  typeof window.utils !== 'undefined' ||
                                  typeof window.UTILS !== 'undefined';
                
                if (utilsExist) {
                    return { success: true, message: 'Utilities Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª' };
                }
                
                // ØªØ³Øª ØªÙˆØ§Ø¨Ø¹ Ù¾Ø§ÛŒÙ‡
                const testObj = { a: 1, b: { c: 2 } };
                const jsonStr = JSON.stringify(testObj);
                const parsedObj = JSON.parse(jsonStr);
                
                return parsedObj.a === testObj.a && parsedObj.b.c === testObj.b.c ?
                    { success: true, message: 'ØªÙˆØ§Ø¨Ø¹ Ù¾Ø§ÛŒÙ‡ JS Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯' } :
                    { success: false, message: 'Ù…Ø´Ú©Ù„ Ø¯Ø± Ù…Ø­ÛŒØ· Ø§Ø¬Ø±Ø§ÛŒ JS' };
            } catch (error) {
                return { success: false, message: `Ø®Ø·Ø§ÛŒ ØªØ³Øª: ${error.message}` };
            }
        }
        
        function testRouter() {
            try {
                const routerExists = typeof window.Router !== 'undefined' || 
                                    typeof window.router !== 'undefined';
                
                return routerExists ? 
                    { success: true, message: 'Router Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª' } :
                    { success: false, message: 'Router ÛŒØ§ÙØª Ù†Ø´Ø¯' };
            } catch (error) {
                return { success: false, message: `Ø®Ø·Ø§ÛŒ ØªØ³Øª: ${error.message}` };
            }
        }
        
        function testDatabase() {
            try {
                const dbExists = typeof window.Database !== 'undefined' || 
                                typeof window.db !== 'undefined' ||
                                typeof window.AppDatabase !== 'undefined';
                
                return dbExists ? 
                    { success: true, message: 'Database Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª' } :
                    { success: false, message: 'Database ÛŒØ§ÙØª Ù†Ø´Ø¯' };
            } catch (error) {
                return { success: false, message: `Ø®Ø·Ø§ÛŒ ØªØ³Øª: ${error.message}` };
            }
        }
        
        // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§
        function testContextProvider() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ EventBus Ø¯Ø§Ø±Ø¯' };
        }
        
        function testApiClient() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ EventBus Ùˆ Utilities Ø¯Ø§Ø±Ø¯' };
        }
        
        function testRouterMiddleware() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Router Ùˆ StateManager Ø¯Ø§Ø±Ø¯' };
        }
        
        function testGuards() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Router Ùˆ StateManager Ø¯Ø§Ø±Ø¯' };
        }
        
        function testBaseState() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        function testBaseApi() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        function testConfig() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        function testFontManager() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        // ==================== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        async function runModuleTest(moduleIndex) {
            const module = CORE_MODULES[moduleIndex];
            
            if (!appState.loadedModules.has(module.id)) {
                log(`âš ï¸ Ø§Ø¨ØªØ¯Ø§ ${module.name} Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯`, 'warning');
                return;
            }
            
            log(`ğŸ§ª Ø´Ø±ÙˆØ¹ ØªØ³Øª ${module.name}...`, 'info');
            
            try {
                const result = await module.test();
                
                if (result.success) {
                    appState.testResults.passed++;
                    log(`âœ… ${module.name}: ${result.message}`, 'success');
                    updateModuleCard(moduleIndex, 'loaded', [], true);
                } else {
                    appState.testResults.failed++;
                    log(`âŒ ${module.name}: ${result.message}`, 'error');
                }
                
                appState.testResults.total++;
                updateStats();
            } catch (error) {
                appState.testResults.failed++;
                appState.testResults.total++;
                log(`ğŸ’¥ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª ${module.name}: ${error.message}`, 'error');
            }
        }
        
        async function runAllTests() {
            log('âš¡ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§...', 'info');
            
            appState.testResults = { passed: 0, failed: 0, total: 0 };
            
            for (let i = 0; i < CORE_MODULES.length; i++) {
                if (appState.loadedModules.has(CORE_MODULES[i].id)) {
                    await runModuleTest(i);
                    await new Promise(resolve => setTimeout(resolve, 200));
                } else {
                    log(`â­ï¸ Ø±Ø¯ Ú©Ø±Ø¯Ù† ${CORE_MODULES[i].name} (Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯Ù‡)`, 'warning');
                }
            }
            
            log(`ğŸ“Š ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯: ${appState.testResults.passed} Ù…ÙˆÙÙ‚ØŒ ${appState.testResults.failed} Ù†Ø§Ù…ÙˆÙÙ‚`, 'info');
        }
        
        // ==================== ØªØ­Ù„ÛŒÙ„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ ====================
        function analyzeDependencies() {
            log('ğŸ”— ØªØ­Ù„ÛŒÙ„ Ú¯Ø±Ø§Ù ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§...', 'info');
            
            const dependencyGraph = document.createElement('div');
            dependencyGraph.className = 'dependency-graph';
            dependencyGraph.innerHTML = '<h3>ğŸ“Š Ù†Ù…ÙˆØ¯Ø§Ø± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§:</h3>';
            
            CORE_MODULES.forEach(module => {
                const deps = module.dependencies;
                if (deps.length > 0) {
                    deps.forEach(depId => {
                        const depModule = CORE_MODULES.find(m => m.id === depId);
                        if (depModule) {
                            const node = document.createElement('div');
                            node.innerHTML = `
                                <span class="graph-node">${depModule.name}</span>
                                <span class="graph-arrow">â†’</span>
                                <span class="graph-node">${module.name}</span>
                            `;
                            dependencyGraph.appendChild(node);
                        }
                    });
                }
            });
            
            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ØµÙØ­Ù‡
            const existingGraph = document.querySelector('.dependency-graph');
            if (existingGraph) {
                existingGraph.remove();
            }
            
            document.querySelector('.container').insertBefore(
                dependencyGraph, 
                document.getElementById('modulesContainer')
            );
            
            log('âœ… ØªØ­Ù„ÛŒÙ„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯. Ù†Ù…ÙˆØ¯Ø§Ø± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.', 'success');
        }
        
        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI ====================
        function updateModuleCard(index, status, missingDeps = [], tested = false) {
            const card = document.querySelector(`[data-module-index="${index}"]`);
            if (!card) return;
            
            // Ø¢Ù¾Ø¯ÛŒØª Ú©Ù„Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
            card.className = `module-card ${status}`;
            
            // Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¶Ø¹ÛŒØª
            const statusEl = card.querySelector('.module-status');
            statusEl.className = `module-status status-${status}`;
            
            let statusText = '';
            switch(status) {
                case 'loaded': statusText = tested ? 'âœ… ØªØ³Øª Ø´Ø¯' : 'ğŸ“¦ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ'; break;
                case 'error': statusText = 'âŒ Ø®Ø·Ø§'; break;
                case 'waiting': statusText = 'â³ Ù…Ù†ØªØ¸Ø± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ'; break;
                default: statusText = 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
            }
            statusEl.textContent = statusText;
            
            // Ø¢Ù¾Ø¯ÛŒØª Ø¨Ø®Ø´ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
            const depsContainer = card.querySelector('.module-deps');
            if (depsContainer && missingDeps.length > 0) {
                depsContainer.innerHTML = `
                    <div>ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…ÙÙ‚ÙˆØ¯:</div>
                    ${missingDeps.map(depId => {
                        const depModule = CORE_MODULES.find(m => m.id === depId);
                        return `<span class="dep-item missing">${depModule ? depModule.name : depId}</span>`;
                    }).join('')}
                `;
            }
            
            // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡ ØªØ³Øª
            const testBtn = card.querySelector('.btn-test');
            if (testBtn) {
                testBtn.disabled = status !== 'loaded';
            }
        }
        
        function updateStats() {
            document.getElementById('loadedCount').textContent = appState.loadedModules.size;
            document.getElementById('passedCount').textContent = appState.testResults.passed;
            document.getElementById('errorCount').textContent = appState.testResults.failed;
            
            // Ø´Ù…Ø§Ø±Ø´ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
            let depCount = 0;
            CORE_MODULES.forEach(module => {
                depCount += module.dependencies.filter(dep => 
                    appState.loadedModules.has(dep)
                ).length;
            });
            document.getElementById('depCount').textContent = depCount;
        }
        
        function clearLogs() {
            document.getElementById('logsContainer').innerHTML = '';
            appState.logs = [];
            log('ğŸ—‘ï¸ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'info');
        }
        
        // ==================== Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ====================
        function createModuleCards() {
            const container = document.getElementById('modulesContainer');
            container.innerHTML = '';
            
            CORE_MODULES.forEach((module, index) => {
                const card = document.createElement('div');
                card.className = 'module-card pending';
                card.setAttribute('data-module-index', index);
                
                // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…Ø§ÛŒØ´ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
                const depsHtml = module.dependencies.length > 0 ? 
                    `ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ: ${module.dependencies.map(d => 
                        `<span class="dep-item">${d}</span>`
                    ).join('')}` : 
                    'Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ';
                
                card.innerHTML = `
                    <div class="module-header">
                        <div class="module-name">${module.name}</div>
                        <div class="module-status status-pending">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                    </div>
                    <div class="module-deps">
                        ${depsHtml}
                    </div>
                    <div class="test-buttons">
                        <button class="btn btn-load" onclick="loadModule(${index})">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
                        <button class="btn btn-test" onclick="runModuleTest(${index})" disabled>ØªØ³Øª</button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        window.addEventListener('DOMContentLoaded', () => {
            createModuleCards();
            log('ğŸ” Ù…Ù…ÛŒØ²ÛŒ Ù‡Ø³ØªÙ‡ Vakamova Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª', 'success');
            log(`Ù‡Ø¯Ù: Ø¨Ø±Ø±Ø³ÛŒ ${CORE_MODULES.length} ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ`, 'info');
            log('ØªÙˆØµÛŒÙ‡: Ø§Ø² Ø¯Ú©Ù…Ù‡ "Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯" Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨Ø§ ØªØ±ØªÛŒØ¨ ØµØ­ÛŒØ­ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯', 'warning');
            
            // Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ú©Ù†Ø³ÙˆÙ„ (Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²)
            window.CoreAuditor = {
                loadAll: loadAllCoreFiles,
                loadSmart: loadSmartSequence,
                testAll: runAllTests,
                analyze: analyzeDependencies,
                getState: () => ({ 
                    loaded: appState.loadedModules.size,
                    total: CORE_MODULES.length,
                    tests: appState.testResults,
                    modules: Array.from(appState.loadedModules.keys())
                }),
                log
            };
        });
    </script>
</body>
</html>
