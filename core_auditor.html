<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” Ù…Ù…ÛŒØ²ÛŒ Ù‡Ø³ØªÙ‡ Vakamova - Core Auditor</title>
    <style>
        :root {
            --primary: #0d7377;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #f44336;
            --dark: #1a1a2e;
            --light: #f8f9fa;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Vazirmatn', sans-serif; }
        body { background: linear-gradient(135deg, var(--dark) 0%, #16213e 100%); color: var(--light); min-height: 100vh; padding: 20px; }
        
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 40px; padding: 30px; background: rgba(255,255,255,0.05); border-radius: 20px; border: 2px solid var(--primary); }
        h1 { color: #14ffec; font-size: 2.8rem; margin-bottom: 10px; }
        .subtitle { color: #8892b0; font-size: 1.2rem; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0; }
        .stat-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .stat-card h3 { color: #8892b0; font-size: 1rem; margin-bottom: 10px; }
        .stat-card .value { font-size: 2.5rem; font-weight: bold; }
        .stat-card.success .value { color: var(--success); }
        .stat-card.warning .value { color: var(--warning); }
        
        .modules-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 30px 0; }
        .module-card { background: rgba(17,34,64,0.8); border-radius: 15px; padding: 20px; border: 2px solid transparent; transition: all 0.3s; }
        .module-card.loaded { border-color: var(--success); }
        .module-card.error { border-color: var(--danger); }
        .module-card.pending { border-color: var(--warning); }
        
        .module-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .module-name { font-size: 1.3rem; font-weight: bold; color: #14ffec; }
        .module-status { padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; }
        .status-loaded { background: rgba(76,175,80,0.2); color: var(--success); }
        .status-error { background: rgba(244,67,54,0.2); color: var(--danger); }
        .status-pending { background: rgba(255,152,0,0.2); color: var(--warning); }
        
        .module-deps { margin: 15px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 10px; }
        .dep-item { display: inline-block; padding: 3px 10px; margin: 3px; background: rgba(255,255,255,0.1); border-radius: 5px; font-size: 0.85rem; }
        
        .test-buttons { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .btn-test { background: var(--primary); color: white; }
        .btn-test:hover { background: #0a5f62; transform: translateY(-2px); }
        .btn-load { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3); }
        .btn-load:hover { background: rgba(255,255,255,0.2); }
        
        .controls { display: flex; gap: 20px; margin: 30px 0; flex-wrap: wrap; }
        .btn-main { padding: 15px 30px; font-size: 1.1rem; background: linear-gradient(135deg, var(--primary) 0%, #14ffec 100%); color: black; font-weight: bold; }
        
        .logs-container { background: rgba(0,0,0,0.5); border-radius: 10px; padding: 20px; margin-top: 30px; max-height: 400px; overflow-y: auto; }
        .log-entry { padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); font-family: 'Courier New', monospace; }
        .log-timestamp { color: #8892b0; font-size: 0.9rem; }
        .log-success { color: var(--success); border-left: 4px solid var(--success); padding-left: 15px; }
        .log-error { color: var(--danger); border-left: 4px solid var(--danger); padding-left: 15px; }
        .log-warning { color: var(--warning); border-left: 4px solid var(--warning); padding-left: 15px; }
        
        .progress-bar { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; margin: 20px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #14ffec); width: 0%; transition: width 0.5s; }
        
        @media (max-width: 768px) {
            .modules-grid { grid-template-columns: 1fr; }
            .controls { flex-direction: column; }
            .btn-main { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ” Ù…Ù…ÛŒØ²ÛŒ Ù‡Ø³ØªÙ‡ Vakamova</h1>
            <p class="subtitle">Ø¨Ø±Ø±Ø³ÛŒ Û±Û³ ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ core/ - ØªØ³Øª Ù…Ø³ØªÙ‚Ù„ Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ø®Ø§Ø±Ø¬ÛŒ</p>
        </header>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card success">
                <h3>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡</h3>
                <div class="value" id="loadedCount">0</div>
            </div>
            <div class="stat-card success">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚</h3>
                <div class="value" id="passedCount">0</div>
            </div>
            <div class="stat-card warning">
                <h3>Ø®Ø·Ø§Ù‡Ø§</h3>
                <div class="value" id="errorCount">0</div>
            </div>
            <div class="stat-card">
                <h3>ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„</h3>
                <div class="value" id="depCount">0</div>
            </div>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        
        <div class="controls">
            <button class="btn btn-main" onclick="loadAllCoreFiles()">ğŸ“¥ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Core</button>
            <button class="btn btn-main" onclick="runAllTests()">âš¡ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <button class="btn btn-main" onclick="analyzeDependencies()">ğŸ”— ØªØ­Ù„ÛŒÙ„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§</button>
            <button class="btn btn-main" onclick="clearLogs()">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯Ø²Ø§Ø±Ø´</button>
        </div>
        
        <div id="modulesContainer" class="modules-grid">
            <!-- Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div class="logs-container" id="logsContainer">
            <!-- Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
    </div>
    
    <script>
        // ==================== Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ CORE ====================
        const CORE_MODULES = [
            { 
                name: 'Event Bus', 
                path: 'core/event_bus.js', 
                dependencies: [],
                test: () => testEventBus()
            },
            { 
                name: 'State Manager', 
                path: 'core/state_manager.js', 
                dependencies: ['event_bus.js'],
                test: () => testStateManager()
            },
            { 
                name: 'Context Provider', 
                path: 'core/context_provider.js', 
                dependencies: ['event_bus.js'],
                test: () => testContextProvider()
            },
            { 
                name: 'API Client', 
                path: 'core/api_client.js', 
                dependencies: ['event_bus.js', 'utils.js'],
                test: () => testApiClient()
            },
            { 
                name: 'Router Middleware', 
                path: 'core/router_middleware.js', 
                dependencies: ['router.js', 'state_manager.js'],
                test: () => testRouterMiddleware()
            },
            { 
                name: 'Route Guards', 
                path: 'core/guards.js', 
                dependencies: ['router.js', 'state_manager.js'],
                test: () => testGuards()
            },
            { 
                name: 'State (Ù¾Ø§ÛŒÙ‡)', 
                path: 'core/state.js', 
                dependencies: [],
                test: () => testBaseState()
            },
            { 
                name: 'Router', 
                path: 'core/router.js', 
                dependencies: ['event_bus.js', 'state_manager.js'],
                test: () => testRouter()
            },
            { 
                name: 'Database', 
                path: 'core/database.js', 
                dependencies: ['utils.js'],
                test: () => testDatabase()
            },
            { 
                name: 'API (Ù¾Ø§ÛŒÙ‡)', 
                path: 'core/api.js', 
                dependencies: ['utils.js'],
                test: () => testBaseApi()
            },
            { 
                name: 'Utilities', 
                path: 'core/utils.js', 
                dependencies: [],
                test: () => testUtilities()
            },
            { 
                name: 'Config Manager', 
                path: 'core/config.js', 
                dependencies: ['utils.js'],
                test: () => testConfig()
            },
            { 
                name: 'Font Manager', 
                path: 'core/font_manager.js', 
                dependencies: ['utils.js'],
                test: () => testFontManager()
            }
        ];
        
        // ==================== ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ù†Ø§Ù…Ù‡ ====================
        const appState = {
            loadedModules: new Map(),
            testResults: { passed: 0, failed: 0, total: 0 },
            dependencies: new Map(),
            logs: []
        };
        
        // ==================== Ø³ÛŒØ³ØªÙ… Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ ====================
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const logEntry = { message, type, timestamp };
            appState.logs.push(logEntry);
            
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${type}`;
            logElement.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span>${message}</span>
            `;
            
            document.getElementById('logsContainer').prepend(logElement);
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            updateStats();
        }
        
        // ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„ ====================
        async function loadModule(moduleIndex) {
            const module = CORE_MODULES[moduleIndex];
            
            try {
                // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
                const missingDeps = module.dependencies.filter(dep => 
                    !appState.loadedModules.has(dep.replace('.js', ''))
                );
                
                if (missingDeps.length > 0) {
                    log(`â³ ${module.name} Ù…Ù†ØªØ¸Ø± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ: ${missingDeps.join(', ')}`, 'warning');
                    return false;
                }
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„
                await new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = module.path;
                    script.type = 'module';
                    
                    script.onload = () => {
                        appState.loadedModules.set(module.name, { 
                            loaded: true, 
                            path: module.path,
                            dependencies: module.dependencies 
                        });
                        updateModuleCard(moduleIndex, 'loaded');
                        log(`âœ… ${module.name} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'success');
                        resolve();
                    };
                    
                    script.onerror = () => reject(new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${module.path}`));
                    document.head.appendChild(script);
                });
                
                return true;
            } catch (error) {
                updateModuleCard(moduleIndex, 'error');
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± ${module.name}: ${error.message}`, 'error');
                return false;
            }
        }
        
        async function loadAllCoreFiles() {
            log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Core...', 'info');
            document.getElementById('progressFill').style.width = '0%';
            
            let loaded = 0;
            const total = CORE_MODULES.length;
            
            for (let i = 0; i < total; i++) {
                const success = await loadModule(i);
                if (success) loaded++;
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù¾ÛŒØ´Ø±ÙØª
                const progress = (loaded / total) * 100;
                document.getElementById('progressFill').style.width = `${progress}%`;
                
                // ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¨Ù‡ØªØ±
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            log(`ğŸ‰ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯: ${loaded} Ø§Ø² ${total} ÙØ§ÛŒÙ„`, 'success');
        }
        
        // ==================== ØªÙˆØ§Ø¨Ø¹ ØªØ³Øª Ù‡Ø± Ù…Ø§Ú˜ÙˆÙ„ ====================
        function testEventBus() {
            try {
                if (typeof eventBus === 'undefined' && typeof HyperEventBus === 'undefined') {
                    throw new Error('Ù‡ÛŒÚ† Ù†Ù…ÙˆÙ†Ù‡ EventBus ÛŒØ§ÙØª Ù†Ø´Ø¯');
                }
                
                const bus = eventBus || new HyperEventBus();
                const testEvent = 'core:auditor:test';
                let received = false;
                
                const unsubscribe = bus.on(testEvent, () => received = true);
                bus.emit(testEvent);
                unsubscribe();
                
                return received ? 
                    { success: true, message: 'EventBus Ù¾Ø§Ø³Ø® Ù…ÛŒâ€ŒØ¯Ù‡Ø¯' } :
                    { success: false, message: 'EventBus Ù¾Ø§Ø³Ø® Ù†Ø¯Ø§Ø¯' };
            } catch (error) {
                return { success: false, message: error.message };
            }
        }
        
        function testStateManager() {
            try {
                if (typeof HyperStateManager === 'undefined') {
                    throw new Error('StateManager ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡');
                }
                
                const eventBus = window.eventBus || new (window.HyperEventBus || Object)();
                const state = new HyperStateManager(eventBus);
                const testKey = 'auditor.test';
                const testValue = { timestamp: Date.now() };
                
                state.set(testKey, testValue);
                const retrieved = state.get(testKey);
                
                return retrieved && retrieved.timestamp === testValue.timestamp ?
                    { success: true, message: 'StateManager Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡/Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯' } :
                    { success: false, message: 'StateManager Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¯Ø±Ø³Øª Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ú©Ø±Ø¯' };
            } catch (error) {
                return { success: false, message: error.message };
            }
        }
        
        function testUtilities() {
            try {
                if (typeof window.Utils === 'object' || typeof window.utils === 'object') {
                    return { success: true, message: 'Utilities Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª' };
                }
                
                // ØªØ³Øª ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
                const testObj = { a: 1, b: 2 };
                const cloned = JSON.parse(JSON.stringify(testObj));
                
                return cloned.a === testObj.a ?
                    { success: true, message: 'ØªÙˆØ§Ø¨Ø¹ Ù¾Ø§ÛŒÙ‡ JS Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯' } :
                    { success: false, message: 'Ù…Ø´Ú©Ù„ Ø¯Ø± Ù…Ø­ÛŒØ· Ø§Ø¬Ø±Ø§' };
            } catch (error) {
                return { success: false, message: error.message };
            }
        }
        
        function testRouter() {
            try {
                if (typeof window.Router === 'function' || typeof window.router === 'object') {
                    return { success: true, message: 'Router Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª' };
                }
                return { success: false, message: 'Router ÛŒØ§ÙØª Ù†Ø´Ø¯' };
            } catch (error) {
                return { success: false, message: error.message };
            }
        }
        
        function testDatabase() {
            try {
                if (typeof window.Database === 'function' || typeof window.db === 'object') {
                    return { success: true, message: 'Database Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª' };
                }
                return { success: false, message: 'Database ÛŒØ§ÙØª Ù†Ø´Ø¯' };
            } catch (error) {
                return { success: false, message: error.message };
            }
        }
        
        // ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø§Ø¯Ù‡â€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§
        function testContextProvider() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù†Ù…ÙˆÙ†Ù‡ EventBus Ø¯Ø§Ø±Ø¯' };
        }
        
        function testApiClient() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ EventBus Ùˆ Utilities Ø¯Ø§Ø±Ø¯' };
        }
        
        function testRouterMiddleware() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Router Ùˆ StateManager Ø¯Ø§Ø±Ø¯' };
        }
        
        function testGuards() {
            return { success: true, message: 'Ù†ÛŒØ§Ø² Ø¨Ù‡ Router Ùˆ StateManager Ø¯Ø§Ø±Ø¯' };
        }
        
        function testBaseState() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        function testBaseApi() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        function testConfig() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        function testFontManager() {
            return { success: true, message: 'Ù…Ø³ØªÙ‚Ù„ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯' };
        }
        
        // ==================== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        async function runModuleTest(moduleIndex) {
            const module = CORE_MODULES[moduleIndex];
            
            if (!appState.loadedModules.has(module.name)) {
                log(`âš ï¸ Ø§Ø¨ØªØ¯Ø§ ${module.name} Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯`, 'warning');
                return;
            }
            
            log(`ğŸ§ª ØªØ³Øª ${module.name}...`, 'info');
            
            try {
                const result = await module.test();
                
                if (result.success) {
                    appState.testResults.passed++;
                    log(`âœ… ${module.name}: ${result.message}`, 'success');
                    updateModuleCard(moduleIndex, 'loaded', true);
                } else {
                    appState.testResults.failed++;
                    log(`âŒ ${module.name}: ${result.message}`, 'error');
                }
                
                appState.testResults.total++;
                updateStats();
            } catch (error) {
                log(`ğŸ’¥ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª ${module.name}: ${error.message}`, 'error');
            }
        }
        
        async function runAllTests() {
            log('âš¡ Ø´Ø±ÙˆØ¹ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§...', 'info');
            
            appState.testResults = { passed: 0, failed: 0, total: 0 };
            
            for (let i = 0; i < CORE_MODULES.length; i++) {
                if (appState.loadedModules.has(CORE_MODULES[i].name)) {
                    await runModuleTest(i);
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
            }
            
            log(`ğŸ“Š ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯: ${appState.testResults.passed} Ù…ÙˆÙÙ‚ØŒ ${appState.testResults.failed} Ù†Ø§Ù…ÙˆÙÙ‚`, 'info');
        }
        
        // ==================== ØªØ­Ù„ÛŒÙ„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ ====================
        function analyzeDependencies() {
            log('ğŸ”— ØªØ­Ù„ÛŒÙ„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§...', 'info');
            
            const graph = {};
            CORE_MODULES.forEach(module => {
                graph[module.name] = {
                    dependencies: module.dependencies,
                    dependents: []
                };
            });
            
            // ÛŒØ§ÙØªÙ† ÙˆØ§Ø¨Ø³ØªÙ‡â€ŒÙ‡Ø§
            CORE_MODULES.forEach(module => {
                module.dependencies.forEach(dep => {
                    const depName = CORE_MODULES.find(m => m.path.includes(dep))?.name;
                    if (depName && graph[depName]) {
                        graph[depName].dependents.push(module.name);
                    }
                });
            });
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªØ§ÛŒØ¬
            Object.entries(graph).forEach(([name, data]) => {
                const hasDeps = data.dependencies.length > 0;
                const hasDependents = data.dependents.length > 0;
                
                let message = `${name}:`;
                if (hasDeps) message += ` Ù†ÛŒØ§Ø² Ø¨Ù‡ ${data.dependencies.length} ÙØ§ÛŒÙ„`;
                if (hasDependents) message += ` â†’ ${data.dependents.length} ÙØ§ÛŒÙ„ Ø¨Ù‡ Ø¢Ù† Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ù†Ø¯`;
                
                log(message, hasDeps ? 'warning' : 'success');
            });
            
            log('âœ… ØªØ­Ù„ÛŒÙ„ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯', 'success');
        }
        
        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI ====================
        function updateModuleCard(index, status, tested = false) {
            const card = document.querySelector(`[data-module-index="${index}"]`);
            if (!card) return;
            
            card.className = `module-card ${status}`;
            
            const statusEl = card.querySelector('.module-status');
            statusEl.className = `module-status status-${status}`;
            statusEl.textContent = 
                status === 'loaded' ? (tested ? 'âœ… ØªØ³Øª Ø´Ø¯' : 'ğŸ“¦ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ') :
                status === 'error' ? 'âŒ Ø®Ø·Ø§' : 'â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
        }
        
        function updateStats() {
            document.getElementById('loadedCount').textContent = appState.loadedModules.size;
            document.getElementById('passedCount').textContent = appState.testResults.passed;
            document.getElementById('errorCount').textContent = appState.testResults.failed;
            
            // Ø´Ù…Ø§Ø±Ø´ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
            let depCount = 0;
            CORE_MODULES.forEach(module => {
                depCount += module.dependencies.filter(dep => 
                    appState.loadedModules.has(dep.replace('.js', ''))
                ).length;
            });
            document.getElementById('depCount').textContent = depCount;
        }
        
        function clearLogs() {
            document.getElementById('logsContainer').innerHTML = '';
            appState.logs = [];
            log('ğŸ—‘ï¸ Ú¯Ø²Ø§Ø±Ø´â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'info');
        }
        
        // ==================== Ø§ÛŒØ¬Ø§Ø¯ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ====================
        function createModuleCards() {
            const container = document.getElementById('modulesContainer');
            container.innerHTML = '';
            
            CORE_MODULES.forEach((module, index) => {
                const card = document.createElement('div');
                card.className = 'module-card pending';
                card.setAttribute('data-module-index', index);
                
                card.innerHTML = `
                    <div class="module-header">
                        <div class="module-name">${module.name}</div>
                        <div class="module-status status-pending">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                    </div>
                    <div class="module-deps">
                        ${module.dependencies.length > 0 ? 
                            `ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ: ${module.dependencies.map(d => `<span class="dep-item">${d}</span>`).join('')}` : 
                            'Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ'}
                    </div>
                    <div class="test-buttons">
                        <button class="btn btn-load" onclick="loadModule(${index})">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
                        <button class="btn btn-test" onclick="runModuleTest(${index})">ØªØ³Øª</button>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }
        
        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        window.addEventListener('DOMContentLoaded', () => {
            createModuleCards();
            log('ğŸ” Ù…Ù…ÛŒØ²ÛŒ Ù‡Ø³ØªÙ‡ Vakamova Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª', 'success');
            log(`Ù‡Ø¯Ù: Ø¨Ø±Ø±Ø³ÛŒ ${CORE_MODULES.length} ÙØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ`, 'info');
            log('Ø§Ø¨ØªØ¯Ø§ "Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§" Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯', 'warning');
            
            // Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¯Ø³ØªÛŒ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„
            window.CoreAuditor = {
                loadAll: loadAllCoreFiles,
                testAll: runAllTests,
                analyze: analyzeDependencies,
                getState: () => ({ 
                    loaded: appState.loadedModules.size,
                    tests: appState.testResults,
                    modules: CORE_MODULES.map(m => m.name)
                }),
                log
            };
        });
    </script>
</body>
</html>
