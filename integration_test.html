<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Vakamova</title>
    <style>
        body { font-family: system-ui; padding: 20px; direction: rtl; }
        .success { color: green; }
        .error { color: red; }
        .log { border: 1px solid #ccc; padding: 15px; margin-top: 20px; min-height: 100px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Vakamova</h1>
    <button id="runTest">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª</button>
    <div id="log" class="log"></div>

    <script>
        const log = document.getElementById('log');
        const output = (msg, type = 'info') => {
            const p = document.createElement('p');
            p.innerHTML = `[${new Date().toLocaleTimeString('fa-IR')}] ${msg}`;
            p.className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            log.appendChild(p);
        };

        // Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
        const coreFiles = [
            'core/event_bus.js',
            'core/utils.js',
            'core/state_manager.js',
            'core/security.layer.js',
            'core/core.operation.js',
            'core/persistence.js',
            'modules/auth/auth_manager.js'
        ];

        async function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => resolve(src);
                script.onerror = () => reject(new Error(`Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${src}`));
                document.head.appendChild(script);
            });
        }

        async function runIntegrationTest() {
            log.innerHTML = '';
            output('Ø´Ø±ÙˆØ¹ ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ...');

            // Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
            output('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ core...');
            try {
                for (const file of coreFiles) {
                    await loadScript(file);
                    output(`âœ… ${file} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'success');
                }
            } catch (e) {
                output(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ: ${e.message}`, 'error');
                return;
            }

            // Ù…Ø±Ø­Ù„Ù‡ Û²: ØªØ³Øª EventBus
            output('ØªØ³Øª EventBus...');
            if (typeof eventBus !== 'undefined') {
                try {
                    eventBus.emit('test:integration', { message: 'Ø³Ù„Ø§Ù… Vakamova' });
                    output('âœ… EventBus Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯', 'success');
                } catch (e) {
                    output(`âŒ EventBus Ø®Ø·Ø§: ${e.message}`, 'error');
                }
            } else {
                output('âŒ eventBus ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡', 'error');
            }

            // Ù…Ø±Ø­Ù„Ù‡ Û³: ØªØ³Øª State Manager
            output('ØªØ³Øª State Manager...');
            if (typeof HyperStateManager !== 'undefined') {
                try {
                    const testState = new HyperStateManager(eventBus);
                    testState.set('integration.test', 'Ù…Ù‚Ø¯Ø§Ø± ØªØ³Øª');
                    const value = testState.get('integration.test');
                    if (value === 'Ù…Ù‚Ø¯Ø§Ø± ØªØ³Øª') {
                        output('âœ… State Manager Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'success');
                    }
                } catch (e) {
                    output(`âŒ State Manager Ø®Ø·Ø§: ${e.message}`, 'error');
                }
            }

            // Ù…Ø±Ø­Ù„Ù‡ Û´: ØªØ³Øª Auth Manager (Ø§Ú¯Ø± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ø´Ø¯)
            output('Ø¨Ø±Ø±Ø³ÛŒ Auth Manager...');
            if (typeof auth_manager !== 'undefined') {
                output('âœ… Auth Manager Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª', 'success');
                // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§ÛŒ auth_manager Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
            }

            // Ù…Ø±Ø­Ù„Ù‡ Ûµ: ØªØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
            output('Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯...');
            const newFiles = ['security.layer.js', 'core.operation.js', 'persistence.js'];
            newFiles.forEach(file => {
                if (typeof window[file.replace('.js', '')] !== 'undefined') {
                    output(`âœ… ${file} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'success');
                } else {
                    output(`âš ï¸ ${file} Ø¨Ù‡ ØµÙˆØ±Øª global ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡`, 'info');
                }
            });

            output('ØªØ³Øª Ú©Ø§Ù…Ù„ Ø´Ø¯!', 'success');
        }

        document.getElementById('runTest').addEventListener('click', runIntegrationTest);
    </script>
</body>
</html>
