<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³ØªØ± ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Vakamova</title>
    <style>
        :root {
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --bg: #0f172a;
            --card-bg: #1e293b;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid #334155;
        }
        
        h1 {
            color: #38bdf8;
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }
        
        .btn-secondary {
            background: #334155;
            color: #cbd5e1;
            border: 1px solid #475569;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .status-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        
        .status-card h3 {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-card .value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .status-card.passed .value { color: var(--success); }
        .status-card.failed .value { color: var(--error); }
        .status-card.warning .value { color: var(--warning); }
        
        .file-list {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            border: 1px solid #334155;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #334155;
        }
        
        .file-item:last-child { border-bottom: none; }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .file-icon {
            font-size: 1.2rem;
        }
        
        .file-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-pending { background: #475569; color: #cbd5e1; }
        .status-loaded { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .status-error { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        
        .log-container {
            background: #111827;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid #334155;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 12px 15px;
            border-bottom: 1px solid #1e293b;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry:last-child { border-bottom: none; }
        
        .log-success { 
            color: var(--success);
            border-right: 4px solid var(--success);
        }
        
        .log-error { 
            color: var(--error);
            border-right: 4px solid var(--error);
        }
        
        .log-warning { 
            color: var(--warning);
            border-right: 4px solid var(--warning);
        }
        
        .log-info { 
            color: var(--info);
            border-right: 4px solid var(--info);
        }
        
        .progress-container {
            margin: 25px 0;
        }
        
        .progress-bar {
            height: 8px;
            background: #334155;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9, #3b82f6);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .status-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª ØªØ³ØªØ± ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Vakamova</h1>
            <p class="subtitle">Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Û±Û³ ÙØ§ÛŒÙ„ Ù‡Ø³ØªÙ‡ + Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</p>
        </header>
        
        <div class="control-panel">
            <button class="btn btn-primary" onclick="runFullTest()">
                <span>ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„</span>
            </button>
            <button class="btn btn-secondary" onclick="loadCoreFiles()">
                <span>ğŸ“¦ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Core</span>
            </button>
            <button class="btn btn-secondary" onclick="testEventBus()">
                <span>ğŸ”— ØªØ³Øª EventBus</span>
            </button>
            <button class="btn btn-secondary" onclick="clearLogs()">
                <span>ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§</span>
            </button>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <div class="status-cards">
            <div class="status-card" id="cardLoaded">
                <h3>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡</h3>
                <div class="value">0</div>
            </div>
            <div class="status-card" id="cardPassed">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚</h3>
                <div class="value">0</div>
            </div>
            <div class="status-card" id="cardFailed">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚</h3>
                <div class="value">0</div>
            </div>
            <div class="status-card">
                <h3>Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§</h3>
                <div class="value" id="executionTime">0s</div>
            </div>
        </div>
        
        <div class="file-list">
            <h3 style="margin-bottom: 15px; color: #e2e8f0;">ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ</h3>
            <div id="fileListContainer">
                <!-- ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
        </div>
        
        <div class="log-container">
            <h3 style="margin-bottom: 15px; color: #e2e8f0;">ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ø§Ø¬Ø±Ø§</h3>
            <div id="logContainer"></div>
        </div>
    </div>

    <script>
        // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡ ====================
        const PROJECT_FILES = [
            // ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø³ØªÙ‡ Ø§ØµÙ„ÛŒ (Ø¨Ø§ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡)
            { name: 'Event Bus', path: './core/event_bus.js', type: 'core', required: true },
            { name: 'Utils', path: './core/utils.js', type: 'core', required: true },
            { name: 'State Manager', path: './core/state_manager.js', type: 'core', required: true },
            { name: 'Context Provider', path: './core/context_provider.js', type: 'core', required: false },
            { name: 'API Client', path: './core/api_client.js', type: 'core', required: false },
            { name: 'Router', path: './core/router.js', type: 'core', required: false },
            { name: 'Database', path: './core/database.js', type: 'core', required: false },
            { name: 'API Base', path: './core/api.js', type: 'core', required: false },
            { name: 'Config', path: './core/config.js', type: 'core', required: false },
            { name: 'Font Manager', path: './core/font_manager.js', type: 'core', required: false },
            { name: 'Guards', path: './core/guards.js', type: 'core', required: false },
            { name: 'Router Middleware', path: './core/router_middleware.js', type: 'core', required: false },
            { name: 'State (Base)', path: './core/state.js', type: 'core', required: false },
            
            // ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ù…Ø§
            { name: 'Security Layer', path: './core/security.layer.js', type: 'custom', required: true },
            { name: 'Core Operations', path: './core/core.operation.js', type: 'custom', required: true },
            { name: 'Persistence', path: './core/persistence.js', type: 'custom', required: true },
            
            // Ù…Ø§Ú˜ÙˆÙ„ Auth
            { name: 'Auth Manager', path: './modules/auth/auth_manager.js', type: 'auth', required: true },
            { name: 'Token Manager', path: './modules/auth/token_manager.js', type: 'auth', required: false },
            
            // ØµÙØ­Ø§Øª
            { name: 'Home Page', path: './pages/home/page.js', type: 'page', required: false },
            { name: 'Auth View', path: './pages/auth/view.js', type: 'page', required: false }
        ];

        // ==================== ÙˆØ¶Ø¹ÛŒØª ØªØ³ØªØ± ====================
        const testerState = {
            loadedFiles: new Map(),
            testResults: { passed: 0, failed: 0 },
            startTime: null,
            logs: []
        };

        // ==================== Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯ÛŒÙ†Ú¯ ====================
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const logEntry = { message, type, timestamp };
            testerState.logs.push(logEntry);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ØµÙØ­Ù‡
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${type}`;
            logElement.innerHTML = `
                <strong>[${timestamp}]</strong> 
                <span>${message}</span>
            `;
            
            document.getElementById('logContainer').appendChild(logElement);
            
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
            logElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            
            // Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¶Ø¹ÛŒØª
            updateStatus();
        }

        // ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ ====================
        function loadScript(fileInfo) {
            return new Promise((resolve, reject) => {
                // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø´ Ù…Ø±ÙˆØ±Ú¯Ø±
                const script = document.createElement('script');
                script.src = `${fileInfo.path}?v=${Date.now()}`;
                script.type = 'module';
                
                script.onload = () => {
                    testerState.loadedFiles.set(fileInfo.name, {
                        ...fileInfo,
                        loaded: true,
                        timestamp: Date.now()
                    });
                    
                    updateFileUI(fileInfo.name, 'loaded');
                    addLog(`âœ… ${fileInfo.name} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'success');
                    resolve(fileInfo.name);
                };
                
                script.onerror = (error) => {
                    testerState.loadedFiles.set(fileInfo.name, {
                        ...fileInfo,
                        loaded: false,
                        error: error.message
                    });
                    
                    updateFileUI(fileInfo.name, 'error');
                    
                    if (fileInfo.required) {
                        addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± ${fileInfo.name}: ÙØ§ÛŒÙ„ Ø¶Ø±ÙˆØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯`, 'error');
                        reject(new Error(`Required file not found: ${fileInfo.path}`));
                    } else {
                        addLog(`âš ï¸ ${fileInfo.name} ÛŒØ§ÙØª Ù†Ø´Ø¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)`, 'warning');
                        resolve(null); // ÙØ§ÛŒÙ„ Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø±Ø¯ Ù†Ø´Ùˆ
                    }
                };
                
                document.head.appendChild(script);
            });
        }

        async function loadCoreFiles() {
            addLog('Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø³ØªÙ‡...', 'info');
            testerState.startTime = Date.now();
            
            document.getElementById('progressFill').style.width = '0%';
            
            const requiredFiles = PROJECT_FILES.filter(f => f.required);
            const optionalFiles = PROJECT_FILES.filter(f => !f.required);
            
            let loadedCount = 0;
            
            // Ø§ÙˆÙ„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
            for (let i = 0; i < requiredFiles.length; i++) {
                const file = requiredFiles[i];
                try {
                    await loadScript(file);
                    loadedCount++;
                    
                    // Ø¢Ù¾Ø¯ÛŒØª progress bar
                    const progress = (loadedCount / PROJECT_FILES.length) * 100;
                    document.getElementById('progressFill').style.width = `${progress}%`;
                    
                    // ØªØ£Ø®ÛŒØ± Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² blocking
                    await new Promise(r => setTimeout(r, 50));
                } catch (error) {
                    addLog(`ØªÙˆÙ‚Ù Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ: ${error.message}`, 'error');
                    return;
                }
            }
            
            // Ø³Ù¾Ø³ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ
            for (let i = 0; i < optionalFiles.length; i++) {
                const file = optionalFiles[i];
                try {
                    await loadScript(file);
                    loadedCount++;
                    
                    const progress = (loadedCount / PROJECT_FILES.length) * 100;
                    document.getElementById('progressFill').style.width = `${progress}%`;
                    
                    await new Promise(r => setTimeout(r, 30));
                } catch (error) {
                    // ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø®ØªÛŒØ§Ø±ÛŒ Ø®Ø·Ø§ Ù†Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯
                }
            }
            
            document.getElementById('progressFill').style.width = '100%';
            addLog(`Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯: ${loadedCount} Ø§Ø² ${PROJECT_FILES.length} ÙØ§ÛŒÙ„`, 'success');
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯ ====================
        async function testEventBus() {
            addLog('ØªØ³Øª EventBus...', 'info');
            
            if (typeof eventBus === 'undefined') {
                addLog('âŒ EventBus ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª', 'error');
                testerState.testResults.failed++;
                return false;
            }
            
            try {
                // ØªØ³Øª Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯
                let eventReceived = false;
                
                const unsubscribe = eventBus.on('test:integration', (data) => {
                    eventReceived = true;
                    addLog(`Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯: ${JSON.stringify(data)}`, 'success');
                });
                
                eventBus.emit('test:integration', { 
                    test: true, 
                    timestamp: Date.now(),
                    project: 'Vakamova' 
                });
                
                // Ù…Ù†ØªØ¸Ø± Ø¨Ù…Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø±ÙˆÛŒØ¯Ø§Ø¯
                await new Promise(r => setTimeout(r, 100));
                
                if (eventReceived) {
                    addLog('âœ… EventBus Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'success');
                    testerState.testResults.passed++;
                    
                    // ØªÙ…ÛŒØ²Ú©Ø§Ø±ÛŒ
                    if (typeof unsubscribe === 'function') {
                        unsubscribe();
                    }
                    
                    return true;
                } else {
                    addLog('âŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ù†ØªØ´Ø± Ø´Ø¯ Ø§Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                    testerState.testResults.failed++;
                    return false;
                }
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± EventBus: ${error.message}`, 'error');
                testerState.testResults.failed++;
                return false;
            }
        }

        async function testStateManager() {
            addLog('ØªØ³Øª State Manager...', 'info');
            
            if (typeof HyperStateManager === 'undefined') {
                addLog('âš ï¸ HyperStateManager ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡', 'warning');
                return false;
            }
            
            try {
                const testState = new HyperStateManager(eventBus);
                const testKey = 'integration.test';
                const testValue = { data: 'test', number: 42 };
                
                testState.set(testKey, testValue);
                const retrieved = testState.get(testKey);
                
                if (retrieved && retrieved.data === testValue.data) {
                    addLog('âœ… State Manager Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'success');
                    testerState.testResults.passed++;
                    return true;
                } else {
                    addLog('âŒ State Manager Ø¯Ø§Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ù†Ú¯Ø±Ø¯Ø§Ù†Ø¯', 'error');
                    testerState.testResults.failed++;
                    return false;
                }
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± State Manager: ${error.message}`, 'error');
                testerState.testResults.failed++;
                return false;
            }
        }

        async function testNewModules() {
            addLog('Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯...', 'info');
            
            const newModules = [
                { name: 'Security Layer', globalName: 'securityLayer' },
                { name: 'Core Operations', globalName: 'coreOperation' },
                { name: 'Persistence', globalName: 'persistence' }
            ];
            
            let passed = 0;
            
            for (const module of newModules) {
                if (typeof window[module.globalName] !== 'undefined') {
                    addLog(`âœ… ${module.name} Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª`, 'success');
                    passed++;
                } else {
                    addLog(`âš ï¸ ${module.name} Ø¨Ù‡ ØµÙˆØ±Øª global ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡`, 'warning');
                }
            }
            
            if (passed === newModules.length) {
                testerState.testResults.passed++;
            }
            
            return passed === newModules.length;
        }

        async function testAuthManager() {
            addLog('Ø¨Ø±Ø±Ø³ÛŒ Auth Manager...', 'info');
            
            if (typeof auth_manager === 'undefined') {
                addLog('âš ï¸ Auth Manager ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡', 'warning');
                return false;
            }
            
            try {
                // ØªØ³Øª Ø³Ø§Ø¯Ù‡ ÙˆØ¬ÙˆØ¯ Ù…ØªØ¯Ù‡Ø§
                const requiredMethods = ['login', 'register', 'logout'];
                let hasAllMethods = true;
                
                for (const method of requiredMethods) {
                    if (typeof auth_manager[method] !== 'function') {
                        addLog(`âš ï¸ Auth Manager.${method} ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡`, 'warning');
                        hasAllMethods = false;
                    }
                }
                
                if (hasAllMethods) {
                    addLog('âœ… Auth Manager Ù…ØªØ¯Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø±Ø§ Ø¯Ø§Ø±Ø¯', 'success');
                    testerState.testResults.passed++;
                    return true;
                } else {
                    addLog('âš ï¸ Auth Manager Ø¨Ø±Ø®ÛŒ Ù…ØªØ¯Ù‡Ø§ Ø±Ø§ Ù†Ø¯Ø§Ø±Ø¯', 'warning');
                    return false;
                }
            } catch (error) {
                addLog(`âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Auth Manager: ${error.message}`, 'warning');
                return false;
            }
        }

        // ==================== ØªØ³Øª Ú©Ø§Ù…Ù„ ====================
        async function runFullTest() {
            addLog('Ø´Ø±ÙˆØ¹ ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ú©Ø§Ù…Ù„...', 'info');
            testerState.startTime = Date.now();
            
            // Ø±ÛŒØ³Øª Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ
            testerState.testResults = { passed: 0, failed: 0 };
            testerState.loadedFiles.clear();
            
            // Ø±ÛŒØ³Øª UI
            document.getElementById('cardPassed').querySelector('.value').textContent = '0';
            document.getElementById('cardFailed').querySelector('.value').textContent = '0';
            document.getElementById('logContainer').innerHTML = '';
            initializeFileList();
            
            try {
                // Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
                await loadCoreFiles();
                
                // Ù…Ø±Ø­Ù„Ù‡ Û²: ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯
                await testEventBus();
                await testStateManager();
                await testNewModules();
                await testAuthManager();
                
                // Ù…Ø±Ø­Ù„Ù‡ Û³: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù†
                const endTime = Date.now();
                const duration = ((endTime - testerState.startTime) / 1000).toFixed(2);
                document.getElementById('executionTime').textContent = `${duration}s`;
                
                // Ù…Ø±Ø­Ù„Ù‡ Û´: Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬
                addLog('='.repeat(50), 'info');
                addLog(`Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ: ${testerState.testResults.passed} Ù…ÙˆÙÙ‚ØŒ ${testerState.testResults.failed} Ù†Ø§Ù…ÙˆÙÙ‚`, 
                      testerState.testResults.failed === 0 ? 'success' : 'warning');
                addLog(`Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: ${duration} Ø«Ø§Ù†ÛŒÙ‡`, 'info');
                addLog('='.repeat(50), 'info');
                
                // Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¹Ø¯ÛŒ
                if (testerState.testResults.failed === 0) {
                    addLog('ğŸ‰ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù†Ø¯! Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø§Ø¯Ø§Ù…Ù‡ ØªÙˆØ³Ø¹Ù‡ Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒ.', 'success');
                } else {
                    addLog('ğŸ”§ Ø¨Ø±Ø®ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù†Ø¯. Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†.', 'warning');
                }
                
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª: ${error.message}`, 'error');
            }
        }

        // ==================== UI Helpers ====================
        function initializeFileList() {
            const container = document.getElementById('fileListContainer');
            container.innerHTML = '';
            
            PROJECT_FILES.forEach(file => {
                const fileElement = document.createElement('div');
                fileElement.className = 'file-item';
                fileElement.id = `file-${file.name.replace(/\s+/g, '-')}`;
                fileElement.innerHTML = `
                    <div class="file-info">
                        <span class="file-icon">
                            ${file.type === 'core' ? 'ğŸ§ ' : 
                              file.type === 'auth' ? 'ğŸ”' : 
                              file.type === 'page' ? 'ğŸ“„' : 'âš™ï¸'}
                        </span>
                        <div>
                            <div style="font-weight: 600;">${file.name}</div>
                            <div style="font-size: 0.8rem; color: #94a3b8;">${file.path}</div>
                        </div>
                    </div>
                    <div class="file-status status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                `;
                
                container.appendChild(fileElement);
            });
        }

        function updateFileUI(fileName, status) {
            const element = document.getElementById(`file-${fileName.replace(/\s+/g, '-')}`);
            if (!element) return;
            
            const statusEl = element.querySelector('.file-status');
            statusEl.className = 'file-status';
            
            switch (status) {
                case 'loaded':
                    statusEl.classList.add('status-loaded');
                    statusEl.textContent = 'Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯';
                    break;
                case 'error':
                    statusEl.classList.add('status-error');
                    statusEl.textContent = 'Ø®Ø·Ø§';
                    break;
                case 'warning':
                    statusEl.classList.add('status-warning');
                    statusEl.textContent = 'Ø§Ø®ØªÛŒØ§Ø±ÛŒ';
                    break;
            }
        }

        function updateStatus() {
            const loadedCount = Array.from(testerState.loadedFiles.values())
                .filter(f => f.loaded).length;
            
            document.getElementById('cardLoaded').querySelector('.value').textContent = 
                `${loadedCount}/${PROJECT_FILES.length}`;
            
            document.getElementById('cardPassed').querySelector('.value').textContent = 
                testerState.testResults.passed;
            
            document.getElementById('cardFailed').querySelector('.value').textContent = 
                testerState.testResults.failed;
            
            // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ¶Ø¹ÛŒØª
            document.getElementById('cardPassed').className = 
                `status-card ${testerState.testResults.passed > 0 ? 'passed' : ''}`;
            
            document.getElementById('cardFailed').className = 
                `status-card ${testerState.testResults.failed > 0 ? 'failed' : ''}`;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'info');
        }

        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
        window.addEventListener('DOMContentLoaded', () => {
            initializeFileList();
            addLog('ØªØ³ØªØ± Vakamova Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ "Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„" Ú©Ù„ÛŒÚ© Ú©Ù†.', 'info');
            
            // Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù…ÛŒØ§Ù†Ø¨Ø±
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    runFullTest();
                }
            });
        });

        // Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ú©Ù†Ø³ÙˆÙ„
        window.VakamovaTester = {
            runFullTest,
            loadCoreFiles,
            testEventBus,
            testStateManager,
            testNewModules,
            testAuthManager,
            getState: () => ({ ...testerState }),
            clearLogs
        };
    </script>
</body>
</html>
