<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³ØªØ± ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Vakamova</title>
    <style>
        :root {
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --bg: #0f172a;
            --card-bg: #1e293b;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid #334155;
        }
        
        h1 { color: #38bdf8; font-size: 2.2rem; margin-bottom: 10px; }
        .subtitle { color: #94a3b8; font-size: 1.1rem; }
        
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
        }
        
        .btn-secondary {
            background: #334155;
            color: #cbd5e1;
            border: 1px solid #475569;
        }
        
        .btn-secondary:hover { background: #475569; }
        
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .status-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #334155;
        }
        
        .status-card h3 {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-card .value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        
        .status-card.passed .value { color: var(--success); }
        .status-card.failed .value { color: var(--error); }
        .status-card.warning .value { color: var(--warning); }
        
        .file-list {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
            border: 1px solid #334155;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #334155;
        }
        
        .file-item:last-child { border-bottom: none; }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .file-icon { font-size: 1.2rem; }
        
        .file-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .status-pending { background: #475569; color: #cbd5e1; }
        .status-loaded { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .status-error { background: rgba(239, 68, 68, 0.2); color: var(--error); }
        
        .log-container {
            background: #111827;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid #334155;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 12px 15px;
            border-bottom: 1px solid #1e293b;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry:last-child { border-bottom: none; }
        
        .log-success { 
            color: var(--success);
            border-right: 4px solid var(--success);
        }
        
        .log-error { 
            color: var(--error);
            border-right: 4px solid var(--error);
        }
        
        .log-warning { 
            color: var(--warning);
            border-right: 4px solid var(--warning);
        }
        
        .log-info { 
            color: var(--info);
            border-right: 4px solid var(--info);
        }
        
        .progress-container { margin: 25px 0; }
        
        .progress-bar {
            height: 8px;
            background: #334155;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0ea5e9, #3b82f6);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .control-panel { grid-template-columns: 1fr; }
            .status-cards { grid-template-columns: repeat(2, 1fr); }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª ØªØ³ØªØ± ÛŒÚ©Ù¾Ø§Ø±Ú†Ú¯ÛŒ Vakamova</h1>
            <p class="subtitle">Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ - Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡</p>
        </header>
        
        <div class="control-panel">
            <button class="btn btn-primary" onclick="runFullTest()">
                <span>ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„</span>
            </button>
            <button class="btn btn-secondary" onclick="testPaths()">
                <span>ğŸ“ Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ±Ù‡Ø§</span>
            </button>
            <button class="btn btn-secondary" onclick="clearLogs()">
                <span>ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§</span>
            </button>
            <button class="btn btn-secondary" onclick="showDebugInfo()">
                <span>ğŸ› Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯</span>
            </button>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <div class="status-cards">
            <div class="status-card" id="cardLoaded">
                <h3>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡</h3>
                <div class="value">0</div>
            </div>
            <div class="status-card" id="cardPassed">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚</h3>
                <div class="value">0</div>
            </div>
            <div class="status-card" id="cardFailed">
                <h3>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚</h3>
                <div class="value">0</div>
            </div>
            <div class="status-card">
                <h3>Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§</h3>
                <div class="value" id="executionTime">0s</div>
            </div>
        </div>
        
        <div class="file-list">
            <h3 style="margin-bottom: 15px; color: #e2e8f0;">ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡</h3>
            <div id="fileListContainer"></div>
        </div>
        
        <div class="log-container">
            <h3 style="margin-bottom: 15px; color: #e2e8f0;">ğŸ“‹ Ú¯Ø²Ø§Ø±Ø´ Ø§Ø¬Ø±Ø§</h3>
            <div id="logContainer"></div>
        </div>
    </div>

    <script>
        // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡ ====================
        const PROJECT_FILES = [
            // ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø³ØªÙ‡ Ø§ØµÙ„ÛŒ (Ø¨Ø§ Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ ØªØµØ­ÛŒØ­â€ŒØ´Ø¯Ù‡)
            { name: 'Event Bus', path: './core/event_bus.js', type: 'core', required: true },
            { name: 'State Manager', path: './core/state_manager.js', type: 'core', required: true },
            { name: 'Utils', path: './core/utils.js', type: 'core', required: true },
            { name: 'Context Provider', path: './core/context_provider.js', type: 'core', required: false },
            { name: 'API Client', path: './core/api_client.js', type: 'core', required: false },
            { name: 'Router', path: './core/router.js', type: 'core', required: false },
            { name: 'Database', path: './core/database.js', type: 'core', required: false },
            { name: 'Config', path: './core/config.js', type: 'core', required: false },
            
            // ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø´Ù…Ø§ (Ø¨Ø§ Global Export)
            { name: 'Security Layer', path: './core/security.layer.js', type: 'custom', required: true },
            { name: 'Core Operations', path: './core/core.operation.js', type: 'custom', required: true },
            { name: 'Persistence', path: './core/persistence.js', type: 'custom', required: true },
            
            // Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Auth (Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ window.auth_manager Ø¯Ø§Ø±Ù†Ø¯)
            { name: 'Auth Manager', path: './modules/auth/auth_manager.js', type: 'auth', required: true },
            { name: 'Token Manager', path: './modules/auth/token_manager.js', type: 'auth', required: false },
            
            // ØµÙØ­Ø§Øª (Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ Global Export Ø¯Ø§Ø±Ù†Ø¯)
            { name: 'Language Picker', path: './pages/language_picker/view.js', type: 'page', required: false },
            { name: 'Home Page', path: './pages/home/page.js', type: 'page', required: false },
            { name: 'Auth View', path: './pages/auth/view.js', type: 'page', required: false }
        ];

        // ==================== ÙˆØ¶Ø¹ÛŒØª ØªØ³ØªØ± ====================
        const testerState = {
            loadedFiles: new Map(),
            testResults: { passed: 0, failed: 0 },
            startTime: null,
            logs: []
        };

        // ==================== Ø³ÛŒØ³ØªÙ… Ù„Ø§Ú¯ÛŒÙ†Ú¯ ====================
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const logEntry = { message, type, timestamp };
            testerState.logs.push(logEntry);
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ØµÙØ­Ù‡
            const logElement = document.createElement('div');
            logElement.className = `log-entry log-${type}`;
            logElement.innerHTML = `
                <strong>[${timestamp}]</strong> 
                <span>${message}</span>
            `;
            
            document.getElementById('logContainer').appendChild(logElement);
            logElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            updateStatus();
        }

        // ==================== Ø³ÛŒØ³ØªÙ… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ====================
        function loadScript(fileInfo) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                const cacheBuster = `?v=${Date.now()}`;
                
                // ØªÙ†Ø¸ÛŒÙ… type Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ ÙØ§ÛŒÙ„
                if (fileInfo.path.includes('.js') && !fileInfo.path.includes('.layer.')) {
                    script.type = 'module';
                }
                
                script.src = fileInfo.path + cacheBuster;
                
                script.onload = () => {
                    // ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø«Ø¨Øª global objects
                    setTimeout(() => {
                        // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ global object
                        const fileKey = fileInfo.name.toLowerCase().replace(/[^a-z]/g, '');
                        let isLoaded = false;
                        
                        // Ø¨Ø±Ø±Ø³ÛŒ objectÙ‡Ø§ÛŒ Ù…Ù‡Ù…
                        if (fileInfo.name.includes('Event Bus') && window.eventBus) {
                            isLoaded = true;
                        } else if (fileInfo.name.includes('State Manager') && window.HyperStateManager) {
                            isLoaded = true;
                        } else if (fileInfo.name.includes('Auth Manager') && window.auth_manager) {
                            isLoaded = true;
                        } else if (fileInfo.name.includes('Security Layer') && window.securityLayer) {
                            isLoaded = true;
                        } else if (fileInfo.name.includes('Core Operations') && window.coreOperation) {
                            isLoaded = true;
                        } else if (fileInfo.name.includes('Persistence') && window.persistence) {
                            isLoaded = true;
                        } else if (fileInfo.name.includes('Language Picker') && window.LanguagePickerView) {
                            isLoaded = true;
                        } else {
                            // Ø§Ú¯Ø± global Ù†ÛŒØ³ØªØŒ Ø­Ø¯Ø§Ù‚Ù„ ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
                            isLoaded = true;
                        }
                        
                        if (isLoaded) {
                            testerState.loadedFiles.set(fileInfo.name, {
                                ...fileInfo,
                                loaded: true,
                                timestamp: Date.now()
                            });
                            updateFileUI(fileInfo.name, 'loaded');
                            addLog(`âœ… ${fileInfo.name} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`, 'success');
                            resolve(fileInfo.name);
                        } else {
                            testerState.loadedFiles.set(fileInfo.name, {
                                ...fileInfo,
                                loaded: false,
                                error: 'Global object not found'
                            });
                            updateFileUI(fileInfo.name, 'error');
                            addLog(`âš ï¸ ${fileInfo.name} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯ Ø§Ù…Ø§ global Ù†ÛŒØ³Øª`, 'warning');
                            resolve(fileInfo.name); // Ø±Ø¯ Ù†Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ú†ÙˆÙ† ÙØ§ÛŒÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡
                        }
                    }, 100);
                };
                
                script.onerror = (error) => {
                    testerState.loadedFiles.set(fileInfo.name, {
                        ...fileInfo,
                        loaded: false,
                        error: 'File not found or syntax error'
                    });
                    
                    updateFileUI(fileInfo.name, 'error');
                    
                    if (fileInfo.required) {
                        addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± ${fileInfo.name}: ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯`, 'error');
                        addLog(`   Ù…Ø³ÛŒØ±: ${fileInfo.path}`, 'error');
                        reject(new Error(`ÙØ§ÛŒÙ„ Ø¶Ø±ÙˆØ±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯: ${fileInfo.path}`));
                    } else {
                        addLog(`âš ï¸ ${fileInfo.name} ÛŒØ§ÙØª Ù†Ø´Ø¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)`, 'warning');
                        resolve(null);
                    }
                };
                
                document.head.appendChild(script);
            });
        }

        // ==================== ØªØ³Øª Ù…Ø³ÛŒØ±Ù‡Ø§ ====================
        async function testPaths() {
            addLog('Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§...', 'info');
            
            for (const file of PROJECT_FILES) {
                try {
                    const response = await fetch(file.path);
                    if (response.ok) {
                        addLog(`âœ… Ù…Ø³ÛŒØ± Ø¯Ø±Ø³Øª: ${file.path}`, 'success');
                    } else {
                        addLog(`âŒ Ù…Ø³ÛŒØ± Ø§Ø´ØªØ¨Ø§Ù‡: ${file.path} (Ú©Ø¯: ${response.status})`, 'error');
                    }
                } catch (error) {
                    addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ÛŒ: ${file.path}`, 'error');
                }
                
                // ØªØ£Ø®ÛŒØ± Ú©ÙˆÚ†Ú©
                await new Promise(r => setTimeout(r, 100));
            }
            
            addLog('Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ±Ù‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯', 'info');
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯ ====================
        async function testEventBus() {
            addLog('ØªØ³Øª EventBus...', 'info');
            
            if (typeof eventBus === 'undefined') {
                addLog('âŒ window.eventBus ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡', 'error');
                addLog('   Ø¯Ø± event_bus.js Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯: window.eventBus = eventBus;', 'info');
                testerState.testResults.failed++;
                return false;
            }
            
            try {
                let eventReceived = false;
                
                const unsubscribe = eventBus.on('test:integration', (data) => {
                    eventReceived = true;
                    addLog(`ğŸ“¨ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯: ${JSON.stringify(data)}`, 'success');
                });
                
                eventBus.emit('test:integration', { 
                    test: 'Vakamova Integration Test',
                    timestamp: Date.now()
                });
                
                await new Promise(r => setTimeout(r, 150));
                
                if (eventReceived) {
                    addLog('âœ… EventBus Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'success');
                    testerState.testResults.passed++;
                    
                    if (typeof unsubscribe === 'function') {
                        unsubscribe();
                    }
                    
                    return true;
                } else {
                    addLog('âŒ Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù…Ù†ØªØ´Ø± Ø´Ø¯ Ø§Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                    testerState.testResults.failed++;
                    return false;
                }
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± EventBus: ${error.message}`, 'error');
                testerState.testResults.failed++;
                return false;
            }
        }

        async function testStateManager() {
            addLog('ØªØ³Øª State Manager...', 'info');
            
            if (typeof HyperStateManager === 'undefined') {
                addLog('âŒ HyperStateManager ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡', 'error');
                addLog('   Ø¯Ø± state_manager.js Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯: window.HyperStateManager = HyperStateManager;', 'info');
                testerState.testResults.failed++;
                return false;
            }
            
            try {
                const testState = new HyperStateManager(eventBus);
                const testKey = 'integration.test';
                const testValue = { project: 'Vakamova', phase: 'testing' };
                
                testState.set(testKey, testValue);
                const retrieved = testState.get(testKey);
                
                if (retrieved && retrieved.project === 'Vakamova') {
                    addLog('âœ… State Manager Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'success');
                    testerState.testResults.passed++;
                    return true;
                } else {
                    addLog('âŒ State Manager Ø¯Ø§Ø¯Ù‡ Ø±Ø§ Ø¨Ø±Ù†Ú¯Ø±Ø¯Ø§Ù†Ø¯', 'error');
                    testerState.testResults.failed++;
                    return false;
                }
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ Ø¯Ø± State Manager: ${error.message}`, 'error');
                testerState.testResults.failed++;
                return false;
            }
        }

        async function testNewModules() {
            addLog('Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯...', 'info');
            
            const newModules = [
                { name: 'Security Layer', globalName: 'securityLayer', path: './core/security.layer.js' },
                { name: 'Core Operations', globalName: 'coreOperation', path: './core/core.operation.js' },
                { name: 'Persistence', globalName: 'persistence', path: './core/persistence.js' }
            ];
            
            let passed = 0;
            
            for (const module of newModules) {
                if (typeof window[module.globalName] !== 'undefined') {
                    addLog(`âœ… ${module.name} Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª (${module.globalName})`, 'success');
                    passed++;
                } else {
                    addLog(`âŒ ${module.name} ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡`, 'error');
                    addLog(`   Ø¯Ø± ${module.path} Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯: window.${module.globalName} = ...`, 'info');
                }
            }
            
            if (passed === newModules.length) {
                testerState.testResults.passed++;
                return true;
            } else {
                testerState.testResults.failed++;
                return false;
            }
        }

        async function testAuthManager() {
            addLog('Ø¨Ø±Ø±Ø³ÛŒ Auth Manager...', 'info');
            
            if (typeof auth_manager === 'undefined') {
                addLog('âŒ auth_manager ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡', 'error');
                addLog('   Ø¯Ø± auth_manager.js Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯: window.auth_manager = ...', 'info');
                testerState.testResults.failed++;
                return false;
            }
            
            try {
                const requiredMethods = ['login', 'register', 'logout'];
                let hasAllMethods = true;
                
                for (const method of requiredMethods) {
                    if (typeof auth_manager[method] !== 'function') {
                        addLog(`âš ï¸ auth_manager.${method}() ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡`, 'warning');
                        hasAllMethods = false;
                    }
                }
                
                if (hasAllMethods) {
                    addLog('âœ… Auth Manager Ù…ØªØ¯Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ Ø±Ø§ Ø¯Ø§Ø±Ø¯', 'success');
                    testerState.testResults.passed++;
                    return true;
                } else {
                    addLog('âš ï¸ Auth Manager Ø¨Ø±Ø®ÛŒ Ù…ØªØ¯Ù‡Ø§ Ø±Ø§ Ù†Ø¯Ø§Ø±Ø¯', 'warning');
                    testerState.testResults.failed++;
                    return false;
                }
            } catch (error) {
                addLog(`âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Auth Manager: ${error.message}`, 'warning');
                testerState.testResults.failed++;
                return false;
            }
        }

        // ==================== ØªØ³Øª Ú©Ø§Ù…Ù„ ====================
        async function runFullTest() {
            addLog('Ø´Ø±ÙˆØ¹ ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡ Ú©Ø§Ù…Ù„ Vakamova...', 'info');
            testerState.startTime = Date.now();
            
            // Ø±ÛŒØ³Øª ÙˆØ¶Ø¹ÛŒØª
            testerState.testResults = { passed: 0, failed: 0 };
            testerState.loadedFiles.clear();
            document.getElementById('cardPassed').querySelector('.value').textContent = '0';
            document.getElementById('cardFailed').querySelector('.value').textContent = '0';
            document.getElementById('logContainer').innerHTML = '';
            document.getElementById('progressFill').style.width = '0%';
            initializeFileList();
            
            try {
                // Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
                addLog('Ù…Ø±Ø­Ù„Ù‡ Û±: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ...', 'info');
                
                const requiredFiles = PROJECT_FILES.filter(f => f.required);
                let loadedCount = 0;
                
                for (let i = 0; i < requiredFiles.length; i++) {
                    const file = requiredFiles[i];
                    try {
                        await loadScript(file);
                        loadedCount++;
                        
                        // Ø¢Ù¾Ø¯ÛŒØª progress bar
                        const progress = (loadedCount / requiredFiles.length) * 100;
                        document.getElementById('progressFill').style.width = `${progress}%`;
                        
                        await new Promise(r => setTimeout(r, 50));
                    } catch (error) {
                        addLog(`ØªÙˆÙ‚Ù: ${error.message}`, 'error');
                        return;
                    }
                }
                
                // Ù…Ø±Ø­Ù„Ù‡ Û²: ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯
                addLog('Ù…Ø±Ø­Ù„Ù‡ Û²: Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆØ§Ø­Ø¯...', 'info');
                
                await testEventBus();
                await testStateManager();
                await testNewModules();
                await testAuthManager();
                
                // Ù…Ø±Ø­Ù„Ù‡ Û³: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†ØªØ§ÛŒØ¬
                const endTime = Date.now();
                const duration = ((endTime - testerState.startTime) / 1000).toFixed(2);
                document.getElementById('executionTime').textContent = `${duration}s`;
                document.getElementById('progressFill').style.width = '100%';
                
                // Ø®Ù„Ø§ØµÙ‡ Ù†ØªØ§ÛŒØ¬
                addLog('='.repeat(50), 'info');
                addLog(`ğŸ¯ Ù†ØªØ§ÛŒØ¬ Ù†Ù‡Ø§ÛŒÛŒ: ${testerState.testResults.passed} Ù…ÙˆÙÙ‚ØŒ ${testerState.testResults.failed} Ù†Ø§Ù…ÙˆÙÙ‚`, 
                      testerState.testResults.failed === 0 ? 'success' : 'warning');
                addLog(`â±ï¸ Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§: ${duration} Ø«Ø§Ù†ÛŒÙ‡`, 'info');
                addLog(`ğŸ“¦ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡: ${loadedCount}/${requiredFiles.length}`, 'info');
                addLog('='.repeat(50), 'info');
                
                // Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¹Ø¯ÛŒ
                if (testerState.testResults.failed === 0) {
                    addLog('ğŸ‰ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù†Ø¯! Ù¾Ø±ÙˆÚ˜Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.', 'success');
                } else {
                    addLog('ğŸ”§ Ø¨Ø±Ø®ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯Ù†Ø¯. Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.', 'warning');
                }
                
            } catch (error) {
                addLog(`âŒ Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡: ${error.message}`, 'error');
            }
        }

        // ==================== Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ ====================
        function initializeFileList() {
            const container = document.getElementById('fileListContainer');
            container.innerHTML = '';
            
            PROJECT_FILES.forEach(file => {
                const fileElement = document.createElement('div');
                fileElement.className = 'file-item';
                fileElement.id = `file-${file.name.replace(/\s+/g, '-')}`;
                fileElement.innerHTML = `
                    <div class="file-info">
                        <span class="file-icon">
                            ${file.type === 'core' ? 'ğŸ§ ' : 
                              file.type === 'auth' ? 'ğŸ”' : 
                              file.type === 'page' ? 'ğŸ“„' : 'âš™ï¸'}
                        </span>
                        <div>
                            <div style="font-weight: 600;">${file.name}</div>
                            <div style="font-size: 0.8rem; color: #94a3b8;">${file.path}</div>
                        </div>
                    </div>
                    <div class="file-status status-pending">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
                `;
                
                container.appendChild(fileElement);
            });
        }

        function updateFileUI(fileName, status) {
            const element = document.getElementById(`file-${fileName.replace(/\s+/g, '-')}`);
            if (!element) return;
            
            const statusEl = element.querySelector('.file-status');
            statusEl.className = 'file-status';
            
            switch (status) {
                case 'loaded':
                    statusEl.classList.add('status-loaded');
                    statusEl.textContent = 'Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯';
                    break;
                case 'error':
                    statusEl.classList.add('status-error');
                    statusEl.textContent = 'Ø®Ø·Ø§';
                    break;
            }
        }

        function updateStatus() {
            const loadedCount = Array.from(testerState.loadedFiles.values())
                .filter(f => f.loaded).length;
            
            document.getElementById('cardLoaded').querySelector('.value').textContent = 
                `${loadedCount}/${PROJECT_FILES.filter(f => f.required).length}`;
            
            document.getElementById('cardPassed').querySelector('.value').textContent = 
                testerState.testResults.passed;
            
            document.getElementById('cardFailed').querySelector('.value').textContent = 
                testerState.testResults.failed;
            
            // ØªØºÛŒÛŒØ± Ø±Ù†Ú¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§
            document.getElementById('cardPassed').className = 
                `status-card ${testerState.testResults.passed > 0 ? 'passed' : ''}`;
            
            document.getElementById('cardFailed').className = 
                `status-card ${testerState.testResults.failed > 0 ? 'failed' : ''}`;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            addLog('Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'info');
        }

        function showDebugInfo() {
            console.group('ğŸ› Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯ Vakamova');
            console.log('ğŸ“ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡:', testerState.loadedFiles);
            console.log('ğŸ“Š Ù†ØªØ§ÛŒØ¬ ØªØ³Øª:', testerState.testResults);
            console.log('ğŸŒ Global Objects:');
            console.log('  window.eventBus:', window.eventBus);
            console.log('  window.HyperStateManager:', window.HyperStateManager);
            console.log('  window.auth_manager:', window.auth_manager);
            console.log('  window.securityLayer:', window.securityLayer);
            console.log('  window.coreOperation:', window.coreOperation);
            console.log('  window.persistence:', window.persistence);
            console.groupEnd();
            
            addLog('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒØ¨Ø§Ú¯ Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯ (F12)', 'info');
        }

        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
        window.addEventListener('DOMContentLoaded', () => {
            initializeFileList();
            addLog('ØªØ³ØªØ± Vakamova Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.', 'info');
            addLog('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø±ÙˆÛŒ "Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.', 'info');
            addLog('Ø§Ú¯Ø± Ø®Ø·Ø§ Ø¯Ø§Ø±ÛŒØ¯ØŒ Ø§Ø¨ØªØ¯Ø§ "Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø³ÛŒØ±Ù‡Ø§" Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†ÛŒØ¯.', 'info');
            
            // Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ù…ÛŒØ§Ù†Ø¨Ø±
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    runFullTest();
                }
                if (e.ctrlKey && e.key === 'p') {
                    e.preventDefault();
                    testPaths();
                }
            });
        });

        // Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ú©Ù†Ø³ÙˆÙ„
        window.VakamovaTester = {
            runFullTest,
            testPaths,
            testEventBus,
            testStateManager,
            testNewModules,
            testAuthManager,
            clearLogs,
            showDebugInfo,
            getState: () => ({ 
                loadedFiles: Array.from(testerState.loadedFiles.values()),
                testResults: testerState.testResults,
                logs: testerState.logs 
            })
        };
    </script>
</body>
</html>
