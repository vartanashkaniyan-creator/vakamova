<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Performance Ø¯ÛŒØªØ§Ø¨ÛŒØ³ - Vakamova</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:tahoma;background:#004d40;color:#333;padding:20px}.container{max-width:900px;margin:auto;background:#fff;border-radius:10px;overflow:hidden}header{background:#00695c;color:#fff;padding:20px;text-align:center}h1{font-size:1.5rem}.test-section{padding:20px}.test-item{background:#f5f5f5;border-radius:8px;padding:15px;margin-bottom:15px;border-right:5px solid#00897b}.passed{border-right-color:#43a047;background:#e8f5e9}.failed{border-right-color:#e53935;background:#ffebee}.running{border-right-color:#fb8c00;background:#fff3e0}.test-header{display:flex;justify-content:space-between;margin-bottom:10px}.test-name{font-weight:bold}.test-status{padding:3px 10px;border-radius:12px;font-size:.8rem}.status-pending{background:#fff9c4;color:#f57c00}.status-running{background:#bbdefb;color:#1565c0}.status-passed{background:#c8e6c9;color:#2e7d32}.status-failed{background:#ffcdd2;color:#c62828}button{background:#00695c;color:#fff;border:none;padding:12px 25px;border-radius:8px;font-size:1rem;cursor:pointer;width:100%;margin-top:15px}button:hover{background:#004d40}.console{background:#263238;color:#80cbc4;padding:15px;margin-top:20px;border-radius:8px;font-family:monospace;font-size:.9rem;max-height:200px;overflow-y:auto}.log{padding:5px 0;border-bottom:1px solid #37474f}.performance-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:15px 0}.perf-item{background:#e0f2f1;padding:10px;border-radius:6px;text-align:center}.perf-value{font-size:1.1rem;font-weight:bold;color:#00695c}.perf-label{font-size:.8rem;color:#546e7a}.progress-container{margin:15px 0}.progress-bar{width:100%;height:10px;background:#e0e0e0;border-radius:5px;overflow:hidden}.progress-fill{height:100%;background:#26a69a;width:0%;transition:width .3s ease}.results-table{width:100%;border-collapse:collapse;margin-top:20px}th,td{padding:10px;text-align:center;border:1px solid #e0e0e0}th{background:#e0f2f1;color:#00695c}tr:nth-child(even){background:#f9f9f9}.btn-group{display:flex;gap:10px;margin-top:15px}.btn-group button{flex:1}
    </style>
</head>
<body>
    <div class="container">
        <header><h1>ğŸš€ ØªØ³Øª Performance Ø¯ÛŒØªØ§Ø¨ÛŒØ³ - Stress & Benchmark</h1></header>
        <div class="test-section">
            <div class="progress-container">
                <div class="progress-bar"><div class="progress-fill" id="global-progress"></div></div>
                <div style="text-align:center;margin-top:5px;font-size:.9rem" id="progress-text">Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§</div>
            </div>
            
            <div class="performance-stats">
                <div class="perf-item"><div class="perf-value" id="stat-time">0ms</div><div class="perf-label">Ú©Ù„ Ø²Ù…Ø§Ù†</div></div>
                <div class="perf-item"><div class="perf-value" id="stat-ops">0</div><div class="perf-label">Ø¹Ù…Ù„ÛŒØ§Øª/Ø«Ø§Ù†ÛŒÙ‡</div></div>
                <div class="perf-item"><div class="perf-value" id="stat-memory">-</div><div class="perf-label">Ù…ØµØ±Ù Ø­Ø§ÙØ¸Ù‡</div></div>
                <div class="perf-item"><div class="perf-value" id="stat-success">0%</div><div class="perf-label">Ù…ÙˆÙÙ‚ÛŒØª</div></div>
            </div>
            
            <div class="test-item" id="test1">
                <div class="test-header"><div class="test-name">Û±. Ø¯Ø±Ø¬ Ø§Ù†Ø¨ÙˆÙ‡ Û±Û°Û° Ú©Ø§Ø±Ø¨Ø±</div><div class="test-status status-pending" id="status1">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output1"></div>
            </div>
            <div class="test-item" id="test2">
                <div class="test-header"><div class="test-name">Û². Ú©ÙˆØ¦Ø±ÛŒ JOIN Ù¾ÛŒÚ†ÛŒØ¯Ù‡ (Û³ Ø¬Ø¯ÙˆÙ„)</div><div class="test-status status-pending" id="status2">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output2"></div>
            </div>
            <div class="test-item" id="test3">
                <div class="test-header"><div class="test-name">Û³. ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</div><div class="test-status status-pending" id="status3">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output3"></div>
            </div>
            <div class="test-item" id="test4">
                <div class="test-header"><div class="test-name">Û´. Ø¨Ù†Ú†Ù…Ø§Ø±Ú© Ø¹Ù…Ù„ÛŒØ§Øª CRUD</div><div class="test-status status-pending" id="status4">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output4"></div>
            </div>
            <div class="test-item" id="test5">
                <div class="test-header"><div class="test-name">Ûµ. ØªØ³Øª Stress Ù‡Ù…Ø²Ù…Ø§Ù†</div><div class="test-status status-pending" id="status5">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output5"></div>
            </div>
            
            <table class="results-table" id="results-table">
                <thead><tr><th>ØªØ³Øª</th><th>Ø²Ù…Ø§Ù† (ms)</th><th>Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§</th><th>Ø¹Ù…Ù„ÛŒØ§Øª/Ø«Ø§Ù†ÛŒÙ‡</th><th>ÙˆØ¶Ø¹ÛŒØª</th></tr></thead>
                <tbody id="results-body"></tbody>
            </table>
            
            <div class="btn-group">
                <button id="run-btn">â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Performance</button>
                <button id="run-light-btn" style="background:#00838f">ğŸ”† Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø³Ø¨Ú©</button>
            </div>
            <button id="reset-btn" style="background:#546e7a">ğŸ”„ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</button>
            
            <div class="console" id="console">
                <div class="log">[Ø³ÛŒØ³ØªÙ…] ØªØ³Øª Performance Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª</div>
            </div>
        </div>
    </div>

<script>
// ========== Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Performance-Optimized ==========
const PerfDB = {
    users: new Map(),
    lessons: new Map(),
    progress: new Map(),
    transactions: new Map(),
    nextId: { users: 1, lessons: 1, transactions: 1 },
    
    // ========== Ø¹Ù…Ù„ÛŒØ§Øª Ù¾Ø§ÛŒÙ‡ Ø³Ø±ÛŒØ¹ ==========
    createUserFast(email, name) {
        const user = {
            id: this.nextId.users++,
            email,
            name,
            coins: 100,
            level: Math.floor(Math.random() * 5) + 1,
            country: ['Ø§ÛŒØ±Ø§Ù†', 'Ø¢Ù…Ø±ÛŒÚ©Ø§', 'Ø¢Ù„Ù…Ø§Ù†', 'Ú˜Ø§Ù¾Ù†'][Math.floor(Math.random() * 4)],
            joined_date: new Date(Date.now() - Math.random() * 31536000000) // ØªØµØ§Ø¯ÙÛŒ Ø¯Ø± ÛŒÚ© Ø³Ø§Ù„ Ú¯Ø°Ø´ØªÙ‡
        };
        this.users.set(user.id, user);
        return user;
    },
    
    createLessonFast(title, language) {
        const lesson = {
            id: this.nextId.lessons++,
            title,
            language,
            difficulty: ['beginner', 'intermediate', 'advanced'][Math.floor(Math.random() * 3)],
            price: [50, 100, 150, 200][Math.floor(Math.random() * 4)],
            rating: Math.floor(Math.random() * 50) / 10 + 3 // 3.0 ØªØ§ 8.0
        };
        this.lessons.set(lesson.id, lesson);
        return lesson;
    },
    
    // ========== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Performance ==========
    async bulkInsertUsers(count) {
        const startTime = Date.now();
        
        for (let i = 0; i < count; i++) {
            this.createUserFast(`user${i}@perf.com`, `Ú©Ø§Ø±Ø¨Ø± ${i}`);
        }
        
        const duration = Date.now() - startTime;
        const opsPerSecond = (count / (duration / 1000)).toFixed(1);
        
        return {
            count,
            duration: Math.round(duration),
            opsPerSecond
        };
    },
    
    async complexJoinQuery() {
        const startTime = Date.now();
        
        // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ JOIN Ø³Ù‡ Ø¬Ø¯ÙˆÙ„: users + lessons + progress
        const results = [];
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
        const testUser = this.createUserFast('join@test.com', 'Ú©Ø§Ø±Ø¨Ø± Join');
        const testLessons = [];
        for (let i = 0; i < 5; i++) {
            testLessons.push(this.createLessonFast(`Ø¯Ø±Ø³ Join ${i}`, 'english'));
        }
        
        // Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÛŒØ´Ø±ÙØªâ€ŒÙ‡Ø§
        for (const lesson of testLessons) {
            const progressKey = `${testUser.id}_${lesson.id}`;
            this.progress.set(progressKey, {
                user_id: testUser.id,
                lesson_id: lesson.id,
                score: Math.floor(Math.random() * 100),
                completed: false,
                time_spent: Math.floor(Math.random() * 7200)
            });
            
            // Ø§ÛŒØ¬Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´
            const transactionId = this.nextId.transactions++;
            this.transactions.set(transactionId, {
                id: transactionId,
                user_id: testUser.id,
                lesson_id: lesson.id,
                amount: lesson.price,
                status: 'completed',
                created_at: new Date()
            });
        }
        
        // Ø§Ø¬Ø±Ø§ÛŒ Ú©ÙˆØ¦Ø±ÛŒ JOIN (Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡)
        let matchedResults = 0;
        for (const [key, progress] of this.progress) {
            const user = this.users.get(progress.user_id);
            const lesson = this.lessons.get(progress.lesson_id);
            
            if (user && lesson) {
                // ÛŒØ§ÙØªÙ† ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø±ØªØ¨Ø·
                let transaction = null;
                for (const [tId, t] of this.transactions) {
                    if (t.user_id === user.id && t.lesson_id === lesson.id) {
                        transaction = t;
                        break;
                    }
                }
                
                if (transaction) {
                    results.push({
                        userName: user.name,
                        lessonTitle: lesson.title,
                        score: progress.score,
                        price: lesson.price,
                        transactionId: transaction.id
                    });
                    matchedResults++;
                }
            }
        }
        
        const duration = Date.now() - startTime;
        return {
            results,
            duration: Math.round(duration),
            matchedCount: matchedResults,
            querySpeed: matchedResults > 0 ? Math.round(duration / matchedResults) : 0
        };
    },
    
    async advancedFiltering() {
        const startTime = Date.now();
        
        // Ú†Ù†Ø¯ÛŒÙ† Ù†ÙˆØ¹ ÙÛŒÙ„ØªØ± Ù…Ø®ØªÙ„Ù
        const filters = [
            { name: 'Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø³Ø·Ø­ Û³+', condition: u => u.level >= 3 },
            { name: 'Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ù‚ÛŒÙ…Øª Ø¨Ø§Ù„Ø§', condition: l => l.price > 100 },
            { name: 'Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§ÛŒØ±Ø§Ù†ÛŒ', condition: u => u.country === 'Ø§ÛŒØ±Ø§Ù†' },
            { name: 'Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§', condition: l => l.rating > 7.0 }
        ];
        
        const filterResults = {};
        
        // Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±Ù‡Ø§
        for (const filter of filters) {
            const startFilter = Date.now();
            let count = 0;
            
            if (filter.name.includes('Ú©Ø§Ø±Ø¨Ø±')) {
                for (const user of this.users.values()) {
                    if (filter.condition(user)) count++;
                }
            } else {
                for (const lesson of this.lessons.values()) {
                    if (filter.condition(lesson)) count++;
                }
            }
            
            const filterTime = Date.now() - startFilter;
            filterResults[filter.name] = {
                count,
                time: Math.round(filterTime),
                speed: count > 0 ? Math.round(filterTime / count * 100) / 100 : 0
            };
        }
        
        const totalDuration = Date.now() - startTime;
        return {
            filters: filterResults,
            totalDuration: Math.round(totalDuration),
            totalItems: this.users.size + this.lessons.size
        };
    },
    
    async benchmarkCRUD() {
        PerfDB.log("Ø´Ø±ÙˆØ¹ Ø¨Ù†Ú†Ù…Ø§Ø±Ú© CRUD...");
        
        // ØªØ¹Ø¯Ø§Ø¯ iteration Ú©Ù…â€ŒØªØ± Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
        const iterations = 50;
        let createTotal = 0;
        let readTotal = 0;
        let updateTotal = 0;
        
        // ØªØ³Øª Create
        for (let i = 0; i < iterations; i++) {
            const start = Date.now();
            this.createUserFast(`bench${i}@test.com`, `Ø¨Ù†Ú† ${i}`);
            createTotal += (Date.now() - start);
        }
        
        // ØªØ³Øª Read
        const userIds = Array.from(this.users.keys());
        for (let i = 0; i < Math.min(iterations, userIds.length); i++) {
            const start = Date.now();
            this.users.get(userIds[i]);
            readTotal += (Date.now() - start);
        }
        
        // ØªØ³Øª Update
        for (let i = 0; i < Math.min(iterations, userIds.length); i++) {
            const user = this.users.get(userIds[i]);
            if (user) {
                const start = Date.now();
                user.coins += 10;
                updateTotal += (Date.now() - start);
            }
        }
        
        const createAvg = createTotal / iterations;
        const readAvg = readTotal / Math.min(iterations, userIds.length);
        const updateAvg = updateTotal / Math.min(iterations, userIds.length);
        const overallAvg = (createAvg + readAvg + updateAvg) / 3;
        
        return {
            createAvg,
            readAvg,
            updateAvg,
            overallAvg,
            iterations
        };
    },
    
    async stressTestConcurrent() {
        PerfDB.log("Ø´Ø±ÙˆØ¹ ØªØ³Øª Stress Ù‡Ù…Ø²Ù…Ø§Ù† (Ù†Ø³Ø®Ù‡ Ø³Ø¨Ú©)...");
        
        // Ú©Ø§Ù‡Ø´ Ø¹Ù…Ù„ÛŒØ§Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„
        const concurrentOperations = 10;
        const startTime = Date.now();
        let successfulOps = 0;
        
        // Ø¹Ù…Ù„ÛŒØ§Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø¨Ú©â€ŒØªØ±
        for (let i = 0; i < concurrentOperations; i++) {
            try {
                switch (i % 3) {
                    case 0: // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±
                        this.createUserFast(`stress${i}@test.com`, `Ø§Ø³ØªØ±Ø³ ${i}`);
                        break;
                    case 1: // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø³
                        this.createLessonFast(`Ø¯Ø±Ø³ Ø§Ø³ØªØ±Ø³ ${i}`, 'english');
                        break;
                    case 2: // Ø®ÙˆØ§Ù†Ø¯Ù†
                        if (this.users.size > 0) {
                            const firstUser = Array.from(this.users.values())[0];
                            // Ø¹Ù…Ù„ÛŒØ§Øª Ø³Ø§Ø¯Ù‡
                        }
                        break;
                }
                successfulOps++;
            } catch (e) {
                this.log(`Ø¹Ù…Ù„ÛŒØ§Øª ${i} Ø®Ø·Ø§ Ø®ÙˆØ±Ø¯: ${e.message}`, 'warning');
            }
        }
        
        const totalDuration = Date.now() - startTime;
        const opsPerSecond = (concurrentOperations / (totalDuration / 1000)).toFixed(1);
        const successRate = Math.round((successfulOps / concurrentOperations) * 100);
        
        return {
            concurrentOperations,
            totalDuration: Math.round(totalDuration),
            opsPerSecond,
            successRate,
            successfulOps
        };
    },
    
    // ========== Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ ==========
    log(message, type = 'info') {
        console.log(`[PerfDB] ${message}`);
        const consoleEl = document.getElementById('console');
        const logEntry = document.createElement('div');
        logEntry.className = 'log';
        logEntry.textContent = `${message}`;
        consoleEl.appendChild(logEntry);
        consoleEl.scrollTop = consoleEl.scrollHeight;
    },
    
    updateStats(result) {
        if (result) {
            document.getElementById('stat-time').textContent = `${result.totalTime || result.duration || 0}ms`;
            if (result.opsPerSecond) {
                document.getElementById('stat-ops').textContent = result.opsPerSecond;
            }
        }
    },
    
    clear() {
        this.users.clear();
        this.lessons.clear();
        this.progress.clear();
        this.transactions.clear();
        this.nextId = { users: 1, lessons: 1, transactions: 1 };
        this.log("ğŸ§¹ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Performance Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯");
        document.getElementById('results-body').innerHTML = '';
        document.getElementById('global-progress').style.width = '0%';
        document.getElementById('progress-text').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§';
        this.updateStats({ totalTime: 0 });
    },
    
    addResultToTable(testName, time, records, ops, status) {
        const tbody = document.getElementById('results-body');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${testName}</td>
            <td>${time}ms</td>
            <td>${records}</td>
            <td>${ops}</td>
            <td style="color:${status === 'âœ…' ? '#2e7d32' : '#c62828'}">${status}</td>
        `;
        tbody.appendChild(row);
    }
};

// ========== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Performance ==========
const performanceTests = [
    {
        id: 'test1',
        name: 'Ø¯Ø±Ø¬ Ø§Ù†Ø¨ÙˆÙ‡ Û±Û°Û° Ú©Ø§Ø±Ø¨Ø±',
        description: 'Ø§ÛŒØ¬Ø§Ø¯ Û±Û°Û° Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØªØµØ§Ø¯ÙÛŒ',
        run: async () => {
            PerfDB.log("Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø¬ Ø§Ù†Ø¨ÙˆÙ‡ Û±Û°Û° Ú©Ø§Ø±Ø¨Ø±...");
            const result = await PerfDB.bulkInsertUsers(100);
            
            PerfDB.addResultToTable(
                'Ø¯Ø±Ø¬ Ø§Ù†Ø¨ÙˆÙ‡',
                result.duration,
                result.count,
                result.opsPerSecond,
                'âœ…'
            );
            
            return `âœ… ${result.count} Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ${result.duration}ms Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù†Ø¯ (${result.opsPerSecond} Ø¹Ù…Ù„ÛŒØ§Øª/Ø«Ø§Ù†ÛŒÙ‡)`;
        }
    },
    {
        id: 'test2',
        name: 'Ú©ÙˆØ¦Ø±ÛŒ JOIN Ù¾ÛŒÚ†ÛŒØ¯Ù‡',
        description: 'Ø§ØªØµØ§Ù„ Û³ Ø¬Ø¯ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ù¾ÛŒØ´Ø±ÙØª',
        run: async () => {
            PerfDB.log("Ø´Ø±ÙˆØ¹ Ú©ÙˆØ¦Ø±ÛŒ JOIN Ù¾ÛŒÚ†ÛŒØ¯Ù‡...");
            const result = await PerfDB.complexJoinQuery();
            
            PerfDB.addResultToTable(
                'JOIN Ù¾ÛŒÚ†ÛŒØ¯Ù‡',
                result.duration,
                result.matchedCount,
                result.querySpeed,
                'âœ…'
            );
            
            return `âœ… ${result.matchedCount} Ù†ØªÛŒØ¬Ù‡ Ø¯Ø± ${result.duration}ms ÛŒØ§ÙØª Ø´Ø¯ (${result.querySpeed}ms/Ø±Ú©ÙˆØ±Ø¯)`;
        }
    },
    {
        id: 'test3',
        name: 'ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡',
        description: 'Ø§Ø¹Ù…Ø§Ù„ Û´ ÙÛŒÙ„ØªØ± Ù…Ø®ØªÙ„Ù Ø¨Ø± Ø±ÙˆÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§',
        run: async () => {
            PerfDB.log("Ø´Ø±ÙˆØ¹ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡...");
            const result = await PerfDB.advancedFiltering();
            
            // Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ØªØ±ÛŒÙ† Ùˆ Ø¨Ø¯ØªØ±ÛŒÙ† ÙÛŒÙ„ØªØ±
            let fastestFilter = null;
            let slowestFilter = null;
            for (const [name, data] of Object.entries(result.filters)) {
                if (!fastestFilter || data.time < fastestFilter.time) {
                    fastestFilter = { name, ...data };
                }
                if (!slowestFilter || data.time > slowestFilter.time) {
                    slowestFilter = { name, ...data };
                }
            }
            
            PerfDB.addResultToTable(
                'ÙÛŒÙ„ØªØ± Ù¾ÛŒØ´Ø±ÙØªÙ‡',
                result.totalDuration,
                result.totalItems,
                Math.round(result.totalItems / (result.totalDuration / 1000)),
                'âœ…'
            );
            
            return `âœ… ${Object.keys(result.filters).length} ÙÛŒÙ„ØªØ± Ø¯Ø± ${result.totalDuration}ms Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù†Ø¯<br>
                   Ø³Ø±ÛŒØ¹â€ŒØªØ±ÛŒÙ†: ${fastestFilter.name} (${fastestFilter.time}ms)<br>
                   Ú©Ù†Ø¯ØªØ±ÛŒÙ†: ${slowestFilter.name} (${slowestFilter.time}ms)`;
        }
    },
    {
        id: 'test4',
        name: 'Ø¨Ù†Ú†Ù…Ø§Ø±Ú© Ø¹Ù…Ù„ÛŒØ§Øª CRUD',
        description: 'Ø³Ù†Ø¬Ø´ Ø³Ø±Ø¹Øª Create, Read, Update',
        run: async () => {
            const benchmarks = await PerfDB.benchmarkCRUD();
            
            // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„ÛŒ
            const avgTimes = [
                benchmarks.createAvg,
                benchmarks.readAvg,
                benchmarks.updateAvg
            ];
            const overallAvg = avgTimes.reduce((a, b) => a + b) / avgTimes.length;
            
            PerfDB.addResultToTable(
                'Ø¨Ù†Ú†Ù…Ø§Ø±Ú© CRUD',
                Math.round(overallAvg),
                benchmarks.iterations,
                Math.round(1000 / overallAvg),
                'âœ…'
            );
            
            return `âœ… Ø¨Ù†Ú†Ù…Ø§Ø±Ú© ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯ (${benchmarks.iterations} ØªÚ©Ø±Ø§Ø±):<br>
                   Ø§ÛŒØ¬Ø§Ø¯: ${Math.round(benchmarks.createAvg)}ms<br>
                   Ø®ÙˆØ§Ù†Ø¯Ù†: ${Math.round(benchmarks.readAvg)}ms<br>
                   Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: ${Math.round(benchmarks.updateAvg)}ms<br>
                   Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ú©Ù„ÛŒ: ${overallAvg.toFixed(2)}ms`;
        }
    },
    {
        id: 'test5',
        name: 'ØªØ³Øª Stress Ù‡Ù…Ø²Ù…Ø§Ù†',
        description: 'Û±Û° Ø¹Ù…Ù„ÛŒØ§Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¨Ø§Ø±',
        run: async () => {
            const result = await PerfDB.stressTestConcurrent();
            
            PerfDB.addResultToTable(
                'Stress Test',
                result.totalDuration,
                result.concurrentOperations,
                result.opsPerSecond,
                result.successRate >= 90 ? 'âœ…' : 'âš ï¸'
            );
            
            return `âœ… ${result.concurrentOperations} Ø¹Ù…Ù„ÛŒØ§Øª Ø¯Ø± ${result.totalDuration}ms<br>
                   Ø¹Ù…Ù„ÛŒØ§Øª/Ø«Ø§Ù†ÛŒÙ‡: ${result.opsPerSecond}<br>
                   Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª: ${result.successRate}%`;
        }
    }
];

// ========== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ ==========
async function runPerformanceTests(lightMode = false) {
    const runBtn = document.getElementById('run-btn');
    const lightBtn = document.getElementById('run-light-btn');
    
    runBtn.disabled = true;
    lightBtn.disabled = true;
    runBtn.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Performance...';
    
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ
    document.getElementById('results-body').innerHTML = '';
    
    const startTime = Date.now();
    let passed = 0;
    let totalDuration = 0;
    
    // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
    for (let i = 0; i < performanceTests.length; i++) {
        const test = performanceTests[i];
        
        // Ø¯Ø± Ø­Ø§Ù„Øª Ø³Ø¨Ú©ØŒ ÙÙ‚Ø· Û³ ØªØ³Øª Ø§ÙˆÙ„ Ø±Ø§ Ø§Ø¬Ø±Ø§ Ú©Ù†
        if (lightMode && i >= 3) {
            document.getElementById(test.id).style.opacity = '0.5';
            document.getElementById(`status${i+1}`).textContent = 'Ø±Ø¯ Ø´Ø¯Ù‡';
            document.getElementById(`status${i+1}`).className = 'test-status status-pending';
            continue;
        }
        
        const testEl = document.getElementById(test.id);
        const statusEl = document.getElementById(`status${i+1}`);
        const outputEl = document.getElementById(`output${i+1}`);
        
        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ progress bar
        const progress = Math.round(((i) / performanceTests.length) * 100);
        document.getElementById('global-progress').style.width = `${progress}%`;
        document.getElementById('progress-text').textContent = `Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª ${i+1} Ø§Ø² ${performanceTests.length}`;
        
        // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§
        testEl.className = 'test-item running';
        statusEl.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
        statusEl.className = 'test-status status-running';
        outputEl.innerHTML = '<span style="color:#666">Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØ³Øª...</span>';
        
        try {
            PerfDB.log(`Ø´Ø±ÙˆØ¹ ØªØ³Øª: ${test.name}`);
            const testStart = Date.now();
            
            const result = await test.run();
            const testDuration = Date.now() - testStart;
            totalDuration += testDuration;
            
            // ØªØ³Øª Ù…ÙˆÙÙ‚
            testEl.className = 'test-item passed';
            statusEl.textContent = 'Ù…ÙˆÙÙ‚';
            statusEl.className = 'test-status status-passed';
            outputEl.innerHTML = `<div style="color:#2e7d32">${result}</div>`;
            passed++;
            
            PerfDB.log(`ØªØ³Øª "${test.name}" Ù…ÙˆÙÙ‚ Ø¯Ø± ${Math.round(testDuration)}ms`);
            
        } catch (error) {
            // ØªØ³Øª Ù†Ø§Ù…ÙˆÙÙ‚
            testEl.className = 'test-item failed';
            statusEl.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
            statusEl.className = 'test-status status-failed';
            outputEl.innerHTML = `<div style="color:#c62828">âŒ ${error.message}</div>`;
            
            PerfDB.log(`ØªØ³Øª "${test.name}" Ù†Ø§Ù…ÙˆÙÙ‚: ${error.message}`, 'error');
        }
        
        // ØªØ§Ø®ÛŒØ± Ú©ÙˆØªØ§Ù‡ Ø¨ÛŒÙ† ØªØ³Øªâ€ŒÙ‡Ø§
        await new Promise(resolve => setTimeout(resolve, 300));
    }
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù‡Ø§ÛŒÛŒ progress bar
    document.getElementById('global-progress').style.width = '100%';
    
    const totalTime = Date.now() - startTime;
    const successRate = Math.round((passed / performanceTests.length) * 100);
    
    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ
    PerfDB.updateStats({
        totalTime: Math.round(totalTime),
        opsPerSecond: Math.round((passed / (totalTime / 1000)) * 10) / 10
    });
    
    document.getElementById('stat-success').textContent = `${successRate}%`;
    document.getElementById('progress-text').textContent = `ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯: ${passed}/${performanceTests.length} Ù…ÙˆÙÙ‚`;
    
    runBtn.disabled = false;
    lightBtn.disabled = false;
    runBtn.textContent = `ğŸ”„ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ø¯Ø¯ (${successRate}% Ù…ÙˆÙÙ‚)`;
    lightBtn.textContent = 'ğŸ”† Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø³Ø¨Ú©';
    
    // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
    PerfDB.log(`ğŸ¯ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Performance Ú©Ø§Ù…Ù„ Ø´Ø¯Ù†Ø¯!`);
    PerfDB.log(`â±ï¸ Ø²Ù…Ø§Ù† Ú©Ù„: ${Math.round(totalTime)}ms`);
    PerfDB.log(`ğŸ“Š Ù…ÙˆÙÙ‚ÛŒØª: ${passed} Ø§Ø² ${performanceTests.length} ØªØ³Øª`);
    PerfDB.log(`ğŸš€ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø³Ø±Ø¹Øª: ${Math.round((passed / (totalTime / 1000)) * 10) / 10} ØªØ³Øª/Ø«Ø§Ù†ÛŒÙ‡`);
    
    if (passed === performanceTests.length) {
        PerfDB.log("âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Performance Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø´Øª Ø³Ø± Ú¯Ø°Ø§Ø´ØªÙ‡ Ø´Ø¯Ù†Ø¯!");
    }
}

// ========== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ==========
document.addEventListener('DOMContentLoaded', () => {
    // Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
    document.getElementById('run-btn').addEventListener('click', () => runPerformanceTests(false));
    document.getElementById('run-light-btn').addEventListener('click', () => runPerformanceTests(true));
    
    document.getElementById('reset-btn').addEventListener('click', () => {
        PerfDB.clear();
        // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§
        for (let i = 1; i <= 5; i++) {
            const testEl = document.getElementById(`test${i}`);
            const statusEl = document.getElementById(`status${i}`);
            const outputEl = document.getElementById(`output${i}`);
            
            testEl.className = 'test-item';
            testEl.style.opacity = '1';
            statusEl.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
            statusEl.className = 'test-status status-pending';
            outputEl.innerHTML = '';
        }
        document.getElementById('run-btn').textContent = 'â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Performance';
        document.getElementById('stat-success').textContent = '0%';
    });
    
    PerfDB.log("ğŸš€ Ø³ÛŒØ³ØªÙ… ØªØ³Øª Performance Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.");
    PerfDB.log("Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ú©Ø§Ù…Ù„ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø§ÙˆÙ„ØŒ Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø³Ø±ÛŒØ¹ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø¯ÙˆÙ… Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.");
});
</script>
</body>
</html>
