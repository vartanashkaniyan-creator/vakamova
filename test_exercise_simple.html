<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª Exercise Manager - Vakamova</title>
    <style>
        body { font-family: Tahoma; max-width: 800px; margin: 20px auto; padding: 20px; }
        .success { color: #2ecc71; padding: 10px; background: #ecf9f4; border-right: 4px solid #2ecc71; }
        .error { color: #e74c3c; padding: 10px; background: #fdf0ed; border-right: 4px solid #e74c3c; }
        .test-box { margin: 15px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª Exercise Manager</h1>
    <p>Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯:</p>
    <button onclick="runAllTests()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§</button>
    <div id="results"></div>

    <script>
        // ğŸ”¹ ØªØ¹Ø±ÛŒÙ Ø§ÛŒÙ†ØªØ±ÙÛŒØ³ (Ù‡Ù…Ø§Ù† exercise_manager_interface.js)
        class ExerciseManagerInterface {
            async createExercise(type, config) { throw new Error('Method not implemented'); }
            async evaluateAnswer(exerciseId, userAnswer) { throw new Error('Method not implemented'); }
            async getExerciseTips(exerciseId) { throw new Error('Method not implemented'); }
            calculateScore(exerciseId, evaluation) { throw new Error('Method not implemented'); }
        }

        // ğŸ”¹ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø§ØµÙ„ÛŒ (Ù‡Ù…Ø§Ù† exercise_manager.js)
        class ExerciseManager extends ExerciseManagerInterface {
            constructor(dependencies) {
                super();
                this.exerciseRepository = dependencies.exerciseRepository;
                this.evaluationService = dependencies.evaluationService;
                this.scoringStrategy = dependencies.scoringStrategy;
                this.logger = dependencies.logger || console;
                this.exerciseTypes = new Map();
                this.registerDefaultTypes();
            }

            registerExerciseType(type, handler) {
                if (this.exerciseTypes.has(type)) throw new Error(`Ù†ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† '${type}' Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡`);
                this.exerciseTypes.set(type, handler);
            }

            registerDefaultTypes() {
                this.registerExerciseType('multipleChoice', this.createMultipleChoice.bind(this));
                this.registerExerciseType('fillBlank', this.createFillBlank.bind(this));
                this.registerExerciseType('matching', this.createMatching.bind(this));
            }

            async createExercise(type, config) {
                if (!this.exerciseTypes.has(type)) throw new Error(`Ù†ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡: ${type}`);
                const handler = this.exerciseTypes.get(type);
                const exercise = await handler(config);
                const savedExercise = await this.exerciseRepository.save(exercise);
                this.logger.info(`ØªÙ…Ø±ÛŒÙ† Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯: ${savedExercise.id}`);
                return savedExercise;
            }

            async evaluateAnswer(exerciseId, userAnswer) {
                const exercise = await this.exerciseRepository.findById(exerciseId);
                if (!exercise) throw new Error(`ØªÙ…Ø±ÛŒÙ† Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯: ${exerciseId}`);
                const evaluation = await this.evaluationService.evaluate(exercise, userAnswer);
                evaluation.score = this.scoringStrategy.calculate(exercise, evaluation);
                await this.exerciseRepository.saveEvaluation(exerciseId, userAnswer, evaluation);
                return evaluation;
            }

            async getExerciseTips(exerciseId) {
                const exercise = await this.exerciseRepository.findById(exerciseId);
                if (!exercise) throw new Error(`ØªÙ…Ø±ÛŒÙ† Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯: ${exerciseId}`);
                return ['Ù†Ú©ØªÙ‡ Ø§ÙˆÙ„: Ø¯Ù‚Øª Ú©Ù†ÛŒØ¯', 'Ù†Ú©ØªÙ‡ Ø¯ÙˆÙ…: Ø²Ù…Ø§Ù† Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†ÛŒØ¯'];
            }

            calculateScore(exerciseId, evaluation) {
                return this.scoringStrategy.calculate(exerciseId, evaluation);
            }

            // Ù‡Ù†Ø¯Ù„Ø±Ù‡Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ ØªÙ…Ø±ÛŒÙ†
            async createMultipleChoice(config) {
                return {
                    type: 'multipleChoice',
                    id: 'ex_' + Date.now(),
                    question: config.question,
                    options: config.options || [],
                    correctAnswer: config.correctAnswer,
                    difficulty: config.difficulty,
                    lessonId: config.lessonId,
                    createdAt: new Date().toISOString()
                };
            }

            async createFillBlank(config) {
                return { type: 'fillBlank', id: 'ex_' + Date.now(), sentence: config.sentence };
            }

            async createMatching(config) {
                return { type: 'matching', id: 'ex_' + Date.now(), leftItems: config.leftItems || [] };
            }
        }

        // ğŸ”¹ Mock ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§
        const mockDependencies = {
            exerciseRepository: {
                save: async (exercise) => ({ ...exercise, id: 'test_' + Date.now() }),
                findById: async (id) => ({ id, type: 'multipleChoice', lessonId: 'lesson_1' }),
                saveEvaluation: async () => {}
            },
            evaluationService: {
                evaluate: async () => ({ isCorrect: true, feedback: 'Ø¹Ø§Ù„ÛŒ Ø¨ÙˆØ¯!' })
            },
            scoringStrategy: {
                calculate: () => 100
            },
            logger: {
                info: (msg) => console.log('ğŸ“', msg),
                error: (msg) => console.error('âŒ', msg)
            }
        };

        // ğŸ”¹ ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§
        async function runAllTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            
            try {
                // ØªØ³Øª 1: Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡
                const manager = new ExerciseManager(mockDependencies);
                addTestResult('âœ… Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²');

                // ØªØ³Øª 2: Ø§ÛŒØ¬Ø§Ø¯ ØªÙ…Ø±ÛŒÙ†
                const config = {
                    lessonId: 'lesson_1',
                    difficulty: 'easy',
                    question: 'Ù…Ø¹Ù†ÛŒ "Ú©ØªØ§Ø¨" Ú†ÛŒØ³ØªØŸ',
                    options: ['Book', 'Pen', 'Desk'],
                    correctAnswer: 'Book'
                };
                const exercise = await manager.createExercise('multipleChoice', config);
                addTestResult(`âœ… ØªÙ…Ø±ÛŒÙ† Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯: ${exercise.id} (Ù†ÙˆØ¹: ${exercise.type})`);

                // ØªØ³Øª 3: Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø§Ø³Ø®
                const evaluation = await manager.evaluateAnswer(exercise.id, 'Book');
                addTestResult(`âœ… Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯: ${evaluation.isCorrect ? 'ØµØ­ÛŒØ­' : 'ØºÙ„Ø·'} - Ø§Ù…ØªÛŒØ§Ø²: ${evaluation.score}`);

                // ØªØ³Øª 4: Ø¯Ø±ÛŒØ§ÙØª Ù†Ú©Ø§Øª
                const tips = await manager.getExerciseTips(exercise.id);
                addTestResult(`âœ… Ø¯Ø±ÛŒØ§ÙØª Ù†Ú©Ø§Øª: ${tips.length} Ù†Ú©ØªÙ‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ`);

                // ØªØ³Øª 5: Ø«Ø¨Øª Ù†ÙˆØ¹ Ø¬Ø¯ÛŒØ¯
                manager.registerExerciseType('customType', () => ({ type: 'custom' }));
                addTestResult('âœ… Ø«Ø¨Øª Ù†ÙˆØ¹ ØªÙ…Ø±ÛŒÙ† Ø¬Ø¯ÛŒØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²');

                addTestResult('ğŸ‰ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø´ØªÙ†Ø¯!', 'success');

            } catch (error) {
                addTestResult(`âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª: ${error.message}`, 'error');
            }
        }

        // ğŸ”¹ ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡
        function addTestResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = type === 'success' ? 'success' : 'error';
            div.textContent = message;
            document.getElementById('results').appendChild(div);
        }
    </script>
</body>
</html>
