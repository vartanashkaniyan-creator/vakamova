<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vakamova - Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù† Û±Û² Ø²Ø¨Ø§Ù†Ù‡</title>
    <style>
        body { 
            background: #0d0d1a; 
            color: white; 
            font-family: Tahoma; 
            margin: 0; 
            padding: 20px; 
            direction: rtl; 
        }
        #app { min-height: 100vh; }
        .loading { 
            text-align: center; 
            padding: 100px; 
            color: #00b0ff; 
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="loading">
            <h1>ğŸš€ Vakamova</h1>
            <p>Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³ÛŒØ³ØªÙ…...</p>
        </div>
    </div>

    <script type="module">
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ
        const CONFIG = {
            corePath: './core',
            pagesPath: './pages',
            modulesPath: './modules'
        };

        // Ø³ÛŒØ³ØªÙ… Ø³Ø§Ø¯Ù‡ Ø±ÙˆÛŒØ¯Ø§Ø¯
        class EventBus {
            constructor() { this.events = {}; }
            on(e, fn) { this.events[e] = this.events[e] || []; this.events[e].push(fn); }
            emit(e, data) { if(this.events[e]) this.events[e].forEach(fn => fn(data)); }
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø² Ø§ØµÙ„ÛŒ
        class App {
            constructor() {
                this.eventBus = new EventBus();
                this.state = { user: null, page: 'home' };
            }
            
            async init() {
                console.log('Ø´Ø±ÙˆØ¹ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Vakamova...');
                
                try {
                    // 1. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„ Ø§ØµÙ„ÛŒ
                    await this.loadCoreModules();
                    
                    // 2. Ù†Ù…Ø§ÛŒØ´ ØµÙØ­Ù‡ Ø§ÙˆÙ„
                    await this.showHomePage();
                    
                    console.log('âœ… Vakamova Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯');
                    this.eventBus.emit('app:ready', { time: Date.now() });
                    
                } catch(error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ:', error);
                    this.showError();
                }
            }
            
            async loadCoreModules() {
                // ÙÙ‚Ø· Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´ÙˆÙ†Ø¯
                const modules = ['event_bus', 'state_manager', 'router'];
                
                for(const mod of modules) {
                    try {
                        await import(`${CONFIG.corePath}/${mod}.js`);
                        console.log(`âœ… ${mod} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`);
                    } catch(e) {
                        console.warn(`âš ï¸ ${mod} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯:`, e.message);
                    }
                }
            }
            
            async showHomePage() {
                try {
                    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                    const module = await import(`${CONFIG.pagesPath}/home/home_page.js`);
                    const Page = module.default || module;
                    const page = new Page();
                    
                    // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± #app
                    const appEl = document.getElementById('app');
                    if(appEl && page.render) {
                        appEl.innerHTML = '';
                        appEl.appendChild(page.render());
                    }
                } catch(e) {
                    // ØµÙØ­Ù‡ Ø³Ø§Ø¯Ù‡ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†
                    document.getElementById('app').innerHTML = `
                        <div style="text-align:center; padding:50px;">
                            <h1>ğŸŒ Vakamova</h1>
                            <p>Ø³ÛŒØ³ØªÙ… Ø¢Ù…ÙˆØ²Ø´ Û±Û² Ø²Ø¨Ø§Ù†</p>
                            <p style="color:#888;">ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ø¯Ø± Ø­Ø§Ù„ ØªÙˆØ³Ø¹Ù‡ Ø§Ø³Øª</p>
                        </div>
                    `;
                }
            }
            
            showError() {
                document.getElementById('app').innerHTML = `
                    <div style="color:#ff5252; text-align:center; padding:50px;">
                        <h2>âš ï¸ Ø®Ø·Ø§ÛŒ Ø³ÛŒØ³ØªÙ…</h2>
                        <p>Ù„Ø·ÙØ§Ù‹ ØµÙØ­Ù‡ Ø±Ø§ Ø±ÙØ±Ø´ Ú©Ù†ÛŒØ¯</p>
                        <button onclick="window.location.reload()">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
                    </div>
                `;
            }
        }

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        document.addEventListener('DOMContentLoaded', () => {
            const app = new App();
            app.init();
            
            // Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø² Ú©Ù†Ø³ÙˆÙ„
            window.VakamovaApp = app;
        });
    </script>
</body>
</html>
