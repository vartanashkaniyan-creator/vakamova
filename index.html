
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperLang</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Ù†Ù‚Ø·Ù‡ Ø§ØµÙ„ÛŒ Ø±Ù†Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ -->
    <div id="root"></div>

    <script type="module">
        // Ù‡Ø³ØªÙ‡ Ø§ØµÙ„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ - Ø³Ø§Ø²Ù…Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
        const HyperLang = (() => {
            const modules = {};
            const core = {};

            // 1. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ CORE (Ø§ÙˆÙ„ÙˆÛŒØª Ø§ÙˆÙ„)
            const loadCore = async () => {
                console.log('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù‡Ø³ØªÙ‡...');
                try {
                    // Ø§ÛŒÙ† ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ø§ÛŒØ¯ Ø§ÙˆÙ„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´ÙˆÙ†Ø¯
                    const coreFiles = ['CORE_state.js', 'CORE_db.js', 'CORE_router.js'];
                    for (const file of coreFiles) {
                        const module = await import(`./${file}`);
                        const name = file.replace('.js', '').replace('CORE_', '');
                        core[name] = module.default || module;
                        console.log(`âœ… Ù‡Ø³ØªÙ‡ ${name} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`);
                    }
                } catch (e) {
                    console.warn('âš ï¸ Ø¨Ø±Ø®ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ CORE Ù‡Ù†ÙˆØ² Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯. Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...');
                }
                return core;
            };

            // 2. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ (Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø³ØªÙ‡)
            const loadModules = async () => {
                console.log('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§...');
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø­ÛŒØ§ØªÛŒ (Ù…Ø«Ù„Ø§Ù‹ Auth)
                const moduleFiles = ['MODULES_auth.js'];
                for (const file of moduleFiles) {
                    try {
                        const module = await import(`./${file}`);
                        const name = file.replace('.js', '').replace('MODULES_', '');
                        modules[name] = module.default || module;
                        if (modules[name] && typeof modules[name].init === 'function') {
                            modules[name].init(core); // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¨Ø§ Ù‡Ø³ØªÙ‡
                        }
                        console.log(`âœ… Ù…Ø§Ú˜ÙˆÙ„ ${name} Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯`);
                    } catch (e) {
                        console.warn(`â¸ï¸ Ù…Ø§Ú˜ÙˆÙ„ ${file} Ù‡Ù†ÙˆØ² Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª`);
                    }
                }
                return modules;
            };

            // 3. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ UI (Ø¢Ø®Ø±ÛŒÙ† Ù…Ø±Ø­Ù„Ù‡)
            const loadUI = async () => {
                console.log('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ...');
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
                try {
                    const PageHome = await import('./page_home.js');
                    const app = PageHome.default || PageHome;
                    if (typeof app.render === 'function') {
                        document.getElementById('root').innerHTML = app.render();
                        console.log('âœ… Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                    }
                } catch (e) {
                    console.warn('â¸ï¸ ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ù‡Ù†ÙˆØ² Ø¢Ù…Ø§Ø¯Ù‡ Ù†ÛŒØ³Øª');
                    document.getElementById('root').innerHTML = '<p>Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ...</p>';
                }
            };

            // 4. ØªØ§Ø¨Ø¹ Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
            const start = async () => {
                console.log('ğŸš€ Ø´Ø±ÙˆØ¹ HyperLang...');
                await loadCore();
                await loadModules();
                await loadUI();
                console.log('ğŸ‰ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!');
            };

            // API Ø¹Ù…ÙˆÙ…ÛŒ
            return { start, modules, core };
        })();

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        HyperLang.start();
    </script>
</body>
</html>
