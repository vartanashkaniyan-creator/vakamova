<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Lesson + Progress + Database - Vakamova</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 30px;
        }
        
        .test-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(79, 70, 229, 0.15);
        }
        
        .test-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-desc {
            color: #6b7280;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .test-output {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            direction: ltr;
        }
        
        button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            border-top: 2px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span>ğŸ“š ØªØ³Øª ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Lesson + Progress + Database</span>
            </h1>
            <p>Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù…ÙˆØªÙˆØ± Ø¯Ø±Ø³ØŒ Ø±Ø¯ÛŒØ§Ø¨ Ù¾ÛŒØ´Ø±ÙØª Ùˆ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡</p>
        </header>
        
        <div class="test-grid" id="test-grid">
            <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div class="action-bar">
            <button onclick="runAllTests()" id="run-btn">
                <span>â–¶ï¸</span>
                Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
        </div>
    </div>

    <script>
        // Mock Database
        class MockDatabase {
            constructor() {
                this.lessons = new Map();
                this.userProgress = new Map();
                this.userStats = new Map();
            }
            
            async saveLesson(lesson) {
                this.lessons.set(lesson.id, lesson);
                return lesson.id;
            }
            
            async getUserProgress(userId) {
                return this.userProgress.get(userId) || [];
            }
            
            async updateUserProgress(userId, progress) {
                this.userProgress.set(userId, progress);
                return true;
            }
            
            async getUserStats(userId) {
                return this.userStats.get(userId) || {
                    totalLessons: 0,
                    completedLessons: 0,
                    totalTime: 0,
                    streak: 0
                };
            }
            
            async updateUserStats(userId, stats) {
                this.userStats.set(userId, stats);
                return true;
            }
        }

        // Lesson Engine
        class LessonEngine {
            constructor(database) {
                this.db = database;
            }
            
            async createLesson(lessonData) {
                const lesson = {
                    id: `lesson_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    title: lessonData.title,
                    language: lessonData.language,
                    level: lessonData.level,
                    content: lessonData.content,
                    exercises: lessonData.exercises || [],
                    duration: lessonData.duration || 30,
                    createdAt: Date.now()
                };
                
                await this.db.saveLesson(lesson);
                return lesson;
            }
            
            async getLesson(lessonId) {
                return this.db.lessons.get(lessonId);
            }
        }

        // Progress Tracker
        class ProgressTracker {
            constructor(database) {
                this.db = database;
            }
            
            async startLesson(userId, lessonId) {
                const progress = await this.db.getUserProgress(userId);
                progress.push({
                    lessonId,
                    startTime: Date.now(),
                    status: 'in_progress'
                });
                
                await this.db.updateUserProgress(userId, progress);
                return true;
            }
            
            async completeLesson(userId, lessonId, score) {
                const progress = await this.db.getUserProgress(userId);
                const lessonProgress = progress.find(p => p.lessonId === lessonId);
                
                if (lessonProgress) {
                    lessonProgress.endTime = Date.now();
                    lessonProgress.status = 'completed';
                    lessonProgress.score = score;
                    lessonProgress.duration = lessonProgress.endTime - lessonProgress.startTime;
                    
                    // Update stats
                    const stats = await this.db.getUserStats(userId);
                    stats.totalLessons += 1;
                    stats.completedLessons += 1;
                    stats.totalTime += lessonProgress.duration;
                    
                    // Calculate streak
                    const today = new Date().toDateString();
                    if (stats.lastCompletedDate !== today) {
                        stats.streak += 1;
                        stats.lastCompletedDate = today;
                    }
                    
                    await this.db.updateUserStats(userId, stats);
                    await this.db.updateUserProgress(userId, progress);
                    
                    return {
                        success: true,
                        score,
                        duration: lessonProgress.duration,
                        streak: stats.streak
                    };
                }
                
                return { success: false };
            }
            
            async getUserProgress(userId) {
                return await this.db.getUserProgress(userId);
            }
            
            async getUserStats(userId) {
                return await this.db.getUserStats(userId);
            }
        }

        // Test Manager
        const tests = [
            {
                id: 'test-1',
                title: 'Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø³ + Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ ØµØ­ÛŒØ­ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³',
                run: async () => {
                    const db = new MockDatabase();
                    const lessonEngine = new LessonEngine(db);
                    
                    const lessonData = {
                        title: 'Ø¯Ø±Ø³ Ø§ÙˆÙ„ - Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ',
                        language: 'english',
                        level: 'beginner',
                        content: { type: 'dialogue', text: 'Hello, how are you?' },
                        exercises: [
                            { id: 'ex1', type: 'multiple_choice', question: 'Ù…Ø¹Ù†ÛŒ HelloØŸ', options: ['Ø³Ù„Ø§Ù…', 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸'], correct: 0 }
                        ],
                        duration: 25
                    };
                    
                    const lesson = await lessonEngine.createLesson(lessonData);
                    
                    if (!lesson.id) throw new Error('Ø¯Ø±Ø³ Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯');
                    if (lesson.title !== lessonData.title) throw new Error('Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                    if (!db.lessons.has(lesson.id)) throw new Error('Ø¯Ø±Ø³ Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ù†Ø´Ø¯');
                    
                    return `âœ… Ø¯Ø±Ø³ "${lesson.title}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ (Ø´Ù†Ø§Ø³Ù‡: ${lesson.id})`;
                }
            },
            {
                id: 'test-2',
                title: 'Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ + Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ù¾ÛŒØ´Ø±ÙØª',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ Ùˆ Ø«Ø¨Øª Ù¾ÛŒØ´Ø±ÙØª Ú©Ø§Ø±Ø¨Ø±',
                run: async () => {
                    const db = new MockDatabase();
                    const lessonEngine = new LessonEngine(db);
                    const progressTracker = new ProgressTracker(db);
                    
                    const userId = 'user_test_001';
                    
                    // Create lesson
                    const lesson = await lessonEngine.createLesson({
                        title: 'Ø¯Ø±Ø³ ØªØ³Øª Ù¾ÛŒØ´Ø±ÙØª',
                        language: 'english',
                        level: 'beginner',
                        content: { type: 'vocabulary', words: ['apple', 'banana'] }
                    });
                    
                    // Start lesson
                    const startResult = await progressTracker.startLesson(userId, lesson.id);
                    
                    if (!startResult) throw new Error('Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯');
                    
                    const progress = await progressTracker.getUserProgress(userId);
                    const lessonProgress = progress.find(p => p.lessonId === lesson.id);
                    
                    if (!lessonProgress) throw new Error('Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø±Ø³ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯');
                    if (lessonProgress.status !== 'in_progress') throw new Error('ÙˆØ¶Ø¹ÛŒØª Ø¯Ø±Ø³ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                    
                    return `âœ… Ø¯Ø±Ø³ "${lesson.title}" Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø´Ø±ÙˆØ¹ Ø´Ø¯. ÙˆØ¶Ø¹ÛŒØª: ${lessonProgress.status}`;
                }
            },
            {
                id: 'test-3',
                title: 'Ø§ØªÙ…Ø§Ù… Ø¯Ø±Ø³ + Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø²',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªÙ…Ø§Ù… Ø¯Ø±Ø³ØŒ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø±',
                run: async () => {
                    const db = new MockDatabase();
                    const lessonEngine = new LessonEngine(db);
                    const progressTracker = new ProgressTracker(db);
                    
                    const userId = 'user_test_002';
                    
                    // Create and start lesson
                    const lesson = await lessonEngine.createLesson({
                        title: 'Ø¯Ø±Ø³ ØªÚ©Ù…ÛŒÙ„',
                        language: 'persian',
                        level: 'intermediate'
                    });
                    
                    await progressTracker.startLesson(userId, lesson.id);
                    
                    // Wait a bit to simulate lesson duration
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    // Complete lesson
                    const completionResult = await progressTracker.completeLesson(userId, lesson.id, 85);
                    
                    if (!completionResult.success) throw new Error('Ø§ØªÙ…Ø§Ù… Ø¯Ø±Ø³ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
                    if (completionResult.score !== 85) throw new Error('Ø§Ù…ØªÛŒØ§Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                    if (!completionResult.duration) throw new Error('Ø²Ù…Ø§Ù† ØªÚ©Ù…ÛŒÙ„ Ø«Ø¨Øª Ù†Ø´Ø¯');
                    
                    // Check stats
                    const stats = await progressTracker.getUserStats(userId);
                    
                    if (stats.completedLessons !== 1) throw new Error('ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                    if (stats.totalTime <= 0) throw new Error('Ø²Ù…Ø§Ù† Ú©Ù„ Ø«Ø¨Øª Ù†Ø´Ø¯');
                    if (stats.streak !== 1) throw new Error('Ø§Ø³ØªØ±Ú© Ø«Ø¨Øª Ù†Ø´Ø¯');
                    
                    return `âœ… Ø¯Ø±Ø³ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯. Ø§Ù…ØªÛŒØ§Ø²: ${completionResult.score}ØŒ Ù…Ø¯Øª: ${Math.round(completionResult.duration/1000)}Ø«Ø§Ù†ÛŒÙ‡ØŒ Ø§Ø³ØªØ±Ú©: ${stats.streak}`;
                }
            },
            {
                id: 'test-4',
                title: 'Ù¾ÛŒØ´Ø±ÙØª Ú†Ù†Ø¯ Ø¯Ø±Ø³ + Ø¢Ù…Ø§Ø± ØªØ¬Ù…Ø¹ÛŒ',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø¯Ø± Ú†Ù†Ø¯ Ø¯Ø±Ø³ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ Ú©Ø§Ø±Ø¨Ø±',
                run: async () => {
                    const db = new MockDatabase();
                    const lessonEngine = new LessonEngine(db);
                    const progressTracker = new ProgressTracker(db);
                    
                    const userId = 'user_test_003';
                    
                    // Create multiple lessons
                    const lessons = [];
                    for (let i = 1; i <= 3; i++) {
                        const lesson = await lessonEngine.createLesson({
                            title: `Ø¯Ø±Ø³ ${i} - ÙˆØ§Ú˜Ú¯Ø§Ù†`,
                            language: 'english',
                            level: 'beginner',
                            duration: 20
                        });
                        lessons.push(lesson);
                    }
                    
                    // Complete all lessons
                    for (const lesson of lessons) {
                        await progressTracker.startLesson(userId, lesson.id);
                        await new Promise(resolve => setTimeout(resolve, 50));
                        await progressTracker.completeLesson(userId, lesson.id, 70 + Math.random() * 30);
                    }
                    
                    // Check final stats
                    const stats = await progressTracker.getUserStats(userId);
                    const progress = await progressTracker.getUserProgress(userId);
                    
                    if (stats.completedLessons !== 3) throw new Error(`ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡ ${stats.completedLessons} Ø§Ø³Øª (Ø§Ù†ØªØ¸Ø§Ø±: 3)`);
                    if (progress.length !== 3) throw new Error(`ØªØ¹Ø¯Ø§Ø¯ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØª ${progress.length} Ø§Ø³Øª (Ø§Ù†ØªØ¸Ø§Ø±: 3)`);
                    
                    // Verify all lessons are completed
                    const incomplete = progress.filter(p => p.status !== 'completed');
                    if (incomplete.length > 0) throw new Error(`${incomplete.length} Ø¯Ø±Ø³ ØªÚ©Ù…ÛŒÙ„ Ù†Ø´Ø¯Ù‡`);
                    
                    return `âœ… ${stats.completedLessons} Ø¯Ø±Ø³ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯. Ø²Ù…Ø§Ù† Ú©Ù„: ${Math.round(stats.totalTime/1000)} Ø«Ø§Ù†ÛŒÙ‡ØŒ Ø§Ø³ØªØ±Ú©: ${stats.streak}`;
                }
            },
            {
                id: 'test-5',
                title: 'Ù‡Ù…Ø²Ù…Ø§Ù†ÛŒ Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø± + Ø§ÛŒØ²ÙˆÙ„Ù‡ Ø¨ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†ÛŒ Ùˆ Ø¹Ø¯Ù… ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…Ø®ØªÙ„Ù',
                run: async () => {
                    const db = new MockDatabase();
                    const lessonEngine = new LessonEngine(db);
                    const progressTracker = new ProgressTracker(db);
                    
                    const users = ['user_a', 'user_b', 'user_c'];
                    const lessonPromises = [];
                    
                    // Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± ÛŒÚ© Ø¯Ø±Ø³ Ø§ÛŒØ¬Ø§Ø¯ Ùˆ ØªÚ©Ù…ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
                    for (const userId of users) {
                        const promise = (async () => {
                            const lesson = await lessonEngine.createLesson({
                                title: `Ø¯Ø±Ø³ Ø®ØµÙˆØµÛŒ ${userId}`,
                                language: userId === 'user_a' ? 'english' : 'persian',
                                level: 'advanced'
                            });
                            
                            await progressTracker.startLesson(userId, lesson.id);
                            await new Promise(resolve => setTimeout(resolve, Math.random() * 100));
                            await progressTracker.completeLesson(userId, lesson.id, 90);
                            
                            return { userId, lessonId: lesson.id };
                        })();
                        
                        lessonPromises.push(promise);
                    }
                    
                    const results = await Promise.all(lessonPromises);
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ²ÙˆÙ„Ù‡ Ø¨ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    for (const user of users) {
                        const stats = await progressTracker.getUserStats(user);
                        const progress = await progressTracker.getUserProgress(user);
                        
                        if (stats.completedLessons !== 1) throw new Error(`Ú©Ø§Ø±Ø¨Ø± ${user} Ø¨Ø§ÛŒØ¯ 1 Ø¯Ø±Ø³ ØªÚ©Ù…ÛŒÙ„â€ŒØ´Ø¯Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯`);
                        
                        // Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¯Ù… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯ÛŒÚ¯Ø±
                        for (const otherUser of users) {
                            if (otherUser !== user) {
                                const otherProgress = await progressTracker.getUserProgress(otherUser);
                                const hasAccess = otherProgress.some(p => p.userId === user);
                                if (hasAccess) throw new Error(`Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± ${user} Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ú©Ø§Ø±Ø¨Ø± ${otherUser} Ø§Ø³Øª`);
                            }
                        }
                    }
                    
                    return `âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ${users.length} Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ØµÙˆØ±Øª Ø§ÛŒØ²ÙˆÙ„Ù‡ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯. ØªØ¯Ø§Ø®Ù„ Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø±Ø® Ù†Ø¯Ø§Ø¯.`;
                }
            }
        ];

        // Test Runner
        function renderTests() {
            const testGrid = document.getElementById('test-grid');
            testGrid.innerHTML = '';
            
            tests.forEach(test => {
                const card = document.createElement('div');
                card.className = 'test-card';
                card.id = `card-${test.id}`;
                card.innerHTML = `
                    <div class="test-title">
                        <span>${test.title}</span>
                        <span class="test-result" id="result-${test.id}">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                    </div>
                    <div class="test-desc">${test.description}</div>
                    <div class="test-output" id="output-${test.id}"></div>
                `;
                testGrid.appendChild(card);
            });
        }
        
        async function runTest(test) {
            const card = document.getElementById(`card-${test.id}`);
            const output = document.getElementById(`output-${test.id}`);
            const resultSpan = card.querySelector('.test-result');
            
            card.style.borderLeft = '5px solid #f59e0b';
            resultSpan.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
            output.innerHTML = 'ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª...';
            
            try {
                const result = await test.run();
                card.style.borderLeft = '5px solid #10b981';
                resultSpan.textContent = 'Ù…ÙˆÙÙ‚';
                output.innerHTML = `<span style="color: #065f46">âœ… ${result}</span>`;
                return { success: true, result };
            } catch (error) {
                card.style.borderLeft = '5px solid #ef4444';
                resultSpan.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                output.innerHTML = `<span style="color: #991b1b">âŒ Ø®Ø·Ø§: ${error.message}</span>`;
                return { success: false, error: error.message };
            }
        }
        
        async function runAllTests() {
            const runBtn = document.getElementById('run-btn');
            runBtn.disabled = true;
            runBtn.innerHTML = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...';
            
            let passed = 0;
            let failed = 0;
            
            for (const test of tests) {
                const result = await runTest(test);
                if (result.success) passed++;
                else failed++;
                
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            runBtn.disabled = false;
            runBtn.innerHTML = 'ğŸ”„ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ø¯Ø¯ ØªØ³Øªâ€ŒÙ‡Ø§';
            
            // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ú©Ù„ÛŒ
            const summary = document.createElement('div');
            summary.style.cssText = `
                background: ${failed === 0 ? '#d1fae5' : '#fef3c7'};
                border: 2px solid ${failed === 0 ? '#10b981' : '#f59e0b'};
                border-radius: 10px;
                padding: 20px;
                margin: 20px 30px;
                text-align: center;
                font-weight: bold;
                font-size: 1.1rem;
            `;
            summary.innerHTML = `
                ğŸ¯ Ù†ØªÛŒØ¬Ù‡ Ú©Ù„ÛŒ: ${passed} ØªØ³Øª Ù…ÙˆÙÙ‚ØŒ ${failed} ØªØ³Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø§Ø² ${tests.length} ØªØ³Øª
                <br>
                ${failed === 0 ? 'âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯Ù†Ø¯!' : 'âš ï¸ Ø¨Ø±Ø®ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ Ø¯Ø§Ø±Ù†Ø¯.'}
            `;
            
            document.querySelector('.test-grid').appendChild(summary);
            
            console.log(`ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Lesson+Progress+Database Ú©Ø§Ù…Ù„ Ø´Ø¯: ${passed} Ù…ÙˆÙÙ‚ØŒ ${failed} Ù†Ø§Ù…ÙˆÙÙ‚`);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderTests();
            console.log('ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡â€ŒØ³Ø§Ø²ÛŒ Lesson + Progress + Database Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§');
        });
    </script>
</body>
</html>
