<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª EventBus - Vakamova</title>
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø³Ø§Ø¯Ù‡ Ùˆ Ø´ÙØ§Ù */
        body {
            font-family: Tahoma, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f2f5;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #3498db;
        }
        
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .status.loading {
            background: #e3f2fd;
            color: #1565c0;
            border: 2px solid #2196f3;
        }
        
        .status.ready {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }
        
        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }
        
        .test-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 600px) {
            .test-buttons {
                grid-template-columns: 1fr;
            }
        }
        
        .test-btn {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .test-btn.primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .test-btn.success {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .test-btn.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .test-btn.danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.8;
            min-height: 300px;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-item {
            padding: 8px 0;
            border-bottom: 1px solid #34495e;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
        .info { color: #3498db; }
        .warning { color: #f1c40f; }
        
        .results {
            display: flex;
            justify-content: space-around;
            margin-top: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .result-box {
            text-align: center;
        }
        
        .result-value {
            font-size: 32px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .passed .result-value { color: #27ae60; }
        .failed .result-value { color: #e74c3c; }
        .total .result-value { color: #3498db; }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 14px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
        }
        
        .clear-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
        }
        
        .clear-btn:hover {
            background: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ØªØ³Øª EventBus Ù¾Ø±ÙˆÚ˜Ù‡ Vakamova</h1>
        
        <div class="status loading" id="status">
            ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ EventBus...
        </div>
        
        <div class="test-buttons">
            <button class="test-btn primary" onclick="runTest('basic')">
                <span>ğŸ¯</span> ØªØ³Øª Ù¾Ø§ÛŒÙ‡
            </button>
            <button class="test-btn success" onclick="runTest('multiple')">
                <span>ğŸ‘‚</span> ØªØ³Øª Ú†Ù†Ø¯ Listener
            </button>
            <button class="test-btn warning" onclick="runTest('once')">
                <span>1ï¸âƒ£</span> ØªØ³Øª Once
            </button>
            <button class="test-btn danger" onclick="runTest('scenario')">
                <span>ğŸš€</span> Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
            </button>
        </div>
        
        <button class="clear-btn" onclick="clearOutput()">
            ğŸ—‘ï¸ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†ØªØ§ÛŒØ¬
        </button>
        
        <div class="output" id="output">
            <!-- Ù†ØªØ§ÛŒØ¬ ØªØ³Øª Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>
        
        <div class="results" id="results" style="display: none;">
            <div class="result-box passed">
                <div>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚</div>
                <div class="result-value" id="passedCount">0</div>
                <div>passed</div>
            </div>
            <div class="result-box failed">
                <div>ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù‡</div>
                <div class="result-value" id="failedCount">0</div>
                <div>failed</div>
            </div>
            <div class="result-box total">
                <div>Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§</div>
                <div class="result-value" id="totalCount">0</div>
                <div>total</div>
            </div>
        </div>
        
        <footer>
            <p>Ù¾Ø±ÙˆÚ˜Ù‡ Vakamova - Ø§Ù¾ Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù† Û±Û² Ø²Ø¨Ø§Ù†Ù‡</p>
            <p>Ø³ÛŒØ³ØªÙ… EventBus Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ø§ØµÙˆÙ„ SOLID</p>
        </footer>
    </div>

    <!-- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ SimpleEventBus -->
    <script src="simple_eventbus.js"></script>
    
    <script>
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ØªØ³Øª
        let passed = 0;
        let failed = 0;
        
        // Ø§Ù„Ù…Ù†Øªâ€ŒÙ‡Ø§ÛŒ DOM
        const statusEl = document.getElementById('status');
        const outputEl = document.getElementById('output');
        const resultsEl = document.getElementById('results');
        
        // ØªØ§Ø¨Ø¹ Ù„Ø§Ú¯
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-item ${type}`;
            div.textContent = message;
            outputEl.appendChild(div);
            outputEl.scrollTop = outputEl.scrollHeight;
        }
        
        // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø®Ø±ÙˆØ¬ÛŒ
        function clearOutput() {
            outputEl.innerHTML = '';
            passed = 0;
            failed = 0;
            updateResults();
            resultsEl.style.display = 'none';
        }
        
        // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†ØªØ§ÛŒØ¬
        function updateResults() {
            document.getElementById('passedCount').textContent = passed;
            document.getElementById('failedCount').textContent = failed;
            document.getElementById('totalCount').textContent = passed + failed;
            
            if (passed + failed > 0) {
                resultsEl.style.display = 'flex';
            }
        }
        
        // Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª
        function runTest(testType) {
            log(`\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`, 'info');
            log(`ğŸ“‹ Ø´Ø±ÙˆØ¹ ØªØ³Øª: ${getTestName(testType)}`, 'info');
            log(`â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n`, 'info');
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ EventBus
            if (typeof SimpleEventBus === 'undefined') {
                log('âŒ SimpleEventBus Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!', 'error');
                log('Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ ÙØ§ÛŒÙ„ simple_eventbus.js Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.', 'warning');
                return;
            }
            
            try {
                const bus = new SimpleEventBus();
                log('âœ… Ù†Ù…ÙˆÙ†Ù‡ EventBus Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯', 'success');
                
                switch(testType) {
                    case 'basic':
                        runBasicTest(bus);
                        break;
                    case 'multiple':
                        runMultipleTest(bus);
                        break;
                    case 'once':
                        runOnceTest(bus);
                        break;
                    case 'scenario':
                        runScenarioTest(bus);
                        break;
                }
                
                log(`\nğŸ‰ ØªØ³Øª "${getTestName(testType)}" Ú©Ø§Ù…Ù„ Ø´Ø¯`, 'success');
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª: ${error.message}`, 'error');
                failed++;
                console.error(error);
            }
            
            updateResults();
        }
        
        // ØªØ³Øª Ù¾Ø§ÛŒÙ‡
        function runBasicTest(bus) {
            log('\nğŸ”¹ ØªØ³Øª Ù¾Ø§ÛŒÙ‡ (on/emit):', 'info');
            
            let received = null;
            
            // Ø«Ø¨Øª listener
            bus.on('test-basic', (data) => {
                received = data;
                log('  ğŸ“¨ Ø¯Ø§Ø¯Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯', 'success');
            });
            
            // Ø§Ø±Ø³Ø§Ù„ event
            const result = bus.emit('test-basic', { 
                message: 'Ø³Ù„Ø§Ù… Ø¯Ù†ÛŒØ§!',
                project: 'Vakamova'
            });
            
            // Ø¨Ø±Ø±Ø³ÛŒ
            if (received && received.message === 'Ø³Ù„Ø§Ù… Ø¯Ù†ÛŒØ§!') {
                log('  âœ… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø±Ø³Øª Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù†Ø¯', 'success');
                passed++;
            } else {
                log('  âŒ Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯', 'error');
                failed++;
            }
            
            if (result.listenersTriggered === 1) {
                log('  âœ… ØªØ¹Ø¯Ø§Ø¯ listeners Ø¯Ø±Ø³Øª Ø§Ø³Øª', 'success');
                passed++;
            } else {
                log(`  âŒ ØªØ¹Ø¯Ø§Ø¯ listeners Ø§Ø´ØªØ¨Ø§Ù‡: ${result.listenersTriggered}`, 'error');
                failed++;
            }
        }
        
        // ØªØ³Øª Ú†Ù†Ø¯ listener
        function runMultipleTest(bus) {
            log('\nğŸ”¹ ØªØ³Øª Ú†Ù†Ø¯ Listener:', 'info');
            
            let counter = 0;
            
            // Ø«Ø¨Øª Û³ listener
            bus.on('test-multi', () => {
                counter++;
                log(`  ğŸ‘‚ Listener ${counter} ÙØ¹Ø§Ù„ Ø´Ø¯`, 'info');
            });
            
            bus.on('test-multi', () => {
                counter++;
                log(`  ğŸ‘‚ Listener ${counter} ÙØ¹Ø§Ù„ Ø´Ø¯`, 'info');
            });
            
            bus.on('test-multi', () => {
                counter++;
                log(`  ğŸ‘‚ Listener ${counter} ÙØ¹Ø§Ù„ Ø´Ø¯`, 'info');
            });
            
            // Ø§Ø±Ø³Ø§Ù„
            bus.emit('test-multi');
            
            // Ø¨Ø±Ø±Ø³ÛŒ
            if (counter === 3) {
                log('  âœ… ØªÙ…Ø§Ù… Û³ listener ÙØ¹Ø§Ù„ Ø´Ø¯Ù†Ø¯', 'success');
                passed++;
            } else {
                log(`  âŒ ÙÙ‚Ø· ${counter} Ø§Ø² Û³ listener ÙØ¹Ø§Ù„ Ø´Ø¯`, 'error');
                failed++;
            }
        }
        
        // ØªØ³Øª once
        function runOnceTest(bus) {
            log('\nğŸ”¹ ØªØ³Øª Once Listener:', 'info');
            
            let onceCounter = 0;
            
            // Ø«Ø¨Øª once listener
            bus.once('test-once', () => {
                onceCounter++;
                log('  ğŸ”‚ Once Listener ÙØ¹Ø§Ù„ Ø´Ø¯', 'success');
            });
            
            // Û³ Ø¨Ø§Ø± Ø§Ø±Ø³Ø§Ù„
            bus.emit('test-once');
            bus.emit('test-once');
            bus.emit('test-once');
            
            // Ø¨Ø±Ø±Ø³ÛŒ
            if (onceCounter === 1) {
                log('  âœ… Once Listener ÙÙ‚Ø· ÛŒÚ©Ø¨Ø§Ø± ÙØ¹Ø§Ù„ Ø´Ø¯', 'success');
                passed++;
            } else {
                log(`  âŒ Once Listener ${onceCounter} Ø¨Ø§Ø± ÙØ¹Ø§Ù„ Ø´Ø¯`, 'error');
                failed++;
            }
        }
        
        // ØªØ³Øª Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
        function runScenarioTest(bus) {
            log('\nğŸ”¹ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ Vakamova:', 'info');
            
            let lessonStarted = false;
            let exerciseCompleted = false;
            let paymentProcessed = false;
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ø§Ù¾ Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù†
            bus.on('app:lesson:started', (data) => {
                lessonStarted = true;
                log(`  ğŸ“– Ø¯Ø±Ø³ Ø´Ø±ÙˆØ¹ Ø´Ø¯: ${data.language} - Ø³Ø·Ø­ ${data.level}`, 'info');
            });
            
            bus.on('app:exercise:completed', (data) => {
                exerciseCompleted = true;
                log(`  âœ… ØªÙ…Ø±ÛŒÙ† Ú©Ø§Ù…Ù„ Ø´Ø¯: Ø§Ù…ØªÛŒØ§Ø² ${data.score}/100`, 'info');
            });
            
            bus.on('app:payment:success', (data) => {
                paymentProcessed = true;
                log(`  ğŸ’° Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚: ${data.amount} ØªÙˆÙ…Ø§Ù†`, 'info');
            });
            
            // Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ
            log('\n  ğŸ¬ Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ...', 'info');
            
            bus.emit('app:lesson:started', {
                language: 'Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ',
                level: 3,
                lessonId: 101
            });
            
            bus.emit('app:exercise:completed', {
                exerciseId: 205,
                score: 95,
                timeSpent: 180
            });
            
            bus.emit('app:payment:success', {
                amount: 49000,
                plan: 'Ù…Ø§Ù‡Ø§Ù†Ù‡',
                userId: 12345
            });
            
            // Ø¨Ø±Ø±Ø³ÛŒ
            const allPassed = lessonStarted && exerciseCompleted && paymentProcessed;
            
            if (allPassed) {
                log('\n  ğŸ‰ Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¬Ø±Ø§ Ø´Ø¯!', 'success');
                passed++;
            } else {
                log('\n  âŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ú©Ø§Ù…Ù„ Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯', 'error');
                failed++;
            }
        }
        
        // Ù†Ø§Ù… ØªØ³Øª
        function getTestName(type) {
            const names = {
                'basic': 'Ù¾Ø§ÛŒÙ‡',
                'multiple': 'Ú†Ù†Ø¯ Listener',
                'once': 'Once',
                'scenario': 'Ø³Ù†Ø§Ø±ÛŒÙˆÛŒ ÙˆØ§Ù‚Ø¹ÛŒ'
            };
            return names[type] || type;
        }
        
        // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯
        window.onload = function() {
            setTimeout(() => {
                if (typeof SimpleEventBus === 'undefined') {
                    statusEl.textContent = 'âŒ SimpleEventBus Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯!';
                    statusEl.className = 'status error';
                    log('Ù…Ø´Ú©Ù„: ÙØ§ÛŒÙ„ simple_eventbus.js Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯', 'error');
                } else {
                    statusEl.textContent = 'âœ… SimpleEventBus Ø¢Ù…Ø§Ø¯Ù‡ ØªØ³Øª Ø§Ø³Øª!';
                    statusEl.className = 'status ready';
                    log('ğŸ¯ SimpleEventBus Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯', 'success');
                    log('Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ÛŒÚ©ÛŒ Ø§Ø² Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯', 'info');
                }
            }, 1000);
        };
    </script>
</body>
</html>
