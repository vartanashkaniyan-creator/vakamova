<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Action Logging - Vakamova</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .badge {
            background: #10b981;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            padding: 30px;
        }
        
        .sidebar {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }
        
        .sidebar h3 {
            color: #4f46e5;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .test-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .test-btn {
            background: white;
            border: 2px solid #4f46e5;
            color: #4f46e5;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .test-btn:hover {
            background: #4f46e5;
            color: white;
            transform: translateY(-2px);
        }
        
        .test-btn.active {
            background: #4f46e5;
            color: white;
        }
        
        .test-results {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }
        
        .test-result {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            border-left: 5px solid #f59e0b;
        }
        
        .test-result.passed {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        
        .test-result.failed {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .test-result h4 {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .passed .status-badge {
            background: #d1fae5;
            color: #065f46;
        }
        
        .failed .status-badge {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .test-output {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-viewer {
            grid-column: 1 / -1;
            background: #1e293b;
            color: #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .log-viewer h3 {
            color: #94a3b8;
            margin-bottom: 15px;
        }
        
        .log-entries {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 5px 10px;
            border-bottom: 1px solid #334155;
            display: flex;
            gap: 10px;
        }
        
        .log-time {
            color: #94a3b8;
            min-width: 80px;
        }
        
        .log-level {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .log-level.info { background: #3b82f6; color: white; }
        .log-level.warn { background: #f59e0b; color: white; }
        .log-level.error { background: #ef4444; color: white; }
        .log-level.success { background: #10b981; color: white; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <span>ğŸ“ ØªØ³Øª Action Logging</span>
                <span class="badge">Vakamova</span>
            </h1>
            <p>Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§Ú¯ Ø¹Ù…Ù„ÛŒØ§Øª</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <h3>ğŸƒ ØªØ³Øªâ€ŒÙ‡Ø§</h3>
                <div class="test-controls">
                    <button class="test-btn" onclick="runTest(1)">Û±. Ø³Ø§Ø®Øª Logger</button>
                    <button class="test-btn" onclick="runTest(2)">Û². Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ LogÙ‡Ø§</button>
                    <button class="test-btn" onclick="runTest(3)">Û³. ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ</button>
                    <button class="test-btn" onclick="runTest(4)">Û´. Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ LogÙ‡Ø§</button>
                    <button class="test-btn" onclick="runTest(5)">Ûµ. Import/Export</button>
                    <button class="test-btn" onclick="runTest(6)">Û¶. Performance</button>
                    <button class="test-btn" onclick="runTest(7)">Û·. ØªØ³Øª Ø¬Ø§Ù…Ø¹</button>
                    <button class="test-btn active" onclick="runAllTests()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                        â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
                    </button>
                </div>
                
                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-value" id="total-tests">0</div>
                        <div class="stat-label">Ú©Ù„ ØªØ³Øªâ€ŒÙ‡Ø§</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="passed-tests">0</div>
                        <div class="stat-label">Ù…ÙˆÙÙ‚</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="failed-tests">0</div>
                        <div class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="success-rate">0%</div>
                        <div class="stat-label">Ù…ÙˆÙÙ‚ÛŒØª</div>
                    </div>
                </div>
            </div>
            
            <div class="test-results" id="test-results">
                <!-- Ù†ØªØ§ÛŒØ¬ ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
        </div>
        
        <div class="log-viewer">
            <h3>ğŸ“‹ Live Log Viewer</h3>
            <div class="log-entries" id="log-entries">
                <!-- Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
            </div>
        </div>
    </div>

    <script>
        // ==================== Ø³ÛŒØ³ØªÙ… Action Logging ====================
        class ActionLogger {
            constructor(maxLogs = 1000, autoSave = true) {
                this.maxLogs = maxLogs;
                this.autoSave = autoSave;
                this.logs = [];
                this.loadFromStorage();
                this.listeners = [];
            }
            
            log(action, data = {}, level = 'info') {
                const logEntry = {
                    id: `log_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    timestamp: Date.now(),
                    action: action,
                    data: this._sanitizeData(data),
                    level: level,
                    userAgent: navigator.userAgent,
                    sessionId: this._getSessionId()
                };
                
                this.logs.unshift(logEntry); // Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ù„Ø§Ú¯ Ø§ÙˆÙ„
                
                if (this.logs.length > this.maxLogs) {
                    this.logs = this.logs.slice(0, this.maxLogs);
                }
                
                if (this.autoSave) {
                    this.saveToStorage();
                }
                
                this._notifyListeners(logEntry);
                this._updateLiveLog(logEntry);
                
                return logEntry;
            }
            
            getLogs(filter = {}) {
                let filteredLogs = [...this.logs];
                
                if (filter.level) {
                    filteredLogs = filteredLogs.filter(log => log.level === filter.level);
                }
                
                if (filter.startDate && filter.endDate) {
                    filteredLogs = filteredLogs.filter(log => 
                        log.timestamp >= filter.startDate && 
                        log.timestamp <= filter.endDate
                    );
                }
                
                if (filter.action) {
                    filteredLogs = filteredLogs.filter(log => 
                        log.action.toLowerCase().includes(filter.action.toLowerCase())
                    );
                }
                
                if (filter.searchText) {
                    filteredLogs = filteredLogs.filter(log => 
                        JSON.stringify(log).toLowerCase().includes(filter.searchText.toLowerCase())
                    );
                }
                
                if (filter.limit) {
                    filteredLogs = filteredLogs.slice(0, filter.limit);
                }
                
                return filteredLogs;
            }
            
            clearLogs(olderThan = null) {
                if (olderThan) {
                    const cutoffTime = Date.now() - olderThan;
                    this.logs = this.logs.filter(log => log.timestamp > cutoffTime);
                } else {
                    this.logs = [];
                }
                
                this.saveToStorage();
                return this.logs.length;
            }
            
            exportLogs(format = 'json') {
                const exportData = {
                    meta: {
                        exportedAt: Date.now(),
                        totalLogs: this.logs.length,
                        format: format,
                        version: '1.0'
                    },
                    logs: this.logs
                };
                
                if (format === 'json') {
                    return JSON.stringify(exportData, null, 2);
                } else if (format === 'csv') {
                    return this._convertToCSV(exportData.logs);
                }
                
                return exportData;
            }
            
            importLogs(data) {
                try {
                    const parsed = typeof data === 'string' ? JSON.parse(data) : data;
                    
                    if (!parsed.logs || !Array.isArray(parsed.logs)) {
                        throw new Error('ÙØ±Ù…Øª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                    }
                    
                    const validLogs = parsed.logs.filter(log => 
                        log.timestamp && log.action && log.level
                    );
                    
                    this.logs = [...validLogs, ...this.logs].slice(0, this.maxLogs);
                    this.saveToStorage();
                    
                    return validLogs.length;
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± import Ù„Ø§Ú¯â€ŒÙ‡Ø§:', error);
                    return 0;
                }
            }
            
            getStatistics() {
                const levels = {};
                const actions = {};
                let totalSize = 0;
                
                this.logs.forEach(log => {
                    levels[log.level] = (levels[log.level] || 0) + 1;
                    actions[log.action] = (actions[log.action] || 0) + 1;
                    totalSize += JSON.stringify(log).length;
                });
                
                return {
                    totalLogs: this.logs.length,
                    levels: levels,
                    topActions: Object.entries(actions)
                        .sort((a, b) => b[1] - a[1])
                        .slice(0, 5),
                    sizeKB: (totalSize / 1024).toFixed(2),
                    oldestLog: this.logs.length > 0 ? Math.min(...this.logs.map(l => l.timestamp)) : null,
                    newestLog: this.logs.length > 0 ? Math.max(...this.logs.map(l => l.timestamp)) : null
                };
            }
            
            saveToStorage() {
                try {
                    localStorage.setItem('vakamova_action_logs', JSON.stringify({
                        logs: this.logs,
                        lastSaved: Date.now()
                    }));
                } catch (e) {
                    console.warn('Ø°Ø®ÛŒØ±Ù‡ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¯Ø± localStorage Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯:', e);
                }
            }
            
            loadFromStorage() {
                try {
                    const saved = localStorage.getItem('vakamova_action_logs');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        this.logs = parsed.logs || [];
                    }
                } catch (e) {
                    console.warn('Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø§Ø² localStorage Ø¨Ø§ Ø®Ø·Ø§ Ù…ÙˆØ§Ø¬Ù‡ Ø´Ø¯:', e);
                    this.logs = [];
                }
            }
            
            addListener(callback) {
                this.listeners.push(callback);
            }
            
            removeListener(callback) {
                this.listeners = this.listeners.filter(listener => listener !== callback);
            }
            
            // ========== Ù…ØªØ¯Ù‡Ø§ÛŒ Ø®ØµÙˆØµÛŒ ==========
            _sanitizeData(data) {
                // Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³
                const sensitiveKeys = ['password', 'token', 'creditCard', 'cvv'];
                const sanitized = {...data};
                
                sensitiveKeys.forEach(key => {
                    if (sanitized[key]) {
                        sanitized[key] = '***REMOVED***';
                    }
                });
                
                return sanitized;
            }
            
            _getSessionId() {
                let sessionId = sessionStorage.getItem('vakamova_session_id');
                if (!sessionId) {
                    sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    sessionStorage.setItem('vakamova_session_id', sessionId);
                }
                return sessionId;
            }
            
            _notifyListeners(logEntry) {
                this.listeners.forEach(listener => {
                    try {
                        listener(logEntry);
                    } catch (e) {
                        console.error('Ø®Ø·Ø§ Ø¯Ø± listener Ù„Ø§Ú¯:', e);
                    }
                });
            }
            
            _updateLiveLog(logEntry) {
                const logEntries = document.getElementById('log-entries');
                if (logEntries) {
                    const time = new Date(logEntry.timestamp).toLocaleTimeString('fa-IR');
                    const levelClass = `log-level ${logEntry.level}`;
                    
                    const entry = document.createElement('div');
                    entry.className = 'log-entry';
                    entry.innerHTML = `
                        <span class="log-time">${time}</span>
                        <span class="${levelClass}">${logEntry.level.toUpperCase()}</span>
                        <span>${logEntry.action}</span>
                        <span style="color: #94a3b8; margin-left: auto;">${JSON.stringify(logEntry.data).substring(0, 50)}...</span>
                    `;
                    
                    logEntries.insertBefore(entry, logEntries.firstChild);
                    
                    if (logEntries.children.length > 50) {
                        logEntries.removeChild(logEntries.lastChild);
                    }
                }
            }
            
            _convertToCSV(logs) {
                if (logs.length === 0) return '';
                
                const headers = ['timestamp', 'action', 'level', 'data', 'sessionId'];
                const rows = logs.map(log => [
                    new Date(log.timestamp).toISOString(),
                    log.action,
                    log.level,
                    JSON.stringify(log.data),
                    log.sessionId
                ]);
                
                const csvContent = [
                    headers.join(','),
                    ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
                ].join('\n');
                
                return csvContent;
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        const tests = [
            {
                id: 1,
                name: 'Ø³Ø§Ø®Øª Logger',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø§ÛŒØ¬Ø§Ø¯ ØµØ­ÛŒØ­ ActionLogger Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶',
                run: async () => {
                    const logger = new ActionLogger();
                    
                    if (!logger.logs) throw new Error('ÙÛŒÙ„Ø¯ logs Ø§ÛŒØ¬Ø§Ø¯ Ù†Ø´Ø¯Ù‡');
                    if (!Array.isArray(logger.logs)) throw new Error('logs Ø¨Ø§ÛŒØ¯ Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø§Ø´Ø¯');
                    if (logger.maxLogs !== 1000) throw new Error('maxLogs Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
                    
                    return 'âœ… Logger Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯';
                }
            },
            {
                id: 2,
                name: 'Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ LogÙ‡Ø§',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø«Ø¨Øª Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§',
                run: async () => {
                    const logger = new ActionLogger(50);
                    
                    // Ø«Ø¨Øª Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ ØªØ³Øª
                    const testActions = [
                        { action: 'user_login', data: { userId: '123', method: 'email' }, level: 'info' },
                        { action: 'payment_initiated', data: { amount: 50000, currency: 'IRR' }, level: 'success' },
                        { action: 'lesson_completed', data: { lessonId: 'L101', score: 95 }, level: 'info' },
                        { action: 'error_occurred', data: { code: 'NETWORK_ERROR', message: 'Timeout' }, level: 'error' },
                        { action: 'warning_detected', data: { type: 'LOW_BATTERY', percent: 15 }, level: 'warn' }
                    ];
                    
                    testActions.forEach(action => logger.log(action.action, action.data, action.level));
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§
                    if (logger.logs.length !== 5) {
                        throw new Error(`ØªØ¹Ø¯Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ ${logger.logs.length} Ø§Ø³Øª (Ø§Ù†ØªØ¸Ø§Ø±: 5)`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ±ØªÛŒØ¨ Ø²Ù…Ø§Ù†ÛŒ (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
                    const timestamps = logger.logs.map(log => log.timestamp);
                    for (let i = 1; i < timestamps.length; i++) {
                        if (timestamps[i] > timestamps[i-1]) {
                            throw new Error('Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ù‡ ØªØ±ØªÛŒØ¨ Ø²Ù…Ø§Ù†ÛŒ Ù…Ø¹Ú©ÙˆØ³ Ù†ÛŒØ³ØªÙ†Ø¯');
                        }
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ØªÙˆØ§
                    const lastLog = logger.logs[0];
                    if (lastLog.action !== 'warning_detected') {
                        throw new Error('Ø¢Ø®Ø±ÛŒÙ† Ù„Ø§Ú¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø«Ø¨Øª Ø´Ø¯Ù‡');
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª ØªØ¹Ø¯Ø§Ø¯
                    for (let i = 0; i < 60; i++) {
                        logger.log(`test_action_${i}`, { index: i });
                    }
                    
                    if (logger.logs.length > 50) {
                        throw new Error(`Ù…Ø­Ø¯ÙˆØ¯ÛŒØª maxLogs Ø±Ø¹Ø§ÛŒØª Ù†Ø´Ø¯Ù‡: ${logger.logs.length} Ù„Ø§Ú¯`);
                    }
                    
                    return `âœ… ${logger.logs.length} Ù„Ø§Ú¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯Ù†Ø¯`;
                }
            },
            {
                id: 3,
                name: 'ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø³ÛŒØ³ØªÙ… ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡',
                run: async () => {
                    const logger = new ActionLogger();
                    logger.clearLogs();
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ Ù…ØªÙ†ÙˆØ¹
                    const now = Date.now();
                    const oneHour = 3600000;
                    
                    const testLogs = [
                        { timestamp: now - oneHour*2, action: 'A', level: 'info', data: {x: 1} },
                        { timestamp: now - oneHour, action: 'B', level: 'error', data: {x: 2} },
                        { timestamp: now, action: 'C', level: 'success', data: {x: 3} },
                        { timestamp: now - oneHour*3, action: 'ERROR_TEST', level: 'error', data: {message: 'Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡'} },
                        { timestamp: now - oneHour*0.5, action: 'PAYMENT_SUCCESS', level: 'success', data: {amount: 10000} }
                    ];
                    
                    testLogs.forEach(log => {
                        logger.logs.unshift({ // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø«Ø¨Øª
                            ...log,
                            id: `test_${log.timestamp}`,
                            sessionId: 'test_session',
                            userAgent: 'test'
                        });
                    });
                    
                    // ØªØ³Øª ÙÛŒÙ„ØªØ± level
                    const errorLogs = logger.getLogs({ level: 'error' });
                    if (errorLogs.length !== 2) {
                        throw new Error(`ÙÛŒÙ„ØªØ± level Ø§Ø´ØªØ¨Ø§Ù‡: ${errorLogs.length} Ù„Ø§Ú¯ (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    }
                    
                    // ØªØ³Øª ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ®
                    const recentLogs = logger.getLogs({ 
                        startDate: now - oneHour*1.5, 
                        endDate: now 
                    });
                    if (recentLogs.length !== 3) {
                        throw new Error(`ÙÛŒÙ„ØªØ± ØªØ§Ø±ÛŒØ® Ø§Ø´ØªØ¨Ø§Ù‡: ${recentLogs.length} Ù„Ø§Ú¯ (Ø§Ù†ØªØ¸Ø§Ø±: 3)`);
                    }
                    
                    // ØªØ³Øª Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…ØªÙ†
                    const paymentLogs = logger.getLogs({ searchText: 'payment' });
                    if (paymentLogs.length !== 1) {
                        throw new Error(`Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…ØªÙ† Ø§Ø´ØªØ¨Ø§Ù‡: ${paymentLogs.length} Ù„Ø§Ú¯ (Ø§Ù†ØªØ¸Ø§Ø±: 1)`);
                    }
                    
                    // ØªØ³Øª limit
                    const limitedLogs = logger.getLogs({ limit: 2 });
                    if (limitedLogs.length !== 2) {
                        throw new Error(`limit Ø§Ø´ØªØ¨Ø§Ù‡: ${limitedLogs.length} Ù„Ø§Ú¯ (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    }
                    
                    return 'âœ… Ø³ÛŒØ³ØªÙ… ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯';
                }
            },
            {
                id: 4,
                name: 'Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ LogÙ‡Ø§',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ùˆ Ú©Ø§Ù…Ù„ Ù„Ø§Ú¯â€ŒÙ‡Ø§',
                run: async () => {
                    const logger = new ActionLogger();
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ùˆ Ø¬Ø¯ÛŒØ¯
                    const now = Date.now();
                    const oneDay = 86400000;
                    
                    for (let i = 0; i < 10; i++) {
                        logger.logs.unshift({
                            id: `log_${i}`,
                            timestamp: now - (oneDay * i),
                            action: `action_${i}`,
                            data: {},
                            level: 'info',
                            sessionId: 'test',
                            userAgent: 'test'
                        });
                    }
                    
                    // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² 3 Ø±ÙˆØ²
                    const initialCount = logger.logs.length;
                    const remaining = logger.clearLogs(oneDay * 3);
                    
                    if (remaining !== 4) { // 4 Ù„Ø§Ú¯ Ø¯Ø± 3 Ø±ÙˆØ² Ø§Ø®ÛŒØ±
                        throw new Error(`Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡: ${remaining} Ù„Ø§Ú¯ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡ (Ø§Ù†ØªØ¸Ø§Ø±: 4)`);
                    }
                    
                    // Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„
                    logger.clearLogs();
                    if (logger.logs.length !== 0) {
                        throw new Error(`Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ù…Ù„ Ú©Ø§Ø± Ù†Ú©Ø±Ø¯: ${logger.logs.length} Ù„Ø§Ú¯ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ
                    logger.saveToStorage();
                    logger.loadFromStorage();
                    if (logger.logs.length !== 0) {
                        throw new Error('Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø³ Ø§Ø² Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ú©Ø§Ø± Ù†Ú©Ø±Ø¯');
                    }
                    
                    return 'âœ… Ù¾Ø§Ú©â€ŒØ³Ø§Ø²ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯';
                }
            },
            {
                id: 5,
                name: 'Import/Export',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù„Ø§Ú¯â€ŒÙ‡Ø§',
                run: async () => {
                    const logger = new ActionLogger();
                    logger.clearLogs();
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ ØªØ³ØªÛŒ
                    const testLogs = [
                        { action: 'EXPORT_TEST_1', data: { test: true }, level: 'info' },
                        { action: 'EXPORT_TEST_2', data: { number: 42 }, level: 'success' },
                        { action: 'EXPORT_TEST_3', data: { error: 'test' }, level: 'error' }
                    ];
                    
                    testLogs.forEach(log => logger.log(log.action, log.data, log.level));
                    
                    // Export Ø¨Ù‡ JSON
                    const jsonExport = logger.exportLogs('json');
                    if (!jsonExport.includes('EXPORT_TEST_1')) {
                        throw new Error('Ø®Ø±ÙˆØ¬ÛŒ JSON Ø´Ø§Ù…Ù„ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù†ÛŒØ³Øª');
                    }
                    
                    // Export Ø¨Ù‡ CSV
                    const csvExport = logger.exportLogs('csv');
                    if (!csvExport.includes('EXPORT_TEST_2')) {
                        throw new Error('Ø®Ø±ÙˆØ¬ÛŒ CSV Ø´Ø§Ù…Ù„ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù†ÛŒØ³Øª');
                    }
                    
                    // Import
                    const newLogger = new ActionLogger();
                    newLogger.clearLogs();
                    
                    const importedCount = newLogger.importLogs(jsonExport);
                    if (importedCount !== 3) {
                        throw new Error(`Import Ø§Ø´ØªØ¨Ø§Ù‡: ${importedCount} Ù„Ø§Ú¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ (Ø§Ù†ØªØ¸Ø§Ø±: 3)`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ÛŒÚ©Ø³Ø§Ù†ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
                    if (newLogger.logs[0].action !== 'EXPORT_TEST_3') {
                        throw new Error('ØªØ±ØªÛŒØ¨ Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¯Ø± Import Ø­ÙØ¸ Ù†Ø´Ø¯Ù‡');
                    }
                    
                    // ØªØ³Øª Import Ù†Ø§Ù…Ø¹ØªØ¨Ø±
                    try {
                        newLogger.importLogs('invalid json');
                        throw new Error('Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ø§ÛŒ json Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
                    } catch (e) {
                        // Ù…ÙˆÙÙ‚: Ø®Ø·Ø§ Ú¯Ø±ÙØªÛŒÙ…
                    }
                    
                    return 'âœ… Import/Export Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯';
                }
            },
            {
                id: 6,
                name: 'Performance',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§ Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§ÛŒ Ø¯Ø§Ø¯Ù‡',
                run: async () => {
                    const logger = new ActionLogger(10000);
                    logger.clearLogs();
                    
                    // ØªØ³Øª Ø«Ø¨Øª Ø³Ø±ÛŒØ¹
                    const startTime = performance.now();
                    const count = 500;
                    
                    for (let i = 0; i < count; i++) {
                        logger.log(`perf_action_${i}`, { index: i, data: 'x'.repeat(100) });
                    }
                    
                    const logTime = performance.now() - startTime;
                    const avgTime = logTime / count;
                    
                    if (avgTime > 5) { // Ø¨ÛŒØ´ Ø§Ø² 5ms Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„ Ù†ÛŒØ³Øª
                        throw new Error(`Ø²Ù…Ø§Ù† Ø«Ø¨Øª Ù„Ø§Ú¯ Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§: ${avgTime.toFixed(2)}ms Ù…ØªÙˆØ³Ø·`);
                    }
                    
                    // ØªØ³Øª Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ø­Ø¬Ù… Ø¨Ø§Ù„Ø§
                    const searchStart = performance.now();
                    const results = logger.getLogs({ searchText: 'perf_action_250' });
                    const searchTime = performance.now() - searchStart;
                    
                    if (searchTime > 100) { // Ø¨ÛŒØ´ Ø§Ø² 100ms Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„ Ù†ÛŒØ³Øª
                        throw new Error(`Ø²Ù…Ø§Ù† Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§: ${searchTime.toFixed(2)}ms`);
                    }
                    
                    // ØªØ³Øª Ø¢Ù…Ø§Ø±Ú¯ÛŒØ±ÛŒ
                    const statsStart = performance.now();
                    const stats = logger.getStatistics();
                    const statsTime = performance.now() - statsStart;
                    
                    if (statsTime > 50) {
                        throw new Error(`Ø²Ù…Ø§Ù† Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¢Ù…Ø§Ø± Ø¨Ø³ÛŒØ§Ø± Ø¨Ø§Ù„Ø§: ${statsTime.toFixed(2)}ms`);
                    }
                    
                    return `âœ… Performance Ø¹Ø§Ù„ÛŒ - Ø«Ø¨Øª: ${avgTime.toFixed(2)}ms, Ø¬Ø³ØªØ¬Ùˆ: ${searchTime.toFixed(2)}ms, Ø¢Ù…Ø§Ø±: ${statsTime.toFixed(2)}ms`;
                }
            },
            {
                id: 7,
                name: 'ØªØ³Øª Ø¬Ø§Ù…Ø¹',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ ØªÙ…Ø§Ù… Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ Ø¯Ø± ÛŒÚ© Ø³Ù†Ø§Ø±ÛŒÙˆ ÙˆØ§Ù‚Ø¹ÛŒ',
                run: async () => {
                    const logger = new ActionLogger(100);
                    
                    // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ÛŒÚ© Ø³Ù†Ø§Ø±ÛŒÙˆ Ú©Ø§Ø±Ø¨Ø±ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
                    logger.log('app_started', { version: '1.0.0', platform: 'web' });
                    logger.log('user_login', { userId: 'u123', method: 'email' }, 'success');
                    logger.log('lesson_started', { lessonId: 'L101', level: 'beginner' });
                    
                    // Ù„Ø§Ú¯ Ø­Ø§ÙˆÛŒ Ø¯Ø§Ø¯Ù‡ Ø­Ø³Ø§Ø³
                    logger.log('payment_attempt', { 
                        userId: 'u123', 
                        amount: 50000,
                        cardNumber: '1234567812345678', // Ø¨Ø§ÛŒØ¯ Ù¾Ø§Ú© Ø´ÙˆØ¯
                        cvv: '123' // Ø¨Ø§ÛŒØ¯ Ù¾Ø§Ú© Ø´ÙˆØ¯
                    });
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ú© Ø´Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³
                    const paymentLog = logger.logs.find(l => l.action === 'payment_attempt');
                    if (paymentLog.data.cardNumber !== '***REMOVED***' || paymentLog.data.cvv !== '***REMOVED***') {
                        throw new Error('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­Ø³Ø§Ø³ Ù¾Ø§Ú© Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯');
                    }
                    
                    // Ø§Ø¯Ø§Ù…Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆ
                    logger.log('lesson_completed', { lessonId: 'L101', score: 92, timeSpent: 1800 }, 'success');
                    logger.log('error_occurred', { code: 'AUDIO_ERROR', message: 'Could not play sound' }, 'error');
                    logger.log('app_background', { reason: 'user_switch' }, 'info');
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ù…Ø§Ø±
                    const stats = logger.getStatistics();
                    if (stats.totalLogs !== 6) {
                        throw new Error(`Ø¢Ù…Ø§Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡: ${stats.totalLogs} Ù„Ø§Ú¯ (Ø§Ù†ØªØ¸Ø§Ø±: 6)`);
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ listenerÙ‡Ø§
                    let listenerCalled = false;
                    logger.addListener((logEntry) => {
                        listenerCalled = true;
                    });
                    
                    logger.log('test_listener', { test: true });
                    
                    if (!listenerCalled) {
                        throw new Error('Listener Ù„Ø§Ú¯ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù†Ø´Ø¯');
                    }
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ Live Log
                    const liveLogs = document.getElementById('log-entries').children;
                    if (liveLogs.length === 0) {
                        throw new Error('Live Log Viewer Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯');
                    }
                    
                    return `âœ… ØªØ³Øª Ø¬Ø§Ù…Ø¹ Ù…ÙˆÙÙ‚ - ${stats.totalLogs} Ù„Ø§Ú¯ØŒ ${Object.keys(stats.levels).length} Ø³Ø·Ø­ Ù…Ø®ØªÙ„Ù`;
                }
            }
        ];

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        const TestManager = {
            currentTest: null,
            results: [],
            
            displayResult(testId, success, message, details = '') {
                const resultsDiv = document.getElementById('test-results');
                const resultDiv = document.createElement('div');
                
                resultDiv.className = `test-result ${success ? 'passed' : 'failed'}`;
                resultDiv.id = `test-result-${testId}`;
                resultDiv.innerHTML = `
                    <h4>
                        <span>${testId}. ${tests.find(t => t.id === testId).name}</span>
                        <span class="status-badge">${success ? 'âœ… Ù…ÙˆÙÙ‚' : 'âŒ Ù†Ø§Ù…ÙˆÙÙ‚'}</span>
                    </h4>
                    <p>${tests.find(t => t.id === testId).description}</p>
                    <div class="test-output">${message}${details ? `<br><small>${details}</small>` : ''}</div>
                `;
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ Ø§Ø¨ØªØ¯Ø§ÛŒ Ù„ÛŒØ³Øª
                if (resultsDiv.firstChild) {
                    resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
                } else {
                    resultsDiv.appendChild(resultDiv);
                }
                
                // Ø°Ø®ÛŒØ±Ù‡ Ù†ØªÛŒØ¬Ù‡
                this.results[testId] = { success, message };
                this.updateStats();
            },
            
            async runTest(testId) {
                const test = tests.find(t => t.id === testId);
                if (!test) return;
                
                this.currentTest = testId;
                
                try {
                    const result = await test.run();
                    this.displayResult(testId, true, result);
                    
                    // Ø«Ø¨Øª Ù„Ø§Ú¯ Ù…ÙˆÙÙ‚ÛŒØª
                    window.logger?.log('test_passed', { testId, testName: test.name }, 'success');
                    
                } catch (error) {
                    this.displayResult(testId, false, error.message, error.stack);
                    
                    // Ø«Ø¨Øª Ù„Ø§Ú¯ Ø®Ø·Ø§
                    window.logger?.log('test_failed', { 
                        testId, 
                        testName: test.name,
                        error: error.message 
                    }, 'error');
                }
            },
            
            async runAllTests() {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬ Ù‚Ø¨Ù„ÛŒ
                document.getElementById('test-results').innerHTML = '';
                this.results = [];
                
                // Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
                for (const test of tests) {
                    await this.runTest(test.id);
                    await new Promise(resolve => setTimeout(resolve, 300)); // ÙˆÙ‚ÙÙ‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
                }
                
                // Ø«Ø¨Øª Ù„Ø§Ú¯ ØªÚ©Ù…ÛŒÙ„
                const passed = this.results.filter(r => r?.success).length;
                window.logger?.log('tests_completed', { 
                    total: tests.length, 
                    passed: passed,
                    failed: tests.length - passed
                }, passed === tests.length ? 'success' : 'warn');
            },
            
            updateStats() {
                const total = tests.length;
                const passed = this.results.filter(r => r?.success).length;
                const failed = total - passed;
                const rate = total > 0 ? Math.round((passed / total) * 100) : 0;
                
                document.getElementById('total-tests').textContent = total;
                document.getElementById('passed-tests').textContent = passed;
                document.getElementById('failed-tests').textContent = failed;
                document.getElementById('success-rate').textContent = `${rate}%`;
            }
        };

        // ==================== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Ø§ÛŒØ¬Ø§Ø¯ logger Ø¬Ù‡Ø§Ù†ÛŒ
            window.logger = new ActionLogger();
            
            // Ø«Ø¨Øª Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø´Ø±ÙˆØ¹
            logger.log('test_suite_started', { 
                suite: 'Action Logging',
                time: new Date().toISOString()
            }, 'info');
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ù…Ø§Ø± Ø§ÙˆÙ„ÛŒÙ‡
            TestManager.updateStats();
            
            // Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ
            logger.log('system', { message: 'ØªØ³Øª Action Logging Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª' }, 'info');
            logger.log('instruction', { message: 'Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯' }, 'info');
            
            console.log('ğŸš€ ØªØ³Øª Action Logging Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ Ø§Ø³Øª');
        });

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø¹Ù…ÙˆÙ…ÛŒ ====================
        function runTest(testId) {
            TestManager.runTest(testId);
        }
        
        function runAllTests() {
            TestManager.runAllTests();
        }
    </script>
</body>
</html>
