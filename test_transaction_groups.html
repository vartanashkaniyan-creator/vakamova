<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Transaction Groups - Vakamova</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            line-height: 1.6; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: #333; 
            padding: 20px; 
            min-height: 100vh; 
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: rgba(255, 255, 255, 0.95); 
            border-radius: 20px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); 
            overflow: hidden; 
        }
        
        header { 
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        
        .test-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #f8fafc;
            border-top: 2px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            min-width: 120px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6b7280;
        }
        
        .passed .stat-value { color: #10b981; }
        .failed .stat-value { color: #ef4444; }
        .pending .stat-value { color: #f59e0b; }
        
        .test-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            padding: 30px; 
        }
        
        .test-card { 
            background: white; 
            border-radius: 15px; 
            padding: 25px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); 
            border: 2px solid transparent; 
            transition: all 0.3s ease; 
        }
        
        .test-card:hover {
            transform: translateY(-5px);
            border-color: #4f46e5;
            box-shadow: 0 15px 40px rgba(79,70,229,0.15);
        }
        
        .test-card.passed { border-left: 5px solid #10b981; }
        .test-card.failed { border-left: 5px solid #ef4444; }
        .test-card.pending { border-left: 5px solid #f59e0b; }
        
        .test-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1f2937;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-result {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        
        .passed .test-result { background: #d1fae5; color: #065f46; }
        .failed .test-result { background: #fee2e2; color: #991b1b; }
        .pending .test-result { background: #fef3c7; color: #92400e; }
        
        .test-desc {
            color: #6b7280;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        .test-output {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            direction: ltr;
        }
        
        .test-output.success { background: #f0fdf4; border-color: #bbf7d0; }
        .test-output.error { background: #fef2f2; border-color: #fecaca; }
        
        button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(79,70,229,0.4);
        }
        
        button:active { transform: translateY(0); }
        
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 30px;
            border-top: 2px solid #e2e8f0;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e2e8f0;
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        #console-log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            margin: 0 30px 30px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 150px;
            overflow-y: auto;
            direction: ltr;
            text-align: left;
        }
        
        #status-message {
            background: #f8fafc;
            padding: 10px 30px;
            border-bottom: 2px solid #e2e8f0;
            font-weight: bold;
            color: #4f46e5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª ØªØ³Øª Transaction Groups - Ø¹Ù…Ù„ÛŒØ§Øª Ú¯Ø±ÙˆÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡</h1>
            <p>Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªÙ…ÛŒ Ø¨ÙˆØ¯Ù† (Atomicity)ØŒ Rollback Ùˆ Commit Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒÛŒ Ø§Ø² Ø¹Ù…Ù„ÛŒØ§Øª State</p>
        </header>

        <div id="status-message">Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§...</div>

        <div class="test-stats">
            <div class="stat pending">
                <span class="stat-value" id="passed-count">0</span>
                <span class="stat-label">Ù…ÙˆÙÙ‚</span>
            </div>
            <div class="stat pending">
                <span class="stat-value" id="failed-count">0</span>
                <span class="stat-label">Ù†Ø§Ù…ÙˆÙÙ‚</span>
            </div>
            <div class="stat pending">
                <span class="stat-value" id="pending-count">6</span>
                <span class="stat-label">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
            </div>
            <div class="stat">
                <span class="stat-value" id="coverage">0%</span>
                <span class="stat-label">Ù¾ÙˆØ´Ø´</span>
            </div>
        </div>

        <div class="test-grid" id="test-grid">
            <!-- ØªØ³Øªâ€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>

        <div id="console-log">
            <div>> Ú©Ù†Ø³ÙˆÙ„ ØªØ³Øª Transaction Groups:</div>
            <div id="console-output"></div>
        </div>

        <div class="action-bar">
            <button id="run-all-btn">
                <span>â–¶ï¸</span>
                Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
            <button id="clear-btn" style="background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);">
                <span>ğŸ”„</span>
                Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬
            </button>
        </div>
    </div>

    <script>
        // ========== Ø¨Ø®Ø´ Û±: Logger ==========
        const logger = {
            log: (message, data = {}) => {
                const time = new Date().toLocaleTimeString('fa-IR');
                const output = document.getElementById('console-output');
                const logEntry = document.createElement('div');
                logEntry.innerHTML = `<span style="color: #94a3b8">[${time}]</span> ${message}`;
                output.appendChild(logEntry);
                output.scrollTop = output.scrollHeight;
                console.log(message, data);
            },
            error: (message, error) => {
                logger.log(`<span style="color: #ef4444">âŒ ${message}: ${error}</span>`);
            },
            success: (message) => {
                logger.log(`<span style="color: #10b981">âœ… ${message}</span>`);
            }
        };

        // ========== Ø¨Ø®Ø´ Û²: TransactionGroupsManager ==========
        class TransactionGroupsManager {
            constructor(stateManager) {
                this.stateManager = stateManager || {
                    setState: (path, value) => console.log(`Mock: ${path} = ${value}`),
                    getState: () => ({})
                };
                this.currentTransaction = null;
                this.transactionLogs = [];
                this.snapshotBeforeTransaction = null;
            }

            begin(groupId) {
                if (this.currentTransaction) {
                    throw new Error(`ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª (${this.currentTransaction.id})`);
                }
                
                this.currentTransaction = {
                    id: groupId,
                    actions: [],
                    startTime: Date.now(),
                    status: 'active'
                };
                
                this.snapshotBeforeTransaction = this._takeStateSnapshot();
                logger.log(`ğŸ”µ ØªØ±Ø§Ú©Ù†Ø´ "${groupId}" Ø´Ø±ÙˆØ¹ Ø´Ø¯`);
                return this;
            }

            addAction(actionType, statePath, newValue) {
                if (!this.currentTransaction) {
                    throw new Error('Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ ÙØ¹Ø§Ù„ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                }
                
                this.currentTransaction.actions.push({
                    type: actionType,
                    path: statePath,
                    value: newValue,
                    timestamp: Date.now()
                });
                
                logger.log(`   â• "${actionType}" Ø±ÙˆÛŒ "${statePath}"`);
                return this;
            }

            async commit() {
                if (!this.currentTransaction) {
                    throw new Error('Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Commit ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                }
                
                const txn = this.currentTransaction;
                logger.log(`ğŸ”„ Commit ØªØ±Ø§Ú©Ù†Ø´ "${txn.id}" (${txn.actions.length} Ø¹Ù…Ù„)`);
                
                try {
                    const executedActions = [];
                    
                    for (const action of txn.actions) {
                        logger.log(`   ğŸ›  Ø§Ø¬Ø±Ø§ÛŒ: ${action.type} -> ${action.path}`);
                        executedActions.push(action);
                        
                        if (action.path.includes('FAIL_ME')) {
                            throw new Error(`Ø®Ø·Ø§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± ${action.path}`);
                        }
                    }
                    
                    txn.status = 'committed';
                    txn.endTime = Date.now();
                    txn.executedActions = executedActions;
                    
                    this.transactionLogs.push({ ...txn, result: 'success' });
                    logger.success(`âœ… ØªØ±Ø§Ú©Ù†Ø´ "${txn.id}" Commit Ø´Ø¯ (${txn.endTime - txn.startTime}ms)`);
                    
                    this.currentTransaction = null;
                    this.snapshotBeforeTransaction = null;
                    
                    return { 
                        success: true, 
                        transactionId: txn.id,
                        duration: txn.endTime - txn.startTime,
                        actionCount: txn.actions.length
                    };
                    
                } catch (error) {
                    logger.error(`Ø®Ø·Ø§ Ø¯Ø± Commit "${txn.id}"`, error.message);
                    await this._performRollback(txn, `Ø®Ø·Ø§: ${error.message}`);
                    throw error;
                }
            }

            async rollback(reason = 'Ø¯Ø³ØªÙˆØ±ÛŒ') {
                if (!this.currentTransaction) {
                    throw new Error('Ù‡ÛŒÚ† ØªØ±Ø§Ú©Ù†Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Rollback ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯');
                }
                return await this._performRollback(this.currentTransaction, reason);
            }

            async _performRollback(transaction, reason) {
                logger.log(`âª Rollback ØªØ±Ø§Ú©Ù†Ø´ "${transaction.id}" (Ø¯Ù„ÛŒÙ„: ${reason})`);
                
                if (this.snapshotBeforeTransaction) {
                    logger.log(`   ğŸ”„ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Snapshot`);
                }
                
                transaction.status = 'rolled_back';
                transaction.endTime = Date.now();
                transaction.rollbackReason = reason;
                
                this.transactionLogs.push({ ...transaction, result: 'rolled_back' });
                logger.success(`âœ… ØªØ±Ø§Ú©Ù†Ø´ "${transaction.id}" Rollback Ø´Ø¯`);
                
                this.currentTransaction = null;
                this.snapshotBeforeTransaction = null;
                
                return { 
                    success: true, 
                    transactionId: transaction.id,
                    reason: reason
                };
            }

            _takeStateSnapshot() {
                return {
                    timestamp: Date.now(),
                    data: 'snapshot_of_current_state'
                };
            }

            getStats() {
                const total = this.transactionLogs.length;
                const committed = this.transactionLogs.filter(t => t.result === 'success').length;
                const rolledBack = this.transactionLogs.filter(t => t.result === 'rolled_back').length;
                return { total, committed, rolledBack };
            }

            getCurrentTransaction() {
                return this.currentTransaction ? { ...this.currentTransaction } : null;
            }
        }

        // ========== Ø¨Ø®Ø´ Û³: ØªØ³Øªâ€ŒÙ‡Ø§ ==========
        const tests = [
            {
                id: 'txn-1',
                title: 'Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Commit ØªØ±Ø§Ú©Ù†Ø´ Ø³Ø§Ø¯Ù‡',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø±ÙˆØ¹ ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„ÛŒØ§Øª Ùˆ Commit Ù…ÙˆÙÙ‚.',
                run: async () => {
                    const txnManager = new TransactionGroupsManager();
                    
                    txnManager.begin('test_txn_1')
                              .addAction('SET', 'user.points', 100)
                              .addAction('SET', 'user.level', 'beginner');
                    
                    const result = await txnManager.commit();
                    
                    if (!result.success) throw new Error('Commit Ù†Ø§Ù…ÙˆÙÙ‚');
                    if (result.actionCount !== 2) throw new Error(`ØªØ¹Ø¯Ø§Ø¯ Ø¹Ù…Ù„ÛŒØ§Øª: ${result.actionCount} (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    
                    return `âœ… ØªØ±Ø§Ú©Ù†Ø´ Commit Ø´Ø¯ (${result.duration}ms)`;
                }
            },
            {
                id: 'txn-2',
                title: 'Rollback Ø¯Ø³ØªÛŒ',
                description: 'Ø´Ø±ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù…Ù„ÛŒØ§Øª Ùˆ Rollback Ø¢Ú¯Ø§Ù‡Ø§Ù†Ù‡.',
                run: async () => {
                    const txnManager = new TransactionGroupsManager();
                    
                    txnManager.begin('test_txn_2')
                              .addAction('SET', 'cart.total', 50000);
                    
                    const result = await txnManager.rollback('ØªØ³Øª Rollback');
                    
                    if (!result.success) throw new Error('Rollback Ù†Ø§Ù…ÙˆÙÙ‚');
                    
                    const stats = txnManager.getStats();
                    if (stats.rolledBack !== 1) throw new Error(`Ø¢Ù…Ø§Ø± Rollback: ${stats.rolledBack} (Ø§Ù†ØªØ¸Ø§Ø±: 1)`);
                    
                    return 'âœ… Rollback Ø¯Ø³ØªÛŒ Ù…ÙˆÙÙ‚';
                }
            },
            {
                id: 'txn-3',
                title: 'Ú†Ù†Ø¯ ØªØ±Ø§Ú©Ù†Ø´ Ù¾Ø´Øª Ø³Ø± Ù‡Ù…',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ØµØ­ÛŒØ­ Ú†Ù†Ø¯ ØªØ±Ø§Ú©Ù†Ø´ Ù…Ø³ØªÙ‚Ù„.',
                run: async () => {
                    const txnManager = new TransactionGroupsManager();
                    
                    await txnManager.begin('txn_a').addAction('SET', 'a', 1).commit();
                    await txnManager.begin('txn_b').addAction('SET', 'b', 2).commit();
                    
                    const stats = txnManager.getStats();
                    if (stats.committed !== 2) throw new Error(`Commit: ${stats.committed} (Ø§Ù†ØªØ¸Ø§Ø±: 2)`);
                    
                    return 'âœ… Ø¯Ùˆ ØªØ±Ø§Ú©Ù†Ø´ Ù¾Ø´Øª Ø³Ø± Ù‡Ù… Ù…Ø¯ÛŒØ±ÛŒØª Ø´Ø¯';
                }
            },
            {
                id: 'txn-4',
                title: 'Ø®Ø·Ø§ÛŒ ØªØ±Ø§Ú©Ù†Ø´ ØªÙˆØ¯Ø±ØªÙˆ',
                description: 'Ø´Ø±ÙˆØ¹ ØªØ±Ø§Ú©Ù†Ø´ Ø¯ÙˆÙ… Ù‚Ø¨Ù„ Ø§Ø² Ù¾Ø§ÛŒØ§Ù† Ø§ÙˆÙ„ Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¯Ù‡Ø¯.',
                run: async () => {
                    const txnManager = new TransactionGroupsManager();
                    txnManager.begin('first_txn');
                    
                    let errorThrown = false;
                    try {
                        txnManager.begin('second_txn');
                    } catch (error) {
                        errorThrown = true;
                        if (!error.message.includes('ÛŒÚ© ØªØ±Ø§Ú©Ù†Ø´ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª')) {
                            throw new Error(`Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨: "${error.message}"`);
                        }
                    }
                    
                    if (!errorThrown) throw new Error('Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
                    
                    await txnManager.rollback('Ù¾Ø§ÛŒØ§Ù† ØªØ³Øª');
                    return 'âœ… Ø§Ø² ØªØ±Ø§Ú©Ù†Ø´ ØªÙˆØ¯Ø±ØªÙˆ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø´Ø¯';
                }
            },
            {
                id: 'txn-5',
                title: 'Rollback Ø®ÙˆØ¯Ú©Ø§Ø±',
                description: 'Rollback Ø§ØªÙˆÙ…Ø§ØªÛŒÚ© Ù‡Ù†Ú¯Ø§Ù… Ø®Ø·Ø§ Ø¯Ø± Ø­ÛŒÙ† Ø§Ø¬Ø±Ø§.',
                run: async () => {
                    const txnManager = new TransactionGroupsManager();
                    
                    txnManager.begin('failing_txn')
                              .addAction('SET', 'step1', 'ok')
                              .addAction('SET', 'FAIL_ME', 'error')
                              .addAction('SET', 'step3', 'never');
                    
                    let errorCaught = false;
                    try {
                        await txnManager.commit();
                    } catch (error) {
                        errorCaught = true;
                    }
                    
                    if (!errorCaught) throw new Error('Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
                    
                    const currentTxn = txnManager.getCurrentTransaction();
                    if (currentTxn !== null) throw new Error('ØªØ±Ø§Ú©Ù†Ø´ Ù‡Ù†ÙˆØ² ÙØ¹Ø§Ù„ Ø§Ø³Øª');
                    
                    const stats = txnManager.getStats();
                    if (stats.rolledBack !== 1) throw new Error(`Rollback: ${stats.rolledBack} (Ø§Ù†ØªØ¸Ø§Ø±: 1)`);
                    
                    return 'âœ… Rollback Ø®ÙˆØ¯Ú©Ø§Ø± Ù…ÙˆÙÙ‚';
                }
            },
            {
                id: 'txn-6',
                title: 'Ø¢Ù…Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø¯Ù‚ÛŒÙ‚',
                description: 'Ø¨Ø±Ø±Ø³ÛŒ Ø¢Ù…Ø§Ø±Ú¯ÛŒØ±ÛŒ Ø§Ø² ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§.',
                run: async () => {
                    const txnManager = new TransactionGroupsManager();
                    
                    await txnManager.begin('stats_1').addAction('SET', 'x', 1).commit();
                    await txnManager.begin('stats_2').addAction('SET', 'y', 2).commit();
                    await txnManager.begin('stats_3').addAction('SET', 'z', 3).rollback('ØªØ³Øª');
                    await txnManager.begin('stats_4').addAction('SET', 'w', 4).commit();
                    
                    const stats = txnManager.getStats();
                    
                    if (stats.total !== 4) throw new Error(`Ú©Ù„: ${stats.total} (Ø§Ù†ØªØ¸Ø§Ø±: 4)`);
                    if (stats.committed !== 3) throw new Error(`Commit: ${stats.committed} (Ø§Ù†ØªØ¸Ø§Ø±: 3)`);
                    if (stats.rolledBack !== 1) throw new Error(`Rollback: ${stats.rolledBack} (Ø§Ù†ØªØ¸Ø§Ø±: 1)`);
                    
                    return `âœ… Ø¢Ù…Ø§Ø± ØµØ­ÛŒØ­. Ú©Ù„: ${stats.total}, Commit: ${stats.committed}, Rollback: ${stats.rolledBack}`;
                }
            }
        ];

        // ========== Ø¨Ø®Ø´ Û´: TestManager ==========
        const TestManager = {
            tests: tests,
            results: {},
            
            renderTests() {
                const testGrid = document.getElementById('test-grid');
                testGrid.innerHTML = '';
                
                this.tests.forEach(test => {
                    const card = document.createElement('div');
                    card.className = 'test-card pending';
                    card.id = `card-${test.id}`;
                    card.innerHTML = `
                        <div class="test-title">
                            <span>${test.title}</span>
                            <span class="test-result" id="result-${test.id}">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                        </div>
                        <div class="test-desc">${test.description}</div>
                        <div class="test-output" id="output-${test.id}"></div>
                    `;
                    testGrid.appendChild(card);
                });
                
                this.updateStats();
                document.getElementById('status-message').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§';
            },
            
            async runTest(test) {
                const card = document.getElementById(`card-${test.id}`);
                const output = document.getElementById(`output-${test.id}`);
                const resultSpan = document.getElementById(`result-${test.id}`);
                
                card.className = 'test-card pending';
                resultSpan.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                output.className = 'test-output';
                output.innerHTML = '<div class="loading"></div> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                
                document.getElementById('status-message').textContent = `Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ: ${test.title}`;
                logger.log(`Ø´Ø±ÙˆØ¹ ØªØ³Øª: ${test.title}`);
                
                try {
                    const result = await test.run();
                    card.className = 'test-card passed';
                    resultSpan.textContent = 'Ù…ÙˆÙÙ‚';
                    output.className = 'test-output success';
                    output.innerHTML = `<strong>âœ… Ù†ØªÛŒØ¬Ù‡:</strong> ${result}`;
                    this.results[test.id] = { success: true, result };
                    logger.success(`ØªØ³Øª "${test.title}" Ù…ÙˆÙÙ‚`);
                    return true;
                } catch (error) {
                    card.className = 'test-card failed';
                    resultSpan.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
                    output.className = 'test-output error';
                    output.innerHTML = `<strong>âŒ Ø®Ø·Ø§:</strong> ${error.message}`;
                    this.results[test.id] = { success: false, error: error.message };
                    logger.error(`ØªØ³Øª "${test.title}" Ù†Ø§Ù…ÙˆÙÙ‚`, error.message);
                    return false;
                } finally {
                    this.updateStats();
                }
            },
            
            async runAllTests() {
                const runBtn = document.getElementById('run-all-btn');
                runBtn.disabled = true;
                runBtn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
                
                let passed = 0;
                logger.log('ğŸš€ Ø´Ø±ÙˆØ¹ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§');
                
                for (const test of this.tests) {
                    const success = await this.runTest(test);
                    if (success) passed++;
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                runBtn.disabled = false;
                runBtn.innerHTML = '<span>â–¶ï¸</span> Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ø¯Ø¯';
                document.getElementById('status-message').textContent = `ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯: ${passed} Ø§Ø² ${this.tests.length} Ù…ÙˆÙÙ‚`;
                
                const coverage = Math.round((passed / this.tests.length) * 100);
                document.getElementById('coverage').textContent = `${coverage}%`;
                logger.log(`ğŸ¯ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯: ${passed} Ù…ÙˆÙÙ‚ Ø§Ø² ${this.tests.length}`);
            },
            
            updateStats() {
                const passed = document.querySelectorAll('.test-card.passed').length;
                const failed = document.querySelectorAll('.test-card.failed').length;
                const pending = this.tests.length - passed - failed;
                
                document.getElementById('passed-count').textContent = passed;
                document.getElementById('failed-count').textContent = failed;
                document.getElementById('pending-count').textContent = pending;
            },
            
            clearTests() {
                this.tests.forEach(test => {
                    const card = document.getElementById(`card-${test.id}`);
                    const output = document.getElementById(`output-${test.id}`);
                    const resultSpan = document.getElementById(`result-${test.id}`);
                    
                    card.className = 'test-card pending';
                    resultSpan.textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±';
                    output.className = 'test-output';
                    output.innerHTML = '';
                });
                
                this.results = {};
                this.updateStats();
                document.getElementById('console-output').innerHTML = '';
                document.getElementById('coverage').textContent = '0%';
                document.getElementById('status-message').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§';
                logger.log('ğŸ§¹ Ù†ØªØ§ÛŒØ¬ Ù¾Ø§Ú© Ø´Ø¯');
            }
        };

        // ========== Ø¨Ø®Ø´ Ûµ: Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ==========
        document.addEventListener('DOMContentLoaded', function() {
            TestManager.renderTests();
            
            // Ø§ØªØµØ§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.getElementById('run-all-btn').onclick = function() {
                TestManager.runAllTests();
            };
            
            document.getElementById('clear-btn').onclick = function() {
                TestManager.clearTests();
            };
            
            logger.log('ğŸš€ ØªØ³Øª Transaction Groups Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª');
            logger.log('ğŸ“± Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ ÙØ¹Ø§Ù„ Ù‡Ø³ØªÙ†Ø¯ - Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯');
        });
    </script>
</body>
</html>
