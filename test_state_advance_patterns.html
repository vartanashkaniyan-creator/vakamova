<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ State - Vakamova</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:tahoma;background:#4527a0;color:#333;padding:20px}.container{max-width:900px;margin:auto;background:#fff;border-radius:10px;overflow:hidden}header{background:#5e35b1;color:#fff;padding:20px;text-align:center}h1{font-size:1.5rem}.test-section{padding:20px}.test-item{background:#f5f5f5;border-radius:8px;padding:15px;margin-bottom:15px;border-right:5px solid#7e57c2}.passed{border-right-color:#43a047;background:#e8f5e9}.failed{border-right-color:#e53935;background:#ffebee}.running{border-right-color:#fb8c00;background:#fff3e0}.test-header{display:flex;justify-content:space-between;margin-bottom:10px}.test-name{font-weight:bold}.test-status{padding:3px 10px;border-radius:12px;font-size:.8rem}.status-pending{background:#fff9c4;color:#f57c00}.status-running{background:#bbdefb;color:#1565c0}.status-passed{background:#c8e6c9;color:#2e7d32}.status-failed{background:#ffcdd2;color:#c62828}button{background:#5e35b1;color:#fff;border:none;padding:12px 25px;border-radius:8px;font-size:1rem;cursor:pointer;width:100%;margin-top:15px}button:hover{background:#4527a0}.console{background:#263238;color:#80cbc4;padding:15px;margin-top:20px;border-radius:8px;font-family:monospace;font-size:.9rem;max-height:200px;overflow-y:auto}.log{padding:5px 0;border-bottom:1px solid #37474f}.pattern-info{background:#d1c4e9;padding:10px;border-radius:6px;margin:10px 0;font-size:.9rem}.state-preview{background:#f3e5f5;border:1px dashed#7e57c2;padding:10px;border-radius:6px;margin-top:10px;font-family:monospace;font-size:.85rem;max-height:150px;overflow-y:auto}
    </style>
</head>
<body>
    <div class="container">
        <header><h1>ğŸ§© ØªØ³Øª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ State Management</h1></header>
        <div class="test-section">
            <div class="pattern-info">
                <strong>ğŸ¯ Ù‡Ø¯Ù:</strong> ØªØ³Øª Û´ Ø§Ù„Ú¯ÙˆÛŒ Ø­ÛŒØ§ØªÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±<br>
                <strong>ğŸ“‹ Ø§Ù„Ú¯ÙˆÙ‡Ø§:</strong> Middleware, Selector, Serialization, Partitioning
            </div>
            
            <div class="test-item" id="test1">
                <div class="test-header"><div class="test-name">Û±. Ø³ÛŒØ³ØªÙ… Middleware</div><div class="test-status status-pending" id="status1">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output1"></div>
            </div>
            <div class="test-item" id="test2">
                <div class="test-header"><div class="test-name">Û². Ø§Ù„Ú¯ÙˆÛŒ Selector</div><div class="test-status status-pending" id="status2">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output2"></div>
            </div>
            <div class="test-item" id="test3">
                <div class="test-header"><div class="test-name">Û³. Serialization Ù¾ÛŒØ´Ø±ÙØªÙ‡</div><div class="test-status status-pending" id="status3">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output3"></div>
            </div>
            <div class="test-item" id="test4">
                <div class="test-header"><div class="test-name">Û´. Partitioning State</div><div class="test-status status-pending" id="status4">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div></div>
                <div id="output4"></div>
            </div>
            
            <button id="run-btn">â–¶ï¸ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§</button>
            <div class="state-preview" id="state-preview">
                <strong>ğŸ“Š Ù¾ÛŒØ´â€ŒÙ†Ù…Ø§ÛŒØ´ State:</strong> ØªØ³Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯
            </div>
            
            <div class="console" id="console">
                <div class="log">[Ø³ÛŒØ³ØªÙ…] ØªØ³Øª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ State Management Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª</div>
            </div>
        </div>
    </div>

<script>
// ========== State Manager Ù¾ÛŒØ´Ø±ÙØªÙ‡ ==========
const AdvancedStateManager = {
    state: {},
    middlewares: [],
    selectors: new Map(),
    partitions: new Map(),
    stateHistory: [],
    maxHistorySize: 50,
    
    // ========== Middleware System ==========
    addMiddleware(middleware) {
        this.middlewares.push(middleware);
        this.log(`Middleware Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯: ${middleware.name || 'Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…'}`);
    },
    
    async setState(key, value) {
        const startTime = Date.now();
        let processedValue = value;
        let shouldProceed = true;
        
        // Ø§Ø¬Ø±Ø§ÛŒ MiddlewareÙ‡Ø§ Ù‚Ø¨Ù„ Ø§Ø² ØªÙ†Ø¸ÛŒÙ… State
        for (const middleware of this.middlewares) {
            try {
                const result = await middleware.beforeSet(key, processedValue, this.state);
                if (result === false) {
                    shouldProceed = false;
                    this.log(`Middleware "${middleware.name}" Ø¯Ø±Ø®ÙˆØ§Ø³Øª set Ø±Ø§ Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯`, 'warning');
                    break;
                }
                if (result !== undefined && result !== processedValue) {
                    processedValue = result;
                    this.log(`Middleware "${middleware.name}" Ù…Ù‚Ø¯Ø§Ø± Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯`);
                }
            } catch (error) {
                this.log(`Ø®Ø·Ø§ Ø¯Ø± middleware "${middleware.name}": ${error.message}`, 'error');
            }
        }
        
        if (!shouldProceed) {
            return false;
        }
        
        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ØªØ§Ø±ÛŒØ®Ú†Ù‡
        const oldValue = this.state[key];
        this.addToHistory(key, oldValue, processedValue);
        
        // ØªÙ†Ø¸ÛŒÙ… State
        this.state[key] = processedValue;
        
        // Ø§Ø¬Ø±Ø§ÛŒ MiddlewareÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ø² ØªÙ†Ø¸ÛŒÙ… State
        for (const middleware of this.middlewares) {
            try {
                await middleware.afterSet(key, processedValue, oldValue, this.state);
            } catch (error) {
                this.log(`Ø®Ø·Ø§ Ø¯Ø± afterSet middleware: ${error.message}`, 'error');
            }
        }
        
        // Ø§Ø¬Ø±Ø§ÛŒ SelectorÙ‡Ø§
        this.updateSelectors();
        
        const duration = Date.now() - startTime;
        this.log(`State "${key}" ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯ (${duration}ms)`);
        this.updatePreview();
        
        return true;
    },
    
    // ========== Selector Pattern ==========
    createSelector(name, dependencies, computeFn) {
        const selector = {
            name,
            dependencies,
            computeFn,
            cachedValue: null,
            lastComputed: null,
            recomputeCount: 0
        };
        
        this.selectors.set(name, selector);
        this.log(`Selector "${name}" Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯ (ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§: ${dependencies.join(', ')})`);
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø§ÙˆÙ„ÛŒÙ‡
        this.recomputeSelector(name);
        
        return selector;
    },
    
    recomputeSelector(name) {
        const selector = this.selectors.get(name);
        if (!selector) return null;
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù…Ø¬Ø¯Ø¯
        const allDepsExist = selector.dependencies.every(dep => this.state[dep] !== undefined);
        if (!allDepsExist) {
            this.log(`Selector "${name}" ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù…Ù„ Ù†Ø¯Ø§Ø±Ø¯`, 'warning');
            return null;
        }
        
        // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ
        const dependencyValues = {};
        selector.dependencies.forEach(dep => {
            dependencyValues[dep] = this.state[dep];
        });
        
        // Ù…Ø­Ø§Ø³Ø¨Ù‡
        const startTime = Date.now();
        const newValue = selector.computeFn(dependencyValues);
        const duration = Date.now() - startTime;
        
        selector.cachedValue = newValue;
        selector.lastComputed = Date.now();
        selector.recomputeCount++;
        
        this.log(`Selector "${name}" Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯: ${JSON.stringify(newValue).substring(0, 50)}... (${duration}ms)`);
        return newValue;
    },
    
    getSelectorValue(name) {
        const selector = this.selectors.get(name);
        if (!selector) {
            throw new Error(`Selector "${name}" ÛŒØ§ÙØª Ù†Ø´Ø¯`);
        }
        
        // Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ú©Ø´
        const shouldRecompute = selector.dependencies.some(dep => {
            return this.state[dep] !== undefined && 
                   JSON.stringify(this.state[dep]) !== JSON.stringify(selector.lastDependencyValues?.[dep]);
        });
        
        if (shouldRecompute || selector.cachedValue === null) {
            this.recomputeSelector(name);
        }
        
        return selector.cachedValue;
    },
    
    updateSelectors() {
        let recomputedCount = 0;
        for (const [name, selector] of this.selectors) {
            const shouldRecompute = selector.dependencies.some(dep => {
                return this.state[dep] !== undefined;
            });
            
            if (shouldRecompute) {
                this.recomputeSelector(name);
                recomputedCount++;
            }
        }
        
        if (recomputedCount > 0) {
            this.log(`${recomputedCount} selector Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯`);
        }
    },
    
    // ========== Advanced Serialization ==========
    serializeState(options = {}) {
        const { excludeKeys = [], includeKeys = [], maxDepth = 5 } = options;
        
        const serializeValue = (value, depth = 0) => {
            if (depth > maxDepth) {
                return '... (Ø­Ø¯ Ø¹Ù…Ù‚)';
            }
            
            if (value === null || value === undefined) {
                return value;
            }
            
            if (typeof value === 'function') {
                return `[Function: ${value.name || 'Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡'}]`;
            }
            
            if (typeof value === 'symbol') {
                return value.toString();
            }
            
            if (typeof value !== 'object') {
                return value;
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ circular references
            const seen = new WeakSet();
            const checkCircular = (obj, path = []) => {
                if (seen.has(obj)) {
                    return `[Circular Reference: ${path.join('.')}]`;
                }
                seen.add(obj);
                
                if (Array.isArray(obj)) {
                    return obj.map((item, index) => 
                        serializeValue(item, depth + 1)
                    );
                }
                
                const result = {};
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        result[key] = serializeValue(obj[key], depth + 1);
                    }
                }
                return result;
            };
            
            return checkCircular(value);
        };
        
        const filteredState = {};
        for (const key in this.state) {
            if (excludeKeys.includes(key)) continue;
            if (includeKeys.length > 0 && !includeKeys.includes(key)) continue;
            
            filteredState[key] = serializeValue(this.state[key]);
        }
        
        const serialized = JSON.stringify(filteredState, null, 2);
        this.log(`State serialized Ø´Ø¯ (${serialized.length} Ø¨Ø§ÛŒØª)`);
        
        return serialized;
    },
    
    deserializeState(serialized, options = {}) {
        const { merge = true, validate = true } = options;
        
        try {
            const parsed = JSON.parse(serialized);
            
            if (validate) {
                // Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø§ÛŒÙ‡
                if (typeof parsed !== 'object' || parsed === null) {
                    throw new Error('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ serialized Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ù‡Ø³ØªÙ†Ø¯');
                }
            }
            
            if (merge) {
                Object.assign(this.state, parsed);
            } else {
                this.state = parsed;
            }
            
            this.log(`State deserialized Ø´Ø¯ (${Object.keys(parsed).length} Ú©Ù„ÛŒØ¯)`);
            this.updateSelectors();
            this.updatePreview();
            
            return true;
        } catch (error) {
            this.log(`Ø®Ø·Ø§ Ø¯Ø± deserialization: ${error.message}`, 'error');
            return false;
        }
    },
    
    // ========== State Partitioning ==========
    createPartition(name, initialState = {}) {
        if (this.partitions.has(name)) {
            throw new Error(`Partition "${name}" Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯`);
        }
        
        const partition = {
            name,
            state: { ...initialState },
            middlewares: [],
            selectors: new Map(),
            parent: this
        };
        
        this.partitions.set(name, partition);
        this.log(`Partition "${name}" Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯`);
        
        return partition;
    },
    
    getPartition(name) {
        const partition = this.partitions.get(name);
        if (!partition) {
            throw new Error(`Partition "${name}" ÛŒØ§ÙØª Ù†Ø´Ø¯`);
        }
        
        return {
            setState: (key, value) => {
                partition.state[key] = value;
                this.log(`Partition "${name}": "${key}" ØªÙ†Ø¸ÛŒÙ… Ø´Ø¯`);
                this.updatePreview();
                return true;
            },
            getState: (key) => {
                return partition.state[key];
            },
            getFullState: () => {
                return { ...partition.state };
            },
            mergeToGlobal: () => {
                Object.assign(this.state, partition.state);
                this.log(`Partition "${name}" Ø¨Ù‡ Global State Ø§Ø¯ØºØ§Ù… Ø´Ø¯`);
                this.updatePreview();
            }
        };
    },
    
    // ========== History Management ==========
    addToHistory(key, oldValue, newValue) {
        this.stateHistory.push({
            timestamp: Date.now(),
            key,
            oldValue,
            newValue,
            action: 'SET'
        });
        
        // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø§Ù†Ø¯Ø§Ø²Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡
        if (this.stateHistory.length > this.maxHistorySize) {
            this.stateHistory.shift();
        }
    },
    
    getHistory() {
        return [...this.stateHistory];
    },
    
    // ========== Utilities ==========
    log(message, type = 'info') {
        const consoleEl = document.getElementById('console');
        const logEntry = document.createElement('div');
        logEntry.className = 'log';
        
        const prefix = type === 'error' ? '[Ø®Ø·Ø§] ' : 
                      type === 'warning' ? '[Ù‡Ø´Ø¯Ø§Ø±] ' : 
                      type === 'success' ? '[Ù…ÙˆÙÙ‚] ' : '';
        
        logEntry.textContent = `${prefix}${message}`;
        
        if (type === 'error') logEntry.style.color = '#ef9a9a';
        if (type === 'warning') logEntry.style.color = '#fff59d';
        if (type === 'success') logEntry.style.color = '#c5e1a5';
        
        consoleEl.appendChild(logEntry);
        consoleEl.scrollTop = consoleEl.scrollHeight;
        console.log(`[AdvancedState] ${message}`);
    },
    
    updatePreview() {
        const preview = document.getElementById('state-preview');
        const stateSummary = {
            globalKeys: Object.keys(this.state).length,
            partitions: this.partitions.size,
            selectors: this.selectors.size,
            middlewares: this.middlewares.length,
            historySize: this.stateHistory.length
        };
        
        preview.innerHTML = `
            <strong>ğŸ“Š ÙˆØ¶Ø¹ÛŒØª State:</strong><br>
            â€¢ Global Keys: ${stateSummary.globalKeys}<br>
            â€¢ Partitions: ${stateSummary.partitions}<br>
            â€¢ Selectors: ${stateSummary.selectors}<br>
            â€¢ Middlewares: ${stateSummary.middlewares}<br>
            â€¢ History Entries: ${stateSummary.historySize}
        `;
    },
    
    clear() {
        this.state = {};
        this.middlewares = [];
        this.selectors.clear();
        this.partitions.clear();
        this.stateHistory = [];
        this.log("State Manager Ù¾Ø§Ú© Ø´Ø¯");
        this.updatePreview();
    }
};

// ========== ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ==========
const patternTests = [
    {
        id: 'test1',
        name: 'Ø³ÛŒØ³ØªÙ… Middleware',
        run: async () => {
            AdvancedStateManager.log("=== Ø´Ø±ÙˆØ¹ ØªØ³Øª Middleware ===");
            AdvancedStateManager.clear();
            
            // ØªØ¹Ø±ÛŒÙ MiddlewareÙ‡Ø§ÛŒ ØªØ³Øª
            const middleware1 = {
                name: 'ValidationMiddleware',
                async beforeSet(key, value, currentState) {
                    if (key === 'price' && (typeof value !== 'number' || value < 0)) {
                        AdvancedStateManager.log(`Middleware: Ù‚ÛŒÙ…Øª Ù†Ø§Ù…Ø¹ØªØ¨Ø± ${value}`, 'warning');
                        return false; // Ù…Ø³Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù†
                    }
                    return value;
                },
                async afterSet(key, value, oldValue, newState) {
                    if (key === 'price') {
                        AdvancedStateManager.log(`Middleware: Ù‚ÛŒÙ…Øª Ø§Ø² ${oldValue} Ø¨Ù‡ ${value} ØªØºÛŒÛŒØ± Ú©Ø±Ø¯`);
                    }
                }
            };
            
            const middleware2 = {
                name: 'LoggingMiddleware',
                async beforeSet(key, value, currentState) {
                    AdvancedStateManager.log(`Logging: Ø¯Ø±Ø®ÙˆØ§Ø³Øª set Ø¨Ø±Ø§ÛŒ "${key}" Ø¨Ø§ Ù…Ù‚Ø¯Ø§Ø± ${JSON.stringify(value).substring(0, 30)}...`);
                    return value;
                }
            };
            
            // Ø§ÙØ²ÙˆØ¯Ù† MiddlewareÙ‡Ø§
            AdvancedStateManager.addMiddleware(middleware1);
            AdvancedStateManager.addMiddleware(middleware2);
            
            // ØªØ³Øª Û±: set Ù…Ø¹ØªØ¨Ø±
            const result1 = await AdvancedStateManager.setState('price', 100);
            if (!result1) throw new Error('set Ù…Ø¹ØªØ¨Ø± Ø¨Ø§ÛŒØ¯ Ù…ÙˆÙÙ‚ Ù…ÛŒâ€ŒØ´Ø¯');
            
            // ØªØ³Øª Û²: set Ù†Ø§Ù…Ø¹ØªØ¨Ø± (Ø¨Ø§ÛŒØ¯ ØªÙˆØ³Ø· middleware Ù…Ø³Ø¯ÙˆØ¯ Ø´ÙˆØ¯)
            const result2 = await AdvancedStateManager.setState('price', -50);
            if (result2) throw new Error('set Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø¨Ø§ÛŒØ¯ Ù…Ø³Ø¯ÙˆØ¯ Ù…ÛŒâ€ŒØ´Ø¯');
            
            // ØªØ³Øª Û³: set Ù…Ø¹Ù…ÙˆÙ„ÛŒ
            await AdvancedStateManager.setState('product', 'Ú©ØªØ§Ø¨ Ø¢Ù…ÙˆØ²Ø´');
            
            // Ø¨Ø±Ø±Ø³ÛŒ State Ù†Ù‡Ø§ÛŒÛŒ
            if (AdvancedStateManager.state.price !== 100) {
                throw new Error(`Ù‚ÛŒÙ…Øª Ø¨Ø§ÛŒØ¯ 100 Ø¨Ø§Ø´Ø¯ØŒ Ø§Ù…Ø§ ${AdvancedStateManager.state.price} Ø§Ø³Øª`);
            }
            
            return `âœ… Middleware System ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (${AdvancedStateManager.middlewares.length} middleware ÙØ¹Ø§Ù„)`;
        }
    },
    {
        id: 'test2',
        name: 'Ø§Ù„Ú¯ÙˆÛŒ Selector',
        run: async () => {
            AdvancedStateManager.log("=== Ø´Ø±ÙˆØ¹ ØªØ³Øª Selector Pattern ===");
            AdvancedStateManager.clear();
            
            // ØªÙ†Ø¸ÛŒÙ… State Ø§ÙˆÙ„ÛŒÙ‡
            await AdvancedStateManager.setState('cartItems', [
                { id: 1, name: 'Ú©ØªØ§Ø¨', price: 50, quantity: 2 },
                { id: 2, name: 'Ø¯ÙØªØ±', price: 20, quantity: 3 },
                { id: 3, name: 'Ù…Ø¯Ø§Ø¯', price: 5, quantity: 10 }
            ]);
            
            await AdvancedStateManager.setState('discount', 10); // 10% ØªØ®ÙÛŒÙ
            
            // Ø§ÛŒØ¬Ø§Ø¯ SelectorÙ‡Ø§
            const totalPriceSelector = AdvancedStateManager.createSelector(
                'totalPrice',
                ['cartItems', 'discount'],
                (deps) => {
                    const subtotal = deps.cartItems.reduce((sum, item) => 
                        sum + (item.price * item.quantity), 0
                    );
                    const discountAmount = subtotal * (deps.discount / 100);
                    return subtotal - discountAmount;
                }
            );
            
            const itemCountSelector = AdvancedStateManager.createSelector(
                'itemCount',
                ['cartItems'],
                (deps) => deps.cartItems.reduce((sum, item) => sum + item.quantity, 0)
            );
            
            const expensiveItemsSelector = AdvancedStateManager.createSelector(
                'expensiveItems',
                ['cartItems'],
                (deps) => deps.cartItems.filter(item => item.price > 30)
            );
            
            // ØªØ³Øª SelectorÙ‡Ø§
            const totalPrice = AdvancedStateManager.getSelectorValue('totalPrice');
            const expectedTotal = (50*2 + 20*3 + 5*10) * 0.9; // 270 * 0.9 = 243
            if (totalPrice !== expectedTotal) {
                throw new Error(`Ù…Ø­Ø§Ø³Ø¨Ù‡ totalPrice Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª. Ø§Ù†ØªØ¸Ø§Ø±: ${expectedTotal}ØŒ ÙˆØ§Ù‚Ø¹ÛŒ: ${totalPrice}`);
            }
            
            const itemCount = AdvancedStateManager.getSelectorValue('itemCount');
            if (itemCount !== 15) { // 2+3+10
                throw new Error(`itemCount Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª. Ø§Ù†ØªØ¸Ø§Ø±: 15ØŒ ÙˆØ§Ù‚Ø¹ÛŒ: ${itemCount}`);
            }
            
            const expensiveItems = AdvancedStateManager.getSelectorValue('expensiveItems');
            if (expensiveItems.length !== 1 || expensiveItems[0].name !== 'Ú©ØªØ§Ø¨') {
                throw new Error('ÙÛŒÙ„ØªØ± expensiveItems Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª');
            }
            
            // ØªØ³Øª Caching: Selector Ù†Ø¨Ø§ÛŒØ¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´ÙˆØ¯
            const selector = AdvancedStateManager.selectors.get('totalPrice');
            const initialRecomputeCount = selector.recomputeCount;
            
            // ØªØºÛŒÛŒØ± State Ú©Ù‡ Ø¨Ù‡ Selector ÙˆØ§Ø¨Ø³ØªÙ‡ Ù†ÛŒØ³Øª
            await AdvancedStateManager.setState('userName', 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª');
            
            // Selector Ù†Ø¨Ø§ÛŒØ¯ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø´Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
            if (selector.recomputeCount !== initialRecomputeCount) {
                throw new Error('Selector Ø¨Ù‡â€ŒØµÙˆØ±Øª ØºÛŒØ±Ø¶Ø±ÙˆØ±ÛŒ recompute Ø´Ø¯ (Caching Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯)');
            }
            
            // ØªØºÛŒÛŒØ± State ÙˆØ§Ø¨Ø³ØªÙ‡ (Ø¨Ø§ÛŒØ¯ Ø¨Ø§Ø¹Ø« recompute Ø´ÙˆØ¯)
            await AdvancedStateManager.setState('discount', 20);
            if (selector.recomputeCount === initialRecomputeCount) {
                throw new Error('Selector Ø¨Ø¹Ø¯ Ø§Ø² ØªØºÛŒÛŒØ± ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒ recompute Ù†Ø´Ø¯');
            }
            
            const newTotal = AdvancedStateManager.getSelectorValue('totalPrice');
            const expectedNewTotal = (50*2 + 20*3 + 5*10) * 0.8; // 270 * 0.8 = 216
            
            if (Math.abs(newTotal - expectedNewTotal) > 0.01) {
                throw new Error(`Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¬Ø¯ÛŒØ¯ totalPrice Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª. Ø§Ù†ØªØ¸Ø§Ø±: ${expectedNewTotal}ØŒ ÙˆØ§Ù‚Ø¹ÛŒ: ${newTotal}`);
            }
            
            return `âœ… Selector Pattern ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (${AdvancedStateManager.selectors.size} selector Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯)`;
        }
    },
    {
        id: 'test3',
        name: 'Serialization Ù¾ÛŒØ´Ø±ÙØªÙ‡',
        run: async () => {
            AdvancedStateManager.log("=== Ø´Ø±ÙˆØ¹ ØªØ³Øª Serialization Ù¾ÛŒØ´Ø±ÙØªÙ‡ ===");
            AdvancedStateManager.clear();
            
            // Ø§ÛŒØ¬Ø§Ø¯ State Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø¨Ø§ Ø§Ù†ÙˆØ§Ø¹ Ø¯Ø§Ø¯Ù‡ Ù…Ø®ØªÙ„Ù
            const complexState = {
                user: {
                    id: 1,
                    name: 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª',
                    preferences: {
                        theme: 'dark',
                        language: 'fa',
                        notifications: true
                    },
                    // ØªØ§Ø¨Ø¹ (Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ serialize Ø´ÙˆØ¯)
                    greet: function() { return `Ø³Ù„Ø§Ù… ${this.name}`; }
                },
                cart: {
                    items: [
                        { id: 1, name: 'Ù…Ø­ØµÙˆÙ„ Û±', price: 100 },
                        { id: 2, name: 'Ù…Ø­ØµÙˆÙ„ Û²', price: 200 }
                    ],
                    total: 300,
                    // ØªØ§Ø±ÛŒØ®
                    lastUpdated: new Date(),
                    // Map Ùˆ Set
                    metadata: new Map([['key1', 'value1'], ['key2', 'value2']])
                },
                // Circular reference (Ø¨Ø±Ø§ÛŒ ØªØ³Øª)
                circularRef: null
            };
            
            // Ø§ÛŒØ¬Ø§Ø¯ circular reference
            complexState.circularRef = complexState.user;
            
            // ØªÙ†Ø¸ÛŒÙ… State
            AdvancedStateManager.state = complexState;
            
            // ØªØ³Øª Serialization Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø®ØªÙ„Ù
            const serialized1 = AdvancedStateManager.serializeState({
                excludeKeys: ['circularRef'],
                maxDepth: 3
            });
            
            if (!serialized1 || serialized1.length === 0) {
                throw new Error('Serialization Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ serialized
            const parsed1 = JSON.parse(serialized1);
            
            if (!parsed1.user || !parsed1.cart) {
                throw new Error('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù… Ø¯Ø± serialization Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡â€ŒØ§Ù†Ø¯');
            }
            
            if (parsed1.user.greet !== '[Function: greet]') {
                throw new Error('ØªÙˆØ§Ø¨Ø¹ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ serialize Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯');
            }
            
            // ØªØ³Øª Deserialization
            const testState = {
                simpleKey: 'Ù…Ù‚Ø¯Ø§Ø± Ø³Ø§Ø¯Ù‡',
                nested: {
                    level1: {
                        level2: 'Ø¹Ù…ÛŒÙ‚'
                    }
                },
                array: [1, 2, 3]
            };
            
            const serializedTest = JSON.stringify(testState);
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† State ÙØ¹Ù„ÛŒ
            AdvancedStateManager.state = {};
            
            // Deserialize Ø¨Ø§ merge
            const result1 = AdvancedStateManager.deserializeState(serializedTest, { merge: true });
            if (!result1) throw new Error('Deserialization Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
            
            if (AdvancedStateManager.state.simpleKey !== 'Ù…Ù‚Ø¯Ø§Ø± Ø³Ø§Ø¯Ù‡') {
                throw new Error('Deserialization Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù†Ú©Ø±Ø¯');
            }
            
            // Deserialize Ø¨Ø§ replace
            const newState = {
                completelyNew: 'Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯'
            };
            const serializedNew = JSON.stringify(newState);
            
            const result2 = AdvancedStateManager.deserializeState(serializedNew, { merge: false });
            if (!result2) throw new Error('Deserialization Ø¨Ø§ replace Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯');
            
            if (AdvancedStateManager.state.simpleKey !== undefined) {
                throw new Error('Deserialization Ø¨Ø§ replace State Ù‚Ø¯ÛŒÙ…ÛŒ Ø±Ø§ Ù¾Ø§Ú© Ù†Ú©Ø±Ø¯');
            }
            
            if (AdvancedStateManager.state.completelyNew !== 'Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯') {
                throw new Error('Deserialization Ø¨Ø§ replace Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ù†Ú©Ø±Ø¯');
            }
            
            // ØªØ³Øª serialization Ø¨Ø§ includeKeys
            AdvancedStateManager.state = {
                key1: 'value1',
                key2: 'value2',
                key3: 'value3'
            };
            
            const selectiveSerialized = AdvancedStateManager.serializeState({
                includeKeys: ['key1', 'key3']
            });
            
            const selectiveParsed = JSON.parse(selectiveSerialized);
            if (selectiveParsed.key2 !== undefined) {
                throw new Error('includeKeys Ú©Ø§Ø± Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯');
            }
            
            AdvancedStateManager.log(`Serialization Ù…ÙˆÙÙ‚: ${serialized1.length} Ø¨Ø§ÛŒØª`, 'success');
            
            return `âœ… Serialization Ù¾ÛŒØ´Ø±ÙØªÙ‡ ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Circular refs, Functions, Selective)`;
        }
    },
    {
        id: 'test4',
        name: 'Partitioning State',
        run: async () => {
            AdvancedStateManager.log("=== Ø´Ø±ÙˆØ¹ ØªØ³Øª State Partitioning ===");
            AdvancedStateManager.clear();
            
            // Ø§ÛŒØ¬Ø§Ø¯ Partitions Ù…Ø®ØªÙ„Ù
            const authPartition = AdvancedStateManager.createPartition('auth', {
                user: null,
                token: null,
                isLoggedIn: false
            });
            
            const uiPartition = AdvancedStateManager.createPartition('ui', {
                theme: 'light',
                language: 'fa',
                sidebarOpen: true
            });
            
            const cartPartition = AdvancedStateManager.createPartition('cart', {
                items: [],
                total: 0,
                isLoading: false
            });
            
            // Ú©Ø§Ø± Ø¨Ø§ PartitionÙ‡Ø§
            const auth = AdvancedStateManager.getPartition('auth');
            const ui = AdvancedStateManager.getPartition('ui');
            const cart = AdvancedStateManager.getPartition('cart');
            
            // ØªÙ†Ø¸ÛŒÙ… Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¯Ø± PartitionÙ‡Ø§
            auth.setState('user', { id: 1, name: 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª' });
            auth.setState('token', 'abc123');
            auth.setState('isLoggedIn', true);
            
            ui.setState('theme', 'dark');
            ui.setState('language', 'en');
            ui.setState('sidebarOpen', false);
            
            cart.setState('items', [
                { id: 1, name: 'Ú©ØªØ§Ø¨', price: 50, quantity: 2 }
            ]);
            cart.setState('total', 100);
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¬Ø¯Ø§ÛŒÛŒ PartitionÙ‡Ø§
            if (AdvancedStateManager.state.user !== undefined) {
                throw new Error('Partition auth Ù†Ø¨Ø§ÛŒØ¯ Ø¯Ø± Global State Ø¨Ø§Ø´Ø¯');
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ù‚Ø§Ø¯ÛŒØ± PartitionÙ‡Ø§
            const authState = auth.getFullState();
            if (!authState.isLoggedIn || authState.user.name !== 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª') {
                throw new Error('Ù…Ù‚Ø§Ø¯ÛŒØ± Partition auth Ø§Ø´ØªØ¨Ø§Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯');
            }
            
            const uiState = ui.getFullState();
            if (uiState.theme !== 'dark' || uiState.language !== 'en') {
                throw new Error('Ù…Ù‚Ø§Ø¯ÛŒØ± Partition ui Ø§Ø´ØªØ¨Ø§Ù‡ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯');
            }
            
            // ØªØ³Øª Ø§Ø¯ØºØ§Ù… Partition Ø¨Ù‡ Global
            const initialGlobalKeys = Object.keys(AdvancedStateManager.state).length;
            auth.mergeToGlobal();
            
            if (Object.keys(AdvancedStateManager.state).length === initialGlobalKeys) {
                throw new Error('Ø§Ø¯ØºØ§Ù… Partition Ø¨Ù‡ Global Ú©Ø§Ø± Ù†Ú©Ø±Ø¯');
            }
            
            if (AdvancedStateManager.state.user?.name !== 'Ú©Ø§Ø±Ø¨Ø± ØªØ³Øª') {
                throw new Error('Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Partition Ù¾Ø³ Ø§Ø² Ø§Ø¯ØºØ§Ù… Ø¯Ø± Global Ù†ÛŒØ³ØªÙ†Ø¯');
            }
            
            // ØªØ³Øª Ø§ÛŒØ¬Ø§Ø¯ Partition ØªÚ©Ø±Ø§Ø±ÛŒ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¯Ù‡Ø¯)
            let duplicateError = null;
            try {
                AdvancedStateManager.createPartition('auth', {});
            } catch (error) {
                duplicateError = error.message;
            }
            
            if (!duplicateError || !duplicateError.includes('Ø§Ø² Ù‚Ø¨Ù„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯')) {
                throw new Error('Ø§ÛŒØ¬Ø§Ø¯ Partition ØªÚ©Ø±Ø§Ø±ÛŒ Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
            }
            
            // ØªØ³Øª Partition Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ (Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ø¯Ù‡Ø¯)
            let notFoundError = null;
            try {
                AdvancedStateManager.getPartition('nonexistent');
            } catch (error) {
                notFoundError = error.message;
            }
            
            if (!notFoundError || !notFoundError.includes('ÛŒØ§ÙØª Ù†Ø´Ø¯')) {
                throw new Error('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Partition Ù†Ø§Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ø§Ø¯');
            }
            
            AdvancedStateManager.log(`Ø§ÛŒØ¬Ø§Ø¯ ${AdvancedStateManager.partitions.size} Partition Ù…ÙˆÙÙ‚`, 'success');
            
            return `âœ… State Partitioning ØµØ­ÛŒØ­ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ø§ÛŒØ²ÙˆÙ„Ù‡â€ŒØ³Ø§Ø²ÛŒ + Ø§Ø¯ØºØ§Ù…)`;
        }
    }
];

// ========== Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ ==========
async function runAllPatternTests() {
    const runBtn = document.getElementById('run-btn');
    runBtn.disabled = true;
    runBtn.textContent = 'â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡...';
    
    // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ú©Ù†Ø³ÙˆÙ„
    document.getElementById('console').innerHTML = '<div class="log">[Ø³ÛŒØ³ØªÙ…] ØªØ³Øª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ State Management Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª</div>';
    
    AdvancedStateManager.log("=== Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ===");
    
    let passed = 0;
    
    for (let i = 0; i < patternTests.length; i++) {
        const test = patternTests[i];
        const testElement = document.getElementById(test.id);
        const statusElement = document.getElementById(`status${i+1}`);
        const outputElement = document.getElementById(`output${i+1}`);
        
        // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø¨Ù‡ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§
        testElement.className = 'test-item running';
        statusElement.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§';
        statusElement.className = 'test-status status-running';
        outputElement.innerHTML = '<span style="color:#666">Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ...</span>';
        
        try {
            AdvancedStateManager.log(`Ø´Ø±ÙˆØ¹ ØªØ³Øª: ${test.name}`);
            
            // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Ù‡Ø± ØªØ³Øª
            AdvancedStateManager.clear();
            
            const result = await test.run();
            
            // ØªØ³Øª Ù…ÙˆÙÙ‚
            testElement.className = 'test-item passed';
            statusElement.textContent = 'Ù…ÙˆÙÙ‚';
            statusElement.className = 'test-status status-passed';
            outputElement.innerHTML = `<div style="color:#2e7d32">${result}</div>`;
            passed++;
            
            AdvancedStateManager.log(`ØªØ³Øª "${test.name}" Ù…ÙˆÙÙ‚`, 'success');
            
        } catch (error) {
            // ØªØ³Øª Ù†Ø§Ù…ÙˆÙÙ‚
            testElement.className = 'test-item failed';
            statusElement.textContent = 'Ù†Ø§Ù…ÙˆÙÙ‚';
            statusElement.className = 'test-status status-failed';
            outputElement.innerHTML = `<div style="color:#c62828"><strong>âŒ Ø®Ø·Ø§:</strong> ${error.message}</div>`;
            
            AdvancedStateManager.log(`ØªØ³Øª "${test.name}" Ù†Ø§Ù…ÙˆÙÙ‚: ${error.message}`, 'error');
        }
        
        // ØªØ§Ø®ÛŒØ± Ú©ÙˆØªØ§Ù‡ Ø¨ÛŒÙ† ØªØ³Øªâ€ŒÙ‡Ø§
        await new Promise(resolve => setTimeout(resolve, 500));
    }
    
    runBtn.disabled = false;
    runBtn.textContent = `ğŸ”„ Ø§Ø¬Ø±Ø§ÛŒ Ù…Ø¬Ø¯Ø¯ (${passed}/${patternTests.length} Ù…ÙˆÙÙ‚)`;
    
    // Ù†Ù…Ø§ÛŒØ´ Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
    if (passed === patternTests.length) {
        AdvancedStateManager.log("ğŸ‰ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø´Øª Ø³Ø± Ú¯Ø°Ø§Ø´ØªÙ‡ Ø´Ø¯Ù†Ø¯!", 'success');
        AdvancedStateManager.log("âœ… State Manager Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.", 'success');
    } else {
        AdvancedStateManager.log(`ØªØ³Øªâ€ŒÙ‡Ø§ Ú©Ø§Ù…Ù„ Ø´Ø¯Ù†Ø¯: ${passed} Ø§Ø² ${patternTests.length} Ù…ÙˆÙÙ‚`, 
                               passed >= 3 ? 'success' : 'warning');
    }
}

// ========== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ==========
document.addEventListener('DOMContentLoaded', () => {
    // Ø§ØªØµØ§Ù„ Ø¯Ú©Ù…Ù‡ Ø§ØµÙ„ÛŒ
    document.getElementById('run-btn').addEventListener('click', runAllPatternTests);
    
    AdvancedStateManager.log("Ø³ÛŒØ³ØªÙ… ØªØ³Øª Ø§Ù„Ú¯ÙˆÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ State Management Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª.");
    AdvancedStateManager.log("Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ 'Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§' Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.");
    AdvancedStateManager.updatePreview();
});
</script>
</body>
</html>
