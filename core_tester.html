<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³ØªØ± Ù‡Ø³ØªÙ‡ Vakamova</title>
    <style>
        body { font-family: Vazirmatn, sans-serif; padding: 20px; background: #f5f5f5; }
        .tester { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 800px; margin: 0 auto; }
        h1 { color: #0d7377; text-align: center; margin-bottom: 25px; }
        .file-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-bottom: 25px; }
        .file-item { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 2px solid #dee2e6; text-align: center; cursor: pointer; transition: all 0.3s; }
        .file-item:hover { background: #e9ecef; border-color: #0d7377; }
        .file-item.testing { background: #fff3cd; border-color: #ffc107; }
        .file-item.success { background: #d1e7dd; border-color: #198754; }
        .file-item.error { background: #f8d7da; border-color: #dc3545; }
        .controls { display: flex; gap: 10px; justify-content: center; margin: 25px 0; flex-wrap: wrap; }
        button { padding: 12px 24px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        #runAll { background: #0d7377; color: white; }
        #runAll:hover { background: #095c5f; }
        #runSelected { background: #6f42c1; color: white; }
        #runSelected:hover { background: #5a32a3; }
        #clearLogs { background: #6c757d; color: white; }
        #clearLogs:hover { background: #545b62; }
        select { padding: 12px; border-radius: 6px; border: 2px solid #ced4da; min-width: 250px; font-family: inherit; }
        .log-container { background: #1a1a1a; color: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px; max-height: 400px; overflow-y: auto; font-family: monospace; }
        .log-entry { padding: 8px; border-bottom: 1px solid #333; }
        .log-entry.success { color: #4CAF50; }
        .log-entry.error { color: #ff5252; }
        .log-entry.info { color: #64b5f6; }
        .summary { display: flex; justify-content: space-around; margin-top: 20px; padding: 15px; background: #e9ecef; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="tester">
        <h1>ğŸ§ª ØªØ³ØªØ± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø³ØªÙ‡ Vakamova</h1>
        
        <div class="controls">
            <button id="runAll">â–¶ï¸ ØªØ³Øª Ù‡Ù…Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§</button>
            <select id="fileSelect">
                <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ ØªØ³Øª ØªÚ©ÛŒ --</option>
            </select>
            <button id="runSelected">ğŸš€ ØªØ³Øª ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡</button>
            <button id="clearLogs">ğŸ—‘ï¸ Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù„Ø§Ú¯â€ŒÙ‡Ø§</button>
        </div>
        
        <div class="file-list" id="fileList">
            <!-- ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù¾ÙˆÛŒØ§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
        
        <div class="summary">
            <div>Ú©Ù„: <span id="totalCount">0</span></div>
            <div style="color: #4CAF50;">Ù…ÙˆÙÙ‚: <span id="successCount">0</span></div>
            <div style="color: #dc3545;">Ù†Ø§Ù…ÙˆÙÙ‚: <span id="errorCount">0</span></div>
            <div>Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª: <span id="testingCount">0</span></div>
        </div>
        
        <h3>ğŸ“œ Ú¯Ø²Ø§Ø±Ø´ Ø§Ø¬Ø±Ø§:</h3>
        <div class="log-container" id="logContainer"></div>
    </div>
    
    <script>
        const CORE_FILES = [
            { name: 'event_bus.js', path: './core/event_bus.js', testFn: testEventBus },
            { name: 'context_provider.js', path: './core/context_provider.js', testFn: testContextProvider },
            { name: 'config.js', path: './core/config.js', testFn: testConfig },
            { name: 'db.js', path: './core/db.js', testFn: testDatabase },
            { name: 'api.js', path: './core/api.js', testFn: testApi },
            { name: 'api_client.js', path: './core/api_client.js', testFn: testApiClient },
            { name: 'font_manager.js', path: './core/font_manager.js', testFn: testFontManager },
            { name: 'route_guards.js', path: './core/route_guards.js', testFn: testRouteGuards },
            { name: 'router.js', path: './core/router.js', testFn: testRouter },
            { name: 'router_middleware.js', path: './core/router_middleware.js', testFn: testRouterMiddleware },
            { name: 'state.js', path: './core/state.js', testFn: testState },
            { name: 'state_manager.js', path: './core/state_manager.js', testFn: testStateManager },
            { name: 'utils.js', path: './core/utils.js', testFn: testUtils }
        ];

        let testResults = { total: 0, success: 0, error: 0, testing: 0 };
        const loadedModules = new Map();

        function initializeUI() {
            const fileList = document.getElementById('fileList');
            const fileSelect = document.getElementById('fileSelect');
            
            CORE_FILES.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.id = `file-${file.name.replace('.', '-')}`;
                fileItem.innerHTML = `
                    <div class="file-name">ğŸ“„ ${file.name}</div>
                    <div class="file-status">â³ Ù…Ù†ØªØ¸Ø±</div>
                `;
                fileList.appendChild(fileItem);
                
                const option = document.createElement('option');
                option.value = file.path;
                option.textContent = file.name;
                fileSelect.appendChild(option);
            });
            updateSummary();
        }

        async function loadAndTestFile(fileInfo) {
            const fileElement = document.getElementById(`file-${fileInfo.name.replace('.', '-')}`);
            fileElement.className = 'file-item testing';
            fileElement.querySelector('.file-status').textContent = 'ğŸ” Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...';
            testResults.testing++;
            updateSummary();
            
            log(`Ø´Ø±ÙˆØ¹ ØªØ³Øª: ${fileInfo.name}`, 'info');
            
            try {
                const module = await loadModule(fileInfo.path);
                loadedModules.set(fileInfo.name, module);
                
                if (fileInfo.testFn) {
                    await fileInfo.testFn(module);
                } else {
                    await basicModuleTest(module, fileInfo.name);
                }
                
                fileElement.className = 'file-item success';
                fileElement.querySelector('.file-status').textContent = 'âœ… Ù…ÙˆÙÙ‚';
                testResults.success++;
                log(`ØªØ³Øª ${fileInfo.name} Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú¯Ø°Ø±Ø§Ù†Ø¯Ù‡ Ø´Ø¯`, 'success');
            } catch (error) {
                fileElement.className = 'file-item error';
                fileElement.querySelector('.file-status').textContent = 'âŒ Ø®Ø·Ø§';
                testResults.error++;
                log(`Ø®Ø·Ø§ Ø¯Ø± ${fileInfo.name}: ${error.message}`, 'error');
                console.error(error);
            } finally {
                testResults.testing--;
                testResults.total++;
                updateSummary();
            }
        }

        async function loadModule(path) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = path;
                script.type = 'module';
                
                script.onload = () => {
                    const moduleName = path.split('/').pop().replace('.js', '');
                    const module = window[moduleName] || window[moduleName.replace(/_/g, '')] || window[moduleName.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join('')];
                    resolve(module || {});
                };
                
                script.onerror = () => reject(new Error(`Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ${path} Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯`));
                document.head.appendChild(script);
            });
        }

        async function basicModuleTest(module, name) {
            if (typeof module === 'object' && Object.keys(module).length > 0) {
                return true;
            }
            throw new Error('Ù…Ø§Ú˜ÙˆÙ„ Ø®Ø§Ù„ÛŒ ÛŒØ§ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
        }

        async function testEventBus(module) {
            if (!module || !module.emit) {
                throw new Error('EventBus Ø¯Ø§Ø±Ø§ÛŒ Ù…ØªØ¯ emit Ù†ÛŒØ³Øª');
            }
            module.emit('test', { message: 'ØªØ³Øª EventBus' });
            return true;
        }

        async function testContextProvider(module) {
            if (!module || !module.register) {
                throw new Error('ContextProvider Ø¯Ø§Ø±Ø§ÛŒ Ù…ØªØ¯ register Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testDatabase(module) {
            if (!module) {
                throw new Error('Ù…Ø§Ú˜ÙˆÙ„ database Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯');
            }
            return true;
        }

        async function testApi(module) {
            if (!module) {
                throw new Error('Ù…Ø§Ú˜ÙˆÙ„ api Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø´Ø¯');
            }
            return true;
        }

        async function testApiClient(module) {
            if (!module || typeof module !== 'function') {
                throw new Error('ApiClient ÛŒÚ© ØªØ§Ø¨Ø¹ Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testRouter(module) {
            if (!module || !module.navigate) {
                throw new Error('Router Ø¯Ø§Ø±Ø§ÛŒ Ù…ØªØ¯ navigate Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testState(module) {
            if (!module || !module.set) {
                throw new Error('State Ø¯Ø§Ø±Ø§ÛŒ Ù…ØªØ¯ set Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testStateManager(module) {
            if (!module || typeof module !== 'function') {
                throw new Error('StateManager ÛŒÚ© ØªØ§Ø¨Ø¹ Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testUtils(module) {
            if (!module || typeof module !== 'object') {
                throw new Error('Utils ÛŒÚ© Ø¢Ø¨Ø¬Ú©Øª Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testConfig(module) {
            if (!module || typeof module !== 'object') {
                throw new Error('Config ÛŒÚ© Ø¢Ø¨Ø¬Ú©Øª Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testFontManager(module) {
            if (!module || !module.loadFont) {
                throw new Error('FontManager Ø¯Ø§Ø±Ø§ÛŒ Ù…ØªØ¯ loadFont Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testRouteGuards(module) {
            if (!module || !module.checkAccess) {
                throw new Error('RouteGuards Ø¯Ø§Ø±Ø§ÛŒ Ù…ØªØ¯ checkAccess Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function testRouterMiddleware(module) {
            if (!module || !module.process) {
                throw new Error('RouterMiddleware Ø¯Ø§Ø±Ø§ÛŒ Ù…ØªØ¯ process Ù†ÛŒØ³Øª');
            }
            return true;
        }

        async function runAllTests() {
            testResults = { total: 0, success: 0, error: 0, testing: 0 };
            document.querySelectorAll('.file-item').forEach(item => {
                item.className = 'file-item';
                item.querySelector('.file-status').textContent = 'â³ Ù…Ù†ØªØ¸Ø±';
            });
            log('Ø´Ø±ÙˆØ¹ ØªØ³Øª Ú©Ù„ÛŒÙ‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‡Ø³ØªÙ‡...', 'info');
            
            for (const file of CORE_FILES) {
                await loadAndTestFile(file);
                await new Promise(resolve => setTimeout(resolve, 300));
            }
            
            log(`âœ… ØªØ³Øª Ú©Ù„ÛŒÙ‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯. Ù…ÙˆÙÙ‚: ${testResults.success}, Ù†Ø§Ù…ÙˆÙÙ‚: ${testResults.error}`, 
                testResults.error === 0 ? 'success' : 'error');
        }

        async function runSelectedTest() {
            const select = document.getElementById('fileSelect');
            const selectedPath = select.value;
            if (!selectedPath) {
                log('Ù„Ø·ÙØ§Ù‹ ÛŒÚ© ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯', 'error');
                return;
            }
            
            const fileInfo = CORE_FILES.find(f => f.path === selectedPath);
            if (fileInfo) {
                await loadAndTestFile(fileInfo);
            }
        }

        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString('fa-IR')}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${type}] ${message}`);
        }

        function updateSummary() {
            document.getElementById('totalCount').textContent = testResults.total;
            document.getElementById('successCount').textContent = testResults.success;
            document.getElementById('errorCount').textContent = testResults.error;
            document.getElementById('testingCount').textContent = testResults.testing;
        }

        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            log('Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø´Ø¯Ù†Ø¯', 'info');
        }

        document.getElementById('runAll').addEventListener('click', runAllTests);
        document.getElementById('runSelected').addEventListener('click', runSelectedTest);
        document.getElementById('clearLogs').addEventListener('click', clearLogs);

        document.addEventListener('DOMContentLoaded', initializeUI);
    </script>
</body>
</html>
