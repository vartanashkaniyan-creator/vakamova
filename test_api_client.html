<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª API Client - Vakamova</title>
    <style>
        body { font-family: Tahoma; max-width: 1000px; margin: 20px auto; padding: 20px; background: #f5f7fa; }
        .test-case { background: white; padding: 15px; margin: 15px 0; border-radius: 8px; border-right: 5px solid #3498db; }
        .success { color: #27ae60; background: #eafaf1; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .error { color: #c0392b; background: #fdedec; padding: 10px; margin: 5px 0; border-radius: 4px; }
        button { background: linear-gradient(to left, #3498db, #9b59b6); color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        .mock-server { background: #fff3cd; padding: 15px; border-radius: 6px; border: 2px dashed #ffc107; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª API Client</h1>
    
    <div class="mock-server">
        <h3>ğŸ–¥ Mock Server Configuration</h3>
        <p><strong>Base URL:</strong> https://api.vakamova.test</p>
        <p><strong>Endpoints:</strong></p>
        <ul>
            <li>GET /lessons â†’ 200 OK (with data)</li>
            <li>POST /lessons â†’ 201 Created</li>
            <li>GET /protected â†’ 401 then 200 (token refresh)</li>
            <li>GET /error â†’ 500 Server Error (with retry)</li>
            <li>GET /slow â†’ 200 (slow response, timeout test)</li>
        </ul>
    </div>
    
    <button onclick="runAllTests()">Ø´Ø±ÙˆØ¹ ØªØ³Øª Ú©Ø§Ù…Ù„</button>
    <button onclick="runQuickTest()">ØªØ³Øª Ø³Ø±ÛŒØ¹</button>
    <button onclick="clearResults()">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù†ØªØ§ÛŒØ¬</button>
    
    <div id="results"></div>

    <script>
        // ==================== Mock ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ ====================
        const mockDependencies = {
            authManager: {
                getToken: () => localStorage.getItem('test_token') || 'initial_token_123',
                setToken: (token) => localStorage.setItem('test_token', token),
                clearToken: () => localStorage.removeItem('test_token')
            },
            offlineQueue: {
                add: async (request) => {
                    console.log('ğŸ“¦ Added to offline queue:', request);
                    return { queueId: 'offline_' + Date.now(), ...request };
                },
                processAll: async () => console.log('Processing offline queue')
            },
            logger: {
                info: (msg, data) => console.log('â„¹ï¸', msg, data || ''),
                debug: (msg, data) => console.log('ğŸ”', msg, data || ''),
                warn: (msg, data) => console.log('âš ï¸', msg, data || ''),
                error: (msg, data) => console.error('âŒ', msg, data || '')
            },
            config: {
                baseURL: 'https://api.vakamova.test/v1',
                appVersion: '1.0.0'
            }
        };

        // ==================== Mock fetch API ====================
        const originalFetch = window.fetch;
        let fetchCallCount = 0;
        const mockResponses = new Map();
        
        // Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ mock
        mockResponses.set('GET:/lessons', {
            status: 200,
            data: { 
                lessons: [
                    { id: 1, title: 'Ù…Ú©Ø§Ù„Ù…Ù‡ Ù…Ù‚Ø¯Ù…Ø§ØªÛŒ', duration: '15 Ø¯Ù‚ÛŒÙ‚Ù‡' },
                    { id: 2, title: 'Ú¯Ø±Ø§Ù…Ø± Ø²Ù…Ø§Ù† Ø­Ø§Ù„', duration: '20 Ø¯Ù‚ÛŒÙ‚Ù‡' }
                ],
                total: 10
            },
            delay: 100
        });
        
        mockResponses.set('POST:/lessons', {
            status: 201,
            data: { id: 100, title: 'Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯', created: true },
            delay: 150
        });
        
        mockResponses.set('GET:/protected', {
            status: 401,
            data: { error: 'Token expired' },
            delay: 100,
            callsBeforeSuccess: 1 // Ø§ÙˆÙ„ 401 Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŒ Ø¨Ø¹Ø¯ 200
        });
        
        mockResponses.set('GET:/error', {
            status: 500,
            data: { error: 'Internal Server Error' },
            delay: 200,
            maxRetries: 2 // Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø¨Ø§Ø± 200 Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
        });
        
        mockResponses.set('GET:/slow', {
            status: 200,
            data: { message: 'Slow response completed' },
            delay: 2000 // Ù¾Ø§Ø³Ø® Ú©Ù†Ø¯
        });
        
        // ØªØ§Ø¨Ø¹ mock fetch
        window.fetch = async function(url, options = {}) {
            fetchCallCount++;
            const method = options.method || 'GET';
            const endpoint = url.replace('https://api.vakamova.test/v1', '');
            const key = `${method}:${endpoint}`;
            
            console.log(`ğŸ”— Fetch #${fetchCallCount}: ${method} ${endpoint}`);
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡
            if (sessionStorage.getItem('simulateNetworkError') === 'true') {
                await new Promise(resolve => setTimeout(resolve, 50));
                throw new TypeError('Failed to fetch');
            }
            
            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù¾Ø§Ø³Ø® mock
            let responseConfig = mockResponses.get(key);
            
            // Ø§Ú¯Ø± Ù¾Ø§Ø³Ø® Ø®Ø§ØµÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡ØŒ Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´â€ŒÙØ±Ø¶
            if (!responseConfig) {
                responseConfig = {
                    status: 200,
                    data: { message: 'Default mock response', url, method },
                    delay: 50
                };
            }
            
            // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ ØªØ§Ø®ÛŒØ±
            await new Promise(resolve => setTimeout(resolve, responseConfig.delay));
            
            // Ù…Ø¯ÛŒØ±ÛŒØª Ø­Ø§Ù„Ø§Øª Ø®Ø§Øµ
            if (key === 'GET:/protected') {
                const callCount = parseInt(sessionStorage.getItem('protected_calls') || '0');
                sessionStorage.setItem('protected_calls', (callCount + 1).toString());
                
                if (callCount === 0) {
                    // Ø¨Ø§Ø± Ø§ÙˆÙ„ 401 Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
                    return {
                        ok: false,
                        status: 401,
                        headers: { get: () => 'application/json' },
                        json: async () => responseConfig.data
                    };
                }
                // Ø¨Ø§Ø± Ø¯ÙˆÙ… 200 Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
                responseConfig.status = 200;
                responseConfig.data = { message: 'Protected data', access: 'granted' };
            }
            
            if (key === 'GET:/error') {
                const errorCount = parseInt(sessionStorage.getItem('error_calls') || '0');
                sessionStorage.setItem('error_calls', (errorCount + 1).toString());
                
                if (errorCount < 2) {
                    return {
                        ok: false,
                        status: 500,
                        headers: { get: () => 'application/json' },
                        json: async () => responseConfig.data
                    };
                }
                // Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø¨Ø§Ø± Ø®Ø·Ø§ØŒ Ù…ÙˆÙÙ‚ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                responseConfig.status = 200;
                responseConfig.data = { message: 'Recovered after retry' };
            }
            
            // Ø¨Ø§Ø²Ú¯ÙˆØ±Ø¯Ù† Ù¾Ø§Ø³Ø® mock
            return {
                ok: responseConfig.status >= 200 && responseConfig.status < 300,
                status: responseConfig.status,
                statusText: responseConfig.status === 200 ? 'OK' : 'Error',
                headers: {
                    get: (headerName) => {
                        const headers = {
                            'content-type': 'application/json',
                            'x-request-id': 'mock_' + Date.now()
                        };
                        return headers[headerName.toLowerCase()];
                    }
                },
                json: async () => responseConfig.data,
                text: async () => JSON.stringify(responseConfig.data)
            };
        };

        // ==================== API Client Implementation ====================
        class APIClient {
            constructor(dependencies) {
                this.authManager = dependencies.authManager;
                this.offlineQueue = dependencies.offlineQueue;
                this.logger = dependencies.logger;
                this.config = dependencies.config;
                this.baseURL = this.config.baseURL;
                this.defaultHeaders = {
                    'Content-Type': 'application/json',
                    'Accept': 'application/json',
                    'X-App-Version': this.config.appVersion
                };
                this.cache = new Map();
                this.maxRetries = 3;
                this.tokenRefresher = null;
            }
            
            setHeaders(headers) {
                this.defaultHeaders = { ...this.defaultHeaders, ...headers };
            }
            
            async get(endpoint, params = {}, options = {}) {
                return this.request('GET', endpoint, null, params, options);
            }
            
            async post(endpoint, data = {}, options = {}) {
                return this.request('POST', endpoint, data, {}, options);
            }
            
            async put(endpoint, data = {}, options = {}) {
                return this.request('PUT', endpoint, data, {}, options);
            }
            
            async delete(endpoint, options = {}) {
                return this.request('DELETE', endpoint, null, {}, options);
            }
            
            async request(method, endpoint, data = null, params = {}, options = {}) {
                // Ø³Ø§Ø®Øª URL
                let url = `${this.baseURL}${endpoint}`;
                if (Object.keys(params).length > 0) {
                    url += '?' + new URLSearchParams(params).toString();
                }
                
                // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø±Ø®ÙˆØ§Ø³Øª
                const requestOptions = {
                    method,
                    headers: { ...this.defaultHeaders, ...options.headers },
                    ...options
                };
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù†
                const token = this.authManager.getToken();
                if (token) {
                    requestOptions.headers.Authorization = `Bearer ${token}`;
                }
                
                // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† body Ø¨Ø±Ø§ÛŒ POST/PUT
                if (data && (method === 'POST' || method === 'PUT')) {
                    requestOptions.body = JSON.stringify(data);
                }
                
                // Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
                if (!navigator.onLine && this.offlineQueue) {
                    this.logger.warn('Device offline, queuing request', { endpoint });
                    return this.offlineQueue.add({
                        method, endpoint, data, params,
                        timestamp: new Date().toISOString()
                    });
                }
                
                // Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø§ retry
                return this.fetchWithRetry(url, requestOptions, options);
            }
            
            async fetchWithRetry(url, options, requestOptions, retryCount = 0) {
                try {
                    const response = await fetch(url, options);
                    
                    // Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ÛŒ 401 Ùˆ Ø¨Ø§Ø²Ø¢ÙˆØ±ÛŒ ØªÙˆÚ©Ù†
                    if (response.status === 401 && this.tokenRefresher) {
                        await this.tokenRefresher();
                        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ØªÙˆÚ©Ù† Ø¬Ø¯ÛŒØ¯
                        const newToken = this.authManager.getToken();
                        options.headers.Authorization = `Bearer ${newToken}`;
                        // Ø§Ø±Ø³Ø§Ù„ Ù…Ø¬Ø¯Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
                        return this.fetchWithRetry(url, options, requestOptions, retryCount);
                    }
                    
                    // retry Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø³Ø±ÙˆØ±
                    if (response.status >= 500 && retryCount < this.maxRetries) {
                        await this.delay(1000 * (retryCount + 1));
                        return this.fetchWithRetry(url, options, requestOptions, retryCount + 1);
                    }
                    
                    // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾Ø§Ø³Ø®
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw {
                            status: response.status,
                            message: errorData.error || 'API Error',
                            data: errorData
                        };
                    }
                    
                    return response.json();
                    
                } catch (error) {
                    // retry Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡
                    if (retryCount < this.maxRetries && error instanceof TypeError) {
                        await this.delay(1000 * (retryCount + 1));
                        return this.fetchWithRetry(url, options, requestOptions, retryCount + 1);
                    }
                    throw error;
                }
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            
            setTokenRefresher(refresher) {
                this.tokenRefresher = refresher;
            }
        }

        // ==================== ØªØ³Øªâ€ŒÙ‡Ø§ ====================
        async function runAllTests() {
            clearResults();
            addResult('ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ³Øª Ú©Ø§Ù…Ù„ API Client', 'info');
            
            try {
                // Ø§ÛŒØ¬Ø§Ø¯ Ù†Ù…ÙˆÙ†Ù‡ API Client
                const apiClient = new APIClient(mockDependencies);
                addResult('âœ… API Client Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯', 'success');
                
                // 1. ØªØ³Øª GET Ø³Ø§Ø¯Ù‡
                addResult('1. ØªØ³Øª GET /lessons', 'info');
                try {
                    const lessons = await apiClient.get('/lessons', { page: 1, limit: 10 });
                    addResult(`   âœ… Ø¯Ø±ÛŒØ§ÙØª ${lessons.lessons?.length || 0} Ø¯Ø±Ø³`, 'success');
                } catch (error) {
                    addResult(`   âŒ Ø®Ø·Ø§ Ø¯Ø± GET: ${error.message}`, 'error');
                }
                
                // 2. ØªØ³Øª POST Ø¨Ø§ Ø¯Ø§Ø¯Ù‡
                addResult('2. ØªØ³Øª POST /lessons', 'info');
                try {
                    const newLesson = {
                        title: 'Ø¯Ø±Ø³ ØªØ³Øª Ø¬Ø¯ÛŒØ¯',
                        description: 'Ø§ÛŒÙ† ÛŒÚ© Ø¯Ø±Ø³ ØªØ³Øª Ø§Ø³Øª',
                        difficulty: 'beginner'
                    };
                    const result = await apiClient.post('/lessons', newLesson);
                    addResult(`   âœ… Ø¯Ø±Ø³ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯: ${result.id}`, 'success');
                } catch (error) {
                    addResult(`   âŒ Ø®Ø·Ø§ Ø¯Ø± POST: ${error.message}`, 'error');
                }
                
                // 3. ØªØ³Øª Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÚ©Ù† (401 â†’ refresh â†’ 200)
                addResult('3. ØªØ³Øª Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÚ©Ù† Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡', 'info');
                try {
                    // ØªÙ†Ø¸ÛŒÙ… token refresher
                    apiClient.setTokenRefresher(async () => {
                        addResult('   ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²Ø¢ÙˆØ±ÛŒ ØªÙˆÚ©Ù†...', 'info');
                        mockDependencies.authManager.setToken('refreshed_token_' + Date.now());
                        await apiClient.delay(500);
                    });
                    
                    // Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡
                    sessionStorage.setItem('protected_calls', '0');
                    const protectedData = await apiClient.get('/protected');
                    addResult(`   âœ… Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø­ÙØ§Ø¸Øª Ø´Ø¯Ù‡: ${protectedData.message}`, 'success');
                } catch (error) {
                    addResult(`   âŒ Ø®Ø·Ø§ Ø¯Ø± Ù…Ø¯ÛŒØ±ÛŒØª ØªÙˆÚ©Ù†: ${error.message}`, 'error');
                }
                
                // 4. ØªØ³Øª retry Ø®ÙˆØ¯Ú©Ø§Ø± Ø±ÙˆÛŒ Ø®Ø·Ø§ÛŒ Ø³Ø±ÙˆØ±
                addResult('4. ØªØ³Øª Retry Ø®ÙˆØ¯Ú©Ø§Ø± Ø±ÙˆÛŒ Ø®Ø·Ø§ÛŒ 500', 'info');
                try {
                    sessionStorage.setItem('error_calls', '0');
                    const result = await apiClient.get('/error');
                    addResult(`   âœ… Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø³ Ø§Ø² retry: ${result.message}`, 'success');
                } catch (error) {
                    addResult(`   âŒ Ø®Ø·Ø§ Ø¯Ø± retry: ${error.message}`, 'error');
                }
                
                // 5. ØªØ³Øª Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†
                addResult('5. ØªØ³Øª Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†', 'info');
                try {
                    const originalOnline = navigator.onLine;
                    Object.defineProperty(navigator, 'onLine', { value: false, writable: true });
                    
                    const queued = await apiClient.post('/lessons', { title: 'Ø¯Ø±Ø³ Ø¢ÙÙ„Ø§ÛŒÙ†' });
                    addResult(`   âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± ØµÙ Ø¢ÙÙ„Ø§ÛŒÙ† Ù‚Ø±Ø§Ø± Ú¯Ø±ÙØª: ${queued.queueId}`, 'success');
                    
                    // Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø­Ø§Ù„Øª Ø¢Ù†Ù„Ø§ÛŒÙ†
                    Object.defineProperty(navigator, 'onLine', { value: originalOnline, writable: true });
                } catch (error) {
                    addResult(`   âŒ Ø®Ø·Ø§ Ø¯Ø± Ø­Ø§Ù„Øª Ø¢ÙÙ„Ø§ÛŒÙ†: ${error.message}`, 'error');
                }
                
                // 6. ØªØ³Øª Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡
                addResult('6. ØªØ³Øª Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡', 'info');
                try {
                    sessionStorage.setItem('simulateNetworkError', 'true');
                    await apiClient.get('/test');
                    addResult(`   âŒ Ø§Ù†ØªØ¸Ø§Ø± Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¨ÙˆØ¯ Ø§Ù…Ø§ Ù…ÙˆÙÙ‚ Ø´Ø¯!`, 'error');
                } catch (error) {
                    if (error instanceof TypeError) {
                        addResult(`   âœ… Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø´Ø¯`, 'success');
                    } else {
                        addResult(`   âŒ Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡: ${error.message}`, 'error');
                    }
                } finally {
                    sessionStorage.removeItem('simulateNetworkError');
                }
                
                // 7. ØªØ³Øª timeout
                addResult('7. ØªØ³Øª Ù¾Ø§Ø³Ø® Ú©Ù†Ø¯ (timeout)', 'info');
                try {
                    const startTime = Date.now();
                    const result = await apiClient.get('/slow');
                    const duration = Date.now() - startTime;
                    addResult(`   âœ… Ù¾Ø§Ø³Ø® Ú©Ù†Ø¯ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯ (${duration}ms): ${result.message}`, 'success');
                } catch (error) {
                    addResult(`   âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø® Ú©Ù†Ø¯: ${error.message}`, 'error');
                }
                
                // Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ
                addResult(`\nğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ù†Ù‡Ø§ÛŒÛŒ:`, 'info');
                addResult(`   â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ: ${fetchCallCount}`, 'info');
                addResult(`   â€¢ ØªÙˆÚ©Ù† ÙØ¹Ù„ÛŒ: ${mockDependencies.authManager.getToken()?.substring(0, 20)}...`, 'info');
                addResult(`\nğŸ‰ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù†Ø¯!`, 'success');
                
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø§ÛŒ Ú©Ù„ÛŒ Ø¯Ø± ØªØ³Øª: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        async function runQuickTest() {
            clearResults();
            addResult('âš¡ ØªØ³Øª Ø³Ø±ÛŒØ¹ API Client', 'info');
            
            try {
                const apiClient = new APIClient(mockDependencies);
                addResult('âœ… Ù†Ù…ÙˆÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÙˆÙÙ‚', 'success');
                
                // ØªØ³Øª Ø³Ø§Ø¯Ù‡ GET
                const result = await apiClient.get('/lessons', { test: 'quick' });
                addResult(`âœ… GET Ù…ÙˆÙÙ‚: ${JSON.stringify(result).substring(0, 100)}...`, 'success');
                
                // ØªØ³Øª Ø³Ø§Ø¯Ù‡ POST
                const postResult = await apiClient.post('/test', { quick: 'test' });
                addResult(`âœ… POST Ù…ÙˆÙÙ‚: ${JSON.stringify(postResult)}`, 'success');
                
                addResult('âœ… ØªØ³Øª Ø³Ø±ÛŒØ¹ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
                
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª Ø³Ø±ÛŒØ¹: ${error.message}`, 'error');
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            fetchCallCount = 0;
            sessionStorage.removeItem('protected_calls');
            sessionStorage.removeItem('error_calls');
            sessionStorage.removeItem('simulateNetworkError');
        }
        
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type === 'success' ? 'success' : 
                           type === 'error' ? 'error' : 
                           'test-case';
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }
    </script>
</body>
</html>
