<!DOCTYPE html>
<html>
<head>
    <title>ØªØ³Øª ÙÙˆÙ‚ Ø³Ø§Ø¯Ù‡</title>
    <style>
        body { 
            font-family: Tahoma; 
            padding: 20px;
            text-align: center;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px;
        }
        button:hover {
            background: #45a049;
        }
        #result {
            margin: 20px;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            min-height: 100px;
            font-family: monospace;
            text-align: left;
            background: #f9f9f9;
        }
        .success { color: green; }
        .error { color: red; }
        .step {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #2196F3;
            background: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª ØªØ³Øª Ø³ÛŒØ³ØªÙ… Vakamova</h1>
    <p>ÙØ§Ø² Û±: ØªØ³Øª EventBus Ø³Ø§Ø¯Ù‡</p>
    
    <button onclick="runSimpleTest()">Ø´Ø±ÙˆØ¹ ØªØ³Øª (Ú©Ù„ÛŒÚ© Ú©Ù†)</button>
    
    <div id="result">
        Ù…Ù†ØªØ¸Ø± Ø´Ø±ÙˆØ¹ ØªØ³Øª...
    </div>

    <script>
        // ==================== Û±. Ø§Ø¨ØªØ¯Ø§ Ø¨Ø¨ÛŒÙ†ÛŒÙ… Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯ ====================
        function log(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            const time = new Date().toLocaleTimeString();
            
            resultDiv.innerHTML += `
                <div class="step" style="border-left-color: ${color}">
                    <strong>[${time}]</strong> ${message}
                </div>
            `;
            
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
            resultDiv.scrollTop = resultDiv.scrollHeight;
            
            // Ù‡Ù…Ú†Ù†ÛŒÙ† Ø¯Ø± Ú©Ù†Ø³ÙˆÙ„ Ù‡Ù… Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // ==================== Û². EventBus Ø®ÛŒÙ„ÛŒ Ø³Ø§Ø¯Ù‡ ====================
        class SimpleEventBus {
            constructor() {
                this.listeners = {};
                log("âœ… EventBus Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯", "success");
            }
            
            on(eventName, callback) {
                if (!this.listeners[eventName]) {
                    this.listeners[eventName] = [];
                }
                this.listeners[eventName].push(callback);
                log(`ğŸ“ Ø«Ø¨Øª listener Ø¨Ø±Ø§ÛŒ Ø±ÙˆÛŒØ¯Ø§Ø¯: <strong>${eventName}</strong>`);
                
                // ØªØ§Ø¨Ø¹ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù listener
                return () => {
                    this.off(eventName, callback);
                };
            }
            
            off(eventName, callback) {
                if (this.listeners[eventName]) {
                    this.listeners[eventName] = this.listeners[eventName].filter(
                        cb => cb !== callback
                    );
                    log(`ğŸ—‘ï¸ Ø­Ø°Ù listener Ø¨Ø±Ø§ÛŒ: ${eventName}`);
                }
            }
            
            emit(eventName, data) {
                log(`ğŸš€ Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯: <strong>${eventName}</strong> Ø¨Ø§ Ø¯Ø§Ø¯Ù‡: ${JSON.stringify(data)}`);
                
                if (this.listeners[eventName]) {
                    this.listeners[eventName].forEach(callback => {
                        try {
                            callback(data);
                        } catch (error) {
                            log(`âŒ Ø®Ø·Ø§ Ø¯Ø± listener: ${error.message}`, "error");
                        }
                    });
                }
            }
        }
        
        // ==================== Û³. ØªØ³Øª Ø§ØµÙ„ÛŒ ====================
        function runSimpleTest() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<h3>Ø´Ø±ÙˆØ¹ ØªØ³Øª...</h3>';
            
            log("ğŸ¬ ØªØ³Øª Ø´Ø±ÙˆØ¹ Ø´Ø¯!", "success");
            
            try {
                // Û±. Ø³Ø§Ø®Øª EventBus
                log("Ù…Ø±Ø­Ù„Ù‡ Û±: Ø³Ø§Ø®Øª EventBus...");
                const eventBus = new SimpleEventBus();
                
                // Û². Ø³Ø§Ø®Øª Ú†Ù†Ø¯ listener
                log("Ù…Ø±Ø­Ù„Ù‡ Û²: Ø³Ø§Ø®Øª listenerâ€ŒÙ‡Ø§...");
                
                const loginListener = (userData) => {
                    log(`ğŸ“© Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯: ${userData.email}`, "success");
                };
                
                const logoutListener = () => {
                    log("ğŸ“© Ú©Ø§Ø±Ø¨Ø± Ø®Ø§Ø±Ø¬ Ø´Ø¯", "warning");
                };
                
                const errorListener = (error) => {
                    log(`ğŸ“© Ø®Ø·Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯: ${error.message}`, "error");
                };
                
                // Û³. Ø«Ø¨Øª listenerâ€ŒÙ‡Ø§
                log("Ù…Ø±Ø­Ù„Ù‡ Û³: Ø«Ø¨Øª listenerâ€ŒÙ‡Ø§...");
                const removeLoginListener = eventBus.on('user.login', loginListener);
                eventBus.on('user.logout', logoutListener);
                eventBus.on('system.error', errorListener);
                
                // Û´. Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§
                log("Ù…Ø±Ø­Ù„Ù‡ Û´: Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§...");
                
                // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø§ÙˆÙ„
                setTimeout(() => {
                    eventBus.emit('user.login', {
                        email: 'test@vakamova.com',
                        userId: 'user_123'
                    });
                }, 1000);
                
                // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¯ÙˆÙ…
                setTimeout(() => {
                    eventBus.emit('system.error', {
                        message: 'Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ± Ù‚Ø·Ø¹ Ø´Ø¯',
                        code: 'NETWORK_ERROR'
                    });
                }, 2000);
                
                // Ø­Ø°Ù ÛŒÚ© listener
                setTimeout(() => {
                    log("Ù…Ø±Ø­Ù„Ù‡ Ûµ: Ø­Ø°Ù ÛŒÚ©ÛŒ Ø§Ø² listenerâ€ŒÙ‡Ø§...");
                    removeLoginListener();
                }, 2500);
                
                // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø³ÙˆÙ… (Ø¨Ø§ÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´ÙˆØ¯)
                setTimeout(() => {
                    eventBus.emit('user.login', {
                        email: 'another@test.com'
                    });
                    log("âš ï¸ Ø§ÛŒÙ† Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø¨Ø§ÛŒØ¯ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´ÙˆØ¯ (listener Ø­Ø°Ù Ø´Ø¯Ù‡)");
                }, 3000);
                
                // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ú†Ù‡Ø§Ø±Ù…
                setTimeout(() => {
                    eventBus.emit('user.logout', {});
                }, 3500);
                
                // Ù†ØªÛŒØ¬Ù‡ Ù†Ù‡Ø§ÛŒÛŒ
                setTimeout(() => {
                    log("=".repeat(50));
                    log("ğŸ‰ ØªØ³Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!", "success");
                    log("âœ… EventBus Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯");
                    log("âœ… Listenerâ€ŒÙ‡Ø§ Ø«Ø¨Øª Ùˆ Ø­Ø°Ù Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯");
                    log("âœ… Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ù…Ù†ØªØ´Ø± Ùˆ Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯");
                }, 4000);
                
            } catch (error) {
                log(`âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ³Øª: ${error.message}`, "error");
                console.error("Test error:", error);
            }
        }
        
        // ==================== Û´. ØªØ³Øª Ø§ÙˆÙ„ÛŒÙ‡ Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ ØµÙØ­Ù‡ ====================
        window.onload = function() {
            log("ğŸ“± ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯", "success");
            log("Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ 'Ø´Ø±ÙˆØ¹ ØªØ³Øª' Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯");
            
            // ØªØ³Øª Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ú©Ø§Ø±Ú©Ø±Ø¯ Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª
            setTimeout(() => {
                log("âœ… Ø¬Ø§ÙˆØ§Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ÙØ¹Ø§Ù„ Ø§Ø³Øª", "success");
            }, 500);
        };
    </script>
</body>
</html>
