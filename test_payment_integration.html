<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>ØªØ³Øª Integration Ù¾Ø±Ø¯Ø§Ø®Øª - Vakamova</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
            margin: 0;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 16px;
        }
        
        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .flow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 100px;
        }
        
        .step-icon {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 10px;
            border: 3px solid #e2e8f0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .step-active { border-color: #4f46e5; background: #4f46e5; color: white; }
        .step-success { border-color: #10b981; background: #10b981; color: white; }
        .step-error { border-color: #ef4444; background: #ef4444; color: white; }
        
        .arrow {
            font-size: 24px;
            color: #94a3b8;
        }
        
        .test-section {
            background: white;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }
        
        .test-title {
            color: #2c3e50;
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-description {
            color: #5d6d7e;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .test-scenario {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4f46e5;
        }
        
        button {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(79, 70, 229, 0.3);
        }
        
        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .success {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 2px solid #10b981;
            display: block;
        }
        
        .error {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #ef4444;
            display: block;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .transaction-details {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            direction: ltr;
            text-align: left;
        }
        
        .action-bar {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .flow-diagram { flex-direction: column; }
            .arrow { transform: rotate(90deg); }
            .container { padding: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’° ØªØ³Øª Integration Ù¾Ø±Ø¯Ø§Ø®Øª - Vakamova</h1>
        <div class="subtitle">ØªØ³Øª Ú©Ø§Ù…Ù„ Flow Ø®Ø±ÛŒØ¯ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ ØªØ§ ØªØ£ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ</div>
        
        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">ÙˆØ¶Ø¹ÛŒØª ØªØ³Øª</div>
                <div class="stat-value" id="test-status">Ø¢Ù…Ø§Ø¯Ù‡</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ØªØ¹Ø¯Ø§Ø¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§</div>
                <div class="stat-value" id="transaction-count">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ù…ÙˆÙÙ‚ÛŒØª</div>
                <div class="stat-value" id="success-rate">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Ø²Ù…Ø§Ù† Ú©Ù„</div>
                <div class="stat-value" id="total-time">0ms</div>
            </div>
        </div>
        
        <div class="flow-diagram">
            <div class="flow-step">
                <div class="step-icon" id="step1">1ï¸âƒ£</div>
                <div>Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù†</div>
            </div>
            <div class="arrow">â†’</div>
            <div class="flow-step">
                <div class="step-icon" id="step2">2ï¸âƒ£</div>
                <div>Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª</div>
            </div>
            <div class="arrow">â†’</div>
            <div class="flow-step">
                <div class="step-icon" id="step3">3ï¸âƒ£</div>
                <div>Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡</div>
            </div>
            <div class="arrow">â†’</div>
            <div class="flow-step">
                <div class="step-icon" id="step4">4ï¸âƒ£</div>
                <div>ØªØ£ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª</div>
            </div>
            <div class="arrow">â†’</div>
            <div class="flow-step">
                <div class="step-icon" id="step5">5ï¸âƒ£</div>
                <div>ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ù„Ù†</div>
            </div>
        </div>
        
        <div class="test-section">
            <div class="test-title">
                <span>ğŸ“‹ Ø³Ù†Ø§Ø±ÛŒÙˆ 1: Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚</span>
            </div>
            <div class="test-description">
                Ú©Ø§Ø±Ø¨Ø± Ù¾Ù„Ù† Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù¾Ù„Ù† ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø¯.
            </div>
            <div class="test-scenario">
                <strong>Ù…Ø±Ø§Ø­Ù„:</strong><br>
                1. Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù† Ù…Ø§Ù‡Ø§Ù†Ù‡ (49,000 ØªÙˆÙ…Ø§Ù†)<br>
                2. Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª<br>
                3. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„ (Mock)<br>
                4. Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡<br>
                5. ØªØ£ÛŒÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ø³Ø±ÙˆØ±<br>
                6. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ù„Ù† Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
            </div>
            <button onclick="runSuccessfulPayment()">Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚</button>
            <div id="result1" class="result"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">
                <span>âš ï¸ Ø³Ù†Ø§Ø±ÛŒÙˆ 2: Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚ (Ø®Ø·Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡)</span>
            </div>
            <div class="test-description">
                Ú©Ø§Ø±Ø¨Ø± Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ Ø§Ù…Ø§ Ø¯Ø±Ú¯Ø§Ù‡ Ø®Ø·Ø§ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯. Ø³ÛŒØ³ØªÙ… Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ø¯.
            </div>
            <div class="test-scenario">
                <strong>Ù…Ø±Ø§Ø­Ù„:</strong><br>
                1. Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù† Ø³Ø§Ù„Ø§Ù†Ù‡ (490,000 ØªÙˆÙ…Ø§Ù†)<br>
                2. Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª<br>
                3. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡<br>
                4. Ø®Ø·Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡ (Ø´Ø¨Ú©Ù‡ ÛŒØ§ Ø¨Ø§Ù†Ú©)<br>
                5. Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø§Ù¾ Ø¨Ø§ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§<br>
                6. Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
            </div>
            <button onclick="runFailedPayment()">Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚</button>
            <div id="result2" class="result"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">
                <span>ğŸ”„ Ø³Ù†Ø§Ø±ÛŒÙˆ 3: Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</span>
            </div>
            <div class="test-description">
                Ú©Ø§Ø±Ø¨Ø± Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¯Ø§Ø±Ø¯ØŒ Ø³Ù¾Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
            </div>
            <div class="test-scenario">
                <strong>Ù…Ø±Ø§Ø­Ù„:</strong><br>
                1. Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù† (Ø®Ø·Ø§ Ø¯Ø± Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø®Øª)<br>
                2. Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§<br>
                3. ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ ØªÙˆØ³Ø· Ú©Ø§Ø±Ø¨Ø±<br>
                4. Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ Ø¯Ø± ØªÙ„Ø§Ø´ Ø¯ÙˆÙ…<br>
                5. ØªØ£ÛŒÛŒØ¯ Ùˆ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ
            </div>
            <button onclick="runRetryPayment()">Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
            <div id="result3" class="result"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">
                <span>ğŸ“Š Ø³Ù†Ø§Ø±ÛŒÙˆ 4: ØªØ³Øª Performance Ùˆ Load</span>
            </div>
            <div class="test-description">
                Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ú†Ù†Ø¯ÛŒÙ† Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ùˆ Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø³ÛŒØ³ØªÙ….
            </div>
            <div class="test-scenario">
                <strong>Ù…Ø±Ø§Ø­Ù„:</strong><br>
                1. Ûµ Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ù…Ø²Ù…Ø§Ù†<br>
                2. Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø®<br>
                3. Ø¨Ø±Ø±Ø³ÛŒ ØªØ¯Ø§Ø®Ù„ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§<br>
                4. Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÛŒÚ©ØªØ§ÛŒÛŒ Ø´Ù†Ø§Ø³Ù‡â€ŒÙ‡Ø§
            </div>
            <button onclick="runLoadTest()">Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Performance</button>
            <div id="result4" class="result"></div>
        </div>
        
        <div class="action-bar">
            <button onclick="runAllScenarios()" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); padding: 15px 30px;">
                ğŸš€ Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§
            </button>
            <button onclick="resetAllTests()" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); padding: 15px 30px;">
                ğŸ”„ Ø±ÛŒØ³Øª Ù‡Ù…Ù‡ ØªØ³Øªâ€ŒÙ‡Ø§
            </button>
        </div>
        
        <div class="transaction-details" id="transaction-log">
            <div>ğŸ“‹ Ù„Ø§Ú¯ ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§:</div>
            <div id="log-output"></div>
        </div>
    </div>

    <script>
        // ========== Payment Integration System ==========
        class PaymentIntegrationSystem {
            constructor() {
                this.transactions = new Map();
                this.paymentAdapter = new MockZarinpalAdapter();
                this.paymentManager = new PaymentManager(this.paymentAdapter, new MockEventBus(), new MockLogger());
                this.testStartTime = null;
                this.completedTests = 0;
                this.successfulTests = 0;
                this.totalTransactions = 0;
            }
            
            async processSuccessfulPayment(userId, planType) {
                this.updateStep(1);
                await this.delay(300);
                
                // 1. Ø§Ù†ØªØ®Ø§Ø¨ Ù¾Ù„Ù†
                const plan = this.getPlanDetails(planType);
                this.log(`ğŸ“ Ú©Ø§Ø±Ø¨Ø± ${userId} Ù¾Ù„Ù† ${plan.name} Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯ (${plan.price.toLocaleString()} ØªÙˆÙ…Ø§Ù†)`);
                
                this.updateStep(2);
                await this.delay(400);
                
                // 2. Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª
                const paymentRequest = {
                    id: `PAY_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                    amount: plan.price,
                    currency: 'IRR',
                    userId: userId,
                    planId: plan.id,
                    description: `Ø®Ø±ÛŒØ¯ Ù¾Ù„Ù† ${plan.name} - Vakamova`,
                    metadata: {
                        planType: planType,
                        features: plan.features,
                        duration: plan.duration
                    }
                };
                
                this.log(`ğŸ’³ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª: ${paymentRequest.id}`);
                
                this.updateStep(3);
                await this.delay(500);
                
                // 3. Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ (Mock)
                this.log(`ğŸ”— Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„...`);
                const gatewayResponse = await this.paymentAdapter.initiateGateway(paymentRequest);
                
                this.updateStep(4);
                await this.delay(600);
                
                // 4. Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡ (Ù…ÙˆÙÙ‚)
                this.log(`âœ… Ø¨Ø§Ø²Ú¯Ø´Øª Ù…ÙˆÙÙ‚ Ø§Ø² Ø¯Ø±Ú¯Ø§Ù‡`);
                const verification = await this.paymentAdapter.verifyGateway(gatewayResponse.authority);
                
                this.updateStep(5);
                await this.delay(400);
                
                // 5. ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ù„Ù†
                const activationResult = await this.activateUserPlan(userId, plan.id, paymentRequest.id);
                
                this.resetSteps();
                
                return {
                    success: true,
                    transactionId: paymentRequest.id,
                    gatewayRef: gatewayResponse.authority,
                    amount: paymentRequest.amount,
                    plan: plan.name,
                    activation: activationResult
                };
            }
            
            async processFailedPayment(userId, planType, errorType = 'gateway_error') {
                this.updateStep(1);
                await this.delay(300);
                
                const plan = this.getPlanDetails(planType);
                this.log(`ğŸ“ Ú©Ø§Ø±Ø¨Ø± ${userId} Ù¾Ù„Ù† ${plan.name} Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯`);
                
                this.updateStep(2);
                await this.delay(400);
                
                const paymentRequest = {
                    id: `PAY_FAIL_${Date.now()}`,
                    amount: plan.price,
                    currency: 'IRR',
                    userId: userId
                };
                
                this.log(`ğŸ’³ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª: ${paymentRequest.id}`);
                
                this.updateStep(3);
                await this.delay(500);
                
                // Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø®Ø·Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡
                this.log(`âŒ Ø®Ø·Ø§ÛŒ Ø¯Ø±Ú¯Ø§Ù‡: ${errorType}`);
                
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø§Ù¾ Ø¨Ø§ Ø®Ø·Ø§
                const errorResponse = this.getGatewayError(errorType);
                
                this.resetSteps();
                
                return {
                    success: false,
                    transactionId: paymentRequest.id,
                    error: errorResponse.message,
                    errorCode: errorResponse.code,
                    userMessage: errorResponse.userMessage,
                    canRetry: errorResponse.canRetry
                };
            }
            
            async processRetryPayment(userId, planType) {
                this.log(`ğŸ”„ Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯`);
                
                // ØªÙ„Ø§Ø´ Ø§ÙˆÙ„ - Ù†Ø§Ù…ÙˆÙÙ‚
                const firstAttempt = await this.processFailedPayment(userId, planType, 'bank_error');
                
                await this.delay(1000);
                
                this.log(`ğŸ”„ Ú©Ø§Ø±Ø¨Ø± ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯...`);
                
                // ØªÙ„Ø§Ø´ Ø¯ÙˆÙ… - Ù…ÙˆÙÙ‚
                const secondAttempt = await this.processSuccessfulPayment(userId, planType);
                
                return {
                    firstAttempt,
                    secondAttempt,
                    retrySuccessful: true
                };
            }
            
            async runLoadTest(concurrentUsers = 5) {
                this.log(`ğŸ“Š Ø´Ø±ÙˆØ¹ ØªØ³Øª Load Ø¨Ø§ ${concurrentUsers} Ú©Ø§Ø±Ø¨Ø± Ù‡Ù…Ø²Ù…Ø§Ù†`);
                
                const startTime = Date.now();
                const promises = [];
                
                for (let i = 1; i <= concurrentUsers; i++) {
                    const userId = `USER_LOAD_${i}`;
                    const planType = i % 2 === 0 ? 'monthly' : 'yearly';
                    
                    promises.push(
                        this.processSuccessfulPayment(userId, planType)
                            .then(result => ({ success: true, userId, result }))
                            .catch(error => ({ success: false, userId, error }))
                    );
                    
                    await this.delay(100); // ÙØ§ØµÙ„Ù‡ Ø¨ÛŒÙ† Ø´Ø±ÙˆØ¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
                }
                
                const results = await Promise.all(promises);
                const totalTime = Date.now() - startTime;
                
                const successful = results.filter(r => r.success).length;
                const failed = results.filter(r => !r.success).length;
                
                return {
                    totalTime,
                    concurrentUsers,
                    successful,
                    failed,
                    successRate: Math.round((successful / concurrentUsers) * 100),
                    results
                };
            }
            
            getPlanDetails(planType) {
                const plans = {
                    monthly: {
                        id: 'plan_monthly',
                        name: 'Ù…Ø§Ù‡Ø§Ù†Ù‡',
                        price: 49000,
                        duration: '30 Ø±ÙˆØ²',
                        features: ['Û±Û² Ø²Ø¨Ø§Ù†', 'ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡', 'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ']
                    },
                    yearly: {
                        id: 'plan_yearly',
                        name: 'Ø³Ø§Ù„Ø§Ù†Ù‡',
                        price: 490000,
                        duration: 'Û³Û¶Ûµ Ø±ÙˆØ²',
                        features: ['Û±Û² Ø²Ø¨Ø§Ù†', 'ØªÙ…Ø±ÛŒÙ† Ø±ÙˆØ²Ø§Ù†Ù‡', 'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ', 'ÛµÛ°Ùª ØªØ®ÙÛŒÙ']
                    },
                    lifetime: {
                        id: 'plan_lifetime',
                        name: 'Ù…Ø§Ø¯Ø§Ù…â€ŒØ§Ù„Ø¹Ù…Ø±',
                        price: 1490000,
                        duration: 'Ù…Ø§Ø¯Ø§Ù…â€ŒØ§Ù„Ø¹Ù…Ø±',
                        features: ['Û±Û² Ø²Ø¨Ø§Ù†', 'Ù‡Ù…Ù‡ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§', 'Ø¢Ù¾Ø¯ÛŒØª Ø±Ø§ÛŒÚ¯Ø§Ù†', 'Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ VIP']
                    }
                };
                
                return plans[planType] || plans.monthly;
            }
            
            getGatewayError(errorType) {
                const errors = {
                    gateway_error: {
                        code: 'GATEWAY_001',
                        message: 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª',
                        userMessage: 'Ø¯Ø±Ú¯Ø§Ù‡ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙ‚ØªØ§Ù‹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯Ù‚Ø§ÛŒÙ‚ÛŒ Ø¯ÛŒÚ¯Ø± ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.',
                        canRetry: true
                    },
                    bank_error: {
                        code: 'BANK_002',
                        message: 'Ø®Ø·Ø§ÛŒ Ø¨Ø§Ù†Ú© ØµØ§Ø¯Ø±Ú©Ù†Ù†Ø¯Ù‡ Ú©Ø§Ø±Øª',
                        userMessage: 'Ø¨Ø§Ù†Ú© Ø´Ù…Ø§ Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ù†Ú©Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø¨Ø§Ù†Ú© Ø®ÙˆØ¯ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.',
                        canRetry: true
                    },
                    insufficient_funds: {
                        code: 'FUNDS_003',
                        message: 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª',
                        userMessage: 'Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø­Ø³Ø§Ø¨ Ø´Ù…Ø§ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† ØªØ±Ø§Ú©Ù†Ø´ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª.',
                        canRetry: false
                    },
                    timeout: {
                        code: 'TIMEOUT_004',
                        message: 'Ø²Ù…Ø§Ù† Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯',
                        userMessage: 'Ø²Ù…Ø§Ù† Ø§Ù†Ø¬Ø§Ù… ØªØ±Ø§Ú©Ù†Ø´ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯. Ù„Ø·ÙØ§Ù‹ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.',
                        canRetry: true
                    }
                };
                
                return errors[errorType] || errors.gateway_error;
            }
            
            async activateUserPlan(userId, planId, transactionId) {
                this.log(`ğŸ‰ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ù„Ù† Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± ${userId}`);
                await this.delay(300);
                
                return {
                    success: true,
                    userId,
                    planId,
                    transactionId,
                    activatedAt: new Date().toISOString(),
                    expiresAt: this.calculateExpiryDate(planId),
                    features: this.getPlanDetails(planId.includes('monthly') ? 'monthly' : 'yearly').features
                };
            }
            
            calculateExpiryDate(planId) {
                const now = new Date();
                if (planId.includes('monthly')) {
                    now.setMonth(now.getMonth() + 1);
                } else if (planId.includes('yearly')) {
                    now.setFullYear(now.getFullYear() + 1);
                } else {
                    now.setFullYear(now.getFullYear() + 100); // Ù…Ø§Ø¯Ø§Ù…â€ŒØ§Ù„Ø¹Ù…Ø±
                }
                return now.toISOString();
            }
            
            updateStep(stepNumber) {
                for (let i = 1; i <= 5; i++) {
                    const step = document.getElementById(`step${i}`);
                    if (step) {
                        step.className = 'step-icon';
                    }
                }
                
                const currentStep = document.getElementById(`step${stepNumber}`);
                if (currentStep) {
                    currentStep.className = 'step-icon step-active';
                }
            }
            
            resetSteps() {
                for (let i = 1; i <= 5; i++) {
                    const step = document.getElementById(`step${i}`);
                    if (step) {
                        step.className = 'step-icon';
                    }
                }
            }
            
            log(message) {
                const time = new Date().toLocaleTimeString('fa-IR');
                const logOutput = document.getElementById('log-output');
                const logEntry = document.createElement('div');
                logEntry.style.padding = '5px 0';
                logEntry.style.borderBottom = '1px solid #334155';
                logEntry.innerHTML = `<span style="color: #94a3b8">[${time}]</span> ${message}`;
                logOutput.appendChild(logEntry);
                logOutput.scrollTop = logOutput.scrollHeight;
                console.log(message);
            }
            
            updateStats(success = true) {
                this.completedTests++;
                if (success) this.successfulTests++;
                
                const successRate = this.completedTests > 0 
                    ? Math.round((this.successfulTests / this.completedTests) * 100) 
                    : 0;
                
                document.getElementById('success-rate').textContent = `${successRate}%`;
                
                if (this.testStartTime) {
                    const totalTime = Date.now() - this.testStartTime;
                    document.getElementById('total-time').textContent = `${totalTime}ms`;
                }
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ========== Mock Zarinpal Adapter ==========
        class MockZarinpalAdapter {
            async initiateGateway(request) {
                await this.delay(500);
                return {
                    success: true,
                    authority: `A${Date.now()}${Math.random().toString(36).substr(2, 10)}`,
                    gatewayUrl: 'https://zarinpal.com/pg/StartPay/' + Date.now(),
                    amount: request.amount,
                    description: request.description
                };
            }
            
            async verifyGateway(authority) {
                await this.delay(400);
                return {
                    success: true,
                    refId: Date.now(),
                    authority: authority,
                    transactionDate: new Date().toISOString(),
                    cardPan: '6219******1234'
                };
            }
            
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ========== Mock Payment Manager (Ø§Ø² ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ) ==========
        class PaymentManager {
            constructor(adapter, eventBus, logger) {
                this._adapter = adapter;
                this._eventBus = eventBus;
                this._logger = logger;
            }
            
            async initiatePayment(request) {
                return {
                    success: true,
                    transactionId: request.id,
                    gatewayReference: `GREF_${Date.now()}`
                };
            }
        }

        class MockEventBus {
            emit(event, data) {
                console.log(`Event: ${event}`, data);
            }
        }

        class MockLogger {
            info(msg, data) { console.log(`INFO: ${msg}`, data); }
            error(msg, data) { console.error(`ERROR: ${msg}`, data); }
        }

        // ========== Global System ==========
        const paymentSystem = new PaymentIntegrationSystem();
        
        // ========== Test Functions ==========
        async function runSuccessfulPayment() {
            const btn = event.target;
            const resultDiv = document.getElementById('result1');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            
            paymentSystem.testStartTime = Date.now();
            
            try {
                const result = await paymentSystem.processSuccessfulPayment('USER_001', 'monthly');
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ Ú©Ø§Ù…Ù„ Ø´Ø¯!</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ Ø´Ù†Ø§Ø³Ù‡ ØªØ±Ø§Ú©Ù†Ø´: ${result.transactionId}<br>
                    â€¢ Ù…Ø¨Ù„Øº: ${result.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
                    â€¢ Ù¾Ù„Ù†: ${result.plan}<br>
                    â€¢ Ù…Ø±Ø¬Ø¹ Ø¯Ø±Ú¯Ø§Ù‡: ${result.gatewayRef}<br>
                    â€¢ ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ: ${result.activation.success ? 'Ù…ÙˆÙÙ‚' : 'Ù†Ø§Ù…ÙˆÙÙ‚'}<br><br>
                    <small>âœ… ØªÙ…Ø§Ù… Ù…Ø±Ø§Ø­Ù„ Flow Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯.</small>
                `;
                
                paymentSystem.updateStats(true);
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}<br>
                    <small>Ù…Ø´Ú©Ù„ Ø¯Ø± ÙØ±Ø¢ÛŒÙ†Ø¯ Ù¾Ø±Ø¯Ø§Ø®Øª</small>
                `;
                
                paymentSystem.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚';
        }
        
        async function runFailedPayment() {
            const btn = event.target;
            const resultDiv = document.getElementById('result2');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            
            try {
                const result = await paymentSystem.processFailedPayment('USER_002', 'yearly', 'bank_error');
                
                resultDiv.className = result.success ? 'result success' : 'result error';
                resultDiv.innerHTML = `
                    <strong>${result.success ? 'âœ…' : 'âŒ'} Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ Ø´Ù†Ø§Ø³Ù‡ ØªØ±Ø§Ú©Ù†Ø´: ${result.transactionId}<br>
                    â€¢ Ú©Ø¯ Ø®Ø·Ø§: ${result.errorCode}<br>
                    â€¢ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§: ${result.error}<br>
                    â€¢ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø±: ${result.userMessage}<br>
                    â€¢ Ù‚Ø§Ø¨Ù„ÛŒØª ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯: ${result.canRetry ? 'âœ… Ø¯Ø§Ø±Ø¯' : 'âŒ Ù†Ø¯Ø§Ø±Ø¯'}<br><br>
                    <small>${result.canRetry ? 'âœ… Ø³ÛŒØ³ØªÙ… Ø®Ø·Ø§ Ø±Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø±Ø¯' : 'âš ï¸ Ú©Ø§Ø±Ø¨Ø± Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ø¬Ø¯Ø¯ ØªÙ„Ø§Ø´ Ú©Ù†Ø¯'}</small>
                `;
                
                paymentSystem.updateStats(result.canRetry);
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ ØªØ³Øª Ø®Ø·Ø§ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}
                `;
                
                paymentSystem.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚';
        }
        
        async function runRetryPayment() {
            const btn = event.target;
            const resultDiv = document.getElementById('result3');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            
            try {
                const result = await paymentSystem.processRetryPayment('USER_003', 'monthly');
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯ Ú©Ø§Ù…Ù„ Ø´Ø¯!</strong><br><br>
                    <strong>ØªÙ„Ø§Ø´ Ø§ÙˆÙ„ (Ù†Ø§Ù…ÙˆÙÙ‚):</strong><br>
                    â€¢ Ú©Ø¯ Ø®Ø·Ø§: ${result.firstAttempt.errorCode}<br>
                    â€¢ Ù¾ÛŒØ§Ù…: ${result.firstAttempt.userMessage}<br><br>
                    
                    <strong>ØªÙ„Ø§Ø´ Ø¯ÙˆÙ… (Ù…ÙˆÙÙ‚):</strong><br>
                    â€¢ Ø´Ù†Ø§Ø³Ù‡ ØªØ±Ø§Ú©Ù†Ø´: ${result.secondAttempt.transactionId}<br>
                    â€¢ Ù…Ø¨Ù„Øº: ${result.secondAttempt.amount.toLocaleString()} ØªÙˆÙ…Ø§Ù†<br>
                    â€¢ Ù¾Ù„Ù†: ${result.secondAttempt.plan}<br><br>
                    
                    <small>âœ… Ø³ÛŒØ³ØªÙ… Retry Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¨Ù‡ Ø¯Ø±Ø³ØªÛŒ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</small>
                `;
                
                paymentSystem.updateStats(true);
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ ØªØ³Øª Retry Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}
                `;
                
                paymentSystem.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯';
        }
        
        async function runLoadTest() {
            const btn = event.target;
            const resultDiv = document.getElementById('result4');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§...';
            resultDiv.className = 'result';
            resultDiv.innerHTML = '';
            
            try {
                const result = await paymentSystem.runLoadTest(5);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <strong>âœ… ØªØ³Øª Load Ú©Ø§Ù…Ù„ Ø´Ø¯!</strong><br><br>
                    <strong>Ù†ØªØ§ÛŒØ¬:</strong><br>
                    â€¢ ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‡Ù…Ø²Ù…Ø§Ù†: ${result.concurrentUsers}<br>
                    â€¢ Ø²Ù…Ø§Ù† Ú©Ù„ Ø§Ø¬Ø±Ø§: ${result.totalTime}ms<br>
                    â€¢ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆÙÙ‚: ${result.successful}<br>
                    â€¢ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…ÙˆÙÙ‚: ${result.failed}<br>
                    â€¢ Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª: ${result.successRate}%<br>
                    â€¢ Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø²Ù…Ø§Ù† Ù‡Ø± Ù¾Ø±Ø¯Ø§Ø®Øª: ${Math.round(result.totalTime / result.concurrentUsers)}ms<br><br>
                    
                    <small>âœ… Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ${result.concurrentUsers} Ù¾Ø±Ø¯Ø§Ø®Øª Ù‡Ù…Ø²Ù…Ø§Ù† Ø±Ø§ Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ù†Ø¯.</small>
                `;
                
                paymentSystem.updateStats(result.successRate >= 80);
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>âŒ ØªØ³Øª Load Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯</strong><br><br>
                    Ø®Ø·Ø§: ${error.message}<br>
                    <small>Ù…Ø´Ú©Ù„ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù†</small>
                `;
                
                paymentSystem.updateStats(false);
            }
            
            btn.disabled = false;
            btn.textContent = 'Ø§Ø¬Ø±Ø§ÛŒ ØªØ³Øª Performance';
        }
        
        // ========== Control Functions ==========
        async function runAllScenarios() {
            paymentSystem.log('ğŸš€ Ø´Ø±ÙˆØ¹ Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª...');
            
            await runSuccessfulPaymentWrapper();
            await paymentSystem.delay(1000);
            
            await runFailedPaymentWrapper();
            await paymentSystem.delay(1000);
            
            await runRetryPaymentWrapper();
            await paymentSystem.delay(1000);
            
            await runLoadTestWrapper();
            
            paymentSystem.log('ğŸ¯ ØªÙ…Ø§Ù… Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø§Ù…Ù„ Ø´Ø¯Ù†Ø¯');
        }
        
        async function runSuccessfulPaymentWrapper() {
            const btn = document.querySelector('button[onclick="runSuccessfulPayment()"]');
            const event = { target: btn };
            await runSuccessfulPayment(event);
        }
        
        async function runFailedPaymentWrapper() {
            const btn = document.querySelector('button[onclick="runFailedPayment()"]');
            const event = { target: btn };
            await runFailedPayment(event);
        }
        
        async function runRetryPaymentWrapper() {
            const btn = document.querySelector('button[onclick="runRetryPayment()"]');
            const event = { target: btn };
            await runRetryPayment(event);
        }
        
        async function runLoadTestWrapper() {
            const btn = document.querySelector('button[onclick="runLoadTest()"]');
            const event = { target: btn };
            await runLoadTest(event);
        }
        
        function resetAllTests() {
            // Ø±ÛŒØ³Øª Ù…Ø±Ø§Ø­Ù„
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) step.className = 'step-icon';
            }
            
            // Ø±ÛŒØ³Øª Ù†ØªØ§ÛŒØ¬
            for (let i = 1; i <= 4; i++) {
                const resultDiv = document.getElementById(`result${i}`);
                if (resultDiv) {
                    resultDiv.className = 'result';
                    resultDiv.innerHTML = '';
                }
            }
            
            // Ø±ÛŒØ³Øª Ù„Ø§Ú¯
            document.getElementById('log-output').innerHTML = '';
            
            // Ø±ÛŒØ³Øª Ø¢Ù…Ø§Ø±
            document.getElementById('test-status').textContent = 'Ø¢Ù…Ø§Ø¯Ù‡';
            document.getElementById('success-rate').textContent = '0%';
            document.getElementById('total-time').textContent = '0ms';
            
            paymentSystem.log('â™»ï¸ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø±ÛŒØ³Øª Ø´Ø¯Ù†Ø¯');
        }

        // ========== Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ==========
        document.addEventListener('DOMContentLoaded', () => {
            paymentSystem.log('ğŸ’° Ø³ÛŒØ³ØªÙ… ØªØ³Øª Integration Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø¬Ø±Ø§');
            paymentSystem.log('âœ… Û´ Ø³Ù†Ø§Ø±ÛŒÙˆ Ø§ØµÙ„ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø¢Ù…Ø§Ø¯Ù‡ Ù‡Ø³ØªÙ†Ø¯');
        });
    </script>
</body>
</html>
